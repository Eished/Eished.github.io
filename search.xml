<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Webpack + TypeScript 开发油猴脚本：斗鱼直播自动切换画质2.0</title>
      <link href="/2022/08/01/webpack-typescript-kai-fa-you-hou-jiao-ben-dou-yu-zhi-bo-zi-dong-qie-huan-hua-zhi-2-0/"/>
      <url>/2022/08/01/webpack-typescript-kai-fa-you-hou-jiao-ben-dou-yu-zhi-bo-zi-dong-qie-huan-hua-zhi-2-0/</url>
      
        <content type="html"><![CDATA[<h2 id="Webpack-TypeScript-开发油猴脚本：斗鱼直播自动切换画质-2-0"><a href="#Webpack-TypeScript-开发油猴脚本：斗鱼直播自动切换画质-2-0" class="headerlink" title="Webpack + TypeScript 开发油猴脚本：斗鱼直播自动切换画质 2.0"></a>Webpack + TypeScript 开发油猴脚本：斗鱼直播自动切换画质 2.0</h2><h3 id="基于以下两个项目："><a href="#基于以下两个项目：" class="headerlink" title="基于以下两个项目："></a>基于以下两个项目：</h3><p><a href="https://iknow.fun/2021/08/03/dou-yu-zhi-bo-cha-jian-zi-dong-qie-huan-zui-gao-hua-zhi-huo-zui-di-hua-zhi/">斗鱼直播油猴脚本：自动切换最高画质或最低画质</a></p><ul><li>切换画质基础实现：自动切换最高或最低画质</li></ul><p><a href="https://iknow.fun/2022/05/25/react-typescript-tailwindcss-kai-fa-you-hou-jiao-ben/">React + TypeScript + Tailwindcss 开发油猴脚本</a></p><ul><li>删减后形成 Webpack + TypeScript 基础配置</li></ul><p>项目地址：<a href="https://github.com/Eished/douyu-helper" target="_blank" rel="noopener">https://github.com/Eished/douyu-helper</a></p><h3 id="改进的功能"><a href="#改进的功能" class="headerlink" title="改进的功能"></a>改进的功能</h3><ul><li><input checked="" disabled="" type="checkbox"> 点击浏览器油猴插件图标，弹出菜单栏，可切换全局默认画质和选择当前直播间画质。</li><li><input checked="" disabled="" type="checkbox"> 油猴菜单栏选项根据直播间画质选项动态加载。</li><li><input checked="" disabled="" type="checkbox"> 切换画质时不刷新页面。</li><li><input checked="" disabled="" type="checkbox"> 自动记住每个直播间选择的画质，并自动切换到上次选择的画质</li><li><input checked="" disabled="" type="checkbox"> 点击播放器切换或者油猴插件图标切换都可以记住选择的画质。</li><li><input checked="" disabled="" type="checkbox"> 局部配置优先，没有匹配到局部配置时，使用全局默认画质。</li></ul><h3 id="开发思路"><a href="#开发思路" class="headerlink" title="开发思路"></a>开发思路</h3><ol><li>重构为 TypeScript</li><li>本打算扩展最高或最低画质，增加中间选项让画质选项自动添加和模糊匹配最接近全局预设的画质，但不知道画质取值范围和排序，写到一半没什么好的思路，于是让每个直播间的画质设定独立保存，并保留最高或最低画质功能。<ol><li>获取斗鱼直播间 id</li><li>保存设定值到直播间 id 下</li><li>初始化运行时取设定值匹配的画质选项并选择</li><li>未匹配到则使用默认画质设定值</li></ol></li><li>监听画质选项点击事件，保存用户的点击画质选项事件值，不保存自动选择画质的点击事件值</li><li>手动编写斗鱼播放器 HTML 模拟其主要功能，用于本地快速开发和调试。</li><li>油猴 API 类型定义</li></ol><h3 id="主要代码实现"><a href="#主要代码实现" class="headerlink" title="主要代码实现"></a>主要代码实现</h3><p><code>index.ts</code>：</p><ul><li>根据是否是开发环境决定是否执行</li></ul><pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">import</span> app <span class="token keyword">from</span> <span class="token string">'@/app'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">{</span> isTampermonkey <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/lib/environment'</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>PRODUCTION<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 本地开发时注入页面的js，设置为只在油猴环境运行。</span>  <span class="token comment" spellcheck="true">// 开启压缩后 webpack 在生产环境构建会把这部分代码删掉。</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTampermonkey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><code>app.ts</code>：</p><ul><li>主要逻辑实现</li></ul><p><a href="https://github.com/Eished/douyu-helper/blob/main/src/app.ts" target="_blank" rel="noopener">https://github.com/Eished/douyu-helper/blob/main/src/app.ts</a></p><pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> rid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'rid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rid<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> results <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/[\d]{1,10}/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>      rid <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">const</span> videoSub <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.layout-Player-videoSub'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>rid <span class="token operator">&amp;&amp;</span> videoSub<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">autoSelectClarity</span><span class="token punctuation">(</span>rid<span class="token punctuation">,</span> videoSub<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> autoSelectClarity <span class="token operator">=</span> <span class="token punctuation">(</span>rid<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">,</span> videoSub<span class="token punctuation">:</span> Element<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> Clarities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'全局默认最高画质'</span><span class="token punctuation">,</span> <span class="token string">'全局默认最低画质'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> selectedClarity<span class="token punctuation">:</span> <span class="token keyword">string</span> <span class="token operator">|</span> undefined <span class="token operator">=</span> <span class="token function">GM_getValue</span><span class="token punctuation">(</span>rid<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> defaultClarity<span class="token punctuation">:</span> <span class="token keyword">number</span> <span class="token operator">|</span> undefined <span class="token operator">=</span> <span class="token function">GM_getValue</span><span class="token punctuation">(</span><span class="token string">'defaultClarity'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> clickClarity <span class="token operator">=</span> <span class="token punctuation">(</span>li<span class="token punctuation">:</span> HTMLLIElement<span class="token punctuation">,</span> save <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 阻止点击事件循环</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>li<span class="token punctuation">.</span>className<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'selected'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      save <span class="token operator">?</span> <span class="token function">GM_setValue</span><span class="token punctuation">(</span>rid<span class="token punctuation">,</span> li<span class="token punctuation">.</span>innerText<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>      li<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> selectClarity <span class="token operator">=</span> <span class="token punctuation">(</span>list<span class="token punctuation">:</span> NodeListOf<span class="token operator">&lt;</span>HTMLLIElement<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 注册菜单栏</span>    Clarities<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>clarity<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token function">GM_registerMenuCommand</span><span class="token punctuation">(</span>clarity<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">clickClarity</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">'defaultClarity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>          <span class="token function">clickClarity</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span>list<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">'defaultClarity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> notFoundCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> availableClarity <span class="token operator">=</span> li<span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>selectedClarity <span class="token operator">===</span> availableClarity<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 选择自定义画质</span>        <span class="token function">clickClarity</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        notFoundCount<span class="token operator">++</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token comment" spellcheck="true">// 防止误触发保存，仅保存真实点击</span>      li<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">clickClarity</span><span class="token punctuation">(</span>li<span class="token punctuation">,</span> e<span class="token punctuation">.</span>isTrusted<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">// 注册菜单栏</span>      <span class="token function">GM_registerMenuCommand</span><span class="token punctuation">(</span>availableClarity<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">clickClarity</span><span class="token punctuation">(</span>li<span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 选择默认画质</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>notFoundCount <span class="token operator">===</span> list<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultClarity <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">clickClarity</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span>list<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">clickClarity</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token punctuation">(</span>mutations<span class="token punctuation">:</span> MutationRecord<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> observer<span class="token punctuation">:</span> MutationObserver<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> controller <span class="token operator">=</span> videoSub<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`[value="画质 "]`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>      observer<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">const</span> ul <span class="token operator">=</span> controller<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span>      <span class="token keyword">const</span> list <span class="token operator">=</span> ul<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      list <span class="token operator">?</span> <span class="token function">selectClarity</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span> <span class="token punctuation">:</span> console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'斗鱼直播助手：未找到画质选项'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>  observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>videoSub<span class="token punctuation">,</span> <span class="token punctuation">{</span>    childList<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span>    subtree<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> app<span class="token punctuation">;</span></code></pre><p>模拟斗鱼播放器：</p><p><a href="https://github.com/Eished/douyu-helper/blob/main/public/index.html" target="_blank" rel="noopener">https://github.com/Eished/douyu-helper/blob/main/public/index.html</a></p><p>油猴 API 类型定义：</p><p><a href="https://github.com/Eished/douyu-helper/blob/main/src/global.d.ts" target="_blank" rel="noopener">https://github.com/Eished/douyu-helper/blob/main/src/global.d.ts</a></p><p>开发文档：</p><p><a href="https://github.com/Eished/douyu-helper/tree/main/docs" target="_blank" rel="noopener">https://github.com/Eished/douyu-helper/tree/main/docs</a></p><h3 id="学习到的知识点"><a href="#学习到的知识点" class="headerlink" title="学习到的知识点"></a>学习到的知识点</h3><h4 id="TypeScript-与闭包"><a href="#TypeScript-与闭包" class="headerlink" title="TypeScript 与闭包"></a>TypeScript 与闭包</h4><pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">let</span> stringOrNull<span class="token punctuation">:</span> <span class="token keyword">string</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>stringOrNull <span class="token operator">=</span> <span class="token string">'test'</span><span class="token punctuation">;</span><span class="token keyword">const</span> funcA <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">funcA</span><span class="token punctuation">(</span>stringOrNull<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>stringOrNull<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> funcB <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">funcA</span><span class="token punctuation">(</span>stringOrNull<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 类型“string | null”的参数不能赋给类型“string”的参数。</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token function">funcB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">const</span> funcC <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>stringOrNull<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">funcA</span><span class="token punctuation">(</span>stringOrNull<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>问题：</p><ul><li>在函数内使用外部变量时 TypeScript 类型推导失效。如上代码 <code>funcB</code> 中无法推导出 <code>stringOrNull</code> 是字符串类型。</li></ul><p>原因：</p><ul><li><p>这种情况看起来是由于引用的外部变量作用域的问题，更细致来看符合闭包的特征，闭包让你可以在一个内层函数中访问到其外层函数的作用域。</p><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures" target="_blank" rel="noopener">MDN</a>: 闭包是由函数以及声明该函数的词法环境组合而成的。该环境包含了这个闭包创建时<strong>作用域内的任何局部变量</strong>。</p></blockquote></li><li><p>原因是：闭包仅收集函数作用域内的局部变量的引用，没有记录逻辑代码，所有无法用外部逻辑代码在内层函数内对变量的定义进行类型推导。</p><ul><li>注：示例有三层作用域，第二层作用域未进行任何操作。</li></ul><blockquote><p>C++ 11 中 lambda 闭包(closure) 的实现：c++ 编译期把闭包捕获的变量都放在 global上，使用记录的 c++ 捕捉范围，把那些引用用调用方式传进去</p></blockquote></li></ul><p>解决方案：</p><ol><li>不使用闭包，使用传参。</li><li>缩小作用域范围，在闭包生成前确定类型。</li></ol><pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">let</span> stringOrNull<span class="token punctuation">:</span> <span class="token keyword">string</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">const</span> funcA <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>stringOrNull<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> str <span class="token operator">=</span> stringOrNull<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 缩小作用域范围，在闭包生成前确定类型。</span>  <span class="token keyword">const</span> funcB <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">funcA</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token function">funcB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">funcN</span><span class="token punctuation">(</span>stringOrNull<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 直接传参</span><span class="token punctuation">}</span></code></pre><h4 id="MutationObserver"><a href="#MutationObserver" class="headerlink" title="MutationObserver"></a>MutationObserver</h4><p>之前使用 javascript 不清晰的写法：</p><ul><li>这样写由于变量声明提升可以正确运行，只是 <code>observer.disconnect();</code> 不能明显看到引用来源</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> controller <span class="token operator">=</span> videoSub<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`[value="画质 "]`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>    observer<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>videoSub<span class="token punctuation">,</span> <span class="token punctuation">{</span>  childList<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  subtree<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>之后使用 typescript 的写法：</p><pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token punctuation">(</span>mutations<span class="token punctuation">:</span> MutationRecord<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> observer<span class="token punctuation">:</span> MutationObserver<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> controller <span class="token operator">=</span> videoSub<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`[value="画质 "]`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>    observer<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>videoSub<span class="token punctuation">,</span> <span class="token punctuation">{</span>  childList<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span>  subtree<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="仅响应真实-Click-事件"><a href="#仅响应真实-Click-事件" class="headerlink" title="仅响应真实 Click 事件"></a>仅响应真实 Click 事件</h4><ul><li>点击全局最高/最低画质选项会触发 <code>click</code> 事件，导致当前直播间的画质选项被保存，导致全局设置失效。<ul><li>使用 <code>e.isTrusted</code> 来判断这个点击是来自用户/代码，只保存用户的点击事件产生的调用。</li><li><code>GM_registerMenuCommand</code> 油猴菜单栏选项绑定了播放器画质选项，也是用户点击，直接传入 <code>true</code> 保存。</li></ul></li></ul><pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">const</span> clickClarity <span class="token operator">=</span> <span class="token punctuation">(</span>li<span class="token punctuation">:</span> HTMLLIElement<span class="token punctuation">,</span> save <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 阻止点击事件循环</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>li<span class="token punctuation">.</span>className<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'selected'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    save <span class="token operator">?</span> <span class="token function">GM_setValue</span><span class="token punctuation">(</span>rid<span class="token punctuation">,</span> li<span class="token punctuation">.</span>innerText<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>    li<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> selectClarity <span class="token operator">=</span> <span class="token punctuation">(</span>list<span class="token punctuation">:</span> NodeListOf<span class="token operator">&lt;</span>HTMLLIElement<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 注册菜单栏</span>  Clarities<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>clarity<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">GM_registerMenuCommand</span><span class="token punctuation">(</span>clarity<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">clickClarity</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">'defaultClarity'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">clickClarity</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span>list<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">'defaultClarity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> notFoundCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> availableClarity <span class="token operator">=</span> li<span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>selectedClarity <span class="token operator">===</span> availableClarity<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 选择自定义画质</span>      <span class="token function">clickClarity</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      notFoundCount<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 防止误触发保存，仅保存真实点击</span>    li<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">clickClarity</span><span class="token punctuation">(</span>li<span class="token punctuation">,</span> e<span class="token punctuation">.</span>isTrusted<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 注册菜单栏</span>    <span class="token function">GM_registerMenuCommand</span><span class="token punctuation">(</span>availableClarity<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">clickClarity</span><span class="token punctuation">(</span>li<span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 选择默认画质</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>notFoundCount <span class="token operator">===</span> list<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultClarity <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">clickClarity</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span>list<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token function">clickClarity</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h4 id="Webpack-配置的改进"><a href="#Webpack-配置的改进" class="headerlink" title="Webpack 配置的改进"></a>Webpack 配置的改进</h4><ul><li><p>自动生成油猴头文件，以及生产环境和开发环境所需的不同参数</p></li><li><p>热刷新解决方案：</p><ul><li><code>HtmlWebpackPlugin</code> 将<code>websocket</code>代码注入到打包好的 js 里面，再把 js 插入 html，<code>devServer</code> 和 <code>websocket</code> 客户端通信实现网页热刷新</li><li>问题：<ul><li>油猴脚本不需要通过 webpack 将 js 插入网页。</li><li>造成重复运行相同代码，webpack 插入的 js 没有油猴环境，运行到调用油猴 API 时报错。</li></ul></li><li>解决方案：在代码开始时里加上判断当前环境的函数。<ul><li>问题：生产环境不需要这些代码。</li><li>解决：让 webpack 在生产环境构建时删掉这些代码<ul><li><code>DefinePlugin</code> 变量替换</li><li><code>NormalModuleReplacementPlugin</code> 正则匹配替换</li><li>这两个插件都能实现替换效果，<code>DefinePlugin</code> 能自动优化无法达到的分支，需要写的代码更少，所以使用这个完成。</li></ul></li></ul></li></ul></li><li><p>代码构建缓慢：</p><ul><li><p>之前很快：<code>webpack 5.72.0 compiled successfully in 1362 ms</code></p><ul><li>现在：<code>webpack 5.72.0 compiled successfully in 9335 ms</code></li></ul></li><li><p>不设置 <code>devtool: &#39;source-map&#39;</code> 就恢复正常了</p><ul><li><code>development</code> 模式下默认是 <code>eval</code></li><li><code>production</code> 模式下默认是 <code>false</code></li></ul></li><li><p>文档介绍：<code>source-map build: slowest rebuild: slowest</code> 用于找到具体的报错位置</p></li><li><p>什么时候使用？</p><blockquote><p>（1）<strong>开发环境</strong>：需要考虑速度快，调试更友好</p><ul><li>速度快( <code>eval</code> &gt; <code>inline</code> &gt; <code>cheap</code> &gt;… )<ol><li><code>eval-cheap-souce-map</code></li><li><code>eval-source-map</code></li></ol></li><li>调试更友好<ol><li><code>souce-map</code></li><li><code>cheap-module-souce-map</code></li><li><code>cheap-souce-map</code></li></ol></li></ul><p><strong>最终得出最好的两种方案 –&gt; eval-source-map（完整度高，内联速度快） / eval-cheap-module-souce-map（错误提示忽略列但是包含其他信息，内联速度快）</strong></p><p>（2）<strong>生产环境</strong>：需要考虑源代码要不要隐藏，调试要不要更友好</p><ul><li>内联会让代码体积变大，所以在生产环境不用内联</li><li>隐藏源代码<ol><li><code>nosources-source-map</code> 全部隐藏（打包后的代码与源代码）</li><li><code>hidden-source-map</code> 只隐藏源代码，会提示构建后代码错误信息</li></ol></li></ul><p><strong>最终得出最好的两种方案 –&gt; source-map（最完整） / cheap-module-souce-map（错误提示一整行忽略列）</strong></p></blockquote></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 前端 </tag>
            
            <tag> HTML5 </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Tampermonkey </tag>
            
            <tag> TypeScript </tag>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WSL2 + VSCode 开发 JavaScript 和 Python 环境配置总结</title>
      <link href="/2022/05/29/wsl2-javascript-python-vscode-huan-jing-pei-zhi-zong-jie/"/>
      <url>/2022/05/29/wsl2-javascript-python-vscode-huan-jing-pei-zhi-zong-jie/</url>
      
        <content type="html"><![CDATA[<h3 id="基础设置"><a href="#基础设置" class="headerlink" title="基础设置"></a>基础设置</h3><ol><li><a href="https://dowww.spencerwoo.com/1-preparations/1-1-installation.html" target="_blank" rel="noopener">在 Windows 上用 WSL 优雅开发</a></li><li><a href="https://zhuanlan.zhihu.com/p/345645621" target="_blank" rel="noopener">限制 wsl2 占用过多内存</a></li><li><a href="https://solidspoon.xyz/2021/02/17/%E9%85%8D%E7%BD%AEWSL2%E4%BD%BF%E7%94%A8Windows%E4%BB%A3%E7%90%86%E4%B8%8A%E7%BD%91/" target="_blank" rel="noopener">配置 WSL2 使用 Windows 代理上网</a></li><li><a href="https://docs.microsoft.com/zh-cn/windows/wsl/wsl-config" target="_blank" rel="noopener">WSL 中的高级设置配置</a></li><li><a href="https://docs.microsoft.com/zh-cn/windows/wsl/install#upgrade-version-from-wsl-1-to-wsl-2" target="_blank" rel="noopener">将版本从 WSL 1 升级到 WSL 2</a><ul><li><code>wsl --set-version &lt;ubuntu名字&gt; 2</code></li></ul></li></ol><p>重启命令</p><pre><code>wsl -t Ubuntu-20.04</code></pre><h3 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h3><p><strong><a href="https://segmentfault.com/a/1190000041463008" target="_blank" rel="noopener">WSL2 连接到宿主 Windows 程序的网络代理设置</a></strong> 最终测试成功</p><p><a href="https://zinglix.xyz/2020/04/18/wsl2-proxy/" target="_blank" rel="noopener">https://zinglix.xyz/2020/04/18/wsl2-proxy/</a></p><p><a href="https://zhuanlan.zhihu.com/p/414627975" target="_blank" rel="noopener">WSL2 内使用 windows 的 v2ray 代理配置方式</a></p><p><a href="https://www.jianshu.com/p/ba2cf239ebe0" target="_blank" rel="noopener">https://www.jianshu.com/p/ba2cf239ebe0</a></p><p><strong>出现的问题分析：</strong>可以双方 ping 通，不设置代理可以双方访问，设置代理就无法请求，v2ray 未收到请求。</p><p>关闭所有防火墙正常连接，重置防火墙后无法连接。</p><p>定位关键问题：</p><ol><li>高级安全 Windows Defender 防火墙</li><li>本地计算机上的高级安全 Windows Defender 防火墙</li><li>操作-&gt;属性</li><li>把 wsl 的网卡防火墙关掉，重启可能会失效</li></ol><p><img src="/images/tianruo_2022-5-29-637893920717599123.png" alt="tianruo_2022-5-29-637893920717599123"></p><p>很多软件不支持 socks5，建议使用 http 协议代理<br>.bashrc</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ~/.bashrc: executed by bash(1) for non-login shells.</span><span class="token comment" spellcheck="true"># see /usr/share/doc/bash/examples/startup-files (in the package bash-doc)</span><span class="token comment" spellcheck="true"># for examples</span><span class="token function">umask</span> 022PATH<span class="token operator">=</span><span class="token string">"<span class="token variable">$HOME</span>/bin:<span class="token variable">$HOME</span>/.poetry/bin:<span class="token variable">$HOME</span>/.local/bin:<span class="token variable">$PATH</span>"</span><span class="token comment" spellcheck="true"># If not running interactively, don't do anything</span><span class="token keyword">case</span> $- <span class="token keyword">in</span>    *i*<span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>      *<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">;</span>esac<span class="token comment" spellcheck="true"># don't put duplicate lines or lines starting with space in the history.</span><span class="token comment" spellcheck="true"># See bash(1) for more options</span>HISTCONTROL<span class="token operator">=</span>ignoreboth<span class="token comment" spellcheck="true"># append to the history file, don't overwrite it</span><span class="token function">shopt</span> -s histappend<span class="token comment" spellcheck="true"># for setting history length see HISTSIZE and HISTFILESIZE in bash(1)</span>HISTSIZE<span class="token operator">=</span>1000HISTFILESIZE<span class="token operator">=</span>2000<span class="token comment" spellcheck="true"># check the window size after each command and, if necessary,</span><span class="token comment" spellcheck="true"># update the values of LINES and COLUMNS.</span><span class="token function">shopt</span> -s checkwinsize<span class="token comment" spellcheck="true"># If set, the pattern "**" used in a pathname expansion context will</span><span class="token comment" spellcheck="true"># match all files and zero or more directories and subdirectories.</span><span class="token comment" spellcheck="true">#shopt -s globstar</span><span class="token comment" spellcheck="true"># make less more friendly for non-text input files, see lesspipe(1)</span><span class="token punctuation">[</span> -x /usr/bin/lesspipe <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">eval</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>SHELL<span class="token operator">=</span>/bin/sh lesspipe<span class="token variable">)</span></span>"</span><span class="token comment" spellcheck="true"># set variable identifying the chroot you work in (used in the prompt below)</span><span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">"<span class="token variable">${debian_chroot:-}</span>"</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> -r /etc/debian_chroot <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    debian_chroot<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /etc/debian_chroot<span class="token variable">)</span></span><span class="token keyword">fi</span><span class="token comment" spellcheck="true"># set a fancy prompt (non-color, unless we know we "want" color)</span><span class="token keyword">case</span> <span class="token string">"<span class="token variable">$TERM</span>"</span> <span class="token keyword">in</span>    xterm-color<span class="token operator">|</span>*-256color<span class="token punctuation">)</span> color_prompt<span class="token operator">=</span>yes<span class="token punctuation">;</span><span class="token punctuation">;</span>esac<span class="token comment" spellcheck="true"># uncomment for a colored prompt, if the terminal has the capability; turned</span><span class="token comment" spellcheck="true"># off by default to not distract the user: the focus in a terminal window</span><span class="token comment" spellcheck="true"># should be on the output of commands, not on the prompt</span><span class="token comment" spellcheck="true">#force_color_prompt=yes</span><span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">"<span class="token variable">$force_color_prompt</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token keyword">if</span> <span class="token punctuation">[</span> -x /usr/bin/tput <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> tput setaf 1 <span class="token operator">></span><span class="token operator">&amp;</span>/dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token comment" spellcheck="true"># We have color support; assume it's compliant with Ecma-48</span> <span class="token comment" spellcheck="true"># (ISO/IEC-6429). (Lack of such support is extremely rare, and such</span> <span class="token comment" spellcheck="true"># a case would tend to support setf rather than setaf.)</span> color_prompt<span class="token operator">=</span>yes    <span class="token keyword">else</span> color_prompt<span class="token operator">=</span>    <span class="token keyword">fi</span><span class="token keyword">fi</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$color_prompt</span>"</span> <span class="token operator">=</span> <span class="token function">yes</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    PS1<span class="token operator">=</span><span class="token string">'<span class="token variable">${debian_chroot:+($debian_chroot)}</span>\[\033[01;32m\]\u:\[\033[01;34m\]\w\[\033[0;35m\]<span class="token variable"><span class="token variable">$(</span>__git_ps1 " <span class="token punctuation">[</span>%s<span class="token punctuation">]</span>"<span class="token variable">)</span></span>\[\033[00m\] \$ '</span><span class="token keyword">else</span>    PS1<span class="token operator">=</span><span class="token string">'<span class="token variable">${debian_chroot:+($debian_chroot)}</span>\u@\h: \w <span class="token variable"><span class="token variable">$(</span>__git_ps1 " <span class="token punctuation">[</span>%s<span class="token punctuation">]</span>"<span class="token variable">)</span></span> \$ '</span><span class="token keyword">fi</span>unset color_prompt force_color_prompt<span class="token comment" spellcheck="true"># If this is an xterm set the title to user@host:dir</span><span class="token keyword">case</span> <span class="token string">"<span class="token variable">$TERM</span>"</span> <span class="token keyword">in</span>xterm*<span class="token operator">|</span>rxvt*<span class="token punctuation">)</span>    PS1<span class="token operator">=</span><span class="token string">"\[\e]0;<span class="token variable">${debian_chroot:+($debian_chroot)}</span>\u@\h: \w \a\]<span class="token variable">$PS1</span>"</span>    <span class="token punctuation">;</span><span class="token punctuation">;</span>*<span class="token punctuation">)</span>    <span class="token punctuation">;</span><span class="token punctuation">;</span>esac<span class="token keyword">case</span> <span class="token string">"<span class="token variable">$TERM</span>"</span> <span class="token keyword">in</span>    st-*<span class="token punctuation">)</span>        PROMPT_COMMAND<span class="token operator">=</span><span class="token string">'echo -ne "\033]0;st - <span class="token variable">$PWD</span>\007"'</span>    <span class="token punctuation">;</span><span class="token punctuation">;</span>esac<span class="token comment" spellcheck="true"># enable color support of ls and also add handy aliases</span><span class="token keyword">if</span> <span class="token punctuation">[</span> -x /usr/bin/dircolors <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token function">test</span> -r ~/.dircolors <span class="token operator">&amp;&amp;</span> <span class="token function">eval</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">dircolors</span> -b ~/.dircolors<span class="token variable">)</span></span>"</span> <span class="token operator">||</span> <span class="token function">eval</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">dircolors</span> -b<span class="token variable">)</span></span>"</span>    <span class="token function">alias</span> ls<span class="token operator">=</span><span class="token string">'ls --color=auto'</span>    <span class="token comment" spellcheck="true">#alias dir='dir --color=auto'</span>    <span class="token comment" spellcheck="true">#alias vdir='vdir --color=auto'</span>    <span class="token function">alias</span> grep<span class="token operator">=</span><span class="token string">'grep --color=auto'</span>    <span class="token function">alias</span> fgrep<span class="token operator">=</span><span class="token string">'fgrep --color=auto'</span>    <span class="token function">alias</span> egrep<span class="token operator">=</span><span class="token string">'egrep --color=auto'</span><span class="token keyword">fi</span><span class="token comment" spellcheck="true"># colored GCC warnings and errors</span><span class="token comment" spellcheck="true">#export GCC_COLORS='error=01;31:warning=01;35:note=01;36:caret=01;32:locus=01:quote=01'</span><span class="token comment" spellcheck="true"># some more ls aliases</span><span class="token function">alias</span> ll<span class="token operator">=</span><span class="token string">'ls -alF'</span><span class="token function">alias</span> la<span class="token operator">=</span><span class="token string">'ls -A'</span><span class="token function">alias</span> l<span class="token operator">=</span><span class="token string">'ls -CF'</span><span class="token comment" spellcheck="true"># Add an "alert" alias for long running commands.  Use like so:</span><span class="token comment" spellcheck="true">#   sleep 10; alert</span><span class="token function">alias</span> alert<span class="token operator">=</span><span class="token string">'notify-send --urgency=low -i "<span class="token variable"><span class="token variable">$(</span><span class="token punctuation">[</span> $? <span class="token operator">=</span> 0 <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">echo</span> terminal <span class="token operator">||</span> <span class="token keyword">echo</span> error<span class="token variable">)</span></span>" "$(history|tail -n1|sed -e '</span>\<span class="token string">''</span>s/^\s*<span class="token punctuation">[</span>0-9<span class="token punctuation">]</span>\+\s*//<span class="token punctuation">;</span>s/<span class="token punctuation">[</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token operator">|</span><span class="token punctuation">]</span>\s*alert$//<span class="token string">'\''</span><span class="token punctuation">)</span><span class="token string">"'# Alias definitions.# You may want to put all your additions into a separate file like# ~/.bash_aliases, instead of adding them here directly.# See /usr/share/doc/bash-doc/examples in the bash-doc package.if [ -f ~/.bash_aliases ]; then    . ~/.bash_aliasesfi# enable programmable completion features (you don't need to enable# this, if it's already enabled in /etc/bash.bashrc and /etc/profile# sources /etc/bash.bashrc).if ! shopt -oq posix; then  if [ -f /usr/share/bash-completion/bash_completion ]; then    . /usr/share/bash-completion/bash_completion  elif [ -f /etc/bash_completion ]; then    . /etc/bash_completion  fifi# Configure the Git PS1 promptGIT_PS1_SHOWDIRTYSTATE=trueGIT_PS1_SHOWSTASHSTATE=trueGIT_PS1_SHOWUNTRACKEDFILES=true# SSH keychain# eval <span class="token variable"><span class="token variable">`</span>keychain --quiet --eval --agents <span class="token function">ssh</span> id_rsa<span class="token variable">`</span></span># Load Environment Variables for coding projectsif [ -d ~/.project_env ]; then    if ! [ -z "</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> -A ~/.project_env<span class="token variable">)</span></span><span class="token string">" ]; then        for envf in ~/.project_env/*; do            export <span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> -v '^#' $envf <span class="token operator">|</span> <span class="token function">xargs</span> -d '\n'<span class="token variable">)</span></span>        done    fifiexport NVM_DIR="</span><span class="token punctuation">$(</span><span class="token punctuation">[</span> -z <span class="token string">"<span class="token variable">${XDG_CONFIG_HOME-}</span>"</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">printf</span> %s <span class="token string">"<span class="token variable">${HOME}</span>/.nvm"</span> <span class="token operator">||</span> <span class="token function">printf</span> %s <span class="token string">"<span class="token variable">${XDG_CONFIG_HOME}</span>/nvm"</span><span class="token punctuation">)</span><span class="token string">"[ -s "</span><span class="token variable">$NVM_DIR</span>/nvm.sh<span class="token string">" ] &amp;&amp; \. "</span><span class="token variable">$NVM_DIR</span>/nvm.sh<span class="token string">" # This loads nvm# 代理设置export hostip=<span class="token variable"><span class="token variable">$(</span>ip route <span class="token operator">|</span> <span class="token function">grep</span> default <span class="token operator">|</span> <span class="token function">awk</span> '<span class="token punctuation">{</span>print $3<span class="token punctuation">}</span>'<span class="token variable">)</span></span>export hostport=58883 # 局域网连接端口alias proxy='    export HTTPS_PROXY="</span>http://<span class="token variable">${hostip}</span><span class="token keyword">:</span><span class="token variable">${hostport}</span><span class="token string">";    export HTTP_PROXY="</span>http://<span class="token variable">${hostip}</span><span class="token keyword">:</span><span class="token variable">${hostport}</span><span class="token string">";    export ALL_PROXY="</span>http://<span class="token variable">${hostip}</span><span class="token keyword">:</span><span class="token variable">${hostport}</span><span class="token string">";    echo -e "</span>Acquire::http::Proxy \<span class="token string">"http://<span class="token variable">${hostip}</span>:<span class="token variable">${hostport}</span>\";"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> -a /etc/apt/apt.conf.d/proxy.conf <span class="token operator">></span> /dev/null<span class="token punctuation">;</span>    <span class="token keyword">echo</span> -e <span class="token string">"Acquire::https::Proxy \"http://<span class="token variable">${hostip}</span>:<span class="token variable">${hostport}</span>\";"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> -a /etc/apt/apt.conf.d/proxy.conf <span class="token operator">></span> /dev/null<span class="token punctuation">;</span><span class="token string">'alias unproxy='</span>    unset HTTPS_PROXY<span class="token punctuation">;</span>    unset HTTP_PROXY<span class="token punctuation">;</span>    unset ALL_PROXY<span class="token punctuation">;</span>    <span class="token function">sudo</span> <span class="token function">sed</span> -i -e <span class="token string">'/Acquire::http::Proxy/d'</span> /etc/apt/apt.conf.d/proxy.conf<span class="token punctuation">;</span>    <span class="token function">sudo</span> <span class="token function">sed</span> -i -e <span class="token string">'/Acquire::https::Proxy/d'</span> /etc/apt/apt.conf.d/proxy.conf<span class="token punctuation">;</span>'<span class="token punctuation">[</span> -s <span class="token string">"<span class="token variable">$NVM_DIR</span>/bash_completion"</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> \. <span class="token string">"<span class="token variable">$NVM_DIR</span>/bash_completion"</span>  <span class="token comment" spellcheck="true"># This loads nvm bash_completion</span><span class="token comment" spellcheck="true"># yarn 全局环境变量</span><span class="token function">export</span> PATH<span class="token operator">=</span><span class="token string">"<span class="token variable">$PATH</span>:<span class="token variable">${HOME}</span>/.yarn/bin"</span><span class="token function">export</span> PATH<span class="token operator">=</span><span class="token string">"/usr/bin:<span class="token variable">$PATH</span>"</span><span class="token comment" spellcheck="true"># >>> conda initialize >>></span><span class="token comment" spellcheck="true"># !! Contents within this block are managed by 'conda init' !!</span>__conda_setup<span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>'/home/eis/miniconda3/bin/conda' 'shell.bash' 'hook' 2<span class="token operator">></span> /dev/null<span class="token variable">)</span></span>"</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq 0 <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token function">eval</span> <span class="token string">"<span class="token variable">$__conda_setup</span>"</span><span class="token keyword">else</span>    <span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token string">"/home/eis/miniconda3/etc/profile.d/conda.sh"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>        <span class="token keyword">.</span> <span class="token string">"/home/eis/miniconda3/etc/profile.d/conda.sh"</span>    <span class="token keyword">else</span>        <span class="token function">export</span> PATH<span class="token operator">=</span><span class="token string">"/home/eis/miniconda3/bin:<span class="token variable">$PATH</span>"</span>    <span class="token keyword">fi</span><span class="token keyword">fi</span>unset __conda_setup<span class="token comment" spellcheck="true"># &lt;&lt;&lt; conda initialize &lt;&lt;&lt;</span></code></pre><h3 id="nvm"><a href="#nvm" class="headerlink" title="nvm"></a>nvm</h3><pre class=" language-bash"><code class="language-bash">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh <span class="token operator">|</span> <span class="token function">bash</span></code></pre><h3 id="yarn-全局访问"><a href="#yarn-全局访问" class="headerlink" title="yarn 全局访问"></a>yarn 全局访问</h3><p><a href="https://stackoverflow.com/questions/40317578/yarn-global-command-not-working" target="_blank" rel="noopener">https://stackoverflow.com/questions/40317578/yarn-global-command-not-working</a></p><pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> i yarn -gyarn global bin</code></pre><h3 id="设置-ssh-秘钥权限"><a href="#设置-ssh-秘钥权限" class="headerlink" title="设置 ssh 秘钥权限"></a>设置 ssh 秘钥权限</h3><p>设置文件内所有文件</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">chmod</span> -R 700 ~/.ssh</code></pre><h3 id="配置-code-命令"><a href="#配置-code-命令" class="headerlink" title="配置 code 命令"></a>配置 code 命令</h3><p>VSCode Server 会自动安装 Code 命令，这样配置的打开路径将会在 WSL 外。</p><blockquote><p>.bashrc</p><pre class=" language-bash"><code class="language-bash"><span class="token function">alias</span> code<span class="token operator">=</span><span class="token string">"/mnt/c/Users/Kis/AppData/Local/Programs/>Microsoft\ VS\ Code/Code.exe"</span></code></pre></blockquote><h3 id="VSCode-ssh-remote-非-WSL-时使用"><a href="#VSCode-ssh-remote-非-WSL-时使用" class="headerlink" title="VSCode ssh remote 非 WSL 时使用"></a><a href="https://zhuanlan.zhihu.com/p/68577071" target="_blank" rel="noopener">VSCode ssh remote</a> 非 WSL 时使用</h3><p><a href="https://code.visualstudio.com/docs/remote/ssh" target="_blank" rel="noopener">系统支持列表</a>，不支持 ubuntu32 位系统</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 代理设置</span><span class="token comment" spellcheck="true"># export hostip=$(ip route | grep default | awk '{print $3}')</span><span class="token function">export</span> hostip<span class="token operator">=</span><span class="token string">"192.168.1.101"</span><span class="token function">export</span> hostport<span class="token operator">=</span>58883 <span class="token comment" spellcheck="true"># 局域网连接端口</span><span class="token function">alias</span> proxy<span class="token operator">=</span><span class="token string">'    export HTTPS_PROXY="http://<span class="token variable">${hostip}</span>:<span class="token variable">${hostport}</span>";    export HTTP_PROXY="http://<span class="token variable">${hostip}</span>:<span class="token variable">${hostport}</span>";    export ALL_PROXY="http://<span class="token variable">${hostip}</span>:<span class="token variable">${hostport}</span>";    echo -e "Acquire::http::Proxy \"http://<span class="token variable">${hostip}</span>:<span class="token variable">${hostport}</span>\";" | sudo tee -a /etc/apt/apt.conf.d/proxy.conf > /dev/null;    echo -e "Acquire::https::Proxy \"http://<span class="token variable">${hostip}</span>:<span class="token variable">${hostport}</span>\";" | sudo tee -a /etc/apt/apt.conf.d/proxy.conf > /dev/null;'</span><span class="token function">alias</span> unproxy<span class="token operator">=</span><span class="token string">'    unset HTTPS_PROXY;    unset HTTP_PROXY;    unset ALL_PROXY;    sudo sed -i -e '</span>/Acquire::http::Proxy/d<span class="token string">' /etc/apt/apt.conf.d/proxy.conf;    sudo sed -i -e '</span>/Acquire::https::Proxy/d<span class="token string">' /etc/apt/apt.conf.d/proxy.conf;'</span></code></pre><pre><code>// 先卸载sudo apt-get remove openssh-server// 安装sudo apt-get install openssh-server//重启sshd服务sudo service ssh --full-restartsudo vim /etc/ssh/sshd_config</code></pre><h3 id="设置-root-密码"><a href="#设置-root-密码" class="headerlink" title="设置 root 密码"></a>设置 root 密码</h3><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span>  <span class="token function">passwd</span> root</code></pre><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> apt <span class="token function">install</span> python3-pippip3 <span class="token function">install</span> virtualenvvirtualenv venv<span class="token function">cd</span> venv<span class="token function">source</span> bin/activate</code></pre><p><a href="https://zhuanlan.zhihu.com/p/60647332" target="_blank" rel="noopener">最全的 Python 虚拟环境使用方法</a></p><pre class=" language-sh"><code class="language-sh"># ERROR: Could not install packages due to an EnvironmentError: Missing dependencies for SOCKS support.unset all_proxyunset ALL_PROXYpip install pysockssource ~/.bashrc</code></pre><p><a href="https://zhuanlan.zhihu.com/p/43298296" target="_blank" rel="noopener">Win10 下 Ubuntu(WSL)中 Python 环境配置笔记 Conda 虚拟环境</a></p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update<span class="token function">sudo</span> <span class="token function">apt-get</span> upgrade<span class="token function">sudo</span> <span class="token function">reboot</span><span class="token function">wget</span> https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh<span class="token function">sudo</span> <span class="token function">chmod</span> 777 Miniconda3-latest-Linux-x86_64.sh <span class="token comment" spellcheck="true">#懒人操作</span>./Miniconda3-latest-Linux-x86_64.shvim /home/YOURNAME/.bashrc<span class="token function">export</span> PATH<span class="token operator">=</span>/home/YOURNAME/miniconda3/bin/conda:<span class="token variable">$PATH</span><span class="token function">source</span> /home/YOURNAME/.bashrc<span class="token keyword">echo</span> <span class="token variable">$PATH</span>conda create -n py36 python<span class="token operator">=</span>3.6conda activate py36<span class="token comment" spellcheck="true">#conda deactivate 用以退出环境</span>conda <span class="token function">install</span> jupyterjupyter notebook <span class="token comment" spellcheck="true"># 运行jupyter，用给出的链接可在Win10访问</span></code></pre><h3 id="pip-下载异常"><a href="#pip-下载异常" class="headerlink" title="pip 下载异常"></a><a href="https://github.com/microsoft/WSL/issues/6643" target="_blank" rel="noopener">pip 下载异常</a></h3><p>会等几分钟后再下载</p><pre><code>DISPLAY= pip install &lt;packagename&gt;</code></pre><p>或者</p><p><a href="https://stackoverflow.com/q/68369527" target="_blank" rel="noopener">Importing <code>keyring</code> taking very long in WSL2</a> is an already known problem, that has been <a href="https://github.com/jaraco/keyring/issues/531" target="_blank" rel="noopener">fixed in keyring versions ≥ 21.6.0</a>.</p><p>Therefore, updating <code>keyring</code> to the latest version should solve the problem:</p><pre><code>DISPLAY= pip install -U keyring</code></pre><h3 id="网络问题"><a href="#网络问题" class="headerlink" title="网络问题"></a>网络问题</h3><p>重置网络可修复</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 测试网络</span>curl baidu.com<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>FIX WSL2 NETWORKING IN WINDOWS 10<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>cmd as admin:wsl --shutdownnetsh winsock resetnetsh int ip reset allnetsh winhttp reset proxyipconfig /flushdnsWindows Search <span class="token operator">></span> Network ResetRestart Windows</code></pre><h3 id="备份-迁移-WSL2-下的子系统步骤："><a href="#备份-迁移-WSL2-下的子系统步骤：" class="headerlink" title="备份/迁移 WSL2 下的子系统步骤："></a><a href="https://www.cnblogs.com/davidchild/p/15606786.html" target="_blank" rel="noopener">备份/迁移 WSL2 下的子系统步骤：</a></h3><p>最近遇到一个问题，使用 WSL2 一段时间后，由于 WSL2 默认的安装目录是 C USER，随着使用时间的增长，C 盘被 WSL2 占用的空间也随之增长。因此需要对原</p><p>本已安装的 WSL2 进行重新备份，迁移，并且要迁移到其他目录中。</p><p>我的系统是 Windows,预装了 WSL2 下的子系统：wsl-ubuntu20.04。</p><p><a href="https://docs.microsoft.com/zh-cn/windows/wsl/basic-commands" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/windows/wsl/basic-commands</a></p><h4 id="1-在-Windows-PowerShell-中输入如下命令"><a href="#1-在-Windows-PowerShell-中输入如下命令" class="headerlink" title="1.在 Windows PowerShell 中输入如下命令"></a>1.在 Windows PowerShell 中输入如下命令</h4><pre class=" language-bash"><code class="language-bash">wsl -l --all -v</code></pre><h4 id="2-导出分发版为-tar-文件到-d-盘-如果你只是备份，那么下面的到第二步就可以了"><a href="#2-导出分发版为-tar-文件到-d-盘-如果你只是备份，那么下面的到第二步就可以了" class="headerlink" title="2.导出分发版为 tar 文件到 d 盘(如果你只是备份，那么下面的到第二步就可以了)"></a>2.导出分发版为 tar 文件到 d 盘(如果你只是备份，那么下面的到第二步就可以了)</h4><pre class=" language-bash"><code class="language-bash">wsl --export Ubuntu-20.04 e:wsl-ubuntu20.04.tar</code></pre><h4 id="3-注销当前分发版"><a href="#3-注销当前分发版" class="headerlink" title="3.注销当前分发版"></a>3.注销当前分发版</h4><pre class=" language-bash"><code class="language-bash">wsl --unregister Ubuntu-20.04</code></pre><h4 id="4-重新导入并安装-WSL-在-d-wsl-ubuntu20-04（迁移-还原到其他目录）"><a href="#4-重新导入并安装-WSL-在-d-wsl-ubuntu20-04（迁移-还原到其他目录）" class="headerlink" title="4.重新导入并安装 WSL 在 d:wsl-ubuntu20.04（迁移/还原到其他目录）"></a>4.重新导入并安装 WSL 在 d:wsl-ubuntu20.04（迁移/还原到其他目录）</h4><pre class=" language-bash"><code class="language-bash">wsl --import Ubuntu-20.04 e:wsl-ubuntu20.04 e:wsl-ubuntu20.04.tar --version 2</code></pre><h4 id="5-删除-tar-文件-可选"><a href="#5-删除-tar-文件-可选" class="headerlink" title="5.删除 tar 文件(可选)"></a>5.删除 tar 文件(可选)</h4><pre class=" language-bash"><code class="language-bash">del d:wsl-ubuntu20.04.tar</code></pre><p><strong>踩坑记录：</strong></p><p>迁移之后，会发现 Linux 子系统跟 Windows10 docker 通讯不了，</p><p>例如：当在子系统输入 docker ps 命令时，会报：Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</p><p><strong>此时需要重新需要去 Windows 10 Docker Setting 设置：</strong></p><p>General -&gt; use the wsl2 based engine</p><p>Resourse -&gt; wsl integration -&gt; enable integration with my default distro</p><p><strong>二、迁移 windows10 Docker 目录</strong></p><p>在 Windows PowerShell</p><p><strong>1、关闭和 wsl</strong></p><pre><code>wsl --shutdown</code></pre><p><strong>2、备份到处 docker data</strong></p><pre><code>wsl --export docker-desktop-data e:\docker-desktop-data.tar&lt;/P&gt;</code></pre><p><strong>3、注销 docker-desktop-data</strong></p><pre><code>wsl --unregister docker-desktop-data</code></pre><p>4、重新导入 docker-desktop-data 到要存放的文件夹，我这边的文件夹为：e:\docker-desktop-data</p><pre><code>wsl --import docker-desktop-data e:\docker-desktop-data\ e:\docker-desktop-data.tar --version 2</code></pre><p>5、重新设置 子系统 为 WSL2 –可以忽略此步骤</p><pre><code>wsl --set-version Ubuntu-20.04 2</code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 前端 </tag>
            
            <tag> JavaScript </tag>
            
            <tag> WSL2 </tag>
            
            <tag> Python </tag>
            
            <tag> VSCode </tag>
            
            <tag> proxy </tag>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React + TypeScript + Tailwindcss 开发油猴脚本</title>
      <link href="/2022/05/25/react-typescript-tailwindcss-kai-fa-you-hou-jiao-ben/"/>
      <url>/2022/05/25/react-typescript-tailwindcss-kai-fa-you-hou-jiao-ben/</url>
      
        <content type="html"><![CDATA[<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>想给 <a href="https://github.com/Eished/jkforum_helper" target="_blank" rel="noopener">jkforum_helper</a> 油猴脚本加入前端 UI，用前端框架来开发提高开发效率。</p><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>此脚本只需要一个页面，里面只有表单元素。</p><p><img src="https://cdn.jsdelivr.net/gh/eished/jkforum_helper@0.7.0/readme.assets/20220419013050.png" alt="20220419013050"></p><h2 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h2><p>TypeScript 类型检查可以提前发现代码问题，提高代码质量，以及更强大的代码补全，必选。</p><p>首先去网上搜索、分析、尝试了很多框架，都没有理想的。</p><p>分析自己常用的脚本，看到 <a href="https://github.com/the1812/Bilibili-Evolved" target="_blank" rel="noopener">Bilibili-Evolved</a> 项目已经很成熟，插件化、组件化代码开发符合脚本开发的理想状态，想直接使用此项目作为模板开发。</p><p>仔细分析其代码过后，觉得对于我的需求代码冗余，我想要一个简单通用的 TypeScript 前端项目，又因其使用的是 Vue2，对 TypeScript 不友好，决定使用 React + TypeScript 自己写。</p><p>UI 库方面，计划使用人气很高的 Ant Design，实际尝试后，对开发的打包速度和生成文件的大小影响较大，并且会影响源网站的样式。尝试了平时使用较多的 Tailwindcss，虽然同样会影响源网站的样式，但打包更快，体积小，更灵活，更适合这种轻前端的项目。</p><p>最终测试下来：React + TypeScript + Tailwindcss 符合需求。</p><h2 id="项目移植"><a href="#项目移植" class="headerlink" title="项目移植"></a>项目移植</h2><h3 id="初始化环境"><a href="#初始化环境" class="headerlink" title="初始化环境"></a>初始化环境</h3><p><code>npm init</code></p><h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3><p>package.json</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"jkforum-helper"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"![JKFicon64oval2](https://cdn.jsdelivr.net/gh/eished/jkforum_helper/readme.assets/JKFicon64oval2.png)"</span><span class="token punctuation">,</span>  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"/dist/jkforum.user.js"</span><span class="token punctuation">,</span>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"webpack serve"</span><span class="token punctuation">,</span>    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"webpack --watch"</span><span class="token punctuation">,</span>    <span class="token property">"style"</span><span class="token operator">:</span> <span class="token string">"npx tailwindcss -i ./src/input.css -o ./src/output.css --watch"</span><span class="token punctuation">,</span>    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"yarn lint &amp;&amp; npx tailwindcss -i ./src/input.css -o ./src/output.css &amp;&amp; webpack --env production"</span><span class="token punctuation">,</span>    <span class="token property">"lint"</span><span class="token operator">:</span> <span class="token string">"eslint 'src/**/*.{ts,tsx}'"</span><span class="token punctuation">,</span>    <span class="token property">"lint:fix"</span><span class="token operator">:</span> <span class="token string">"yarn lint --fix"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"repository"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"git"</span><span class="token punctuation">,</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"git+https://github.com/Eished/jkforum_helper.git"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"JKForum"</span><span class="token punctuation">,</span> <span class="token string">"TamperMonkey"</span><span class="token punctuation">,</span> <span class="token string">"tailwindcsss"</span><span class="token punctuation">,</span> <span class="token string">"typescript"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"Eished"</span><span class="token punctuation">,</span>  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span>  <span class="token property">"bugs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://github.com/Eished/jkforum_helper/issues"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"homepage"</span><span class="token operator">:</span> <span class="token string">"https://github.com/Eished/jkforum_helper#readme"</span><span class="token punctuation">,</span>  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"@babel/core"</span><span class="token operator">:</span> <span class="token string">"^7.17.9"</span><span class="token punctuation">,</span>    <span class="token property">"@babel/preset-env"</span><span class="token operator">:</span> <span class="token string">"^7.16.11"</span><span class="token punctuation">,</span>    <span class="token property">"@babel/preset-react"</span><span class="token operator">:</span> <span class="token string">"^7.16.7"</span><span class="token punctuation">,</span>    <span class="token property">"@tailwindcss/forms"</span><span class="token operator">:</span> <span class="token string">"^0.5.1"</span><span class="token punctuation">,</span>    <span class="token property">"@types/file-saver"</span><span class="token operator">:</span> <span class="token string">"^2.0.5"</span><span class="token punctuation">,</span>    <span class="token property">"@types/react"</span><span class="token operator">:</span> <span class="token string">"^18.0.5"</span><span class="token punctuation">,</span>    <span class="token property">"@types/react-dom"</span><span class="token operator">:</span> <span class="token string">"^18.0.1"</span><span class="token punctuation">,</span>    <span class="token property">"@typescript-eslint/eslint-plugin"</span><span class="token operator">:</span> <span class="token string">"^5.19.0"</span><span class="token punctuation">,</span>    <span class="token property">"@typescript-eslint/parser"</span><span class="token operator">:</span> <span class="token string">"^5.19.0"</span><span class="token punctuation">,</span>    <span class="token property">"autoprefixer"</span><span class="token operator">:</span> <span class="token string">"^10.4.4"</span><span class="token punctuation">,</span>    <span class="token property">"babel-loader"</span><span class="token operator">:</span> <span class="token string">"^8.2.4"</span><span class="token punctuation">,</span>    <span class="token property">"css-loader"</span><span class="token operator">:</span> <span class="token string">"^6.7.1"</span><span class="token punctuation">,</span>    <span class="token property">"eslint"</span><span class="token operator">:</span> <span class="token string">"^8.13.0"</span><span class="token punctuation">,</span>    <span class="token property">"eslint-config-prettier"</span><span class="token operator">:</span> <span class="token string">"^8.5.0"</span><span class="token punctuation">,</span>    <span class="token property">"eslint-plugin-html"</span><span class="token operator">:</span> <span class="token string">"^6.2.0"</span><span class="token punctuation">,</span>    <span class="token property">"eslint-plugin-prettier"</span><span class="token operator">:</span> <span class="token string">"^4.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"eslint-plugin-react"</span><span class="token operator">:</span> <span class="token string">"^7.29.4"</span><span class="token punctuation">,</span>    <span class="token property">"eslint-plugin-react-hooks"</span><span class="token operator">:</span> <span class="token string">"^4.4.0"</span><span class="token punctuation">,</span>    <span class="token property">"html-webpack-plugin"</span><span class="token operator">:</span> <span class="token string">"^5.5.0"</span><span class="token punctuation">,</span>    <span class="token property">"less"</span><span class="token operator">:</span> <span class="token string">"^4.1.2"</span><span class="token punctuation">,</span>    <span class="token property">"less-loader"</span><span class="token operator">:</span> <span class="token string">"^10.2.0"</span><span class="token punctuation">,</span>    <span class="token property">"postcss"</span><span class="token operator">:</span> <span class="token string">"^8.4.12"</span><span class="token punctuation">,</span>    <span class="token property">"postcss-loader"</span><span class="token operator">:</span> <span class="token string">"^6.2.1"</span><span class="token punctuation">,</span>    <span class="token property">"postcss-preset-env"</span><span class="token operator">:</span> <span class="token string">"^7.4.3"</span><span class="token punctuation">,</span>    <span class="token property">"prettier"</span><span class="token operator">:</span> <span class="token string">"^2.6.2"</span><span class="token punctuation">,</span>    <span class="token property">"style-loader"</span><span class="token operator">:</span> <span class="token string">"^3.3.1"</span><span class="token punctuation">,</span>    <span class="token property">"tailwindcss"</span><span class="token operator">:</span> <span class="token string">"^3.0.24"</span><span class="token punctuation">,</span>    <span class="token property">"to-string-loader"</span><span class="token operator">:</span> <span class="token string">"^1.2.0"</span><span class="token punctuation">,</span>    <span class="token property">"ts-loader"</span><span class="token operator">:</span> <span class="token string">"^9.2.8"</span><span class="token punctuation">,</span>    <span class="token property">"typescript"</span><span class="token operator">:</span> <span class="token string">"^4.6.3"</span><span class="token punctuation">,</span>    <span class="token property">"webpack"</span><span class="token operator">:</span> <span class="token string">"^5.72.0"</span><span class="token punctuation">,</span>    <span class="token property">"webpack-cli"</span><span class="token operator">:</span> <span class="token string">"^4.9.2"</span><span class="token punctuation">,</span>    <span class="token property">"webpack-dev-server"</span><span class="token operator">:</span> <span class="token string">"^4.9.0"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"file-saver"</span><span class="token operator">:</span> <span class="token string">"^2.0.5"</span><span class="token punctuation">,</span>    <span class="token property">"jszip"</span><span class="token operator">:</span> <span class="token string">"^3.9.1"</span><span class="token punctuation">,</span>    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"^18.1.0"</span><span class="token punctuation">,</span>    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"^18.1.0"</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="配置-TypeScript"><a href="#配置-TypeScript" class="headerlink" title="配置 TypeScript"></a>配置 TypeScript</h3><p>tsconfig.json</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"jsx"</span><span class="token operator">:</span> <span class="token string">"react"</span><span class="token punctuation">,</span>    <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"es2016"</span> /* Set the JavaScript language version for emitted JavaScript and include compatible library declarations. */<span class="token punctuation">,</span>    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"commonjs"</span> /* Specify what module code is generated. */<span class="token punctuation">,</span>    <span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"./"</span> /* Specify the base directory to resolve non-relative module names. */<span class="token punctuation">,</span>    <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"@/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/*"</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span> /* Specify a set of entries that re-map imports to additional lookup locations. */<span class="token punctuation">,</span>    <span class="token property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span> /* Emit additional JavaScript to ease support for importing CommonJS modules. This enables `allowSyntheticDefaultImports` for type compatibility. */<span class="token punctuation">,</span>    <span class="token property">"forceConsistentCasingInFileNames"</span><span class="token operator">:</span> <span class="token boolean">true</span> /* Ensure that casing is correct in imports. */<span class="token punctuation">,</span>    <span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span> /* Enable all strict type-checking options. */<span class="token punctuation">,</span>    <span class="token property">"skipLibCheck"</span><span class="token operator">:</span> <span class="token boolean">false</span> /* Skip type checking all .d.ts files. */  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="油猴-API-类型声明"><a href="#油猴-API-类型声明" class="headerlink" title="油猴 API 类型声明"></a>油猴 API 类型声明</h3><p>global.d.ts</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/* eslint-disable @typescript-eslint/no-explicit-any */</span><span class="token keyword">import</span> <span class="token punctuation">{</span> XhrResponseType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/commonType'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// https://juejin.cn/post/6898710177969602574</span>declare global <span class="token punctuation">{</span>  <span class="token keyword">interface</span> <span class="token class-name">MonkeyXhrResponse</span> <span class="token punctuation">{</span>    finalUrl<span class="token punctuation">:</span> string<span class="token punctuation">;</span>    readyState<span class="token punctuation">:</span> number<span class="token punctuation">;</span>    status<span class="token punctuation">:</span> number<span class="token punctuation">;</span>    statusText<span class="token punctuation">:</span> string<span class="token punctuation">;</span>    responseHeaders<span class="token punctuation">:</span> any<span class="token punctuation">;</span>    response<span class="token punctuation">:</span> any<span class="token punctuation">;</span>    responseXML<span class="token punctuation">:</span> Document<span class="token punctuation">;</span>    responseText<span class="token punctuation">:</span> string<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">interface</span> <span class="token class-name">MonkeyXhrBasicDetails</span> <span class="token punctuation">{</span>    url<span class="token punctuation">:</span> string<span class="token punctuation">;</span>    method<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string">'GET'</span> <span class="token operator">|</span> <span class="token string">'POST'</span> <span class="token operator">|</span> <span class="token string">'HEAD'</span><span class="token punctuation">;</span>    headers<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>name<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> string <span class="token punctuation">}</span><span class="token punctuation">;</span>    data<span class="token operator">?</span><span class="token punctuation">:</span> string<span class="token punctuation">;</span>    binary<span class="token operator">?</span><span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>    timeout<span class="token operator">?</span><span class="token punctuation">:</span> number<span class="token punctuation">;</span>    context<span class="token operator">?</span><span class="token punctuation">:</span> any<span class="token punctuation">;</span>    responseType<span class="token operator">?</span><span class="token punctuation">:</span> XhrResponseType<span class="token punctuation">;</span>    overrideMimeType<span class="token operator">?</span><span class="token punctuation">:</span> string<span class="token punctuation">;</span>    anonymous<span class="token operator">?</span><span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>    fetch<span class="token operator">?</span><span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>    username<span class="token operator">?</span><span class="token punctuation">:</span> string<span class="token punctuation">;</span>    password<span class="token operator">?</span><span class="token punctuation">:</span> string<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">interface</span> <span class="token class-name">MonkeyXhrDetails</span> <span class="token keyword">extends</span> <span class="token class-name">MonkeyXhrBasicDetails</span> <span class="token punctuation">{</span>    onabort<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>response<span class="token punctuation">:</span> MonkeyXhrResponse<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">void</span><span class="token punctuation">;</span>    onerror<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>response<span class="token punctuation">:</span> MonkeyXhrResponse<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">void</span><span class="token punctuation">;</span>    onloadstart<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>response<span class="token punctuation">:</span> MonkeyXhrResponse<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">void</span><span class="token punctuation">;</span>    onprogress<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>response<span class="token punctuation">:</span> MonkeyXhrResponse<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">void</span><span class="token punctuation">;</span>    onreadystatechange<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>response<span class="token punctuation">:</span> MonkeyXhrResponse<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">void</span><span class="token punctuation">;</span>    ontimeout<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>response<span class="token punctuation">:</span> MonkeyXhrResponse<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">void</span><span class="token punctuation">;</span>    onload<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>response<span class="token punctuation">:</span> MonkeyXhrResponse<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">void</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  type RunAtOptions <span class="token operator">=</span> <span class="token string">'document-start'</span> <span class="token operator">|</span> <span class="token string">'document-end'</span> <span class="token operator">|</span> <span class="token string">'document-idle'</span> <span class="token operator">|</span> <span class="token string">'document-body'</span> <span class="token operator">|</span> <span class="token string">'context-menu'</span><span class="token punctuation">;</span>  <span class="token keyword">interface</span> <span class="token class-name">MonkeyInfo</span> <span class="token punctuation">{</span>    script<span class="token punctuation">:</span> <span class="token punctuation">{</span>      author<span class="token punctuation">:</span> string<span class="token punctuation">;</span>      copyright<span class="token punctuation">:</span> string<span class="token punctuation">;</span>      description<span class="token punctuation">:</span> string<span class="token punctuation">;</span>      excludes<span class="token punctuation">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      homepage<span class="token punctuation">:</span> string<span class="token punctuation">;</span>      icon<span class="token punctuation">:</span> string<span class="token punctuation">;</span>      icon64<span class="token punctuation">:</span> string<span class="token punctuation">;</span>      includes<span class="token punctuation">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      lastUpdated<span class="token punctuation">:</span> number<span class="token punctuation">;</span>      matches<span class="token punctuation">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      downloadMode<span class="token punctuation">:</span> string<span class="token punctuation">;</span>      name<span class="token punctuation">:</span> string<span class="token punctuation">;</span>      namespace<span class="token punctuation">:</span> string<span class="token punctuation">;</span>      options<span class="token punctuation">:</span> <span class="token punctuation">{</span>        awareOfChrome<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>        compat_arrayleft<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>        compat_foreach<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>        compat_forvarin<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>        compat_metadata<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>        compat_prototypes<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>        compat_uW_gmonkey<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>        noframes<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>        override<span class="token punctuation">:</span> <span class="token punctuation">{</span>          excludes<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>          includes<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>          orig_excludes<span class="token punctuation">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          orig_includes<span class="token punctuation">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          use_excludes<span class="token punctuation">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          use_includes<span class="token punctuation">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        run_at<span class="token punctuation">:</span> RunAtOptions<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      position<span class="token punctuation">:</span> number<span class="token punctuation">;</span>      resources<span class="token punctuation">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token string">'run-at'</span><span class="token punctuation">:</span> RunAtOptions<span class="token punctuation">;</span>      system<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>      unwrap<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>      version<span class="token punctuation">:</span> string<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    scriptMetaStr<span class="token punctuation">:</span> string<span class="token punctuation">;</span>    scriptSource<span class="token punctuation">:</span> string<span class="token punctuation">;</span>    scriptUpdateURL<span class="token punctuation">:</span> string<span class="token punctuation">;</span>    scriptWillUpdate<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>    scriptHandler<span class="token punctuation">:</span> string<span class="token punctuation">;</span>    isIncognito<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>    version<span class="token punctuation">:</span> string<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">const</span> GM_info<span class="token punctuation">:</span> MonkeyInfo<span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">GM_xmlhttpRequest</span><span class="token punctuation">(</span>details<span class="token punctuation">:</span> MonkeyXhrDetails<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> abort<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">void</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">function</span> GM_setValue<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> string<span class="token punctuation">,</span> value<span class="token punctuation">:</span> T<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>  <span class="token keyword">function</span> GM_getValue<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> string<span class="token punctuation">,</span> defaultValue<span class="token operator">?</span><span class="token punctuation">:</span> T<span class="token punctuation">)</span><span class="token punctuation">:</span> T<span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">GM_deleteValue</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">GM_getResourceText</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span> string<span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">GM_getResourceURL</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span> string<span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">GM_addStyle</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span> string<span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">GM_addElement</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span> string<span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">GM_notification</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span> string<span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">GM_openInTab</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span> string<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h3 id="配置-Tailwindcss"><a href="#配置-Tailwindcss" class="headerlink" title="配置 Tailwindcss"></a>配置 Tailwindcss</h3><p>tailwind.config.js</p><pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>  content<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'./src/**/*.{html,js,jsx,ts,tsx}'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  theme<span class="token punctuation">:</span> <span class="token punctuation">{</span>    extend<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@tailwindcss/forms'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">}</span></code></pre><h3 id="配置-webpack"><a href="#配置-webpack" class="headerlink" title="配置 webpack"></a>配置 webpack</h3><p>webpack.config.js</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token keyword">const</span> commonMeta <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./src/common.meta.json'</span><span class="token punctuation">)</span><span class="token keyword">const</span> year <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> getBanner <span class="token operator">=</span> meta <span class="token operator">=</span><span class="token operator">></span> <span class="token template-string"><span class="token string">`// ==UserScript==\n${Object.entries(Object.assign(meta, commonMeta))  .map(([key, value]) => {    if (Array.isArray(value)) {      return value.map(item => `</span></span><span class="token comment" spellcheck="true">// @${key.padEnd(20, ' ')}${item}`).join('\n')</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`// @</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token punctuation">.</span><span class="token function">padEnd</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\[year\]/g</span><span class="token punctuation">,</span> year<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ==/UserScript==</span><span class="token comment" spellcheck="true">/* eslint-disable */</span> <span class="token comment" spellcheck="true">/* spell-checker: disable */</span><span class="token comment" spellcheck="true">// @[ You can find all source codes in GitHub repo ]`</span><span class="token keyword">const</span> relativePath <span class="token operator">=</span> p <span class="token operator">=</span><span class="token operator">></span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token keyword">const</span> src <span class="token operator">=</span> <span class="token function">relativePath</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> env <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span>  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>    entry<span class="token punctuation">:</span> <span class="token string">'./src/index.tsx'</span><span class="token punctuation">,</span>    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>      path<span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      filename<span class="token punctuation">:</span> env<span class="token punctuation">.</span>production <span class="token operator">?</span> <span class="token string">'jkforum.user.js'</span> <span class="token punctuation">:</span> <span class="token string">'jkforum.dev.user.js'</span><span class="token punctuation">,</span>      publicPath<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    externals<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    module<span class="token punctuation">:</span> <span class="token punctuation">{</span>      rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>          test<span class="token punctuation">:</span> <span class="token regex">/\.(js|jsx|mjs)$/</span><span class="token punctuation">,</span>          exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>          use<span class="token punctuation">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">{</span>              loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>              options<span class="token punctuation">:</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// 预设：指示babel做怎么样的兼容性处理。</span>                presets<span class="token punctuation">:</span> <span class="token punctuation">[</span>                  <span class="token punctuation">[</span>                    <span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span>                    <span class="token punctuation">{</span>                      corejs<span class="token punctuation">:</span> <span class="token punctuation">{</span>                        version<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>                      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 按需加载</span>                      useBuiltIns<span class="token punctuation">:</span> <span class="token string">'usage'</span><span class="token punctuation">,</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                  <span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token string">'@babel/preset-react'</span><span class="token punctuation">,</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>          test<span class="token punctuation">:</span> <span class="token regex">/\.tsx?$/</span><span class="token punctuation">,</span>          use<span class="token punctuation">:</span> <span class="token string">'ts-loader'</span><span class="token punctuation">,</span>          exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>          include<span class="token punctuation">:</span> <span class="token punctuation">[</span>src<span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>          test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>          use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          include<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>          test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>          <span class="token comment" spellcheck="true">// 使用哪些 loader 进行处理</span>          use<span class="token punctuation">:</span> <span class="token punctuation">[</span>            <span class="token comment" spellcheck="true">// use 数组中 loader 执行顺序：从右到左，从下到上 依次执行</span>            <span class="token comment" spellcheck="true">// 创建 style 标签，将 js 中的样式资源插入进行，添加到 head 中生效</span>            <span class="token comment" spellcheck="true">// GM_addStyle 不需要 style-loader</span>            <span class="token comment" spellcheck="true">// 'style-loader',</span>            <span class="token string">'to-string-loader'</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">// 将 css 文件变成 commonjs 模块加载 js 中，里面内容是样式字符串</span>            <span class="token comment" spellcheck="true">// esModule: false 可以 toString()</span>            <span class="token punctuation">{</span>              loader<span class="token punctuation">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>              options<span class="token punctuation">:</span> <span class="token punctuation">{</span>                esModule<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>              <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>          include<span class="token punctuation">:</span> <span class="token punctuation">[</span>src<span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span>          test<span class="token punctuation">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span>          <span class="token comment" spellcheck="true">// 使用哪些 loader 进行处理</span>          use<span class="token punctuation">:</span> <span class="token punctuation">[</span>            <span class="token comment" spellcheck="true">// use 数组中 loader 执行顺序：从右到左，从下到上 依次执行</span>            <span class="token comment" spellcheck="true">// 创建 style 标签，将 js 中的样式资源插入进行，添加到 head 中生效</span>            <span class="token string">'style-loader'</span><span class="token punctuation">,</span>            <span class="token comment" spellcheck="true">// 将 css 文件变成 commonjs 模块加载 js 中，里面内容是样式字符串</span>            <span class="token string">'css-loader'</span><span class="token punctuation">,</span>            <span class="token punctuation">{</span>              loader<span class="token punctuation">:</span> <span class="token string">'less-loader'</span><span class="token punctuation">,</span>              options<span class="token punctuation">:</span> <span class="token punctuation">{</span>                lessOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>                  javascriptEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>              <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>      minimize<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      minimizer<span class="token punctuation">:</span> <span class="token punctuation">[</span>        <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          terserOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>            output<span class="token punctuation">:</span> <span class="token punctuation">{</span>              comments<span class="token punctuation">:</span> <span class="token regex">/==\/?UserScript==|^[ ]?@|eslint-disable|spell-checker/i</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>          extractComments<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    watchOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>      ignored<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>      extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'.tsx'</span><span class="token punctuation">,</span> <span class="token string">'.ts'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.jsx'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token string">'@'</span><span class="token punctuation">:</span> src<span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    mode<span class="token punctuation">:</span> env<span class="token punctuation">.</span>production <span class="token operator">?</span> <span class="token string">'production'</span> <span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// devtool: 'source-map',</span>    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>      <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>BannerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        banner<span class="token punctuation">:</span> <span class="token function">getBanner</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> env<span class="token punctuation">.</span>production <span class="token operator">?</span> <span class="token string">'JKForum 助手'</span> <span class="token punctuation">:</span> <span class="token string">'JKForum 助手-dev'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        raw<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        entryOnly<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>env<span class="token punctuation">.</span>production<span class="token punctuation">)</span> <span class="token punctuation">{</span>    options<span class="token punctuation">.</span>devServer <span class="token operator">=</span> <span class="token punctuation">{</span>      <span class="token keyword">static</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>        directory<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      compress<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      port<span class="token punctuation">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>      hot<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      open<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      watchFiles<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'src/**/*.tsx'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 无效</span>    <span class="token punctuation">}</span>    options<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>      <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        template<span class="token punctuation">:</span> <span class="token string">'./public/index.html'</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> options<span class="token punctuation">}</span></code></pre><h3 id="添加代码规范"><a href="#添加代码规范" class="headerlink" title="添加代码规范"></a>添加代码规范</h3><pre class=" language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>  parser<span class="token punctuation">:</span> <span class="token string">'@typescript-eslint/parser'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 定义ESLint的解析器</span>  <span class="token keyword">extends</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'eslint:recommended'</span><span class="token punctuation">,</span> <span class="token string">'plugin:react/recommended'</span><span class="token punctuation">,</span> <span class="token string">'plugin:@typescript-eslint/recommended'</span><span class="token punctuation">,</span> <span class="token string">'prettier'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//定义文件继承的子规范</span>  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'@typescript-eslint'</span><span class="token punctuation">,</span> <span class="token string">'react-hooks'</span><span class="token punctuation">,</span> <span class="token string">'eslint-plugin-react'</span><span class="token punctuation">,</span> <span class="token string">'html'</span><span class="token punctuation">,</span> <span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token string">'prettier'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">//定义了该eslint文件所依赖的插件</span>  env<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//指定代码的运行环境</span>    browser<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    node<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    es2021<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  settings<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//自动发现React的版本，从而进行规范react代码</span>    react<span class="token punctuation">:</span> <span class="token punctuation">{</span>      pragma<span class="token punctuation">:</span> <span class="token string">'React'</span><span class="token punctuation">,</span>      version<span class="token punctuation">:</span> <span class="token string">'detect'</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  parserOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//指定ESLint可以解析JSX语法</span>    ecmaFeatures<span class="token punctuation">:</span> <span class="token punctuation">{</span>      jsx<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    ecmaVersion<span class="token punctuation">:</span> <span class="token string">'latest'</span><span class="token punctuation">,</span>    sourceType<span class="token punctuation">:</span> <span class="token string">'module'</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  rules<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 自定义的一些规则</span>    <span class="token string">'prettier/prettier'</span><span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>    <span class="token string">'linebreak-style'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'unix'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string">'react-hooks/rules-of-hooks'</span><span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>    <span class="token string">'react-hooks/exhaustive-deps'</span><span class="token punctuation">:</span> <span class="token string">'warn'</span><span class="token punctuation">,</span>    <span class="token string">'react/jsx-uses-react'</span><span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>    <span class="token string">'react/jsx-uses-vars'</span><span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>    <span class="token string">'react/react-in-jsx-scope'</span><span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>    <span class="token string">'valid-typeof'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>      <span class="token string">'warn'</span><span class="token punctuation">,</span>      <span class="token punctuation">{</span>        requireStringLiterals<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string">'@typescript-eslint/no-var-requires'</span><span class="token punctuation">:</span> <span class="token string">'off'</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span></code></pre><h3 id="试运行"><a href="#试运行" class="headerlink" title="试运行"></a>试运行</h3><pre class=" language-javascript"><code class="language-javascript">yarn dev</code></pre><h3 id="进行代码移植"><a href="#进行代码移植" class="headerlink" title="进行代码移植"></a>进行代码移植</h3><p>项目文件结构</p><pre class=" language-text"><code class="language-text">| dist| public| doc| src| | idnex.tsx   // React 入口| | app.tsx     // 悬浮按钮初始化数据| | output.css  // tailwindcss 样式文件| | global.d.ts // 油猴 API 的类型声明| | —— components| | —— lib| | —— utils</code></pre><h2 id="优化提升"><a href="#优化提升" class="headerlink" title="优化提升"></a>优化提升</h2><h3 id="TailwindCSS-样式与源网站冲突"><a href="#TailwindCSS-样式与源网站冲突" class="headerlink" title="TailwindCSS 样式与源网站冲突"></a>TailwindCSS 样式与源网站冲突</h3><p>webpack.config.js</p><pre class=" language-javascript"><code class="language-javascript"> <span class="token punctuation">{</span>    test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 使用哪些 loader 进行处理</span>    use<span class="token punctuation">:</span> <span class="token punctuation">[</span>      <span class="token comment" spellcheck="true">// use 数组中 loader 执行顺序：从右到左，从下到上 依次执行</span>      <span class="token comment" spellcheck="true">// 创建 style 标签，将 js 中的样式资源插入进行，添加到 head 中生效</span>      <span class="token comment" spellcheck="true">// GM_addStyle 不需要 style-loader</span>      <span class="token comment" spellcheck="true">// 'style-loader',</span>      <span class="token string">'to-string-loader'</span><span class="token punctuation">,</span>      <span class="token comment" spellcheck="true">// 将 css 文件变成 commonjs 模块加载 js 中，里面内容是样式字符串</span>      <span class="token comment" spellcheck="true">// esModule: false 可以 toString()</span>      <span class="token punctuation">{</span>        loader<span class="token punctuation">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>          esModule<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    include<span class="token punctuation">:</span> <span class="token punctuation">[</span>src<span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>使用 loadStyle 函数过滤掉冲突的样式，再用 GM_addStyle 插入样式</p><h3 id="本地调试与热刷新"><a href="#本地调试与热刷新" class="headerlink" title="本地调试与热刷新"></a>本地调试与热刷新</h3><p>油猴头文件加入 <code>// @match http://localhost:8080/*</code></p><p>webpack.config.js</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>env<span class="token punctuation">.</span>production<span class="token punctuation">)</span> <span class="token punctuation">{</span>  options<span class="token punctuation">.</span>devServer <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>      directory<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    compress<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    port<span class="token punctuation">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>    hot<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    open<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    watchFiles<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'src/**/*.tsx'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 无效</span>  <span class="token punctuation">}</span>  options<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      template<span class="token punctuation">:</span> <span class="token string">'./public/index.html'</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><p><code>start: style &amp; dev</code> 启动项目，然后 <code>yarn start</code></p><p>把目标网站的静态 <code>html</code> 文件复制到 <code>public</code> 文件夹下，插入到 <code>index.html</code> 即可本地调试脚本静态功能。</p><ul><li><p><code>yarn start</code> devServer 提供 web 服务和网页热刷新功能</p></li><li><p><code>start: style &amp; dev</code> 生成脚本，让 tampermonkey 使用</p></li></ul><h3 id="拆包发布"><a href="#拆包发布" class="headerlink" title="拆包发布"></a>拆包发布</h3><p>webpack 配置 splitchunks 拆包，减小发布体积</p><p>webpack.config.js</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 单独打包react 和 react-dom file-saver jszip</span><span class="token comment" spellcheck="true">// greasyfork 无法引入私人库</span>  splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>    cacheGroups<span class="token punctuation">:</span> <span class="token punctuation">{</span>      vendor<span class="token punctuation">:</span> <span class="token punctuation">{</span>        test<span class="token punctuation">:</span> <span class="token regex">/[\\/]node_modules[\\/](react|react-dom|file-saver|jszip)[\\/]/</span><span class="token punctuation">,</span>        name<span class="token punctuation">:</span> <span class="token string">'vendor'</span><span class="token punctuation">,</span>        chunks<span class="token punctuation">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>生成主文件发布，生成的 module 文件使用 @require 从自己代码库的 CDN 导入</p><blockquote><p>实测提示：Code 使用了一个未经批准的外部脚本，无法发布。</p></blockquote><h3 id="GItHub-Actions-自动构建"><a href="#GItHub-Actions-自动构建" class="headerlink" title="GItHub Actions 自动构建"></a>GItHub Actions 自动构建</h3><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>项目地址：<a href="https://github.com/Eished/jkforum_helper" target="_blank" rel="noopener">https://github.com/Eished/jkforum_helper</a></p><p>参考项目及其文档：<a href="https://bilibili-evolved-doc.vercel.app/developer" target="_blank" rel="noopener">https://bilibili-evolved-doc.vercel.app/developer</a></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 前端 </tag>
            
            <tag> HTML5 </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Tampermonkey </tag>
            
            <tag> GM_xmlhttpRequest </tag>
            
            <tag> Tailwindcss </tag>
            
            <tag> TypeScript </tag>
            
            <tag> React </tag>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用百度AI接口ORC自动识别验证码</title>
      <link href="/2021/11/28/orc-zi-dong-shi-bie-yan-zheng-ma/"/>
      <url>/2021/11/28/orc-zi-dong-shi-bie-yan-zheng-ma/</url>
      
        <content type="html"><![CDATA[<h1 id="使用百度-AI-接口-ORC-自动识别验证码"><a href="#使用百度-AI-接口-ORC-自动识别验证码" class="headerlink" title="使用百度 AI 接口 ORC 自动识别验证码"></a>使用百度 AI 接口 ORC 自动识别验证码</h1><h2 id="百度-AI-ORC-接口的使用"><a href="#百度-AI-ORC-接口的使用" class="headerlink" title="百度 AI ORC 接口的使用"></a>百度 AI ORC 接口的使用</h2><p><a href="https://cloud.baidu.com/doc/OCR/s/Ck3h7y2ia" target="_blank" rel="noopener">https://cloud.baidu.com/doc/OCR/s/Ck3h7y2ia</a></p><h3 id="请求格式"><a href="#请求格式" class="headerlink" title="请求格式"></a>请求格式</h3><p>POST 方式调用</p><p><strong>注意</strong>：Content-Type 为<code>application/x-www-form-urlencoded</code>，然后通过<code>urlencode</code>格式化请求体。</p><h3 id="返回格式"><a href="#返回格式" class="headerlink" title="返回格式"></a>返回格式</h3><p>JSON 格式</p><h3 id="请求限制"><a href="#请求限制" class="headerlink" title="请求限制"></a>请求限制</h3><p>请求图片需经过<code>base64编码</code>及<code>urlencode</code>后传入：图片的 base64 编码指将一副图片数据编码成一串字符串，使用该字符串代替图像地址。您可以首先得到图片的二进制，然后去掉编码头后再进行 urlencode。</p><p><strong>注意</strong>：</p><ol><li>图片的 base64 编码是不包含图片头的，如<code>（data:image/jpg;base64,）</code>；</li><li>使用 Postman 工具或 Python、PHP 等请求库会自动进行 urlencode，无需自行处理。</li></ol><p><strong>请求格式支持</strong>：PNG、JPG、JPEG、BMP、TIFF、PNM、WebP</p><table><thead><tr><th>接口名称</th><th>图片编码后大小限额</th></tr></thead><tbody><tr><td><strong>百度文字识别所有接口的图像大小限制</strong></td><td>base64 编码 urlencode 后大小不超过 4M，最短边至少 15px，最长边最大 4096px</td></tr></tbody></table><h2 id="获取验证码-BASE64-文件及校验逻辑"><a href="#获取验证码-BASE64-文件及校验逻辑" class="headerlink" title="获取验证码 BASE64 文件及校验逻辑"></a>获取验证码 BASE64 文件及校验逻辑</h2><ol><li>获取验证码 html 文件</li><li>获取验证码图片元素</li><li>添加图片 onload 事件监听</li><li>添加元素到 DOM 渲染</li><li>获取图片 BASE64 文件</li><li>传输文件到 ORC 接口</li><li>获取验证码结果</li><li>发送 post 请求传输验证码</li><li>校验结果<ol><li>真则等待一小时再次请求</li><li>否则重试</li></ol></li></ol><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * ORC */</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">captcha</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">getUserFromName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> type <span class="token operator">=</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>votedUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">id=topthreads:setstatus&amp;tid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>freeTid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;handlekey=k_setstatus&amp;infloat=1&amp;freeon=yes&amp;inajax=1`</span></span><span class="token punctuation">;</span>    <span class="token keyword">const</span> captchaPage <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">postData</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token function">urlSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span> captcha_input<span class="token punctuation">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> type<span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token function">turnCdata</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>responseXML<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>captchaPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span><span class="token string">'访问失败，正在重试...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>captchaPage <span class="token operator">===</span> <span class="token string">'Access denied.'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span>captchaPage<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> captchaPage <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span><span class="token string">'访问失败，正在重试...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">const</span> image <span class="token operator">=</span> captchaPage<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#captcha'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>    image<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//文件的Base64字符串</span>      <span class="token keyword">const</span> base64 <span class="token operator">=</span> <span class="token function">getBase64Image</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">const</span> ma <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readImage</span><span class="token punctuation">(</span>base64<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>ma<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'Access token invalid or no longer valid'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span>          <span class="token string">'Access token invalid or no longer valid. 令牌无效（需要令牌请私聊 or 发送邮件到 kished@outlook.com ）'</span><span class="token punctuation">,</span>          <span class="token number">10000</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        user<span class="token punctuation">.</span>token <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token function">GM_setValue</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>username<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">reject</span><span class="token punctuation">(</span>ma<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">postData</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token function">urlSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span> captcha_input<span class="token punctuation">:</span> ma <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> type<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token function">turnCdata</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>responseXML<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token string">'更新完成！若狀態仍沒更新，請嘗試刷新頁面'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span><span class="token string">'更新完成！自動‘現在有空’中，請不要刷新頁面！'</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>freeTime<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span><span class="token string">'验证失败，正在重试...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">reject</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * 图像转Base64 */</span><span class="token keyword">function</span> <span class="token function">getBase64Image</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> img<span class="token punctuation">.</span>width<span class="token punctuation">;</span>  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> img<span class="token punctuation">.</span>height<span class="token punctuation">;</span>  <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> img<span class="token punctuation">.</span>width<span class="token punctuation">,</span> img<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> ext <span class="token operator">=</span> img<span class="token punctuation">.</span>src<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>src<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> dataURL <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/'</span> <span class="token operator">+</span> ext<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> dataURL<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h2 id="主要代码"><a href="#主要代码" class="headerlink" title="主要代码"></a>主要代码</h2><p><a href="https://github.com/Eished/jkforum_helper" target="_blank" rel="noopener"><code>https://github.com/Eished/jkforum_helper</code></a></p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/** * ORC */</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">captcha</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">getUserFromName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> type <span class="token operator">=</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>votedUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">id=topthreads:setstatus&amp;tid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>freeTid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;handlekey=k_setstatus&amp;infloat=1&amp;freeon=yes&amp;inajax=1`</span></span><span class="token punctuation">;</span>    <span class="token keyword">const</span> captchaPage <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">postData</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token function">urlSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span> captcha_input<span class="token punctuation">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> type<span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token function">turnCdata</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>responseXML<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>captchaPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span><span class="token string">'访问失败，正在重试...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>captchaPage <span class="token operator">===</span> <span class="token string">'Access denied.'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span>captchaPage<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> captchaPage <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span><span class="token string">'访问失败，正在重试...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">const</span> image <span class="token operator">=</span> captchaPage<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#captcha'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>    image<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//文件的Base64字符串</span>      <span class="token keyword">const</span> base64 <span class="token operator">=</span> <span class="token function">getBase64Image</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">const</span> ma <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readImage</span><span class="token punctuation">(</span>base64<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>ma<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'Access token invalid or no longer valid'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span>          <span class="token string">'Access token invalid or no longer valid. 令牌无效（需要令牌请私聊 or 发送邮件到 kished@outlook.com ）'</span><span class="token punctuation">,</span>          <span class="token number">10000</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        user<span class="token punctuation">.</span>token <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token function">GM_setValue</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>username<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">reject</span><span class="token punctuation">(</span>ma<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">postData</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token function">urlSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span> captcha_input<span class="token punctuation">:</span> ma <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> type<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token function">turnCdata</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>responseXML<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token string">'更新完成！若狀態仍沒更新，請嘗試刷新頁面'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span><span class="token string">'更新完成！自動‘現在有空’中，請不要刷新頁面！'</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>freeTime<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span><span class="token string">'验证失败，正在重试...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">reject</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * 图像转Base64 */</span><span class="token keyword">function</span> <span class="token function">getBase64Image</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> img<span class="token punctuation">.</span>width<span class="token punctuation">;</span>  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> img<span class="token punctuation">.</span>height<span class="token punctuation">;</span>  <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> img<span class="token punctuation">.</span>width<span class="token punctuation">,</span> img<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> ext <span class="token operator">=</span> img<span class="token punctuation">.</span>src<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>src<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> dataURL <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/'</span> <span class="token operator">+</span> ext<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> dataURL<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** *Base64字符串转二进制 */</span><span class="token keyword">function</span> <span class="token function">dataURLtoBlob</span><span class="token punctuation">(</span>dataurl<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> arr <span class="token operator">=</span> dataurl<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    mime <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/:(.*?);/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    bstr <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    n <span class="token operator">=</span> bstr<span class="token punctuation">.</span>length<span class="token punctuation">,</span>    u8arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    u8arr<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> bstr<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>u8arr<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    type<span class="token punctuation">:</span> mime<span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">readImage</span><span class="token punctuation">(</span>base64<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">getUserFromName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>orcUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">access_token=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;Content-Type=application/x-www-form-urlencoded`</span></span><span class="token punctuation">;</span>  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token function">urlSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span> image<span class="token punctuation">:</span> base64 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token function">postData</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> body<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> code <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>code<span class="token operator">?</span><span class="token punctuation">.</span>words_result<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> code<span class="token punctuation">.</span>words_result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>words<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">return</span> code<span class="token punctuation">.</span>error_msg<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">postData</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> postData<span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">'document'</span><span class="token punctuation">,</span> usermethod <span class="token operator">=</span> <span class="token string">'POST'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">GM_xmlhttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      method<span class="token punctuation">:</span> usermethod<span class="token punctuation">,</span>      url<span class="token punctuation">:</span> url<span class="token punctuation">,</span>      headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      data<span class="token punctuation">:</span> postData<span class="token punctuation">,</span>      responseType<span class="token punctuation">:</span> type<span class="token punctuation">,</span>      timeout<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>      onload<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">resolve</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>          <span class="token function">reject</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      onerror<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      ontimeout<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">autoCompleteCaptcha</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">getUserFromName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>    user<span class="token punctuation">.</span>token <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">'请输入验证码识别的 api 令牌（需要令牌请私聊 or 发送邮件到 kished@outlook.com ）：'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex">/.*\..*\..*\..*/g</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">GM_setValue</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>username<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span><span class="token string">'无效的令牌'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">.</span>freeTid<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> status <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#topthread_status'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> tid <span class="token operator">=</span> location<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 不同链接地址不同</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tid<span class="token punctuation">)</span> <span class="token punctuation">{</span>        tid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'tid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 用于获取分类贴链接下的 tid</span>      <span class="token punctuation">}</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tid<span class="token punctuation">)</span><span class="token punctuation">;</span>      user<span class="token punctuation">.</span>freeTid <span class="token operator">=</span> tid<span class="token punctuation">;</span>      <span class="token function">GM_setValue</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>username<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span><span class="token string">'找不到指定页面元素！请先打开自己的帖子再试'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token function">captcha</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> msId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">playVideo</span><span class="token punctuation">(</span>msId<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        msId<span class="token punctuation">.</span><span class="token function">removeMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">autoCompleteCaptcha</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>freeTime<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// console.log(e);</span>      <span class="token function">autoCompleteCaptcha</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 前端 </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Tampermonkey </tag>
            
            <tag> Promise </tag>
            
            <tag> GM_xmlhttpRequest </tag>
            
            <tag> ORC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>斗鱼直播油猴脚本：自动切换最高画质或最低画质</title>
      <link href="/2021/08/03/dou-yu-zhi-bo-cha-jian-zi-dong-qie-huan-zui-gao-hua-zhi-huo-zui-di-hua-zhi/"/>
      <url>/2021/08/03/dou-yu-zhi-bo-cha-jian-zi-dong-qie-huan-zui-gao-hua-zhi-huo-zui-di-hua-zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><ol><li>播放控件是动态加载，找到元素把父级全 <code>console.log</code> 确认加载顺序。</li><li>使用 <code>MutationObserver</code> 监听动态加载元素的父级，找到正确的子孙节点，然后点击画质选项。<ul><li>元素的 <code>className</code> 是框架动态生成，会变化，所以使用属性选择器 <code>[value=&quot;画质 &quot;]</code> 找到元素。</li><li>或者使用：<ul><li><code>[class|=&quot;rate-&quot;]</code> (带有 rate- 前缀的元素)</li><li><code>[class^=&quot;rate-&quot;]</code> (以 rate- 开头的元素)</li><li><code>[class*=&quot;rate-&quot;]</code> (包含 rate- 的元素)</li><li><code>querySelector(&quot;#rateId ~ ul&quot;)</code> 通过节点 <code>id</code> 定位通用兄弟节点 <code>ul</code></li></ul></li></ul></li><li><code>GM_setValue</code> 储存画质选项。</li><li><code>GM_registerMenuCommand</code> 菜单栏切换画质。</li><li>问题：没有找到元素后，不能自动关闭监听，虽不会再触发。<ul><li>观察器在内部对节点使用弱引用。也就是说，如果一个节点被从 DOM 中移除了，并且该节点变得不可访问，那么它就可以被垃圾回收。</li></ul></li></ol><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// ==UserScript==</span><span class="token comment" spellcheck="true">// @name         斗鱼自动切换最高画质或最低画质</span><span class="token comment" spellcheck="true">// @namespace    https://github.com/Eished</span><span class="token comment" spellcheck="true">// @author       Eished</span><span class="token comment" spellcheck="true">// @version      2021.08.03.5</span><span class="token comment" spellcheck="true">// @description  斗鱼直播自动调整最低分辨率或最高分辨率；自动调整2K、蓝光、超清、高清清晰度；</span><span class="token comment" spellcheck="true">// @license      AGPL-3.0</span><span class="token comment" spellcheck="true">// @match        *://www.douyu.com/*</span><span class="token comment" spellcheck="true">// @icon         https://www.google.com/s2/favicons?domain=greasyfork.org</span><span class="token comment" spellcheck="true">// @grant        GM_setValue</span><span class="token comment" spellcheck="true">// @grant        GM_getValue</span><span class="token comment" spellcheck="true">// @grant        GM_registerMenuCommand</span><span class="token comment" spellcheck="true">// ==/UserScript==</span><span class="token comment" spellcheck="true">// console.log(document.querySelector(".layout-Player-videoMain"));</span><span class="token comment" spellcheck="true">// console.log(document.querySelector(".layout-Player-videoSub"));</span><span class="token comment" spellcheck="true">// // 以下为动态加载</span><span class="token comment" spellcheck="true">// console.log(document.querySelector(".room-Player-Box"));</span><span class="token comment" spellcheck="true">// console.log(document.querySelector(".room-Player"));</span><span class="token comment" spellcheck="true">// console.log(document.querySelector("#room-html5-player"));</span><span class="token comment" spellcheck="true">// // 以下为动态一次性加载</span><span class="token comment" spellcheck="true">// console.log(document.querySelector(".container-cffcd4"));</span><span class="token comment" spellcheck="true">// console.log(document.querySelector(".right-e7ea5d"));</span><span class="token comment" spellcheck="true">// console.log(document.querySelector(".rate-5c068c > div > ul"));</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token string">'use strict'</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> videoSub <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.layout-Player-videoSub'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>videoSub <span class="token operator">==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">let</span> Clarity <span class="token operator">=</span> <span class="token function">GM_getValue</span><span class="token punctuation">(</span><span class="token string">'Clarity'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Clarity <span class="token operator">==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Clarity <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">'Clarity'</span><span class="token punctuation">,</span> Clarity<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>  observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>videoSub<span class="token punctuation">,</span> <span class="token punctuation">{</span>    childList<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    subtree<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> controller <span class="token operator">=</span> videoSub<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`[value="画质 "]`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>      observer<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">let</span> ul <span class="token operator">=</span> controller<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>Clarity <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        ul <span class="token operator">=</span> ul<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 最高画质</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        ul <span class="token operator">=</span> ul<span class="token punctuation">.</span>lastElementChild<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 最低画质</span>      <span class="token punctuation">}</span>      ul<span class="token punctuation">.</span>className <span class="token operator">?</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ul<span class="token punctuation">.</span>className<span class="token punctuation">)</span> <span class="token punctuation">:</span> ul<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">function</span> <span class="token function">high</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    Clarity <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">'Clarity'</span><span class="token punctuation">,</span> Clarity<span class="token punctuation">)</span><span class="token punctuation">;</span>    location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">function</span> <span class="token function">low</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    Clarity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">'Clarity'</span><span class="token punctuation">,</span> Clarity<span class="token punctuation">)</span><span class="token punctuation">;</span>    location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">GM_registerMenuCommand</span><span class="token punctuation">(</span><span class="token string">'最高画质'</span><span class="token punctuation">,</span> high<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">GM_registerMenuCommand</span><span class="token punctuation">(</span><span class="token string">'最低画质'</span><span class="token punctuation">,</span> low<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 前端 </tag>
            
            <tag> HTML5 </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Tampermonkey </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C/C++网络编程，从socket到epoll</title>
      <link href="/2021/07/29/c-wang-luo-bian-cheng-cong-socket-dao-epoll/"/>
      <url>/2021/07/29/c-wang-luo-bian-cheng-cong-socket-dao-epoll/</url>
      
        <content type="html"><![CDATA[<h2 id="虚拟机安装-ssh"><a href="#虚拟机安装-ssh" class="headerlink" title="虚拟机安装 ssh"></a>虚拟机安装 ssh</h2><pre class=" language-shell"><code class="language-shell">1.安装命令：sudo apt-get install openssh-server安装完成，服务默认已经开启，可以远程ssh连接了。2.查看ssh服务状态：sudo service ssh status3.ssh服务重启命令：sudo service ssh restart4.ssh服务的配置文件，可以修改服务端口，权限控制等sudo gedit /etc/ssh/sshd_config</code></pre><h2 id="vi-常用命令"><a href="#vi-常用命令" class="headerlink" title="vi 常用命令"></a><a href="https://www.freecplus.net/28096d085cbe471c986d246b43ac4fe4.html" target="_blank" rel="noopener">vi 常用命令</a></h2><h3 id="一、关于-vi"><a href="#一、关于-vi" class="headerlink" title="一、关于 vi"></a>一、关于 vi</h3><p>vi 是最强大的文本编辑器，没有之一。尽管 vi 已经是古董级的软件，但还是有无数新人迎着困难去<a href="https://www.iplaysoft.com/tag/学习" target="_blank" rel="noopener">学习</a>使用，可见其经典与受欢迎的程度。</p><p>无论是小说中还是电视剧，真正强大的武器都不容易驾驭，需要付出一些努力才能收获到更加强大的力量，对于 vi 这种<strong>上古<a href="https://www.iplaysoft.com/tag/神器" target="_blank" rel="noopener">神器</a></strong>来说更是如此。由于它全程使用键盘操作，很多首次接触 vi 的人会觉得不习惯而中途放弃。然而，坚持下来的朋友就会渐渐地发现这种键盘操作的设计绝妙，经典之所以能成为经典，必然有它的道理，不用解释太多。</p><p>观察一个程序员对 vi 的熟练程度，可以判断它的技术水平，如果他对 vi 不熟悉，就肯定不是 Linux 平台下的程序员，说 vi 不好用的人也肯定不熟悉 vi 和 Linux，没有例外。</p><h3 id="二、创建-打开文件"><a href="#二、创建-打开文件" class="headerlink" title="二、创建/打开文件"></a>二、创建/打开文件</h3><p>vi 文件名</p><p>打开一个文件，如果文件不存在，就创建它。</p><p>示例：</p><p>vi book.c</p><h3 id="三、vi-的三种模式"><a href="#三、vi-的三种模式" class="headerlink" title="三、vi 的三种模式"></a>三、vi 的三种模式</h3><p>vi 有三种模式，命令行模式、插入模式和替换模式，在命令行模式下，任何键盘输入都是命令，在插入模式和替换模式下，键盘输入的才是字符。</p><p>插入模式和替换模式也合称为编辑模式。</p><h3 id="四、vi-的常用命令"><a href="#四、vi-的常用命令" class="headerlink" title="四、vi 的常用命令"></a>四、vi 的常用命令</h3><p>Esc 从编辑模式切换到命令行模式。</p><p>i 在光标所在位置前面开始插入。</p><p>a 在光标所在的位置后面开始插入。</p><p>o 在光标所在位置行的下面插入空白行。</p><p>O 在光标所在位置行的上面插入空白行。</p><p>I 在光标所在位置行的行首开始插入。</p><p>A 在光标所在位置行的行末开始插入。</p><p>k 类似方向键上。</p><p>j 类似方向键下。</p><p>h 类似方向键左。</p><p>l 类是方向键右。</p><p>Ctrl+u 向上翻半页。</p><p>Ctrl+d 向下翻页。</p><p>Ctrl+g 显示光标所在位置的行号和文件的总行数。</p><p>nG 光标跳到文件的第 n 行行首。</p><p>G 光标跳到文件最后一行。</p><p>:5 回车 光标跳到第 5 行。</p><p>:n 回车 光标跳到第 n 行。</p><p>0 光标跳到当前行的行首。</p><p>$ 光标跳到当前行的行尾。</p><p>w 光标跳到下个单词的开头。</p><p>b 光标跳到上个单词的开头。</p><p>e 光标跳到本单词的尾部。</p><p>x 每按一次，删除光标所在位置的一个字符。</p><p>nx 如”3x”表示删除光标所在位置开始的 3 个字符。</p><p>dw 删除光标所在位置到本单词结尾的字符。</p><p>D 删除本行光标所在位置后面全部的内容。</p><p>dd 删除光标所在位置的一行。</p><p>ndd 如”3dd”表示删除光标所在位置开始的 3 行。</p><p>yy 将光标所在位置的一行复制到缓冲区。</p><p>nyy 将光标所在位置的 n 行复制到缓冲区。</p><p>p 将缓冲区里的内容粘贴到光标所在位置。</p><p>r 替换光标所在位置的一个字符 replace。</p><p>R 从光标所在位置开始替换，直到按下”Esc”。</p><p>cw 从光标所在位置开始替换单词，直到按下”Esc”。</p><p>u 撤销命令，可多次撤销。</p><p>J 把当前行的下一行接到当前行的尾部。</p><p>/abcd 在当前打开的文件中查找“abcd”文本内容。</p><p>n 查找下一个。</p><p>N 查找上一下。</p><p>. 重复执行上一次执行的 vi 命令。</p><p>~ 对光标当前所在的位置的字符进行大小写转换。</p><p>列操作</p><p>Ctrl+V 光标上或下 大写的 I 输入内容 Esc</p><p>:w 回车 存盘。</p><p>:w!回车 强制存盘。</p><p>:wq 回车 存盘退出。</p><p>:x 回车 存盘退出。</p><p>:q 回车 不存盘退出。</p><p>:q!回车 不存盘强制退出。</p><p>:g/aaaaaaaaa/s//bbbbbb/g 回车 把文件中全部的 aaaaaaaaa 替换成 bbbbbb。</p><p>Ctl+insert 复制鼠标选中的文本，相当于 Ctl+c。</p><p>Shift+insert 输出鼠标选中的文本，相当于 Ctl+v。</p><p>以上两个命令在 windows 和 UNIX 中是通用的。</p><h3 id="vim-粘贴时取消自动换行"><a href="#vim-粘贴时取消自动换行" class="headerlink" title="vim 粘贴时取消自动换行"></a>vim 粘贴时取消自动换行</h3><p>当 vim 开启 smartindent 时，对于代码会有自动换行的功效。但是，有时候我们需要在向 vim 中粘贴代码时，需要暂时关闭自动换行的功能。</p><p><strong>解决方法：</strong></p><p>:set paste</p><p>之后进行插入操作，vim 提示变为： – INSERT (paste) –</p><p>这时就不再有自动换行。</p><p><strong>恢复：</strong></p><p>:set nopaste</p><p>vim 提示变为：– INSERT –</p><h3 id="vim-支持-c-c-STL-即标准库关键字高亮"><a href="#vim-支持-c-c-STL-即标准库关键字高亮" class="headerlink" title="vim 支持 c/c++ STL 即标准库关键字高亮"></a>vim 支持 c/c++ STL 即标准库关键字高亮</h3><p><strong>手动复制进去</strong></p><pre class=" language-shell"><code class="language-shell">git clone https://github.com/octol/vim-cpp-enhanced-highlight.git /tmp/vim-cpp-enhanced-highlightmkdir -p ~/.vim/after/syntax/mv /tmp/vim-cpp-enhanced-highlight/after/syntax/cpp.vim ~/.vim/after/syntax/cpp.vimrm -rf /tmp/vim-cpp-enhanced-highlight</code></pre><h3 id="mac-linux-中-vim-永久显示行号、开启语法高亮"><a href="#mac-linux-中-vim-永久显示行号、开启语法高亮" class="headerlink" title="mac/linux 中 vim 永久显示行号、开启语法高亮"></a><a href="https://segmentfault.com/a/1190000024433066" target="_blank" rel="noopener">mac/linux 中 vim 永久显示行号、开启语法高亮</a></h3><pre><code>cp /usr/share/vim/vimrc ~/.vimrc</code></pre><p>先复制一份 vim 配置模板到个人目录下</p><p>注：redhat 改成 cp /etc/vimrc ~/.vimrc</p><p><strong>步骤 2</strong>：</p><pre><code>vi ~/.vimrc</code></pre><p>进入 insert 模式，在最后加二行</p><pre><code> syntax on set nu!</code></pre><p>保存收工。</p><pre><code>set nocompatible                 &quot;去掉有关vi一致性模式，避免以前版本的bug和局限set nu!                                    &quot;显示行号set guifont=Luxi/ Mono/ 9   &quot; 设置字体，字体名称和字号filetype on                              &quot;检测文件的类型set history=1000                  &quot;记录历史的行数set background=dark          &quot;背景使用黑色syntax on                                &quot;语法高亮度显示set autoindent                       &quot;vim使用自动对齐，也就是把当前行的对齐格式应用到下一行(自动缩进）set cindent                             &quot;（cindent是特别针对 C语言语法自动缩进）set smartindent                    &quot;依据上面的对齐格式，智能的选择对齐方式，对于类似C语言编写上有用set tabstop=4                        &quot;设置tab键为4个空格，set shiftwidth =4                   &quot;设置当行之间交错时使用4个空格set ai!                                      &quot; 设置自动缩进set showmatch                     &quot;设置匹配模式，类似当输入一个左括号时会匹配相应的右括号set guioptions-=T                 &quot;去除vim的GUI版本中得toolbarset vb t_vb=                            &quot;当vim进行编辑时，如果命令错误，会发出警报，该设置去掉警报set ruler                                  &quot;在编辑过程中，在右下角显示光标位置的状态行set nohls                                &quot;默认情况下，寻找匹配是高亮度显示，该设置关闭高亮显示set incsearch                        &quot;在程序中查询一单词，自动匹配单词的位置；如查询desk单词，当输到/d时，会自动找到第一个d开头的单词，当输入到/de时，会自动找到第一个以ds开头的单词，以此类推，进行查找；当找到要匹配的单词时，别忘记回车set backspace=2           &quot; 设置退格键可用</code></pre><p>注：如果是 mac，更好的办法是直接换掉默认的终端，改用 zsh</p><h3 id="vim-显示行号、语法高亮、自动缩进的设置"><a href="#vim-显示行号、语法高亮、自动缩进的设置" class="headerlink" title="vim 显示行号、语法高亮、自动缩进的设置"></a>vim 显示行号、语法高亮、自动缩进的设置</h3><p>在 UBUNTU 中 vim 的配置文件存放在/etc/vim 目录中，配置文件名为 vimrc</p><p>在 Fedora 中 vim 的配置文件存放在/etc 目录中，配置文件名为 vimrc</p><p>在 Red Hat Linux 中 vim 的配置文件存放在/etc 目录中，配置文件名为 vimrc</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">set</span> nocompatible                 "去掉有关vi一致性模式，避免以前版本的bug和局限<span class="token keyword">set</span> nu<span class="token operator">!</span>                                    "显示行号<span class="token keyword">set</span> guifont<span class="token operator">=</span>Luxi<span class="token operator">/</span> Mono<span class="token operator">/</span> <span class="token number">9</span>   " 设置字体，字体名称和字号filetype on                              "检测文件的类型<span class="token keyword">set</span> history<span class="token operator">=</span><span class="token number">1000</span>                  "记录历史的行数<span class="token keyword">set</span> background<span class="token operator">=</span>dark          "背景使用黑色syntax on                                "语法高亮度显示<span class="token keyword">set</span> autoindent                       "<span class="token function">vim使用自动对齐，也就是把当前行的对齐格式应用到下一行</span><span class="token punctuation">(</span>自动缩进）<span class="token keyword">set</span> cindent                             "（cindent是特别针对 C语言语法自动缩进）<span class="token keyword">set</span> smartindent                    "依据上面的对齐格式，智能的选择对齐方式，对于类似C语言编写上有用<span class="token keyword">set</span> tabstop<span class="token operator">=</span><span class="token number">4</span>                        "设置tab键为<span class="token number">4</span>个空格，<span class="token keyword">set</span> shiftwidth <span class="token operator">=</span><span class="token number">4</span>                   "设置当行之间交错时使用<span class="token number">4</span>个空格<span class="token keyword">set</span> ai<span class="token operator">!</span>                                      " 设置自动缩进<span class="token keyword">set</span> showmatch                     "设置匹配模式，类似当输入一个左括号时会匹配相应的右括号<span class="token keyword">set</span> guioptions<span class="token operator">-</span><span class="token operator">=</span>T                 "去除vim的GUI版本中得toolbar<span class="token keyword">set</span> vb t_vb<span class="token operator">=</span>                            "当vim进行编辑时，如果命令错误，会发出警报，该设置去掉警报<span class="token keyword">set</span> ruler                                  "在编辑过程中，在右下角显示光标位置的状态行<span class="token keyword">set</span> nohls                                "默认情况下，寻找匹配是高亮度显示，该设置关闭高亮显示<span class="token keyword">set</span> incsearch                        "在程序中查询一单词，自动匹配单词的位置；如查询desk单词，当输到<span class="token operator">/</span>d时，会自动找到第一个d开头的单词，当输入到<span class="token operator">/</span>de时，会自动找到第一个以ds开头的单词，以此类推，进行查找；当找到要匹配的单词时，别忘记回车<span class="token keyword">set</span> backspace<span class="token operator">=</span><span class="token number">2</span>           " 设置退格键可用修改一个文件后，自动进行备份，备份的文件名为原文件名加“<span class="token operator">~</span>”后缀      <span class="token keyword">if</span> <span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"vms"</span><span class="token punctuation">)</span>      <span class="token keyword">set</span> nobackup      <span class="token keyword">else</span>      <span class="token keyword">set</span> backup      endif</code></pre><p>如果设置完成后，发现功能没有起作用，检查一下系统下是否安装了 vim-enhanced 包，查询命令为：</p><p>​ $rpm -q vim-enhanced 注意：如果设置好以上设置后，VIM 没有作出相应的动作，那么请你把你的 VIM 升级到最新版，一般只要在终端输入以下命令即可：sudo apt-get install vim</p><p>转自：<a href="https://blog.csdn.net/chuanj1985/article/details/6873830" target="_blank" rel="noopener">https://blog.csdn.net/chuanj1985/article/details/6873830</a></p><h2 id="C-语言-makefile-文件"><a href="#C-语言-makefile-文件" class="headerlink" title="C 语言 makefile 文件"></a><a href="https://www.freecplus.net/b7a1c199959f4349b2a98874864a2000.html" target="_blank" rel="noopener">C 语言 makefile 文件</a></h2><pre class=" language-shell"><code class="language-shell">apt install make</code></pre><p>在软件的工程中的源文件是很多的，其按照类型、功能、模块分别放在若干个目录和文件中，哪些文件需要编译，那些文件需要后编译，那些文件需要重新编译，甚至进行更复杂的功能操作，这就有了我们的系统编译的工具。</p><p>在 linux 和 unix 中，有一个强大的实用程序，叫 make，可以用它来管理多模块程序的编译和链接，直至生成可执行文件。</p><p>make 程序需要一个编译规则说明文件，称为 makefile，makefile 文件中描述了整个软件工程的编译规则和各个文件之间的依赖关系。</p><p>makefile 就像是一个 shell 脚本一样，其中可以执行操作系统的命令，它带来的好处就是我们能够实现“自动化编译”，一旦写好，只要一个 make 命令，整个软件功能就完全自动编译，提高了软件开发的效率。</p><p>make 是一个命令工具，是一个解释 makefile 中指令的命令工具，一般来说大多数编译器都有这个命令，使用 make 可以是重新编译的次数达到最小化。</p><h3 id="一、makefile-的编写"><a href="#一、makefile-的编写" class="headerlink" title="一、makefile 的编写"></a>一、makefile 的编写</h3><p>makefile 文件的规则可以非常复杂，比 C 程序还要复杂，我通过示例来介绍它的简单用法。</p><p>文件名：makefile，内容如下：</p><pre class=" language-shell"><code class="language-shell">all:book1 book46book1:book1.c        gcc -o book1 book1.cbook46:book46.c _public.h _public.c        gcc -o book46 book46.c _public.cclean:        rm -f book1 book46</code></pre><p><strong>第一行</strong></p><pre class=" language-shell"><code class="language-shell">all:book book46</code></pre><p>all: 这是固定的写法。</p><p>book1 book46 表示需要编译目标程序的清单，中间用空格分隔开，如果清单很长，可以用\换行。</p><p><strong>第二行</strong></p><p>makefile 文件中的空行就像 C 程序中的空行一样，只是为了书写整洁，没有什么意义。</p><p><strong>第三行</strong></p><pre class=" language-shell"><code class="language-shell">book1:book1.c</code></pre><p>book1:表示需要编译的目标程序。</p><p>如果要编译目标程序 book1，需要依赖源程序 book1.c，当 book1.c 的内容发生了变化，执行 make 的时候就会重新编译 book1。</p><p><strong>第四行</strong></p><pre class=" language-shell"><code class="language-shell">        gcc -o book1 book1.c</code></pre><p>这是一个编译命令，和在操作系统命令行输入的命令一样，但是要注意一个问题，在 gcc 之前要用 tab 键，看上去像 8 个空格，实际不是，一定要用 tab，空格不行。</p><p><strong>第六行</strong></p><pre class=" language-shell"><code class="language-shell">book46:book46.c _public.h _public.c</code></pre><p>与第三行的含义相同。</p><p>book46:表示编译的目标程序。</p><p>如果要编译目标程序 book46，需要依赖源程序 book46.c、_public.h 和_public.c 三个文件，只要任何一个的内容发生了变化，执行 make 的时候就会重新编译 book46。</p><p><strong>第七行</strong></p><pre class=" language-shell"><code class="language-shell">        gcc -o book46 book46.c _public.c</code></pre><p>与第四行的含义相同。</p><p><strong>第九行</strong></p><pre class=" language-shell"><code class="language-shell">clean:</code></pre><p>清除目标文件，清除的命令由第十行之后的脚本来执行。</p><p><strong>第十行</strong></p><pre class=" language-shell"><code class="language-shell">        rm  -f  book1 book46</code></pre><p>清除目标文件的脚本命令，注意了，rm 之前也是一个 tab 键，不是空格。</p><h3 id="二、make-命令"><a href="#二、make-命令" class="headerlink" title="二、make 命令"></a>二、make 命令</h3><p>makefile 准备好了，在命令提示符下执行 make 就可以编译 makefile 中 all 参数指定的目标文件。</p><p>执行 make 编译目标程序：</p><p><img src="https://www.freecplus.net/runoobFiles/ueditor/image/20200318/1584536443451006468.png" alt="image.png"></p><p>再执行一次 make：</p><p><img src="https://www.freecplus.net/runoobFiles/ueditor/image/20200318/1584536454572081980.png" alt="image.png"></p><p>因为全部的目标程序都是最新的，所以提示没有目标可以编译。</p><p>执行 make clean，执行清除目标文件的指令。</p><p><img src="https://www.freecplus.net/runoobFiles/ueditor/image/20200318/1584536467750040871.png" alt="image.png"></p><p>再执行 make 重新编译。</p><p><img src="https://www.freecplus.net/runoobFiles/ueditor/image/20200318/1584536479435025308.png" alt="image.png"></p><p>修改_public.c 程序，随便改点什么，只要改了就行。</p><p>然后再执行 make：</p><p><img src="https://www.freecplus.net/runoobFiles/ueditor/image/20200318/1584536490024019135.png" alt="image.png"></p><p>注意了，因为 book46 依赖的源程序之一_public.c 改变了，所以 book46 重新编译。</p><p>book1 没有重新编译，因为 book1 依赖的源文件并没有改变。</p><h3 id="三、makefile-文件中的变量"><a href="#三、makefile-文件中的变量" class="headerlink" title="三、makefile 文件中的变量"></a>三、makefile 文件中的变量</h3><p>makefile 中，变量就是一个名字，变量的值就是一个文本字符串。在 makefile 中的目标，依赖，命令或其他地方引用变量时，变量会被它的值替代。</p><p>我通过示例来介绍它的简单用法。</p><pre class=" language-shell"><code class="language-shell">CC=gccFLAG=-gall:book1 book46book1:book1.c        $(CC) $(FLAG) -o book1 book1.cbook46:book46.c _public.h _public.c        $(CC) $(FLAG) -o book46 book46.c _public.cclean:        rm -f book1 book46</code></pre><p><strong>第一行</strong></p><pre class=" language-shell"><code class="language-shell">CC=gcc</code></pre><p>定义变量 CC，赋值 gcc。</p><p><strong>第二行</strong></p><pre class=" language-shell"><code class="language-shell">FLAG=-g</code></pre><p>定义变量 FLAG，赋值-g。</p><p><strong>第七行</strong></p><pre class=" language-shell"><code class="language-shell">        $(CC)  $(FLAG) -o book1 book1.c</code></pre><p><code>$(CC)和$(FLAG)</code>就是使用变量 CC 和 FLAG 的值，类似于 C 语言的宏定义，替换后的结果是：</p><pre class=" language-shell"><code class="language-shell">        gcc -g -o book1 book1.c</code></pre><p>编译效果：</p><p><img src="https://www.freecplus.net/runoobFiles/ueditor/image/20200318/1584536550181088438.png" alt="image.png"></p><p>在 makefile 文件中，使用变量的好处有两个：</p><p>​ 1）如果在很多编译指令采用了变量，只要修改变量的值，就相当于修改全部的编译指令；</p><p>​ 2）把比较长的、公共的编译指令采用变量来表示，可以让 makefile 更简洁。</p><p>四、应用经验</p><p>makefile 文件的编写可以很复杂，复杂到我不想看，在实际开发中，用不着那么复杂的 makefile，我追求简单实用的方法，腾出更多的时间和精力去做更重要的事情，那些把 makefile 文件写得很复杂的程序员在我看来是吃饱了撑的。</p><p>五、课后作业</p><p>把您这段时间写的程序全部编写到 makefile 中，以后再也不要在命令提示符下用 gcc 了。</p><p>六、版权声明</p><p>C 语言技术网原创文章，转载请说明文章的来源、作者和原文的链接。</p><p>来源：C 语言技术网（<a href="http://www.freecplus.net/" target="_blank" rel="noopener">www.freecplus.net</a>）</p><p>作者：码农有道</p><p>如果文章有错别字，或者内容有错误，或其他的建议和意见，请您联系我们指正，非常感谢！！！</p><h2 id="C-C-网络编程，从-socket-到-epoll"><a href="#C-C-网络编程，从-socket-到-epoll" class="headerlink" title="C\C++网络编程，从 socket 到 epoll"></a>C\C++网络编程，从 socket 到 epoll</h2><h3 id="学习-Linux-编程前的准备"><a href="#学习-Linux-编程前的准备" class="headerlink" title="学习 Linux 编程前的准备"></a><a href="https://www.freecplus.net/d08d40bbe87e4ff3bdcab956fdfca6f8.html" target="_blank" rel="noopener">学习 Linux 编程前的准备</a></h3><p>编译器</p><pre class=" language-shell"><code class="language-shell">apt install gcc-c++</code></pre><p>编译 C 程序的命令是 gcc，编译 C++程序的命令是 g++，g++命令和 gcc 命令的用法相同，把 gcc 改为 g++就可以了，我们在学习 C 语言时编写的那些示例程序，基本上都可以用 g++来编译。</p><pre><code>g++ -o book1 book1.c</code></pre><p><strong>XSHELL ssh vim 語法高亮配置</strong></p><p>文件, 默认/当前会话属性, 终端, 终端类型：linux</p><p>文件, 默认/当前会话属性, 终端, 键盘, 功能键类型：linux</p><p><strong>如何对 xshell 中的输入命令的那一行进行高亮显示呢</strong></p><p>修改你登录用户目录下的.bashrc 文件，把 46 行的注释去掉保存后重新登录即可</p><p>（如果使用其他用户登录，其下的.bashrc 也要修改，和 xshell 无关）</p><p><img src="https://img3.sycdn.imooc.com/5e5d2d2c0001168204690193.jpg" alt="//img1.sycdn.imooc.com/5e5d2d2c0001168204690193.jpg"></p><p>重新登录后</p><p><img src="https://img1.sycdn.imooc.com/5e5d2d9b00015d9804510114.jpg" alt="//img4.sycdn.imooc.com/5e5d2d9b00015d9804510114.jpg"></p><h3 id="一、网络通信-socket"><a href="#一、网络通信-socket" class="headerlink" title="一、网络通信 socket"></a>一、网络通信 socket</h3><p>socket 就是插座（中文翻译成套接字有点莫名其妙），运行在计算机中的两个程序通过 socket 建立起一个通道，数据在通道中传输。</p><p><img src="https://www.freecplus.net/runoobFiles/ueditor/image/20200922/1600759995760026651.png" alt="image.png"></p><p>socket 把复杂的 TCP/IP 协议族隐藏了起来，对程序员来说，只要用好 socket 相关的函数，就可以完成网络通信。</p><h3 id="二、socket-的分类"><a href="#二、socket-的分类" class="headerlink" title="二、socket 的分类"></a>二、socket 的分类</h3><p>socket 提供了流（stream）和数据报（datagram）两种通信机制，即流 socket 和数据报 socket。</p><p>流 socket 基于 TCP 协议，是一个有序、可靠、双向字节流的通道，传输数据不会丢失、不会重复、顺序也不会错乱。就像两个人在打电话，接通后就在线了，您一句我一句的聊天。</p><p>数据报 socket 基于 UDP 协议，不需要建立和维持连接，可能会丢失或错乱。UDP 不是一个可靠的协议，对数据的长度有限制，但是它的速度比较高。就像短信功能，一个人向另一个人发短信，对方不一定能收到。</p><p>在实际开发中，数据报 socket 的应用场景极少，本教程只介绍流 socket。</p><h3 id="三、客户-服务端模式"><a href="#三、客户-服务端模式" class="headerlink" title="三、客户/服务端模式"></a>三、客户/服务端模式</h3><p>在 TCP/IP 网络应用中，两个程序之间通信模式是客户/服务端模式（client/server），客户/服务端也叫作客户/服务器，各人习惯。</p><p><img src="https://www.freecplus.net/runoobFiles/ueditor/image/20200922/1600758212122001314.png" alt="image.png"></p><h4 id="1、服务端的工作流程"><a href="#1、服务端的工作流程" class="headerlink" title="1、服务端的工作流程"></a>1、服务端的工作流程</h4><p>1）创建服务端的 socket。</p><p>2）把服务端用于通信的地址和端口绑定到 socket 上。</p><p>3）把 socket 设置为监听模式。</p><p>4）接受客户端的连接。</p><p>5）与客户端通信，接收客户端发过来的报文后，回复处理结果。</p><p>6）不断的重复第 5）步，直到客户端断开连接。</p><p>7）关闭 socket，释放资源。</p><p><strong>服务端示例（server.cpp）</strong></p><pre class=" language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/* * 程序名：server.cpp，此程序用于演示socket通信的服务端 * 作者：C语言技术网(www.freecplus.net) 日期：20190525*/</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;netdb.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>argc<span class="token operator">!=</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Using:./server port\nExample:./server 5005\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// 第1步：创建服务端的socket。</span>  <span class="token keyword">int</span> listenfd<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>listenfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// 第2步：把服务端用于通信的地址和端口绑定到socket上。</span>  <span class="token keyword">struct</span> sockaddr_in servaddr<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 服务端地址信息的数据结构。</span>  <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>servaddr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>servaddr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  servaddr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 协议族，在socket编程中只能是AF_INET。</span>  servaddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">// 任意ip地址。</span>  <span class="token comment" spellcheck="true">//servaddr.sin_addr.s_addr = inet_addr("192.168.190.134"); // 指定ip地址。</span>  servaddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 指定通信端口。</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> sockaddr <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>servaddr<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>servaddr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>  <span class="token punctuation">{</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"bind"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">close</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// 第3步：把socket设置为监听模式。</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">listen</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"listen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">close</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// 第4步：接受客户端的连接。</span>  <span class="token keyword">int</span>  clientfd<span class="token punctuation">;</span>                  <span class="token comment" spellcheck="true">// 客户端的socket。</span>  <span class="token keyword">int</span>  socklen<span class="token operator">=</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> sockaddr_in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// struct sockaddr_in的大小</span>  <span class="token keyword">struct</span> sockaddr_in clientaddr<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 客户端的地址信息。</span>  clientfd<span class="token operator">=</span><span class="token function">accept</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> sockaddr <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>clientaddr<span class="token punctuation">,</span><span class="token punctuation">(</span>socklen_t<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>socklen<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"客户端（%s）已连接。\n"</span><span class="token punctuation">,</span><span class="token function">inet_ntoa</span><span class="token punctuation">(</span>clientaddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 第5步：与客户端通信，接收客户端发过来的报文后，回复ok。</span>  <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token keyword">int</span> iret<span class="token punctuation">;</span>    <span class="token function">memset</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>iret<span class="token operator">=</span><span class="token function">recv</span><span class="token punctuation">(</span>clientfd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 接收客户端的请求报文。</span>    <span class="token punctuation">{</span>       <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"iret=%d\n"</span><span class="token punctuation">,</span>iret<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"接收：%s\n"</span><span class="token punctuation">,</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">strcpy</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token string">"ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>iret<span class="token operator">=</span><span class="token function">send</span><span class="token punctuation">(</span>clientfd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 向客户端发送响应结果。</span>    <span class="token punctuation">{</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"send"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"发送：%s\n"</span><span class="token punctuation">,</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// 第6步：关闭socket，释放资源。</span>  <span class="token function">close</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">close</span><span class="token punctuation">(</span>clientfd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h4 id="2、客户端的工作流程"><a href="#2、客户端的工作流程" class="headerlink" title="2、客户端的工作流程"></a>2、客户端的工作流程</h4><p>1）创建客户端的 socket。</p><p>2）向服务器发起连接请求。</p><p>3）与服务端通信，发送一个报文后等待回复，然后再发下一个报文。</p><p>4）不断的重复第 3）步，直到全部的数据被发送完。</p><p>5）第 4 步：关闭 socket，释放资源。</p><p><strong>客户端示例（client.cpp）</strong></p><pre class=" language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/* * 程序名：client.cpp，此程序用于演示socket的客户端 * 作者：C语言技术网(www.freecplus.net) 日期：20190525*/</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;netdb.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>argc<span class="token operator">!=</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Using:./client ip port\nExample:./client 127.0.0.1 5005\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// 第1步：创建客户端的socket。</span>  <span class="token keyword">int</span> sockfd<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>sockfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// 第2步：向服务器发起连接请求。</span>  <span class="token keyword">struct</span> hostent<span class="token operator">*</span> h<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> <span class="token function">gethostbyname</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">// 指定服务端的ip地址。</span>  <span class="token punctuation">{</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"gethostbyname failed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token keyword">struct</span> sockaddr_in servaddr<span class="token punctuation">;</span>  <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>servaddr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>servaddr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  servaddr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>  servaddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 指定服务端的通信端口。</span>  <span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>servaddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">,</span>h<span class="token operator">-</span><span class="token operator">></span>h_addr<span class="token punctuation">,</span>h<span class="token operator">-</span><span class="token operator">></span>h_length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 不能直接赋值</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">connect</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> sockaddr <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>servaddr<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>servaddr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// 向服务端发起连接清求。</span>  <span class="token punctuation">{</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"connect"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 第3步：与服务端通信，发送一个报文后等待回复，然后再发下一个报文。</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> ii<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>ii<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>ii<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token keyword">int</span> iret<span class="token punctuation">;</span>    <span class="token function">memset</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">sprintf</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token string">"这是第%d个超级女生，编号%03d。"</span><span class="token punctuation">,</span>ii<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>ii<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>iret<span class="token operator">=</span><span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 向服务端发送请求报文。</span>    <span class="token punctuation">{</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"send"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"发送：%s\n"</span><span class="token punctuation">,</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">memset</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>iret<span class="token operator">=</span><span class="token function">recv</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 接收服务端的回应报文。</span>    <span class="token punctuation">{</span>       <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"iret=%d\n"</span><span class="token punctuation">,</span>iret<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"接收：%s\n"</span><span class="token punctuation">,</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// 第4步：关闭socket，释放资源。</span>  <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p><strong>在运行程序之前，必须保证服务器的防火墙已经开通了网络访问策略（云服务器还需要登录云控制平台开通访问策略）。</strong></p><p>先启动服务端程序 server，服务端启动后，进入等待客户端连接状态，然后启动客户端。</p><p>客户端的输出如下：</p><p><img src="https://www.freecplus.net/runoobFiles/ueditor/image/20200922/1600748091684066055.png" alt="image.png"></p><p>服务端的输出如下：</p><p><img src="https://www.freecplus.net/runoobFiles/ueditor/image/20200922/1600748125501002008.png" alt="image.png"></p><h3 id="四、注意事项"><a href="#四、注意事项" class="headerlink" title="四、注意事项"></a>四、注意事项</h3><p>在 socket 通信的客户端和服务器的程序里，出现了多种数据结构，调用了多个函数，涉及到很多方面的知识，对初学者来说，更重要的是了解 socket 通信的过程、每段代码的用途和函数调用的功能，不要去纠缠这些结构体和函数的参数，这些函数和参数虽然比较多，但可以修改的非常少，别抄错就可以了，需要注意的地方我会提出。</p><h4 id="1、socket-文件描述符"><a href="#1、socket-文件描述符" class="headerlink" title="1、socket 文件描述符"></a>1、socket 文件描述符</h4><p>在 UNIX 系统中，一切输入输出设备皆文件，socket()函数的返回值其本质是一个文件描述符，是一个整数。</p><h4 id="2、服务端程序绑定地址"><a href="#2、服务端程序绑定地址" class="headerlink" title="2、服务端程序绑定地址"></a>2、服务端程序绑定地址</h4><p>如果服务器有多个网卡，多个 IP 地址，socket 通信可以指定用其中一个地址来进行通信，也可以任意 ip 地址。</p><p>1）指定 ip 地址的代码</p><pre class=" language-cpp"><code class="language-cpp">  m_servaddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">inet_addr</span><span class="token punctuation">(</span><span class="token string">"192.168.149.129"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 指定ip地址</span></code></pre><p>2）任意 ip 地址的代码</p><pre class=" language-cpp"><code class="language-cpp">  m_servaddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 本主机的任意ip地址</span></code></pre><p>在实际开发中，采用任意 ip 地址的方式比较多。</p><h4 id="3、服务端程序绑定的通信端口"><a href="#3、服务端程序绑定的通信端口" class="headerlink" title="3、服务端程序绑定的通信端口"></a>3、服务端程序绑定的通信端口</h4><pre class=" language-cpp"><code class="language-cpp">  m_servaddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 通信端口</span></code></pre><h4 id="4、客户端程序指定服务端的-ip-地址"><a href="#4、客户端程序指定服务端的-ip-地址" class="headerlink" title="4、客户端程序指定服务端的 ip 地址"></a>4、客户端程序指定服务端的 ip 地址</h4><pre class=" language-cpp"><code class="language-cpp">  <span class="token keyword">struct</span> hostent<span class="token operator">*</span> h<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> <span class="token function">gethostbyname</span><span class="token punctuation">(</span><span class="token string">"118.89.50.198"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">// 指定服务端的ip地址。</span>  <span class="token punctuation">{</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"gethostbyname failed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre><h4 id="5、客户端程序指定服务端的通信端口"><a href="#5、客户端程序指定服务端的通信端口" class="headerlink" title="5、客户端程序指定服务端的通信端口"></a>5、客户端程序指定服务端的通信端口</h4><pre class=" language-cpp"><code class="language-cpp">  servaddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="6、send-函数"><a href="#6、send-函数" class="headerlink" title="6、send 函数"></a>6、send 函数</h4><p>send 函数用于把数据通过 socket 发送给对端。不论是客户端还是服务端，应用程序都用 send 函数来向 TCP 连接的另一端发送数据。</p><p>函数声明：</p><pre class=" language-cpp"><code class="language-cpp">ssize_t <span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> size_t len<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>sockfd 为已建立好连接的 socket。</p><p>buf 为需要发送的数据的内存地址，可以是 C 语言基本数据类型变量的地址，也可以数组、结构体、字符串，内存中有什么就发送什么。</p><p>len 需要发送的数据的长度，为 buf 中有效数据的长度。</p><p>flags 填 0, 其他数值意义不大。</p><p>函数返回已发送的字符数。出错时返回-1，错误信息 errno 被标记。</p><p>注意，就算是网络断开，或 socket 已被对端关闭，send 函数不会立即报错，要过几秒才会报错。</p><p>如果 send 函数返回的错误（&lt;=0），表示通信链路已不可用。</p><h4 id="7、recv-函数"><a href="#7、recv-函数" class="headerlink" title="7、recv 函数"></a>7、recv 函数</h4><p>recv 函数用于接收对端 socket 发送过来的数据。</p><p>recv 函数用于接收对端通过 socket 发送过来的数据。不论是客户端还是服务端，应用程序都用 recv 函数接收来自 TCP 连接的另一端发送过来数据。</p><p>函数声明：</p><pre class=" language-cpp"><code class="language-cpp">ssize_t <span class="token function">recv</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> size_t len<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>sockfd 为已建立好连接的 socket。</p><p>buf 为用于接收数据的内存地址，可以是 C 语言基本数据类型变量的地址，也可以数组、结构体、字符串，只要是一块内存就行了。</p><p>len 需要接收数据的长度，不能超过 buf 的大小，否则内存溢出。</p><p>flags 填 0, 其他数值意义不大。</p><p>函数返回已接收的字符数。出错时返回-1，失败时不会设置 errno 的值。</p><p>如果 socket 的对端没有发送数据，recv 函数就会等待，如果对端发送了数据，函数返回接收到的字符数。出错时返回-1。如果 socket 被对端关闭，返回值为 0。</p><p>如果 recv 函数返回的错误（&lt;=0），表示通信通道已不可用。</p><h4 id="8、服务端有两个-socket"><a href="#8、服务端有两个-socket" class="headerlink" title="8、服务端有两个 socket"></a>8、服务端有两个 socket</h4><p>对服务端来说，有两个 socket，一个是用于监听的 socket，还有一个就是客户端连接成功后，由 accept 函数创建的用于与客户端收发报文的 socket。</p><h4 id="9、程序退出时先关闭-socket"><a href="#9、程序退出时先关闭-socket" class="headerlink" title="9、程序退出时先关闭 socket"></a>9、程序退出时先关闭 socket</h4><p>socket 是系统资源，操作系统打开的 socket 数量是有限的，在程序退出之前必须关闭已打开的 socket，就像关闭文件指针一样，就像 delete 已分配的内存一样，极其重要。</p><p>值得注意的是，关闭 socket 的代码不能只在 main 函数的最后，那是程序运行的理想状态，还应该在 main 函数的每个 return 之前关闭。</p><h3 id="五、相关的库函数"><a href="#五、相关的库函数" class="headerlink" title="五、相关的库函数"></a>五、相关的库函数</h3><h4 id="1、socket-函数"><a href="#1、socket-函数" class="headerlink" title="1、socket 函数"></a>1、socket 函数</h4><p>socket 函数用于创建一个新的 socket，也就是向系统申请一个 socket 资源。socket 函数用户客户端和服务端。</p><p>函数声明：</p><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">socket</span><span class="token punctuation">(</span><span class="token keyword">int</span> domain<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">int</span> protocol<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>参数说明：</p><p>domain：协议域，又称协议族（family）。常用的协议族有 AF_INET、AF_INET6、AF_LOCAL（或称 AF_UNIX，Unix 域 Socket）、AF_ROUTE 等。协议族决定了 socket 的地址类型，在通信中必须采用对应的地址，如 AF_INET 决定了要用 ipv4 地址（32 位的）与端口号（16 位的）的组合、AF_UNIX 决定了要用一个绝对路径名作为地址。</p><p>type：指定 socket 类型。常用的 socket 类型有 SOCK_STREAM、SOCK_DGRAM、SOCK_RAW、SOCK_PACKET、SOCK_SEQPACKET 等。流式 socket（SOCK_STREAM）是一种面向连接的 socket，针对于面向连接的 TCP 服务应用。数据报式 socket（SOCK_DGRAM）是一种无连接的 socket，对应于无连接的 UDP 服务应用。</p><p>protocol：指定协议。常用协议有 IPPROTO_TCP、IPPROTO_UDP、IPPROTO_STCP、IPPROTO_TIPC 等，分别对应 TCP 传输协议、UDP 传输协议、STCP 传输协议、TIPC 传输协议。</p><p>说了一大堆废话，第一个参数只能填 AF_INET，第二个参数只能填 SOCK_STREAM，第三个参数只能填 0。</p><p>除非系统资料耗尽，socket 函数一般不会返回失败。</p><p>返回值：成功则返回一个 socket，失败返回-1，错误原因存于 errno 中。</p><h4 id="2、gethostbyname-函数"><a href="#2、gethostbyname-函数" class="headerlink" title="2、gethostbyname 函数"></a>2、gethostbyname 函数</h4><p>把 ip 地址或域名转换为 hostent 结构体表达的地址。</p><p>函数声明：</p><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">struct</span> hostent <span class="token operator">*</span><span class="token function">gethostbyname</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>参数 name，域名或者主机名，例如”192.168.1.3”、”<a href="http://www.freecplus.net&quot;等。" target="_blank" rel="noopener">www.freecplus.net&quot;等。</a></p><p>返回值：如果成功，返回一个 hostent 结构指针，失败返回 NULL。</p><p>gethostbyname 只用于客户端。</p><p>gethostbyname 只是把字符串的 ip 地址转换为结构体的 ip 地址，只要地址格式没错，一般不会返回错误。失败时不会设置 errno 的值。</p><h4 id="3、connect-函数"><a href="#3、connect-函数" class="headerlink" title="3、connect 函数"></a>3、connect 函数</h4><p>向服务器发起连接请求。</p><p>函数声明：</p><pre><code>int connect(int sockfd, struct sockaddr * serv_addr, int addrlen);</code></pre><p>函数说明：connect 函数用于将参数 sockfd 的 socket 连至参数 serv_addr 指定的服务端，参数 addrlen 为 sockaddr 的结构长度。</p><p>返回值：成功则返回 0，失败返回-1，错误原因存于 errno 中。</p><p>connect 函数只用于客户端。</p><p>如果服务端的地址错了，或端口错了，或服务端没有启动，connect 一定会失败。</p><h4 id="4、bind-函数"><a href="#4、bind-函数" class="headerlink" title="4、bind 函数"></a>4、bind 函数</h4><p>服务端把用于通信的地址和端口绑定到 socket 上。</p><p>函数声明：</p><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> sockaddr <span class="token operator">*</span>addr<span class="token punctuation">,</span>socklen_t addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>参数 sockfd，需要绑定的 socket。</p><p>参数 addr，存放了服务端用于通信的地址和端口。</p><p>参数 addrlen 表示 addr 结构体的大小。</p><p>返回值：成功则返回 0，失败返回-1，错误原因存于 errno 中。</p><p>如果绑定的地址错误，或<strong>端口已被占用</strong>，bind 函数一定会报错，否则一般不会返回错误。</p><h4 id="5、listen-函数"><a href="#5、listen-函数" class="headerlink" title="5、listen 函数"></a>5、listen 函数</h4><p>listen 函数把主动连接 socket 变为被动连接的 socket，使得这个 socket 可以接受其它 socket 的连接请求，从而成为一个服务端的 socket。</p><p>函数声明：</p><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">listen</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">int</span> backlog<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>返回：0-成功， -1-失败</p><p>参数 sockfd 是已经被 bind 过的 socket。socket 函数返回的 socket 是一个主动连接的 socket，在服务端的编程中，程序员希望这个 socket 可以接受外来的连接请求，也就是被动等待客户端来连接。由于系统默认时认为一个 socket 是主动连接的，所以需要通过某种方式来告诉系统，程序员通过调用 listen 函数来完成这件事。</p><p>参数 backlog，这个参数涉及到一些网络的细节，比较麻烦，填 5、10 都行，一般不超过 30。</p><p>当调用 listen 之后，服务端的 socket 就可以调用 accept 来接受客户端的连接请求。</p><p>返回值：成功则返回 0，失败返回-1，错误原因存于 errno 中。</p><p>listen 函数一般不会返回错误。</p><h4 id="6、accept-函数"><a href="#6、accept-函数" class="headerlink" title="6、accept 函数"></a>6、accept 函数</h4><p>服务端接受客户端的连接。</p><p>函数声明：</p><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span><span class="token keyword">struct</span> sockaddr <span class="token operator">*</span>addr<span class="token punctuation">,</span>socklen_t <span class="token operator">*</span>addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>参数 sockfd 是已经被 listen 过的 socket。</p><p>参数 addr 用于存放客户端的地址信息，用 sockaddr 结构体表达，如果不需要客户端的地址，可以填 0。</p><p>参数 addrlen 用于存放 addr 参数的长度，如果 addr 为 0，addrlen 也填 0。</p><p>accept 函数等待客户端的连接，如果没有客户端连上来，它就一直等待，这种方式称之为阻塞。</p><p>accept 等待到客户端的连接后，创建一个新的 socket，函数返回值就是这个新的 socket，服务端使用这个新的 socket 和客户端进行报文的收发。</p><p>返回值：成功则返回 0，失败返回-1，错误原因存于 errno 中。</p><p>accept 在等待的过程中，如果被中断或其它的原因，函数返回-1，表示失败，如果失败，可以重新 accept。</p><h4 id="7、函数小结"><a href="#7、函数小结" class="headerlink" title="7、函数小结"></a>7、函数小结</h4><p>服务端函数调用的流程是：socket-&gt;bind-&gt;listen-&gt;accept-&gt;<strong>recv/send</strong>-&gt;close</p><p>客户端函数调用的流程是：socket-&gt;connect-&gt;<strong>send/recv</strong>-&gt;close</p><p>其中<strong>send/recv</strong>可以进行多次交互。</p><p>六、课后作业</p><p>1）把 client.cpp 和 server.cpp 抄下来，编译运行，试试修改参数再运行。</p><p>2）client.cpp 和 server.cpp 程序中，有些代码不能动，有些代码可以动，把能动的都动一下，就算是抄代码，也要抄个明白。</p><p>3）服务端的 accept 函数会阻塞，阻塞是专业名词，即等待，可以用代码测试一下。</p><p>4）不管是服务端还是客户端 recv 函数也会阻塞，可以用代码测试一下。</p><p>5）修改 client.cpp 和 server.cpp，实现点对点的聊天功能，用户在客户端输入一个字符串，然后发送给服务端，服务端收到客户端的报文后，也提示用户输入一个字符串，返回给客户端，如果服务端收到客户端的报文是“bye”通信结束。</p><p>6）如果以上作业都能完成，建议再把本文章的内容再看一次，对文章开始部分的理论知识将有新的理解。</p><p>七、版权声明</p><p>C 语言技术网原创文章，转载请说明文章的来源、作者和原文的链接。</p><p>来源：C 语言技术网（<a href="http://www.freecplus.net/" target="_blank" rel="noopener">www.freecplus.net</a>）</p><p>作者：码农有道</p><h4 id="8、经验分享"><a href="#8、经验分享" class="headerlink" title="8、经验分享"></a>8、经验分享</h4><h5 id="可以打开多少个-sock"><a href="#可以打开多少个-sock" class="headerlink" title="可以打开多少个 sock"></a>可以打开多少个 sock</h5><pre class=" language-shell"><code class="language-shell">// ulimit -a 1024 个ubuntu@ubuntu:~/Desktop$ ulimit -acore file size          (blocks, -c) 0data seg size           (kbytes, -d) unlimitedscheduling priority             (-e) 0file size               (blocks, -f) unlimitedpending signals                 (-i) 15399max locked memory       (kbytes, -l) 65536max memory size         (kbytes, -m) unlimitedopen files                      (-n) 1024pipe size            (512 bytes, -p) 8POSIX message queues     (bytes, -q) 819200real-time priority              (-r) 0stack size              (kbytes, -s) 8192cpu time               (seconds, -t) unlimitedmax user processes              (-u) 15399virtual memory          (kbytes, -v) unlimitedfile locks                      (-x) unlimited// 修改为 2000 个ubuntu@ubuntu:~/Desktop$ ulimit -HSn 2000</code></pre><h5 id="设置服务端-socket-的-SO-REUSEADDR-属性"><a href="#设置服务端-socket-的-SO-REUSEADDR-属性" class="headerlink" title="设置服务端 socket 的 SO_REUSEADDR 属性"></a>设置服务端 socket 的 SO_REUSEADDR 属性</h5><p>服努端程序的端口释放后可能会处于 TIME WAIT 状态，等待两分钟之后才能再被使用 SO_REUSEADDR 是让端口释放后立即就可以被再次使用。</p><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">// 设置 SO_REUSEADDR选项</span><span class="token keyword">int</span> opt<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> len<span class="token operator">=</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setsockopt</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">,</span> SOL_SOCKET<span class="token punctuation">,</span> SO_REUSEADDR<span class="token punctuation">,</span> <span class="token operator">&amp;</span>opt<span class="token punctuation">,</span> len<span class="token punctuation">)</span></code></pre><h5 id="查看系统进程连接情况"><a href="#查看系统进程连接情况" class="headerlink" title="查看系统进程连接情况"></a>查看系统进程连接情况</h5><p><code>netstat -na</code></p><h3 id="六、主机字节序与网络字节序"><a href="#六、主机字节序与网络字节序" class="headerlink" title="六、主机字节序与网络字节序"></a>六、主机字节序与网络字节序</h3><ul><li><p><strong>字节顺序</strong>：</p><ul><li>是指占内存多于一个字节类型的数据在内存中的存放顺序，一个 32 位整数由 4 个字节组成。內存中存储这 4 个字节有两种方法：一种是将低序字节存储在起始地址，这称为小端（little-endian）字节序；另一种方法是将高序字节存储在起始地址，这称为大端（big-endian）字节序。</li></ul><p><img src="C_C++%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%8C%E4%BB%8Esocket%E5%88%B0epoll.assets/image-20210705144109361.png" alt="image-20210705144109361"></p><ul><li>这两种字节序之间没有标准可循，两种格式都有系统使用。比如，Inter x86、ARM 核采用的是小端模式，Power pc、MIPS UNIX 和 HP-PA UNIX 釆用大端模式。<br>大于一个字节类型的数据在内存中的存放有顺序，一个字节的数据没有顺序的问题</li></ul></li><li><p><strong>网络字节序</strong>：网络字节序是 TCP/P 中规定好的一种数据表示格式，它与具体的 CPU 类型、操作系统等无关，从而可以保证数据在不同主机之间传输时能够被正确解释。网络字节序采用 big endian 排序方式</p></li><li><p><strong>主机字节序</strong>：不同的机器主机字节序不相同，与 CPU 设计有关，数据的顺序是由 cpu 决定的，而与操作系统无关。</p></li><li><p>由于这个原因不同体系结构的机器之间无法通信，所以要转换成一种约定的字节序，也就是网络字节序。即使是同一台机器上的两个进程（比如一个由 C 语言，另一个由 Java 编写）通信，也要考虑字节序的问题（VM 采用大端字节序）。</p></li><li><p>网络字节序与主机字节序之间的转换函数：</p><ul><li><code>hons()，、ntohs()、htonl()、ntohl()</code></li><li>htons 和 ntohs 完成 16 位无符号数的相互转换，</li><li>htonl 和 ntohl 完成 32 位无符号数的相互转换。host to network short long</li></ul></li></ul><h3 id="七、结构体"><a href="#七、结构体" class="headerlink" title="七、结构体"></a>七、结构体</h3><h4 id="socket"><a href="#socket" class="headerlink" title="socket"></a>socket</h4><pre class=" language-c"><code class="language-c"><span class="token keyword">struct</span> sockaddr<span class="token punctuation">{</span>  <span class="token keyword">unsigned</span> <span class="token keyword">short</span> sa_family<span class="token punctuation">;</span>  <span class="token keyword">char</span> sa_data<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">struct</span> sockaddr_in<span class="token punctuation">{</span>  <span class="token keyword">short</span> <span class="token keyword">int</span> sin_family<span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">short</span> <span class="token keyword">int</span> sin_port<span class="token punctuation">;</span>  <span class="token keyword">struct</span> in addr sin_addr<span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> sin_zero<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">struct</span> in addr<span class="token punctuation">{</span>    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> s_addr<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h4 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h4><p>强制转换为老的 sockaddr</p><pre class=" language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">bind</span> <span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> sockaddr <span class="token operator">*</span>addr<span class="token punctuation">,</span> socklen_t addr len<span class="token punctuation">)</span></code></pre><h4 id="gethostbyname"><a href="#gethostbyname" class="headerlink" title="gethostbyname"></a>gethostbyname</h4><pre class=" language-c"><code class="language-c"><span class="token keyword">struct</span> hostent <span class="token punctuation">{</span>  <span class="token keyword">char</span><span class="token operator">*</span> h_name<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//主机名</span>    <span class="token keyword">char</span><span class="token operator">*</span>h_aliases<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//主机所有别名构成的字符串数组，同一P可绑定多个域名int h         int h_addrtype; //主机P地址的类型，例如PV4（AF INET）还是PV6</span>    <span class="token keyword">int</span> h_length<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//主机IP地址长度，IPV4地址为4，IPV6地址则为16</span>     <span class="token keyword">char</span><span class="token operator">*</span>h addr_list<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//主机的jp地址，以网络字节序存储。</span><span class="token punctuation">}</span><span class="token macro property">#<span class="token directive keyword">define</span> h_addr h_addr_list[0]</span><span class="token comment" spellcheck="true">/*for backward compatibility*/</span><span class="token comment" spellcheck="true">// gethostbyname函数可以利用字符串格式的域名获得IP网络字节顺序地址。</span><span class="token keyword">struct</span> hostent<span class="token operator">*</span><span class="token function">gethostbyname</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span>name<span class="token punctuation">)</span></code></pre><ol><li>将一个字符串 IP 地址转换为一个 32 位的网络字节序 IP 地址。如果这个函数成功，函数的返回值非零，如果输入地址不正确则会返回零。使用这个函数并没有错误码存放在 errno 中，所以它的值会被忽略</li><li>把网络字节序 IP 地址转换成字符串的 IP 地址。</li></ol><pre class=" language-c"><code class="language-c"><span class="token keyword">int</span> inet_aton（<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span>cp，<span class="token keyword">struct</span> in_addr<span class="token operator">*</span>inp）<span class="token punctuation">;</span><span class="token keyword">char</span><span class="token operator">*</span>inet_ntoa（<span class="token keyword">struct</span> in_addr in）；in_addr_t inet_addr（<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span>cp）；<span class="token comment" spellcheck="true">// 和第一个相同</span></code></pre><h4 id="listen、connect、accept"><a href="#listen、connect、accept" class="headerlink" title="listen、connect、accept"></a>listen、connect、accept</h4><p>返回新的 socket，生成队列。</p><p>accept 从队列中获取一个</p><p>1）服务端在调用 llisten0 之前，客户端不能向服务端发起连接请求的</p><p>2）服务端调用 listen0 函数后，服务端的 socke 开始监听客户端的连接</p><p>3）客户端调用 connect0 函数向服务端发起连接请求</p><p>4）在 cP 底层，客户端和服务端握手后建立起通信通道，如果有多个客户端请求，在服务端就会形成一个已准备好的连接的队列</p><p>5）服务端调用 accept0 函数从队列中获取一个已准备好的连接，函数返回一个新的 socket，新的 socket 用于与客户端通信，listen 的 socket 只负责监听客户端的连接请求。</p><h4 id="listen-的-socket-队列"><a href="#listen-的-socket-队列" class="headerlink" title="listen 的 socket 队列"></a>listen 的 socket 队列</h4><ul><li>内核会为 ten 状态的 socket 维护两个队列：不完全连接请求队列（SYN RECV 状态）<br>和等待 acep 建立 socke 的队列（ESTABLISHED 状态）</li><li>在 linux 内核 22 之后，backlog 参数的形为改变了，现在它指等待 accept 的完全建立的 socket 的队列长度，而不是不完全连接请求的数量。不完全连接队列的长度可以使用<br>/proc/sys/net/ipv4/tcp_max_syn_backlog 设置（缺省值 128）</li><li>backlog 参数如果比/proc/sys/net/ipv4/tcp max syn backlog，则截断</li></ul><h3 id="八、TCP-报文分包和粘包"><a href="#八、TCP-报文分包和粘包" class="headerlink" title="八、TCP 报文分包和粘包"></a>八、TCP 报文分包和粘包</h3><p>分包：发送方发送字符串”helloworld”，接收方却接收到了两个字符串”hello 和”world 粘包：发送方发送两个字符串”hello”+”world”，接收方却一次性接收到了”helloworld”<br>但是 TcP 传输数据能保证几点：<br>1）顺序不变，例如发送方发送 hell，接收方也一定顺序接收到 helo，这个是 TCP 协议承诺的，因此这点成为我们解决分包和粘包问题的关键</p><p>2）分割的包中间不会插入其他数据。<br>在实际开发中，为了解决分包和粘包的问题，就一定要自定义一份协议，最常用的方一法是<br>报文长度+报文内容<code>0010helloworld</code> 报文长度 asci 码，二进制的数字</p><h3 id="九、socket-封装"><a href="#九、socket-封装" class="headerlink" title="九、socket 封装"></a>九、socket 封装</h3><p>用于解决分包和粘包，封装成类。</p><h3 id="十、多进程的-socket-服务端"><a href="#十、多进程的-socket-服务端" class="headerlink" title="十、多进程的 socket 服务端"></a>十、多进程的 socket 服务端</h3><p>基础：</p><ol><li>信号；</li><li>多进程；</li></ol><h4 id="一、搭建"><a href="#一、搭建" class="headerlink" title="一、搭建"></a>一、搭建</h4><h4 id="二、僵尸进程"><a href="#二、僵尸进程" class="headerlink" title="二、僵尸进程"></a>二、僵尸进程</h4><h4 id="三、增加业务逻辑"><a href="#三、增加业务逻辑" class="headerlink" title="三、增加业务逻辑"></a>三、增加业务逻辑</h4><ol><li>xml 登录和身份验证</li></ol><h4 id="四、TCP-长连接与短连接"><a href="#四、TCP-长连接与短连接" class="headerlink" title="四、TCP 长连接与短连接"></a>四、TCP 长连接与短连接</h4><ol><li>client 与 server 建立连接进行通信，通信完成后释放连接，建立连接时需要 3 次握手，释放连接需要 4 次挥手，连接的建立和释放都需要时间，server 还有创建新进程或线程的开销。<ol><li>短连接：client/server 间只进行一次或连续多次通信，通信完成后马上断开了。管理起来比较简单，不需要额外的控制手段。</li><li>长连接：client/server 间需要多次通信，通信的频率和次数不确定，所以 client 和 server 需要保持这个连接。<br>根据不同的应用场景采用不同的策略，没有十全十美的选择，只有合适的选择</li></ol></li></ol><h3 id="十一、网络服务端性能测试"><a href="#十一、网络服务端性能测试" class="headerlink" title="十一、网络服务端性能测试"></a>十一、网络服务端性能测试</h3><ol><li><p>在实际项目开发中，除了完成程序的功能，还需要测试性能。</p><ol><li>在充分了解服务端的性能后，才能决定如何选择服务端的架构，还有网络带宽、硬件配置等。</li><li>服务端的性能指标是面试中必问的。</li><li>如果不了解系统的性能指标，面试官会认为您没有实际项目开发经验或对网络编程是一知半解。主要的性能指标如下：<ol><li>1）服务端的并发能力；</li><li>2）服务端的业务处理能力</li><li>3）客户端业务响应时效；</li><li>4）网络带宽。</li></ol></li></ol><p>重要的业务系统，最好是与系统管理员和网络管理员一起测试。</p></li></ol><h4 id="一、并发性能测试"><a href="#一、并发性能测试" class="headerlink" title="一、并发性能测试"></a>一、并发性能测试</h4><h4 id="二、业务性能测试"><a href="#二、业务性能测试" class="headerlink" title="二、业务性能测试"></a>二、业务性能测试</h4><h4 id="三、多进程与多线程性能差异"><a href="#三、多进程与多线程性能差异" class="headerlink" title="三、多进程与多线程性能差异"></a>三、多进程与多线程性能差异</h4><h4 id="四、响应时间"><a href="#四、响应时间" class="headerlink" title="四、响应时间"></a>四、响应时间</h4><h4 id="五、带宽"><a href="#五、带宽" class="headerlink" title="五、带宽"></a>五、带宽</h4><h3 id="十二、I-O-复用"><a href="#十二、I-O-复用" class="headerlink" title="十二、I/O 复用"></a>十二、I/O 复用</h3><ol><li>多进程/线程并发模型，为每个 socket 分配一个进程/线程。</li><li>I/O（多路）复用，采用单个进/线程就可以管理多个 socket<ol><li>网络设备（交换机、路由器）；</li><li>大型游戏的后台</li><li>nginx、redis</li></ol></li><li>l/O 复用有三种方案：select、poll、epoll，各有优缺点，select 并不是一定就不行，epoll 也不是什么都好，各有应用场景，必须全部掌握。</li></ol><h4 id="一、select"><a href="#一、select" class="headerlink" title="一、select"></a>一、select</h4><p><img src="C_C++%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%8C%E4%BB%8Esocket%E5%88%B0epoll.assets/image-20210705224417795.png" alt="image-20210705224417795"></p><p><img src="C_C++%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%8C%E4%BB%8Esocket%E5%88%B0epoll.assets/image-20210705235241828.png" alt="image-20210705235241828"></p><ul><li>select 的水平触发<ul><li>selec 采用“水平触发”的方式，如果报告了 fd 后事件没有被处理或数据没有被全部读取，那么下次 select 时会再次报告该 fd。</li></ul></li><li>select 的缺点<ol><li>1）select 支持的文件描述符数量太小了，默认是 1024，虽然可以调整，但是，描述符数量越大，效率将更低，调整的意义不大。</li><li>2）每次调用 select，都需要把 fdset 从用户态拷贝到内核。</li><li>3）同时在线的大量客户端有事件发生的可能很少，但还是需要遍历 feet，因此随着监视的描述符数量的增长，其效率也会线性下降。</li></ol></li><li>select 的其它用途<ul><li>在 unⅸ（Linux）世界里，一切皆文件，文件就是一串二进制流，不管 socket、管道、終端、设备等都是文件，一切都是流。在信息交换的过程中，都是对这些流进行数据的收发操作，简称为 Ⅳ◎ 操作 input and output），往流中读出数据，系统调用 read，写入数据，系统调用 write</li><li>select 是 io 复用函数，除了用于网络通信，还可以用于文件、管道、终端、设备等操作，但开发场景比较少。<br>了解 pselect 函数。</li></ul></li></ul><h4 id="二、poll"><a href="#二、poll" class="headerlink" title="二、poll"></a>二、poll</h4><ol><li><p>poll 模型</p><ul><li>poll 和 select 在本质上没有差别，管理多个描述符也是进行轮询，根据描述符的状态进行处理，但是 poll 没有最大文件描述符数量的限制。</li><li>select 用 fdset 采用 bitmap，poll 用了<strong>数组</strong>。</li><li>poll 和 select 同样存在一个缺点就是，文件描述符的数组被整体复制于用户态和内核态的地址空间之间，而不论这些文件描述符是否有事件，它的开销随着文件描述符数量的增加而线性增大。</li><li>还有 poll 返回后，也需要历遍整个描述符的数组才能得到有事件的描述符。</li></ul></li><li><p>poll 函数和参数</p><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;poll.h></span></span><span class="token keyword">int</span> <span class="token function">poll</span><span class="token punctuation">(</span><span class="token keyword">struct</span> pollfd <span class="token operator">*</span>fdarray<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> nfds<span class="token punctuation">,</span><span class="token keyword">int</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">struct</span> pollfd<span class="token punctuation">{</span> <span class="token keyword">int</span> fd<span class="token punctuation">;</span>                  <span class="token comment" spellcheck="true">//需要检测的文件描述符</span> <span class="token keyword">short</span> events<span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//请求的事件</span> <span class="token keyword">short</span> revents<span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">//返回的事件</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><ol><li><p>返回：若有就绪描述符则为其数目，若超时返回 0，出错返回-1</p><p>第一个参数是指向一个结构体数组第一个元素的指针。每个元素都是一个 pollfd 结构，用于指定测试某个给定描述符 fd 的条件</p></li></ol></li><li><p>下表说明了能够作为 events 和 revents 的常量</p><p><img src="https://pic4.zhimg.com/80/v2-ffc0e68af82b0873a6794a4296e602eb_720w.jpg" alt="img"></p><p>结构体数组中元素的个数是由 nfds 参数指定。</p><p>timeout 参数指定 poll 函数返回前等待多长时间。它是一个指定应等待毫秒数的正值。取值如下表：</p><p>timeout 值说明-1 永远等待，直到有描述符就绪 0 立即返回，不阻塞进程&gt;0 等待指定的毫秒数</p><p>使用 poll 函数建立的服务器端如下：</p><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">//</span><span class="token comment" spellcheck="true">// Created by silver on 2020/8/23.</span><span class="token comment" spellcheck="true">//</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/unistd.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;errno.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/select.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;poll.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/stropts.h></span></span><span class="token macro property">#<span class="token directive keyword">define</span> MAXLINE 4096</span><span class="token macro property">#<span class="token directive keyword">define</span> PORT 9873</span><span class="token macro property">#<span class="token directive keyword">define</span> LISTQUE 1024</span><span class="token macro property">#<span class="token directive keyword">define</span> OPEN_MAX 256</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> listenfd<span class="token punctuation">,</span>confd<span class="token punctuation">,</span>sockfd<span class="token punctuation">;</span>    <span class="token keyword">struct</span> pollfd client<span class="token punctuation">[</span>OPEN_MAX<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> nready<span class="token punctuation">;</span>    <span class="token keyword">int</span> maxcount <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span>MAXLINE<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">struct</span> sockaddr_in SerAddr<span class="token punctuation">,</span>Cliaddr<span class="token punctuation">;</span>    socklen_t Clilen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Cliaddr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//initializer</span>    <span class="token function">bzero</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>SerAddr<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>SerAddr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">bzero</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Cliaddr<span class="token punctuation">,</span>Clilen<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">bzero</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>MAXLINE<span class="token punctuation">)</span><span class="token punctuation">;</span>    listenfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">,</span>IPPROTO_IP<span class="token punctuation">)</span><span class="token punctuation">;</span>    SerAddr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>    SerAddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>PORT<span class="token punctuation">)</span><span class="token punctuation">;</span>    SerAddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> sockaddr<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>SerAddr<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>SerAddr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"Bind error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">listen</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">,</span>LISTQUE<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"listen error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    client<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fd <span class="token operator">=</span> listenfd<span class="token punctuation">;</span>    client<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>events <span class="token operator">=</span> POLLRDNORM<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> count <span class="token operator">&lt;</span> OPEN_MAX<span class="token punctuation">;</span> count<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        client<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">.</span>fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    maxcount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    ssize_t  n<span class="token punctuation">;</span>    <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">"server waiting...."</span><span class="token punctuation">,</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        nready <span class="token operator">=</span> <span class="token function">poll</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span>maxcount <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>revents <span class="token operator">&amp;</span> POLLRDNORM<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// new client connection</span>        <span class="token punctuation">{</span>            confd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> sockaddr<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>Cliaddr<span class="token punctuation">,</span><span class="token operator">&amp;</span>Clilen<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"client address: %s\n"</span><span class="token punctuation">,</span><span class="token function">inet_ntoa</span><span class="token punctuation">(</span>Cliaddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>confd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"accept error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  count<span class="token operator">&lt;</span>OPEN_MAX <span class="token punctuation">;</span> count<span class="token operator">++</span><span class="token punctuation">)</span>            <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">.</span>fd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>                <span class="token punctuation">{</span>                    client<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">.</span>fd <span class="token operator">=</span> confd<span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> OPEN_MAX<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"too many clients"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>            client<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">.</span>events <span class="token operator">=</span> POLLRDNORM<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">></span> maxcount<span class="token punctuation">)</span> maxcount <span class="token operator">=</span> count<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">--</span>nready <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//no more readable descriptions</span>        <span class="token punctuation">}</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> count <span class="token operator">&lt;=</span>maxcount <span class="token punctuation">;</span> count<span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sockfd <span class="token operator">=</span> client<span class="token punctuation">[</span>maxcount<span class="token punctuation">]</span><span class="token punctuation">.</span>fd<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token punctuation">}</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>client<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">.</span>revents <span class="token operator">&amp;</span> <span class="token punctuation">(</span>POLLRDNORM <span class="token operator">|</span> POLLERR<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">{</span>                n <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>MAXLINE<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>errno <span class="token operator">==</span> ECONNRESET<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>                        client<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">.</span>fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"read error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>                    client<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">.</span>fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token function">writen</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">--</span>nready <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//no more readable descriptions</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token function">close</span><span class="token punctuation">(</span>listenfd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>编辑于 2020-09-12</p></li></ol><h4 id="三、epoll"><a href="#三、epoll" class="headerlink" title="三、epoll"></a>三、epoll</h4><p>epoll 解决了 select 和 poll 所有的问题（fdset 拷贝和轮询），采用了最合理的设计和实现方案。</p><p>epoll 在现在的软件中占据了很大的分量，nginx，libuv 等单线程事件循环的软件都使用了 epoll。之前分析过 select，今天分析一下 epoll。</p><p>们按照 epoll 三部曲的顺序进行分析。</p><h5 id="epoll-create"><a href="#epoll-create" class="headerlink" title="epoll_create"></a><strong>epoll_create</strong></h5><pre class=" language-cpp"><code class="language-cpp">asmlinkage <span class="token keyword">long</span> <span class="token function">sys_epoll_create</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> error<span class="token punctuation">,</span> fd<span class="token punctuation">;</span>    <span class="token keyword">struct</span> inode <span class="token operator">*</span>inode<span class="token punctuation">;</span>    <span class="token keyword">struct</span> file <span class="token operator">*</span>file<span class="token punctuation">;</span>    error <span class="token operator">=</span> <span class="token function">ep_getfd</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>inode<span class="token punctuation">,</span> <span class="token operator">&amp;</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>    error <span class="token operator">=</span> <span class="token function">ep_file_init</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> fd<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>我们发现 create 函数似乎很简单。<br>1 操作系统中，进程和文件系统是通过 fd=&gt;file=&gt;node 联系起来的。ep_getfd 就是在建立这个联系。</p><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">ep_getfd</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>efd<span class="token punctuation">,</span> <span class="token keyword">struct</span> inode <span class="token operator">*</span><span class="token operator">*</span>einode<span class="token punctuation">,</span> <span class="token keyword">struct</span> file <span class="token operator">*</span><span class="token operator">*</span>efile<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 获取一个file结构体</span>    file <span class="token operator">=</span> <span class="token function">get_empty_filp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// epoll在底层本身对应一个文件系统，从这个文件系统中获取一个inode</span>    inode <span class="token operator">=</span> <span class="token function">ep_eventpoll_inode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 获取一个文件描述符</span>    fd <span class="token operator">=</span> <span class="token function">get_unused_fd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">sprintf</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">"[%lu]"</span><span class="token punctuation">,</span> inode<span class="token operator">-</span><span class="token operator">></span>i_ino<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>hash <span class="token operator">=</span> inode<span class="token operator">-</span><span class="token operator">></span>i_ino<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 申请一个entry</span>    dentry <span class="token operator">=</span> <span class="token function">d_alloc</span><span class="token punctuation">(</span>eventpoll_mnt<span class="token operator">-</span><span class="token operator">></span>mnt_sb<span class="token operator">-</span><span class="token operator">></span>s_root<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    dentry<span class="token operator">-</span><span class="token operator">></span>d_op <span class="token operator">=</span> <span class="token operator">&amp;</span>eventpollfs_dentry_operations<span class="token punctuation">;</span>    file<span class="token operator">-</span><span class="token operator">></span>f_dentry <span class="token operator">=</span> dentry<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 建立file和inode的联系</span>    <span class="token function">d_add</span><span class="token punctuation">(</span>dentry<span class="token punctuation">,</span> inode<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 建立fd=>file的关联</span>    <span class="token function">fd_install</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">*</span>efd <span class="token operator">=</span> fd<span class="token punctuation">;</span>    <span class="token operator">*</span>einode <span class="token operator">=</span> inode<span class="token punctuation">;</span>    <span class="token operator">*</span>efile <span class="token operator">=</span> file<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>形成一个这种的结构。</p><p>2 通过 ep_file_init 建立 file 和 epoll 的关联。</p><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">ep_file_init</span><span class="token punctuation">(</span><span class="token keyword">struct</span> file <span class="token operator">*</span>file<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">struct</span> eventpoll <span class="token operator">*</span>ep<span class="token punctuation">;</span>    ep <span class="token operator">=</span> <span class="token function">kmalloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> eventpoll<span class="token punctuation">)</span><span class="token punctuation">,</span> GFP_KERNEL<span class="token punctuation">)</span>    <span class="token function">memset</span><span class="token punctuation">(</span>ep<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>ep<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 一系列初始化</span>    file<span class="token operator">-</span><span class="token operator">></span>private_data <span class="token operator">=</span> ep<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>epoll_create 函数主要是建立一个数据结构。并返回一个文件描述符供后面使用。</p><h5 id="epoll-ctl"><a href="#epoll-ctl" class="headerlink" title="epoll_ctl"></a><strong>epoll_ctl</strong></h5><pre class=" language-cpp"><code class="language-cpp">asmlinkage <span class="token keyword">long</span><span class="token function">sys_epoll_ctl</span><span class="token punctuation">(</span><span class="token keyword">int</span> epfd<span class="token punctuation">,</span> <span class="token keyword">int</span> op<span class="token punctuation">,</span> <span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token keyword">struct</span> epoll_event __user <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> error<span class="token punctuation">;</span>    <span class="token keyword">struct</span> file <span class="token operator">*</span>file<span class="token punctuation">,</span> <span class="token operator">*</span>tfile<span class="token punctuation">;</span>    <span class="token keyword">struct</span> eventpoll <span class="token operator">*</span>ep<span class="token punctuation">;</span>    <span class="token keyword">struct</span> epitem <span class="token operator">*</span>epi<span class="token punctuation">;</span>    <span class="token keyword">struct</span> epoll_event epds<span class="token punctuation">;</span>    error <span class="token operator">=</span> <span class="token operator">-</span>EFAULT<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 不是删除操作则复制用户数据到内核</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>        <span class="token function">EP_OP_HASH_EVENT</span><span class="token punctuation">(</span>op<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>        <span class="token function">copy_from_user</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>epds<span class="token punctuation">,</span> event<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> epoll_event<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">)</span>        <span class="token keyword">goto</span> eexit_1<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 根据一种的图，拿到epoll对应的file结构体</span>    file <span class="token operator">=</span> <span class="token function">fget</span><span class="token punctuation">(</span>epfd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 拿到操作的文件的file结构体</span>    tfile <span class="token operator">=</span> <span class="token function">fget</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 通过file拿到epoll_event结构体，见上面的图</span>    ep <span class="token operator">=</span> file<span class="token operator">-</span><span class="token operator">></span>private_data<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 看这个文件描述符是否已经存在，epoll用红黑树维护这个数据</span>    epi <span class="token operator">=</span> <span class="token function">ep_find</span><span class="token punctuation">(</span>ep<span class="token punctuation">,</span> tfile<span class="token punctuation">,</span> fd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>op<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 新增</span>    <span class="token keyword">case</span> EPOLL_CTL_ADD<span class="token operator">:</span>        <span class="token comment" spellcheck="true">// 还没有则新增，有则报错</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>epi<span class="token punctuation">)</span> <span class="token punctuation">{</span>            epds<span class="token punctuation">.</span>events <span class="token operator">|</span><span class="token operator">=</span> POLLERR <span class="token operator">|</span> POLLHUP<span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 插入红黑树</span>            error <span class="token operator">=</span> <span class="token function">ep_insert</span><span class="token punctuation">(</span>ep<span class="token punctuation">,</span> <span class="token operator">&amp;</span>epds<span class="token punctuation">,</span> tfile<span class="token punctuation">,</span> fd<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span>            error <span class="token operator">=</span> <span class="token operator">-</span>EEXIST<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 删除</span>    <span class="token keyword">case</span> EPOLL_CTL_DEL<span class="token operator">:</span>        <span class="token comment" spellcheck="true">// 存在则删除，否则报错</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>epi<span class="token punctuation">)</span>            error <span class="token operator">=</span> <span class="token function">ep_remove</span><span class="token punctuation">(</span>ep<span class="token punctuation">,</span> epi<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">else</span>            error <span class="token operator">=</span> <span class="token operator">-</span>ENOENT<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 修改</span>    <span class="token keyword">case</span> EPOLL_CTL_MOD<span class="token operator">:</span>        <span class="token comment" spellcheck="true">// 存在则修改，否则报错</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>epi<span class="token punctuation">)</span> <span class="token punctuation">{</span>            epds<span class="token punctuation">.</span>events <span class="token operator">|</span><span class="token operator">=</span> POLLERR <span class="token operator">|</span> POLLHUP<span class="token punctuation">;</span>            error <span class="token operator">=</span> <span class="token function">ep_modify</span><span class="token punctuation">(</span>ep<span class="token punctuation">,</span> epi<span class="token punctuation">,</span> <span class="token operator">&amp;</span>epds<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span>            error <span class="token operator">=</span> <span class="token operator">-</span>ENOENT<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>epoll_ctl 函数看起来也没有很复杂，就是根据用户传进来的信息去操作红黑树。对于红黑树的增删改查，查和删除就不分析了。就是去操作红黑树。增和改是类似的逻辑，所以我们只分析增操作就可以了。在此之前，我们先了解一些 epoll 中其他的数据结构。</p><p>当我们新增一个需要监听的文件描述符的时候，系统会申请一个 epitem 去表示。epitem 是保存了文件描述符、事件等信息的结构体。然后把 epitem 插入到 eventpoll 结构体维护的红黑树中。</p><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">ep_insert</span><span class="token punctuation">(</span><span class="token keyword">struct</span> eventpoll <span class="token operator">*</span>ep<span class="token punctuation">,</span> <span class="token keyword">struct</span> epoll_event <span class="token operator">*</span>event<span class="token punctuation">,</span>             <span class="token keyword">struct</span> file <span class="token operator">*</span>tfile<span class="token punctuation">,</span> <span class="token keyword">int</span> fd<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> error<span class="token punctuation">,</span> revents<span class="token punctuation">,</span> pwake <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> flags<span class="token punctuation">;</span>    <span class="token keyword">struct</span> epitem <span class="token operator">*</span>epi<span class="token punctuation">;</span>    <span class="token keyword">struct</span> ep_pqueue epq<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 申请一个epitem</span>    epi <span class="token operator">=</span> <span class="token function">EPI_MEM_ALLOC</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// 省略一系列初始化工作</span>    <span class="token comment" spellcheck="true">// 记录所属的epoll</span>    epi<span class="token operator">-</span><span class="token operator">></span>ep <span class="token operator">=</span> ep<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 在epitem中保存文件描述符fd和file</span>    <span class="token function">EP_SET_FFD</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>epi<span class="token operator">-</span><span class="token operator">></span>ffd<span class="token punctuation">,</span> tfile<span class="token punctuation">,</span> fd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 监听的事件</span>    epi<span class="token operator">-</span><span class="token operator">></span>event <span class="token operator">=</span> <span class="token operator">*</span>event<span class="token punctuation">;</span>    epi<span class="token operator">-</span><span class="token operator">></span>nwait <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    epq<span class="token punctuation">.</span>epi <span class="token operator">=</span> epi<span class="token punctuation">;</span>    <span class="token function">init_poll_funcptr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>epq<span class="token punctuation">.</span>pt<span class="token punctuation">,</span> ep_ptable_queue_proc<span class="token punctuation">)</span><span class="token punctuation">;</span>    revents <span class="token operator">=</span> tfile<span class="token operator">-</span><span class="token operator">></span>f_op<span class="token operator">-</span><span class="token operator">></span><span class="token function">poll</span><span class="token punctuation">(</span>tfile<span class="token punctuation">,</span> <span class="token operator">&amp;</span>epq<span class="token punctuation">.</span>pt<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 把epitem插入红黑树</span>    <span class="token function">ep_rbtree_insert</span><span class="token punctuation">(</span>ep<span class="token punctuation">,</span> epi<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 如果监听的事件在新增的时候就已经触发，则直接插入到epoll就绪队列</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>revents <span class="token operator">&amp;</span> event<span class="token operator">-</span><span class="token operator">></span>events<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">EP_IS_LINKED</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>epi<span class="token operator">-</span><span class="token operator">></span>rdllink<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 把epitem插入就绪队列rdllist</span>        <span class="token function">list_add_tail</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>epi<span class="token operator">-</span><span class="token operator">></span>rdllink<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>rdllist<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//  有事件触发，唤醒阻塞在epoll_wait的进程队列</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">waitqueue_active</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>wq<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token function">wake_up</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>wq<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">waitqueue_active</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>poll_wait<span class="token punctuation">)</span><span class="token punctuation">)</span>            pwake<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>新增操作的大致流程是<br>1 申请了一个新的 epitem 表示待观察的实体。他保存了文件描述符、感兴趣的事件等信息。<br>2 插入红黑树<br>3 判断新增的节点中对应的文件描述符和事件是否已经触发了，是则加入到就绪队列（由 eventpoll-&gt;rdllist 维护的一个队列）<br>下面具体看一下如何判断感兴趣的事件在对应的文件描述符中是否已经触发。相关代码在 ep_insert 中。下面单独拎出来。</p><pre class=" language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/*    struct ep_pqueue {        // 函数指针        poll_table pt;        // epitem        struct epitem *epi;    };*/</span><span class="token keyword">struct</span> ep_pqueue epq<span class="token punctuation">;</span>epq<span class="token punctuation">.</span>epi <span class="token operator">=</span> epi<span class="token punctuation">;</span><span class="token function">init_poll_funcptr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>epq<span class="token punctuation">.</span>pt<span class="token punctuation">,</span> ep_ptable_queue_proc<span class="token punctuation">)</span><span class="token punctuation">;</span>revents <span class="token operator">=</span> tfile<span class="token operator">-</span><span class="token operator">></span>f_op<span class="token operator">-</span><span class="token operator">></span><span class="token function">poll</span><span class="token punctuation">(</span>tfile<span class="token punctuation">,</span> <span class="token operator">&amp;</span>epq<span class="token punctuation">.</span>pt<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">init_poll_funcptr</span><span class="token punctuation">(</span>poll_table <span class="token operator">*</span>pt<span class="token punctuation">,</span> poll_queue_proc qproc<span class="token punctuation">)</span><span class="token punctuation">{</span>    pt<span class="token operator">-</span><span class="token operator">></span>qproc <span class="token operator">=</span> qproc<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>上面的代码是定义了一个 struct ep_pqueue 结构体，然后设置他的一个字段为 ep_ptable_queue_proc。然后执行 tfile-&gt;f_op-&gt;poll。poll 函数由各个文件系统或者网络协议实现。我们以管道为例。</p><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">static</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token function">pipe_poll</span><span class="token punctuation">(</span><span class="token keyword">struct</span> file <span class="token operator">*</span>filp<span class="token punctuation">,</span> poll_table <span class="token operator">*</span>wait<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> mask<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 监听的文件描述符对应的inode</span>    <span class="token keyword">struct</span> inode <span class="token operator">*</span>inode <span class="token operator">=</span> filp<span class="token operator">-</span><span class="token operator">></span>f_dentry<span class="token operator">-</span><span class="token operator">></span>d_inode<span class="token punctuation">;</span>    <span class="token keyword">struct</span> pipe_inode_info <span class="token operator">*</span>info <span class="token operator">=</span> inode<span class="token operator">-</span><span class="token operator">></span>i_pipe<span class="token punctuation">;</span>    <span class="token keyword">int</span> nrbufs<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/*    static inline void poll_wait(struct file * filp, wait_queue_head_t * wait_address, poll_table *p)    {        if (p &amp;&amp; wait_address)            p->qproc(filp, wait_address, p);    }    */</span>    <span class="token function">poll_wait</span><span class="token punctuation">(</span>filp<span class="token punctuation">,</span> <span class="token function">PIPE_WAIT</span><span class="token punctuation">(</span><span class="token operator">*</span>inode<span class="token punctuation">)</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 判断哪些事件触发了</span>    nrbufs <span class="token operator">=</span> info<span class="token operator">-</span><span class="token operator">></span>nrbufs<span class="token punctuation">;</span>    mask <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>filp<span class="token operator">-</span><span class="token operator">></span>f_mode <span class="token operator">&amp;</span> FMODE_READ<span class="token punctuation">)</span> <span class="token punctuation">{</span>        mask <span class="token operator">=</span> <span class="token punctuation">(</span>nrbufs <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> POLLIN <span class="token operator">|</span> POLLRDNORM <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">PIPE_WRITERS</span><span class="token punctuation">(</span><span class="token operator">*</span>inode<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> filp<span class="token operator">-</span><span class="token operator">></span>f_version <span class="token operator">!=</span> <span class="token function">PIPE_WCOUNTER</span><span class="token punctuation">(</span><span class="token operator">*</span>inode<span class="token punctuation">)</span><span class="token punctuation">)</span>            mask <span class="token operator">|</span><span class="token operator">=</span> POLLHUP<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>filp<span class="token operator">-</span><span class="token operator">></span>f_mode <span class="token operator">&amp;</span> FMODE_WRITE<span class="token punctuation">)</span> <span class="token punctuation">{</span>        mask <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span>nrbufs <span class="token operator">&lt;</span> PIPE_BUFFERS<span class="token punctuation">)</span> <span class="token operator">?</span> POLLOUT <span class="token operator">|</span> POLLWRNORM <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">PIPE_READERS</span><span class="token punctuation">(</span><span class="token operator">*</span>inode<span class="token punctuation">)</span><span class="token punctuation">)</span>            mask <span class="token operator">|</span><span class="token operator">=</span> POLLERR<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> mask<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>我们看到具体的 poll 函数里会首先执行 poll_wait 函数。这个函数只是简单执行 struct ep_pqueue epq 结构体中的函数，即刚才设置的 ep_ptable_queue_proc。</p><pre class=" language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//  监听的文件描述符对应的file结构体，whead是等待监听的文件描述符对应的inode可用的队列</span><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">ep_ptable_queue_proc</span><span class="token punctuation">(</span><span class="token keyword">struct</span> file <span class="token operator">*</span>file<span class="token punctuation">,</span> wait_queue_head_t <span class="token operator">*</span>whead<span class="token punctuation">,</span>                 poll_table <span class="token operator">*</span>pt<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">struct</span> epitem <span class="token operator">*</span>epi <span class="token operator">=</span> <span class="token function">EP_ITEM_FROM_EPQUEUE</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">struct</span> eppoll_entry <span class="token operator">*</span>pwq<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>epi<span class="token operator">-</span><span class="token operator">></span>nwait <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>pwq <span class="token operator">=</span> <span class="token function">PWQ_MEM_ALLOC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        pwq<span class="token operator">-</span><span class="token operator">></span>wait<span class="token operator">-</span><span class="token operator">></span>flags <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        pwq<span class="token operator">-</span><span class="token operator">></span>wait<span class="token operator">-</span><span class="token operator">></span>task <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 设置回调</span>        pwq<span class="token operator">-</span><span class="token operator">></span>wait<span class="token operator">-</span><span class="token operator">></span>func <span class="token operator">=</span> ep_poll_callback<span class="token punctuation">;</span>        pwq<span class="token operator">-</span><span class="token operator">></span>whead <span class="token operator">=</span> whead<span class="token punctuation">;</span>        pwq<span class="token operator">-</span><span class="token operator">></span>base <span class="token operator">=</span> epi<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 插入等待监听的文件描述符的inode可用的队列，回调函数是ep_poll_callback</span>        <span class="token function">add_wait_queue</span><span class="token punctuation">(</span>whead<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pwq<span class="token operator">-</span><span class="token operator">></span>wait<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">list_add_tail</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pwq<span class="token operator">-</span><span class="token operator">></span>llink<span class="token punctuation">,</span> <span class="token operator">&amp;</span>epi<span class="token operator">-</span><span class="token operator">></span>pwqlist<span class="token punctuation">)</span><span class="token punctuation">;</span>        epi<span class="token operator">-</span><span class="token operator">></span>nwait<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">/* We have to signal that an error occurred */</span>        epi<span class="token operator">-</span><span class="token operator">></span>nwait <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>主要的逻辑是把当前进程插入监听的文件的等待队列中，等待唤醒。</p><h5 id="epoll-wait"><a href="#epoll-wait" class="headerlink" title="epoll_wait"></a><strong>epoll_wait</strong></h5><pre class=" language-cpp"><code class="language-cpp">asmlinkage <span class="token keyword">long</span> <span class="token function">sys_epoll_wait</span><span class="token punctuation">(</span><span class="token keyword">int</span> epfd<span class="token punctuation">,</span> <span class="token keyword">struct</span> epoll_event __user <span class="token operator">*</span>events<span class="token punctuation">,</span>                   <span class="token keyword">int</span> maxevents<span class="token punctuation">,</span> <span class="token keyword">int</span> timeout<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> error<span class="token punctuation">;</span>    <span class="token keyword">struct</span> file <span class="token operator">*</span>file<span class="token punctuation">;</span>    <span class="token keyword">struct</span> eventpoll <span class="token operator">*</span>ep<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 通过epoll的fd拿到对应的file结构体</span>    file <span class="token operator">=</span> <span class="token function">fget</span><span class="token punctuation">(</span>epfd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 通过file结构体拿到eventpoll结构体</span>    ep <span class="token operator">=</span> file<span class="token operator">-</span><span class="token operator">></span>private_data<span class="token punctuation">;</span>    error <span class="token operator">=</span> <span class="token function">ep_poll</span><span class="token punctuation">(</span>ep<span class="token punctuation">,</span> events<span class="token punctuation">,</span> maxevents<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> error<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">ep_poll</span><span class="token punctuation">(</span><span class="token keyword">struct</span> eventpoll <span class="token operator">*</span>ep<span class="token punctuation">,</span> <span class="token keyword">struct</span> epoll_event __user <span class="token operator">*</span>events<span class="token punctuation">,</span>           <span class="token keyword">int</span> maxevents<span class="token punctuation">,</span> <span class="token keyword">long</span> timeout<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> res<span class="token punctuation">,</span> eavail<span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> flags<span class="token punctuation">;</span>    <span class="token keyword">long</span> jtimeout<span class="token punctuation">;</span>    wait_queue_t wait<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 计算超时时间</span>    jtimeout <span class="token operator">=</span> timeout <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> timeout <span class="token operator">></span> <span class="token punctuation">(</span>MAX_SCHEDULE_TIMEOUT <span class="token operator">-</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">/</span> HZ <span class="token operator">?</span>        MAX_SCHEDULE_TIMEOUT<span class="token operator">:</span> <span class="token punctuation">(</span>timeout <span class="token operator">*</span> HZ <span class="token operator">+</span> <span class="token number">999</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>retry<span class="token operator">:</span>    res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 就绪队列为空</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">list_empty</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>rdllist<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 加入阻塞队列</span>        <span class="token function">init_waitqueue_entry</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wait<span class="token punctuation">,</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">add_wait_queue</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>wq<span class="token punctuation">,</span> <span class="token operator">&amp;</span>wait<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 挂起</span>            <span class="token function">set_current_state</span><span class="token punctuation">(</span>TASK_INTERRUPTIBLE<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 超时或者有就绪事件了，则跳出返回</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">list_empty</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>rdllist<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>jtimeout<span class="token punctuation">)</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 被信号唤醒返回EINTR</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">signal_pending</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                res <span class="token operator">=</span> <span class="token operator">-</span>EINTR<span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// 设置定时器，然后进程挂起，等待超时唤醒（超时或者信号唤醒）</span>            jtimeout <span class="token operator">=</span> <span class="token function">schedule_timeout</span><span class="token punctuation">(</span>jtimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 移出阻塞队列</span>        <span class="token function">remove_wait_queue</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>wq<span class="token punctuation">,</span> <span class="token operator">&amp;</span>wait<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 设置就绪</span>        <span class="token function">set_current_state</span><span class="token punctuation">(</span>TASK_RUNNING<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 是否有事件就绪，唤醒的原因有几个，被唤醒不代表就有就绪事件</span>    eavail <span class="token operator">=</span> <span class="token operator">!</span><span class="token function">list_empty</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>rdllist<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">write_unlock_irqrestore</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>lock<span class="token punctuation">,</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 处理就绪事件返回</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res <span class="token operator">&amp;&amp;</span> eavail <span class="token operator">&amp;&amp;</span>        <span class="token operator">!</span><span class="token punctuation">(</span>res <span class="token operator">=</span> <span class="token function">ep_events_transfer</span><span class="token punctuation">(</span>ep<span class="token punctuation">,</span> events<span class="token punctuation">,</span> maxevents<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> jtimeout<span class="token punctuation">)</span>        <span class="token keyword">goto</span> retry<span class="token punctuation">;</span>    <span class="token keyword">return</span> res<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>总的来说 epoll_wait 的逻辑主要是处理就绪队列的节点。<br>1 如果就绪队列为空，则根据 timeout 做下一步处理，可能定时阻塞。<br>2 如果就绪队列非空则处理就绪队列，返回给用户。处理就绪队列的函数是 ep_events_transfer。</p><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">ep_events_transfer</span><span class="token punctuation">(</span><span class="token keyword">struct</span> eventpoll <span class="token operator">*</span>ep<span class="token punctuation">,</span>                  <span class="token keyword">struct</span> epoll_event __user <span class="token operator">*</span>events<span class="token punctuation">,</span> <span class="token keyword">int</span> maxevents<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> eventcnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">struct</span> list_head txlist<span class="token punctuation">;</span>    <span class="token function">INIT_LIST_HEAD</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>txlist<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ep_collect_ready_items</span><span class="token punctuation">(</span>ep<span class="token punctuation">,</span> <span class="token operator">&amp;</span>txlist<span class="token punctuation">,</span> maxevents<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        eventcnt <span class="token operator">=</span> <span class="token function">ep_send_events</span><span class="token punctuation">(</span>ep<span class="token punctuation">,</span> <span class="token operator">&amp;</span>txlist<span class="token punctuation">,</span> events<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">ep_reinject_items</span><span class="token punctuation">(</span>ep<span class="token punctuation">,</span> <span class="token operator">&amp;</span>txlist<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> eventcnt<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>主要是三个函数，我们一个个看。<br>1 ep_collect_ready_items 收集就绪事件</p><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">ep_collect_ready_items</span><span class="token punctuation">(</span><span class="token keyword">struct</span> eventpoll <span class="token operator">*</span>ep<span class="token punctuation">,</span> <span class="token keyword">struct</span> list_head <span class="token operator">*</span>txlist<span class="token punctuation">,</span> <span class="token keyword">int</span> maxevents<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> nepi<span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> flags<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 就绪事件的队列</span>    <span class="token keyword">struct</span> list_head <span class="token operator">*</span>lsthead <span class="token operator">=</span> <span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>rdllist<span class="token punctuation">,</span> <span class="token operator">*</span>lnk<span class="token punctuation">;</span>    <span class="token keyword">struct</span> epitem <span class="token operator">*</span>epi<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>nepi <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> lnk <span class="token operator">=</span> lsthead<span class="token operator">-</span><span class="token operator">></span>next<span class="token punctuation">;</span> lnk <span class="token operator">!=</span> lsthead <span class="token operator">&amp;&amp;</span> nepi <span class="token operator">&lt;</span> maxevents<span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 通过结构体字段的地址拿到结构体首地址</span>        epi <span class="token operator">=</span> <span class="token function">list_entry</span><span class="token punctuation">(</span>lnk<span class="token punctuation">,</span> <span class="token keyword">struct</span> epitem<span class="token punctuation">,</span> rdllink<span class="token punctuation">)</span><span class="token punctuation">;</span>        lnk <span class="token operator">=</span> lnk<span class="token operator">-</span><span class="token operator">></span>next<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">/* If this file is already in the ready list we exit soon */</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">EP_IS_LINKED</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>epi<span class="token operator">-</span><span class="token operator">></span>txlink<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            epi<span class="token operator">-</span><span class="token operator">></span>revents <span class="token operator">=</span> epi<span class="token operator">-</span><span class="token operator">></span>event<span class="token punctuation">.</span>events<span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 插入txlist队列，然后处理完再返回给用户</span>            <span class="token function">list_add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>epi<span class="token operator">-</span><span class="token operator">></span>txlink<span class="token punctuation">,</span> txlist<span class="token punctuation">)</span><span class="token punctuation">;</span>            nepi<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 从就绪队列中删除</span>            <span class="token function">EP_LIST_DEL</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>epi<span class="token operator">-</span><span class="token operator">></span>rdllink<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> nepi<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>2 ep_send_events 判断哪些事件触发了</p><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">ep_send_events</span><span class="token punctuation">(</span><span class="token keyword">struct</span> eventpoll <span class="token operator">*</span>ep<span class="token punctuation">,</span> <span class="token keyword">struct</span> list_head <span class="token operator">*</span>txlist<span class="token punctuation">,</span>              <span class="token keyword">struct</span> epoll_event __user <span class="token operator">*</span>events<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> eventcnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> revents<span class="token punctuation">;</span>    <span class="token keyword">struct</span> list_head <span class="token operator">*</span>lnk<span class="token punctuation">;</span>    <span class="token keyword">struct</span> epitem <span class="token operator">*</span>epi<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 遍历就绪队列，记录触发的事件</span>    <span class="token function">list_for_each</span><span class="token punctuation">(</span>lnk<span class="token punctuation">,</span> txlist<span class="token punctuation">)</span> <span class="token punctuation">{</span>        epi <span class="token operator">=</span> <span class="token function">list_entry</span><span class="token punctuation">(</span>lnk<span class="token punctuation">,</span> <span class="token keyword">struct</span> epitem<span class="token punctuation">,</span> txlink<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 判断哪些事件触发了</span>        revents <span class="token operator">=</span> epi<span class="token operator">-</span><span class="token operator">></span>ffd<span class="token punctuation">.</span>file<span class="token operator">-</span><span class="token operator">></span>f_op<span class="token operator">-</span><span class="token operator">></span><span class="token function">poll</span><span class="token punctuation">(</span>epi<span class="token operator">-</span><span class="token operator">></span>ffd<span class="token punctuation">.</span>file<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        epi<span class="token operator">-</span><span class="token operator">></span>revents <span class="token operator">=</span> revents <span class="token operator">&amp;</span> epi<span class="token operator">-</span><span class="token operator">></span>event<span class="token punctuation">.</span>events<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 复制到用户空间</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>epi<span class="token operator">-</span><span class="token operator">></span>revents<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__put_user</span><span class="token punctuation">(</span>epi<span class="token operator">-</span><span class="token operator">></span>revents<span class="token punctuation">,</span>                       <span class="token operator">&amp;</span>events<span class="token punctuation">[</span>eventcnt<span class="token punctuation">]</span><span class="token punctuation">.</span>events<span class="token punctuation">)</span> <span class="token operator">||</span>                <span class="token function">__put_user</span><span class="token punctuation">(</span>epi<span class="token operator">-</span><span class="token operator">></span>event<span class="token punctuation">.</span>data<span class="token punctuation">,</span>                       <span class="token operator">&amp;</span>events<span class="token punctuation">[</span>eventcnt<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token operator">-</span>EFAULT<span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// 只监听一次，触发完设置成对任何事件都不感兴趣</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>epi<span class="token operator">-</span><span class="token operator">></span>event<span class="token punctuation">.</span>events <span class="token operator">&amp;</span> EPOLLONESHOT<span class="token punctuation">)</span>                epi<span class="token operator">-</span><span class="token operator">></span>event<span class="token punctuation">.</span>events <span class="token operator">&amp;</span><span class="token operator">=</span> EP_PRIVATE_BITS<span class="token punctuation">;</span>            eventcnt<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> eventcnt<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>3 ep_reinject_items 重新插入就绪队列</p><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">ep_reinject_items</span><span class="token punctuation">(</span><span class="token keyword">struct</span> eventpoll <span class="token operator">*</span>ep<span class="token punctuation">,</span> <span class="token keyword">struct</span> list_head <span class="token operator">*</span>txlist<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> ricnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> pwake <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> flags<span class="token punctuation">;</span>    <span class="token keyword">struct</span> epitem <span class="token operator">*</span>epi<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">list_empty</span><span class="token punctuation">(</span>txlist<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        epi <span class="token operator">=</span> <span class="token function">list_entry</span><span class="token punctuation">(</span>txlist<span class="token operator">-</span><span class="token operator">></span>next<span class="token punctuation">,</span> <span class="token keyword">struct</span> epitem<span class="token punctuation">,</span> txlink<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">EP_LIST_DEL</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>epi<span class="token operator">-</span><span class="token operator">></span>txlink<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//  水平触发模式则一直通知，即重新加入就绪队列</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">EP_RB_LINKED</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>epi<span class="token operator">-</span><span class="token operator">></span>rbn<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>epi<span class="token operator">-</span><span class="token operator">></span>event<span class="token punctuation">.</span>events <span class="token operator">&amp;</span> EPOLLET<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>            <span class="token punctuation">(</span>epi<span class="token operator">-</span><span class="token operator">></span>revents <span class="token operator">&amp;</span> epi<span class="token operator">-</span><span class="token operator">></span>event<span class="token punctuation">.</span>events<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">EP_IS_LINKED</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>epi<span class="token operator">-</span><span class="token operator">></span>rdllink<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">list_add_tail</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>epi<span class="token operator">-</span><span class="token operator">></span>rdllink<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>rdllist<span class="token punctuation">)</span><span class="token punctuation">;</span>            ricnt<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>我们发现，并有没有在 epoll_wait 的时候去收集就绪事件，那么就绪队列是谁处理的呢？我们回顾一下插入红黑树的时候，做了一个事情，就是在文件对应的 inode 上注册一个回调。当文件满足条件的时候，就会唤醒因为 epoll_wait 而阻塞的进程。epoll_wait 会收集事件返回给用户。</p><pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">ep_poll_callback</span><span class="token punctuation">(</span>wait_queue_t <span class="token operator">*</span>wait<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> mode<span class="token punctuation">,</span> <span class="token keyword">int</span> sync<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>key<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> pwake <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> flags<span class="token punctuation">;</span>    <span class="token keyword">struct</span> epitem <span class="token operator">*</span>epi <span class="token operator">=</span> <span class="token function">EP_ITEM_FROM_WAIT</span><span class="token punctuation">(</span>wait<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">struct</span> eventpoll <span class="token operator">*</span>ep <span class="token operator">=</span> epi<span class="token operator">-</span><span class="token operator">></span>ep<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 插入就绪队列</span>    <span class="token function">list_add_tail</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>epi<span class="token operator">-</span><span class="token operator">></span>rdllink<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>rdllist<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 唤醒因epoll_wait而阻塞的进程</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">waitqueue_active</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>wq<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token function">wake_up</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>wq<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">waitqueue_active</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ep<span class="token operator">-</span><span class="token operator">></span>poll_wait<span class="token punctuation">)</span><span class="token punctuation">)</span>        pwake<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>epoll 的实现涉及的内容比较多，先分析一下大致的原理。有机会再深入分析。</p><p>发布于 2020-03-28</p><h4 id="四、IO-复用中写的问题"><a href="#四、IO-复用中写的问题" class="headerlink" title="四、IO 复用中写的问题"></a>四、IO 复用中写的问题</h4>]]></content>
      
      
      <categories>
          
          <category> C/C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> C++ </tag>
            
            <tag> socket </tag>
            
            <tag> epoll </tag>
            
            <tag> 网络编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript Promise 并发控制下载文件的实现</title>
      <link href="/2021/07/29/promise-bing-fa-xia-zai/"/>
      <url>/2021/07/29/promise-bing-fa-xia-zai/</url>
      
        <content type="html"><![CDATA[<h2 id="Promise-并发下载"><a href="#Promise-并发下载" class="headerlink" title="Promise 并发下载"></a>Promise 并发下载</h2><h3 id="Promise-then"><a href="#Promise-then" class="headerlink" title="Promise.then"></a>Promise.then</h3><p><code>.then</code> 的第一个参数是一个函数，该函数将在 promise resolved 后运行并接收结果。</p><p><code>.then</code> 的第二个参数也是一个函数，该函数将在 promise rejected 后运行并接收 error。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// 当 promise 被构造完成时，自动执行此函数</span>  <span class="token comment" spellcheck="true">// 1 秒后发出工作已经被完成的信号，并带有结果 "done"</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"done"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">"fail"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>dat <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dat <span class="token operator">+</span> <span class="token string">"data"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> err <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err <span class="token operator">+</span> <span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="不可控并发下载"><a href="#不可控并发下载" class="headerlink" title="不可控并发下载"></a>不可控并发下载</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">img</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">resolve</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token function">img</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">let</span> promises2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token function">img</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    promises2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">// promise 在遍历时已经运行，Promise.all 用来收集结果</span>  Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="结果同步的任意并发下载"><a href="#结果同步的任意并发下载" class="headerlink" title="结果同步的任意并发下载"></a>结果同步的任意并发下载</h3><p>N个任务并发，同时开始同时结束。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">img</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token function">resolve</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token operator">...</span>arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> arrData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    arg<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token function">img</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        arrData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>arrData<span class="token punctuation">.</span>length <span class="token operator">==</span> arg<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arrData<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">resolve</span><span class="token punctuation">(</span>arrData<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> threads <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> threads <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token operator">...</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>    results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="结果非同步的任意并发下载"><a href="#结果非同步的任意并发下载" class="headerlink" title="结果非同步的任意并发下载"></a>结果非同步的任意并发下载</h3><ol><li>输入promise数组，使用函数包装promise</li><li>所有promise进入执行函数, 等待返回promise结果, </li><li>小于限制数的直接执行, 大于的进入等待队列, 递归调用运行promise</li><li>监控队列长度和正在运行的promise, 都为0则返回结果, 队列剩余则运行队列头,</li><li>promise参数可以作为其他函数参数传递: <code>Promise((resolve,reject)=&gt;{(resolve)=&gt;{return resolve}})</code></li></ol><p>promise 递归调用和传参示例：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">all</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token function">run</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    i<span class="token operator">++</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">resolve</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">run</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">let</span> limit <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>实例代码：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/*   1.输入promise数组，使用函数包装promise  2.所有promise进入执行函数, 等待返回promise结果,   3.小于限制数的直接执行, 大于的进入等待队列,  4.监控队列长度和正在运行的promise, 都为0则返回结果, 队列剩余则运行队列头,  5.promise参数可以作为其他函数参数: Promise((resolve,reject)=>{(resolve)=>{return resolve}})*/</span><span class="token comment" spellcheck="true">// 发送 promise</span><span class="token keyword">function</span> <span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    promises<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>promise <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token function">run</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 递归运行promise</span><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>runningNum <span class="token operator">>=</span> limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"入队:"</span><span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>    queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  runningNum<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    runningNum<span class="token operator">--</span><span class="token punctuation">;</span>    results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> runningNum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">run</span><span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">let</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 输入</span><span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 结果</span><span class="token keyword">let</span> limit <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 并发限制</span><span class="token keyword">let</span> queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 等待队列</span><span class="token keyword">let</span> runningNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 正在运行的</span><span class="token comment" spellcheck="true">// 输入10个promise</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"start"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"end"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 发送10个promise</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>简述一个简易实现思路：</p><ol><li>封装一个 ConcurrencyPromisePool 类</li><li>方法有<code>all()</code>，和<code>Promise.prototype.all</code>类似。</li><li>属性有 <code>limit</code>、<code>queue</code>。前者是并发上限，后者存放排队的 promise。</li></ol><p><strong>注意</strong>：第 2 点中，all 函数传入的是生成 Promise 的方法，而不是 Promise 实例。因为 Promise 一旦生成实例，会直接执行。所以要把这个执行交给 ConcurrencyPromisePool 来控制。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// NodeJS Promise并发控制 </span><span class="token comment" spellcheck="true">// https://xin-tan.com/2020-09-13-bing-fa-kong-zhi/</span><span class="token keyword">class</span> <span class="token class-name">ConcurrencyPromisePool</span> <span class="token punctuation">{</span>  <span class="token function">constructor</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>limit <span class="token operator">=</span> limit<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>runningNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">all</span><span class="token punctuation">(</span>promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> promise <span class="token keyword">of</span> promises<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 发送所有 promise</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_run</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token function">_run</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// 超出限制的 promise 入队</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>runningNum <span class="token operator">>=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">">>> 达到上限，入队："</span><span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 正在运行的 promise</span>    <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>runningNum<span class="token punctuation">;</span>    <span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token operator">--</span><span class="token keyword">this</span><span class="token punctuation">.</span>runningNum<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 运行结束条件：队列长度 &amp;&amp; 正在运行的数量</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>runningNum <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 队列还有则，出队，然后递归调用</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_run</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">15</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>  promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> start`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> end`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">const</span> pool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrencyPromisePool</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>pool<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 前端 </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Promise </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTML5 网页使用 Base64 视频源</title>
      <link href="/2021/07/24/html5-wang-ye-shi-yong-base64-shi-pin-yuan/"/>
      <url>/2021/07/24/html5-wang-ye-shi-yong-base64-shi-pin-yuan/</url>
      
        <content type="html"><![CDATA[<h2 id="HTML5-网页使用-Base64-视频源"><a href="#HTML5-网页使用-Base64-视频源" class="headerlink" title="HTML5 网页使用 Base64 视频源"></a>HTML5 网页使用 Base64 视频源</h2><h3 id="视频转-Base64，使用-FileReader-实现"><a href="#视频转-Base64，使用-FileReader-实现" class="headerlink" title="视频转 Base64，使用 FileReader 实现"></a>视频转 Base64，使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader" target="_blank" rel="noopener">FileReader</a> 实现</h3><p><strong><code>FileReader</code></strong> 对象允许Web应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/File" target="_blank" rel="noopener"><code>File</code></a> 或 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noopener"><code>Blob</code></a> 对象指定要读取的文件或数据。</p><p>其中File对象可以是来自用户在一个<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/Input" target="_blank" rel="noopener">&lt;input&gt;</a>元素上选择文件后返回的<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileList" target="_blank" rel="noopener"><code>FileList</code></a>对象,也可以来自拖放操作生成的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DataTransfer" target="_blank" rel="noopener"><code>DataTransfer</code></a>对象,还可以是来自在一个<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLCanvasElement" target="_blank" rel="noopener"><code>HTMLCanvasElement</code></a>上执行<code>mozGetAsFile()</code>方法后返回结果。</p><p>重要提示： FileReader仅用于以安全的方式从用户（远程）系统读取文件内容 它不能用于从文件系统中按路径名简单地读取文件。 要在JavaScript中按路径名读取文件，应使用标准Ajax解决方案进行服务器端文件读取，如果读取跨域，则使用CORS权限。</p><h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a><strong>属性</strong></h4><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/readyState" target="_blank" rel="noopener"><code>FileReader.readyState</code></a> 只读</p><p>表示<code>FileReader</code>状态的数字。取值如下：</p><table><thead><tr><th>常量名</th><th>值</th><th>描述</th></tr></thead><tbody><tr><td><code>EMPTY</code></td><td><code>0</code></td><td>还没有加载任何数据.</td></tr><tr><td><code>LOADING</code></td><td><code>1</code></td><td>数据正在被加载.</td></tr><tr><td><code>DONE</code></td><td><code>2</code></td><td>已完成全部的读取请求.</td></tr></tbody></table><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/result" target="_blank" rel="noopener"><code>FileReader.result</code></a> 只读</p><p>文件的内容。该属性仅在读取操作完成后才有效，数据的格式取决于使用哪个方法来启动读取操作。</p><h4 id="事件"><a href="#事件" class="headerlink" title="事件"></a><strong>事件</strong></h4><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/onload" target="_blank" rel="noopener"><code>FileReader.onload</code></a></p><p>处理<code>load (en-US)</code>事件。该事件在读取操作完成时触发。</p><blockquote><p>因为 <code>FileReader</code> 继承自<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget" target="_blank" rel="noopener"><code>EventTarget</code></a>，所以所有这些事件也可以通过<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener" target="_blank" rel="noopener"><code>addEventListener</code></a>方法使用。</p></blockquote><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a><strong><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader#properties" target="_blank" rel="noopener">方法</a></strong></h4><ul><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/abort" target="_blank" rel="noopener"><code>FileReader.abort()</code></a></p><p>中止读取操作。在返回时，<code>readyState</code>属性为<code>DONE</code>。</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/readAsArrayBuffer" target="_blank" rel="noopener"><code>FileReader.readAsArrayBuffer()</code></a></p><p>开始读取指定的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noopener"><code>Blob</code></a>中的内容, 一旦完成, result 属性中保存的将是被读取文件的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" target="_blank" rel="noopener"><code>ArrayBuffer</code></a> 数据对象.</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/readAsBinaryString" target="_blank" rel="noopener"><code>FileReader.readAsBinaryString()</code></a> </p><p>开始读取指定的<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noopener"><code>Blob</code></a>中的内容。一旦完成，<code>result</code>属性中将包含所读取文件的原始二进制数据。</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/readAsDataURL" target="_blank" rel="noopener"><code>FileReader.readAsDataURL()</code></a></p><p>开始读取指定的<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noopener"><code>Blob</code></a>中的内容。一旦完成，<code>result</code>属性中将包含一个<code>data:</code> URL格式的Base64字符串以表示所读取文件的内容。</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/readAsText" target="_blank" rel="noopener"><code>FileReader.readAsText()</code></a></p><p>开始读取指定的<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noopener"><code>Blob</code></a>中的内容。一旦完成，<code>result</code>属性中将包含一个字符串以表示所读取的文件内容。</p></li></ul><h3 id="Data-URLs"><a href="#Data-URLs" class="headerlink" title="Data URLs"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/Data_URIs" target="_blank" rel="noopener">Data URLs</a></h3><p>Data URLs 由四个部分组成：前缀(<code>data:</code>)、指示数据类型的MIME类型、如果非文本则为可选的<code>base64</code>标记、数据本身：</p><pre><code>data:[&lt;mediatype&gt;][;base64],&lt;data&gt;</code></pre><p>mediatype 是个 MIME 类型的字符串，例如 “<code>image/jpeg</code>“ 表示 JPEG 图像文件。如果被省略，则默认值为 <code>text/plain;charset=US-ASCII</code></p><p>如果数据是文本类型，你可以直接将文本嵌入 (根据文档类型，使用合适的实体字符或转义字符)。如果是二进制数据，你可以将数据进行base64编码之后再进行嵌入。</p><p>A Data URI takes the format: 格式</p><pre class=" language-html"><code class="language-html">data:[<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MIME-type</span><span class="token punctuation">></span></span>][;charset=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">></span></span>][;base64],<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span><span class="token punctuation">></span></span></code></pre><p>The <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types" target="_blank" rel="noopener">MIME-type</a> specifies what type of data the URI contains. So if you wanted to provide a data URI for an image you would specify it as follows:</p><p><code>&lt;MIME-type&gt;</code> 指定内容格式</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg<span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Red dot<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><p>The MIME type used here is <code>image/png</code> indicating that the encoded data is a PNG image.</p><h4 id="Audio"><a href="#Audio" class="headerlink" title="Audio"></a>Audio</h4><p>Similarily, if you wanted to encode an Ogg audio file, you would use the MIME type <code>audio/ogg</code> as follows:</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>audio</span> <span class="token attr-name">controls</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>data:audio/ogg;base64,T2dnUwACAAAAAAAAAAA+..........+fm5nB6slBlZ3Fcha363d5ut7u3ni1rLoPf728l3KcK<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><p>If you want to specify an MP3 file you would simply set the MIME type to <code>audio/mp3</code> and provide the encoded MP3 audio data string.</p><p>See an example of a <a href="https://iandevlin.com/html5/data-uri/audio.php" target="_blank" rel="noopener">data URI audio source</a>.</p><h4 id="Video"><a href="#Video" class="headerlink" title="Video"></a>Video</h4><p>Providing a data URI for an encoded video is just the same, providing the correct MIME type for the correct encoded data, and of course they can be used in conjunction with the <code>source</code> element:</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">controls</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>video/webm<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8......jVOrhB9DtnVTrIMQTPc<span class="token punctuation">=</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>video/mp4<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>data:video/mp4;base64,AAAAHGZ0eXBtcDQyAAAAAG1wNDJpc29....../l/L+X8v5AAAAMgfDg<span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">></span></span></code></pre><p>See an example of a <a href="https://iandevlin.com/html5/data-uri/video.php" target="_blank" rel="noopener">data URI video source</a>.</p><h4 id="Encoding-in-base64"><a href="#Encoding-in-base64" class="headerlink" title="Encoding in base64"></a>Encoding in base64</h4><p>Of course the code examples provided above don’t display the full data URI for any of the audio and video files as they would fill the entire page! To encode the data I simply used PHP‘s <code>base64_encode</code> function as follows:</p><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">getEncodedVideoString</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token string">'data:video/'</span> <span class="token punctuation">.</span> <span class="token variable">$type</span> <span class="token punctuation">.</span> <span class="token string">';base64,'</span> <span class="token punctuation">.</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>Which was used by the HTML:</p><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">controls</span><span class="token punctuation">></span></span>   &lt;source type="video/webm" src="<span class="token prolog">&lt;?php echo getEncodedVideoString('webm', 'parrots-small.webm'); ?></span>">   &lt;source type="video/mp4" src="<span class="token prolog">&lt;?php echo getEncodedVideoString('mp4', 'parrots-small.mp4');?></span>"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">></span></span></code></pre><p>Of course you can use whatever you like to encode the files, this is just an example. And while you may not want nor need to base64 encode your audio and video files (<a href="http://davidbcalhoun.com/2011/when-to-base64-encode-images-and-when-not-to" target="_blank" rel="noopener">these reasons on why you might base64 encode images</a> might be just as relevant), it’s still good to know that you can should the need arise.</p><h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">genVideo</span><span class="token punctuation">(</span>base64Video<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  video<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText <span class="token operator">=</span> <span class="token string">'width:200px'</span>  video<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">'video1'</span><span class="token punctuation">;</span>  video<span class="token punctuation">.</span>loop <span class="token operator">=</span> <span class="token string">'true'</span><span class="token punctuation">;</span>  video<span class="token punctuation">.</span>autoplay <span class="token operator">=</span> <span class="token string">'true'</span><span class="token punctuation">;</span>  video<span class="token punctuation">.</span>controls <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  video<span class="token punctuation">.</span>src <span class="token operator">=</span> base64Video<span class="token punctuation">;</span>  <span class="token keyword">return</span> video<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 新键文件输入框元素</span><span class="token keyword">const</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>input<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">"file"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 文件输入框插入位置</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".inner"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>input<span class="token punctuation">.</span>onchange <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> files <span class="token operator">=</span> input<span class="token punctuation">.</span>files<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// e.target.files; // FileList</span>  <span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 转Base64</span>  reader<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// const result = e.currentTarget.result; // 等同于reader.result</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"re:"</span><span class="token punctuation">,</span> reader<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> video <span class="token operator">=</span> <span class="token function">genVideo</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 视频插入位置</span>    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".inner"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>video<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 可根据Base64属性生成对应HTML元素</span><span class="token keyword">function</span> <span class="token function">decode64</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">[</span>    type<span class="token punctuation">,</span>    data  <span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  type <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> type<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> HTML/CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 前端 </tag>
            
            <tag> HTML5 </tag>
            
            <tag> BASE64 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 jsDelivr 加速 Github 资源，加快博客打开速度</title>
      <link href="/2021/07/21/shi-yong-jsdelivr-jia-su-github-zi-yuan-jia-kuai-bo-ke-da-kai-su-du/"/>
      <url>/2021/07/21/shi-yong-jsdelivr-jia-su-github-zi-yuan-jia-kuai-bo-ke-da-kai-su-du/</url>
      
        <content type="html"><![CDATA[<h2 id="GitHub-CDN-使用说明"><a href="#GitHub-CDN-使用说明" class="headerlink" title="GitHub CDN 使用说明"></a>GitHub CDN 使用说明</h2><p><strong>在 GitHub 创建公开项目即可使用 jsDelivr 访问：</strong></p><p>We recommend using npm for projects that support it for better UX - npm packages are searchable on our website, and package pages show additional useful information, such as description and link to homepage.</p><p>We use a permanent S3 storage to ensure all files remain available even if GitHub goes down, or a repository or a release is deleted by its author. Files are fetched directly from GitHub only the first time, or when S3 goes down.</p><p>Load any GitHub release, commit, or branch:</p><p><strong>基本格式：</strong></p><pre class=" language-javascript"><code class="language-javascript">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>user<span class="token operator">/</span>repo@version<span class="token operator">/</span>file</code></pre><pre class=" language-javascript"><code class="language-javascript">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>用户名<span class="token operator">/</span>仓库名@版本号<span class="token operator">/</span>文件路径例如：https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>eished<span class="token operator">/</span>jkforum_helper@<span class="token number">0.5</span><span class="token punctuation">.</span><span class="token number">8</span><span class="token operator">/</span>video<span class="token operator">/</span>light<span class="token punctuation">.</span>mp4https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>eished<span class="token operator">/</span>JavaScript_notes<span class="token operator">/</span>JavaScript_code<span class="token operator">/</span>lib<span class="token operator">/</span>move<span class="token punctuation">.</span>min<span class="token punctuation">.</span>js</code></pre><p>Load an exact version of a file:</p><p><strong>精确版本号：</strong></p><pre class=" language-javascript"><code class="language-javascript">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>jquery<span class="token operator">/</span>jquery@<span class="token number">3.2</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">/</span>dist<span class="token operator">/</span>jquery<span class="token punctuation">.</span>min<span class="token punctuation">.</span>jshttps<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>jquery<span class="token operator">/</span>jquery@32b00373b3f42e5cdcb709df53f3b08b7184a944<span class="token operator">/</span>dist<span class="token operator">/</span>jquery<span class="token punctuation">.</span>min<span class="token punctuation">.</span>js</code></pre><p>Use a version range instead of an exact version:</p><p><strong>范围版本号：</strong></p><pre class=" language-javascript"><code class="language-javascript">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>jquery<span class="token operator">/</span>jquery@<span class="token number">3.2</span><span class="token operator">/</span>dist<span class="token operator">/</span>jquery<span class="token punctuation">.</span>min<span class="token punctuation">.</span>jshttps<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>jquery<span class="token operator">/</span>jquery@<span class="token number">3</span><span class="token operator">/</span>dist<span class="token operator">/</span>jquery<span class="token punctuation">.</span>min<span class="token punctuation">.</span>js</code></pre><p>If you use this feature and a file you requested is not available in the newest release, the link will keep working thanks to our version-fallback feature. We’ll continue to serve the file from older release instead of failing with a 404 error.</p><p>Omit the version completely or use “latest” to load the latest one (not recommended for production usage):</p><p><strong>忽略版本号，使用最新版（不推荐生产环境使用）：</strong></p><pre class=" language-javascript"><code class="language-javascript">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>jquery<span class="token operator">/</span>jquery@latest<span class="token operator">/</span>dist<span class="token operator">/</span>jquery<span class="token punctuation">.</span>min<span class="token punctuation">.</span>jshttps<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>jquery<span class="token operator">/</span>jquery<span class="token operator">/</span>dist<span class="token operator">/</span>jquery<span class="token punctuation">.</span>min<span class="token punctuation">.</span>js</code></pre><p>Requesting the latest version (as opposed to “latest major” or “latest minor”) is dangerous because major versions usually come with breaking changes. Only do this if you really know what you are doing.</p><p>Add “.min” to any JS/CSS file to get a minified version - if one doesn’t exist, we’ll generate it for you. All generated files come with source maps and can be easily used during development:</p><p><strong>自动生成 JS 压缩文件：<code>文件名.min.js</code></strong></p><pre class=" language-javascript"><code class="language-javascript">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>jquery<span class="token operator">/</span>jquery@<span class="token number">3.2</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">/</span>src<span class="token operator">/</span>core<span class="token punctuation">.</span>min<span class="token punctuation">.</span>js例如：https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>eished<span class="token operator">/</span>jkforum_helper@<span class="token number">0.5</span><span class="token punctuation">.</span><span class="token number">8</span><span class="token operator">/</span>main<span class="token punctuation">.</span>min<span class="token punctuation">.</span>js</code></pre><p>Minifying a large file can take several seconds. However, we store all generated files in our permanent storage, so this delay only applies to the first few requests.</p><p>Get a directory listing:</p><p><strong>获取文件目录：</strong></p><pre class=" language-javascript"><code class="language-javascript">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>jquery<span class="token regex">/jquery@3.2.1/</span>https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>jquery<span class="token operator">/</span>jquery@<span class="token number">3.2</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token regex">/dist/</span>例如：https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>gh<span class="token operator">/</span>eished<span class="token regex">/jkforum_helper/</span></code></pre><h2 id="hexo-主题-Matery-加速"><a href="#hexo-主题-Matery-加速" class="headerlink" title="hexo 主题 Matery 加速"></a>hexo 主题 Matery 加速</h2><h3 id="分析加载过慢的资源："><a href="#分析加载过慢的资源：" class="headerlink" title="分析加载过慢的资源："></a>分析加载过慢的资源：</h3><p><img src="/images/%E5%9B%BE%E7%89%87_49.Png" alt=""></p><ol><li>GitHub 加载过慢的主要是图片和 js 文件。</li><li>主题 <code>_config.yml</code> 中开启 jsDelivr 加速：</li></ol><pre class=" language-yml"><code class="language-yml"># CDN访问加速 # 第一次使用本功能，一定要先配置url，再`hexo cl && hexo g && hexo d`部署到GitHub的仓库，注意！必须是GitHub的仓库！# 如果必须要使用国内的coding或者gitee，可以采用双部署，同时将网站部署到两个仓库（其中一个必须是GitHub的仓库）# URL配置规则（例子如下）： https://cdn.jsdelivr.net/gh/你的GitHub用户名/你的仓库名# 如果想关闭此功能，将 url地址 注释或删除即可！## 注：配置了此项，就代表着本地调试的时候，网站依然会去GitHub请求资源（原来的资源），本地调试的时候记得将 此项配置 注释或者删除掉# 更多关于访问速度优化，请查看：https://blog.sky03.cn/posts/42790.htmljsDelivr:  url: https://cdn.jsdelivr.net/gh/eished/eished.github.io #https://github.com/eished/eished.github.io # https://cdn.jsdelivr.net/gh/skyls03/skyls03.github.io</code></pre><h3 id="比较速度："><a href="#比较速度：" class="headerlink" title="比较速度："></a>比较速度：</h3><ul><li>之前测试没禁用缓存，<strong>实际加载速度明显提升。</strong></li></ul><p><img src="/images/%E5%9B%BE%E7%89%87_53.Png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> Web </tag>
            
            <tag> 前端 </tag>
            
            <tag> CDN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>油猴 Tampermonkey 中 js 的数组、对象、map、set 存储数据效率对比</title>
      <link href="/2021/07/20/you-hou-jiao-ben-zhong-js-de-shu-zu-dui-xiang-map-set-cun-chu-shu-ju-xiao-lu-dui-bi/"/>
      <url>/2021/07/20/you-hou-jiao-ben-zhong-js-de-shu-zu-dui-xiang-map-set-cun-chu-shu-ju-xiao-lu-dui-bi/</url>
      
        <content type="html"><![CDATA[<h2 id="油猴-Tampermonkey-中-js-的数组、对象、map、set-存储数据效率对比"><a href="#油猴-Tampermonkey-中-js-的数组、对象、map、set-存储数据效率对比" class="headerlink" title="油猴 Tampermonkey 中 js 的数组、对象、map、set 存储数据效率对比"></a>油猴 Tampermonkey 中 js 的数组、对象、map、set 存储数据效率对比</h2><h3 id="数组存对象和-Set-集合存对象："><a href="#数组存对象和-Set-集合存对象：" class="headerlink" title="数组存对象和 Set 集合存对象："></a>数组存对象和 Set 集合存对象：</h3><pre class=" language-javascript"><code class="language-javascript">  <span class="token keyword">const</span> thrSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> thread <span class="token operator">=</span> <span class="token punctuation">{</span>      tid<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      touseruid<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      touser<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      replyIndex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      replyLen<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      randomTime<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>    thrSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">;</span>    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">;</span>    i<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">let</span> setarr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>thrSet<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 相当于整个数组遍历一遍，增加时间</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'setSet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">"thrSet"</span><span class="token punctuation">,</span> setarr<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'setSet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'setArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">"arr"</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'setArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'getSet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> <span class="token keyword">set</span> <span class="token operator">=</span> <span class="token function">GM_getValue</span><span class="token punctuation">(</span><span class="token string">"thrSet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'getSet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'getArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> ar <span class="token operator">=</span> <span class="token function">GM_getValue</span><span class="token punctuation">(</span><span class="token string">"arr"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'getArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>setset:14.48185546875ms </p><p>setarr: 11. 010986328125ms </p><p>getset:4.697821484375ms </p><p>staRrr:4.72599765625ms </p><p><strong>差距很小</strong></p><h3 id="数组存数组和-Set-集合存数组："><a href="#数组存数组和-Set-集合存数组：" class="headerlink" title="数组存数组和 Set 集合存数组："></a>数组存数组和 Set 集合存数组：</h3><pre class=" language-javascript"><code class="language-javascript">  <span class="token keyword">const</span> thrSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> thread <span class="token operator">=</span> <span class="token punctuation">{</span>      tid<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      touseruid<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      touser<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      replyIndex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      replyLen<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      randomTime<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>    thrSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    i<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">let</span> setarr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>thrSet<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 相当于整个数组遍历一遍，增加时间</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'setSet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">"thrSet"</span><span class="token punctuation">,</span> setarr<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'setSet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'setArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">"arr"</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'setArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'getSet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> se <span class="token operator">=</span> <span class="token function">GM_getValue</span><span class="token punctuation">(</span><span class="token string">"thrSet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'getSet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'getArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> ar <span class="token operator">=</span> <span class="token function">GM_getValue</span><span class="token punctuation">(</span><span class="token string">"arr"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'getArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>setset:2.466964453125ms </p><p>setAr:4.576171875ms </p><p>getset:2.852978515625ms </p><p>retArd:2.85498846875ms</p><p>第二次测试：</p><p>setset:3.65673828125ms</p><p>setAr;4.427978515625ms </p><p>getset:2.888916015625ms </p><p>staRr:3.433837898625ms</p><p><strong>差距很小</strong></p><h3 id="数组存数组和-Map-映射存数组："><a href="#数组存数组和-Map-映射存数组：" class="headerlink" title="数组存数组和 Map 映射存数组："></a>数组存数组和 Map 映射存数组：</h3><pre class=" language-javascript"><code class="language-javascript">  <span class="token keyword">const</span> thrSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> thread <span class="token operator">=</span> <span class="token punctuation">{</span>      tid<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      touseruid<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      touser<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      replyIndex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      replyLen<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      randomTime<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>    thrSet<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    i<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">let</span> setarr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>thrSet<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 相当于整个数组遍历一遍，增加时间</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'setMap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">"thrSet"</span><span class="token punctuation">,</span> setarr<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'setMap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'setArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">"arr"</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'setArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'getMap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> se <span class="token operator">=</span> <span class="token function">GM_getValue</span><span class="token punctuation">(</span><span class="token string">"thrSet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'getMap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'getArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> ar <span class="token operator">=</span> <span class="token function">GM_getValue</span><span class="token punctuation">(</span><span class="token string">"arr"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'getArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>strAp:4.163818359375ms </p><p>setAr:4.93693515625ms</p><p>getMap:4.588878125ms </p><p>staRr:1.696244921875ms</p><p>第二次测试</p><p>setMap: 3.80078125ms </p><p>setAr:4.868115234375ms </p><p>getMap:3.119873846875ms </p><p>staRr:3.635986328125ms</p><p>第三次测试</p><p>setap:4.934814453125ms </p><p>setAr:3.2888859375ms </p><p>getMap:3.6669921875ms</p><p>staRr:2.56298828125ms</p><p><strong>差距很小</strong></p><h3 id="数组存对象和-Map-映射存对象："><a href="#数组存对象和-Map-映射存对象：" class="headerlink" title="数组存对象和 Map 映射存对象："></a>数组存对象和 Map 映射存对象：</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">launch1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> thrSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> thread <span class="token operator">=</span> <span class="token punctuation">{</span>      tid<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      touseruid<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      touser<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      replyIndex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      replyLen<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      randomTime<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>    thrSet<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">;</span>    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">;</span>    i<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'setthrSet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> setarr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>thrSet<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 相当于整个数组遍历一遍，增加时间</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'setthrSet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'setMap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">"thrSet"</span><span class="token punctuation">,</span> setarr<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'setMap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'setArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">"arr"</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'setArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'getMap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> se <span class="token operator">=</span> <span class="token function">GM_getValue</span><span class="token punctuation">(</span><span class="token string">"thrSet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'getMap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'getArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> ar <span class="token operator">=</span> <span class="token function">GM_getValue</span><span class="token punctuation">(</span><span class="token string">"arr"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'getArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">launch2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">swRePic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"kkk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>setthrSet: 0.6669921875 ms</p><p>strAp:12.662841796875ms </p><p>setAr:11.68382734375ms </p><p>getmap:6.895947265625ms </p><p>setAr:3.727783283125ms</p><p>第二次测试</p><p>setthrSet: 0.6337890625 ms</p><p>strAp:15.3818359375ms </p><p>setAr:17.834228515625ms </p><p>getMap: 7.79296875ms </p><p>staRr:6.92587899625ms</p><p><strong>差距很小</strong></p><h2 id="油猴脚本中，数组存储比对象高效吗？"><a href="#油猴脚本中，数组存储比对象高效吗？" class="headerlink" title="油猴脚本中，数组存储比对象高效吗？"></a>油猴脚本中，数组存储比对象高效吗？</h2><h3 id="数组存数组和-Set-集合存对象："><a href="#数组存数组和-Set-集合存对象：" class="headerlink" title="数组存数组和 Set 集合存对象："></a>数组存数组和 Set 集合存对象：</h3><pre class=" language-javascript"><code class="language-javascript">  <span class="token keyword">const</span> thrSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> thread <span class="token operator">=</span> <span class="token punctuation">{</span>      tid<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      touseruid<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      touser<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      replyIndex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      replyLen<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>      randomTime<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span>    thrSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">;</span>    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    i<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">let</span> setarr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>thrSet<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 相当于整个数组遍历一遍，增加时间</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'setSet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">"thrSet"</span><span class="token punctuation">,</span> setarr<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'setSet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'setArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">GM_setValue</span><span class="token punctuation">(</span><span class="token string">"arr"</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'setArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'getSet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> se <span class="token operator">=</span> <span class="token function">GM_getValue</span><span class="token punctuation">(</span><span class="token string">"thrSet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'getSet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'getArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">let</span> ar <span class="token operator">=</span> <span class="token function">GM_getValue</span><span class="token punctuation">(</span><span class="token string">"arr"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'getArr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>用数组代替对象？</strong></p><p>setset:13.416015625ms </p><p>setarr:2.85791815625ms </p><p>getset:8.629158398625ms </p><p>getArr:1.35595793125ms</p><p><strong>数组写入快四倍！</strong></p><p><strong>数组读取快六倍！</strong></p><p><strong>应该使用数组或集合，只有键的集合比键值对快很多</strong></p><p>第二次测试</p><p>setset:11.566162189375ms </p><p>setar:2.989998234375ms</p><p>getset:5.27587898625ms </p><p>setAr:5.89111328125ms</p><p>第三次测试</p><p>setset:10.49966796875ms </p><p>setAr:2.97999399625ms</p><p>getset:4.8869149625ms </p><p>staRr:4.846923828125ms</p><p>第四次测试</p><p>setset:17.333984375ms </p><p>setAr:3.989765625ms </p><p>getset:14.43701171875ms </p><p>staRr:6.9951171875ms</p><p>第五次测试</p><p>reset:14.884833283125ms </p><p>setAr:2.69138859375ms </p><p>getset:5.759933293125ms </p><p>staRr:1.711181649625ms</p><p>第六次测试</p><p>setset:18.80878125ms </p><p>setAr:2.327888859375ms </p><p>getset:4.826968359375ms </p><p>staRr:1.85187421875ms</p><p>第七次测试</p><p>setset:18.899987899625ms </p><p>setAr:2.93817578125ms</p><p>getset:4.4268984375ms</p><p>staRr:2.72599765625ms</p><h3 id="结论：只存键比存键值对快，其它基本相同。"><a href="#结论：只存键比存键值对快，其它基本相同。" class="headerlink" title="结论：只存键比存键值对快，其它基本相同。"></a>结论：只存键比存键值对快，其它基本相同。</h3>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 前端 </tag>
            
            <tag> HTML5 </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Tampermonkey </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《弗洛伊德及其后继者·现代精神分析思想史》摘抄与想法</title>
      <link href="/2021/07/16/fu-luo-yi-de-ji-qi-hou-ji-zhe-xian-dai-jing-shen-fen-xi-si-xiang-shi-xiang-fa/"/>
      <url>/2021/07/16/fu-luo-yi-de-ji-qi-hou-ji-zhe-xian-dai-jing-shen-fen-xi-si-xiang-shi-xiang-fa/</url>
      
        <content type="html"><![CDATA[<h3 id="2020-12-31"><a href="#2020-12-31" class="headerlink" title="2020-12-31"></a>2020-12-31</h3><p>原文：本我是“充满翻滚着的兴奋的锅炉”（1933，第73页），包含着原始、无结构、冲动的能量；自我是调节功能的集合，保持着对本我冲动的控制；超我是一套道德价值观和自我批评的态度，主要是围绕着内化的父母形象组织起来的。<br>想法：</p><h3 id="2020-12-31-1"><a href="#2020-12-31-1" class="headerlink" title="2020-12-31"></a>2020-12-31</h3><p>原文：研究了一出生就遭遗弃的婴儿，在育婴堂中，他们的生理需求能够得到充分满足，但任何可持续的养育性互动都被剥夺。他们无一例外变得抑郁、孤僻、体弱多病。如果情绪上的饥饿持续超过三个月，眼睛协同能力就会衰退，出现发动迟滞。幼儿会变得愈发无精打采，终日安静地躺在婴儿床里，把小床垫压出一个凹槽。满两周岁前，三分之一的孩子会死亡。而那些幸存者活到四岁时，几乎还都不能坐、立、行、言。然而，如果母亲在最初的三个月回来的话，这种退化会自行反转。当弗洛伊德宣称剥夺是自我发展的一种刺激、迫使儿童发生朝向现实的关键转变时，斯皮茨关于“成长失败”的儿童研究生动地反映出，如果缺乏与有爱心的养育者的接触，“现实的砖墙”是致命的。<br>想法：</p><h3 id="2020-12-31-2"><a href="#2020-12-31-2" class="headerlink" title="2020-12-31"></a>2020-12-31</h3><p>原文：弗洛伊德引入了客体这一术语来指代本能冲动的目标，通过它，本能的张力得以释放。客体可以是一个人，也可以是无生命的。例如，对于恋物癖来说，鞋子就是力比多客体，因为它提供了表达性冲动的机会。在这种理论图式下，力比多客体本身并没有内在价值。因为它能有效地降低驱力张力，所以通过经验被铆定在驱力上。起初，母亲这个人对孩子来说并没有突出的重要性，而是被聚合在“多变的”客体类群中，其功能只是作为“本能可以在它那儿或者通过它达到目标的东西”之一（弗洛伊德，1915，第122页）。母亲变得重要，是因为孩子确信母亲提供了满足；人类的爱建立在直接和伪装（目标受抑）的满足之上，随着自我找到一些方式对本能冲动进行压抑、升华、提炼，它们在更复杂的客体关系中寻找到安身之所。<br>想法：</p><h3 id="2020-12-31-3"><a href="#2020-12-31-3" class="headerlink" title="2020-12-31"></a>2020-12-31</h3><p>原文：马勒进而推论，儿童在十五到二十四个月之间发展到和解（rapprochement）阶段，这时他们将体验到一种至关重要的精神失衡。此时，心理发展赶上了躯体成熟的速度，这使他忧虑地意识到，正是这种活动使其在精神上从与母亲的共生结合中分离出来。与先前的无畏行动不同，现在，孩子在学步中可能变得不断试探，想把母亲保持在视野之内，通过行动和目光接触调整这种新的分离体验。这时的风险是，母亲可能将这种实质进步的需要误读为退行，对此做出不耐烦或不可接近的反应，使独立行使功能的能力尚未完全发展的孩子陷入对抛弃的忧惧之中。马勒在报告中写道，基本的“心境易感性”可能就建立在这一点上：“在和解亚阶段，母亲的接纳和‘情绪理解’显著匮乏”，促使“抑郁倾向”的形成（1966，第157，161，166页）。<br>想法：</p><h3 id="2020-12-31-4"><a href="#2020-12-31-4" class="headerlink" title="2020-12-31"></a>2020-12-31</h3><p>原文：弗洛伊德所假想的婴儿，是充满了未经驯服的本能张力的生物，是一个史前动物，并不完全处于社会规范控制之下。弗洛伊德强调，无意识是永恒的；在成人的社会伪装面具下，这些幼儿期的本能永远保持紧张状态。发展自我心理学家设想，儿童是从与母亲的共生联合中逐步发展起来的。幼儿在心理意义上的诞生并不与从子宫中的身体出生相一致。母亲的关怀容纳着他脆弱的心灵，这种方式就好像她的身体曾容纳了胚胎发展一样。这一关于人类史前发展的象征性视角从弗洛伊德派自我心理学中浮现出来，为理解人类体验中的许多特征提供了崭新的有利位置。例如，恩斯特·克里斯（1952）把艺术家的创造性自由理解为一种退行，退行到不太结构化的前俄狄浦斯期状态为“为自我服务”；马丁·伯格曼（1973）探索了对共生融合的暂时回退，这常见于成熟爱情的某些最深层面。<br>想法：</p><h3 id="2020-12-31-5"><a href="#2020-12-31-5" class="headerlink" title="2020-12-31"></a>2020-12-31</h3><p>原文：雅各布森同意哈特曼的观点，她提出本能驱力并不是“与生俱来的”，而是在生物性上预设的先天潜能。尽管受到内在成熟过程的影响，但它们的独特特征是在早期关系中获得的。体验从一开始就记录着，对于婴儿来说感受如何，这被斯皮茨称为“情感知觉”；记忆像磁场中的铁屑，在感觉的好和坏两极聚积成丛。正常情况下，婴儿体验到的主要是满意；力比多逐渐从好体验的集合中浮现出来，成为幼儿生活中强大而坚固的动机力量。在理想情况下，攻击性的表现水平较低。然而，早期体验能够改变这种平衡。如果大部分体验是挫败的，被记录为负性，更强烈有力的攻击驱力就会被巩固，扭曲仍然脆弱的正常发展过程。<br>想法：</p><h3 id="2020-12-31-6"><a href="#2020-12-31-6" class="headerlink" title="2020-12-31"></a>2020-12-31</h3><p>原文：1923年，弗洛伊德提出了超我的概念，自我理想是其重要成分之一，作为“俄狄浦斯情结的后继者”来解释父母价值观的内化，这些价值观内化与解决俄狄浦斯挣扎同时发生，其内化控制住幼儿性欲。<br>想法：</p><h3 id="2021-01-15"><a href="#2021-01-15" class="headerlink" title="2021-01-15"></a>2021-01-15</h3><p>原文：费尔贝恩治疗遭受虐待的孩子的临床经验促使了他理论的形成。他震惊于孩子对虐待他们的父母仍怀有强烈的依恋和忠诚；快乐和满足的缺乏完全没有削弱亲子联结。这些孩子反而转向寻求痛苦作为与他人联系的形式，并且是偏好的交往形式。儿童及后来的成人，从他人那里寻求的是他们在早年发展中体验过的联系。如同小鸭子会对任何在恰当时候出现的照料它们的物体产生印刻并跟随其左右一样（洛伦茨，1966），费尔贝恩认为，儿童也会对早期照料者与他们的那些互动方式产生强烈的依恋，并以这种互动为核心来建立日后的情绪生活<br>想法：</p><h3 id="2021-01-15-1"><a href="#2021-01-15-1" class="headerlink" title="2021-01-15"></a>2021-01-15</h3><p>原文：想一想“化学反应”在人们的爱情和各种关系中的重要性。我们对他人的好恶并不都是依据他们给予我们快乐的可能性。我们对他人的喜好是由于他们引起了我们对旧客体依恋的共鸣，童年早期人际互动的途径和基调早已奠定了爱的基本范式。<br>想法：</p><h3 id="2021-01-15-2"><a href="#2021-01-15-2" class="headerlink" title="2021-01-15"></a>2021-01-15</h3><p>原文：在费尔贝恩看来，健康的养育将导致孩子具有向外的倾向，引领他朝向能够提供真实接触和互动的真实的人。费尔贝恩认为克莱因所描述的内部客体是不良养育的结果。如果孩子的依赖需要没有得到满足，如果无人提供孩子所寻求的肯定性互动，那么就会发生远离外部现实、远离与他人真实互动的病态转向，而建立幻想的、只属于自己的幻象（内部客体），个体与之保持幻想的联系（内部客体关系）。在费尔贝恩看来，内部客体并不是（像克莱因所认为的那样）伴随所有经验的必不可少且不可避免的东西，而是补偿性地替代了现实事物，即人际世界中真实的人。<br>想法：</p><h3 id="2021-03-04"><a href="#2021-03-04" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：例如，与排便活动有关的持续快感不能为社会所接受，所以反向形成这种防御被创造出来，将这种快感保持在个体的意识之外；蹒跚学步的孩子起初对排便的着迷后来被转化为一种意识中的嫌恶态度。然而，这些源自冲突的反向形成，最终却可能成为整体人格中的一种高度适应功能，比如干净整洁会带来真正的愉悦享受，因而逐渐拥有了冲突以外的作用，成为“次级自发性”。类似的还有理智化防御，使用抽象思维来试图阻止对冲突情绪的意识，这是高智力群体中常见的一种防御方式，而其抽象思维能力具有明显的适应用途。分析师如果仅仅解译防御（“你在理智化而不是感受”），风险是让病人觉得自己的思考能力是件坏事。哈特曼的精确区分从冲突和适应两个方面定位心理功能，为临床医师提供了更详细的人类特征。<br>想法：</p><h3 id="2021-03-04-1"><a href="#2021-03-04-1" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：自我的主要功能是表征现实，并通过筑起防御，在现实面前（包括社会习俗和道德的要求）引导和控制内部驱力所带来的压力。<br>想法：</p><h3 id="2021-03-04-2"><a href="#2021-03-04-2" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：如果孩子与抑郁、疏离或沉迷于自恋之中的父母在一起，她自己也可能变得抑郁、疏离或沉迷于自恋性自我专注，以此获得与父母人格中无法触及部分的联系感。病人在克服自身最痛苦的情感状态<br>想法：</p><h3 id="2021-03-04-3"><a href="#2021-03-04-3" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：时，却感到正在失去与作为内部客体的父母的联系，这种情况并不罕见。病人在感到更多快乐的时候，也在某种程度上感到更孤单，直到他们能够信任自己的成长能力，从而建立新的、不那么痛苦的人际联系。<br>想法：</p><h3 id="2021-03-04-4"><a href="#2021-03-04-4" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：费尔贝恩没有详细阐述病人是怎样开始感到分析师与那些既往客体不同的。有些学者（如拉克尔）指出，分析师成为与过去不同的客体是由于分析师提供解译的行为。其他的学者（如温尼科特）则提出，分析师之所以成为新的客体，不是由于解译而是由于分析“框架”——分析所使用的可靠结构。无论机制如何，费尔贝恩确信分析性改变的发生不在于萌生领悟，而在于改变与人关联的能力，病人有能力与分析师以新的方式建立关系。<br>想法：</p><h3 id="2021-03-04-5"><a href="#2021-03-04-5" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：温尼科特将促使“足够好的母亲”提供幼儿所需环境的心理状态概括为“原初母性专注（primary maternal preoccupation）”。在怀孕的最后三个月，母亲通过对孩子的自然专注，为这种根源于生物性、由进化塑造而成的功能做好了准备。此时孩子在母亲体内成长，挤压着母亲的内部脏器，妨碍着她的运动能力、消化和排泄过程，甚至呼吸的能力。母亲越来越减弱自身的主观性、自己生活的利益，而越来越关注孩子的运动、孩子的生命。在幼儿生命的最初几个月，母亲为幼儿提供滋养它自体成长的环境，怀孕的最后阶段不但是母亲提供滋养环境的象征性标志，本质上也是为此做准备。在为幼儿提供滋养环境时，母亲自身的主观性、自身的利益、自身的节律以及所关注的事物都逐渐退后而成为无足轻重的东西；她将自己的动作、活动，乃至她的生存本身都用来满足幼儿的愿望和需要。母亲为幼儿提供了由幼儿主宰的生理环境，这使幼儿可以沉浸在温尼科特认为对主观性生长具有关键作用的经验之中，使一个感到生活真实而有意义的独特“人类”个体得以出现。随着幼儿的需要和愿望在非整合的意识流中浮现，足够好的母亲迅速以直觉了解到孩子的愿望，并安排孩子周围的世界以实现孩子的欲望。喂养孩子的母亲在身体上对孩子需要的应答敏感性（乳汁的“流出”）是更广泛意义上对幼儿“自发动作”的应答敏感性的原型，母亲自己深深感到需要把自己奉献给幼儿，成为幼儿的要求和表达的媒介。在这个特殊时期，幼儿感到自己是一切造物的全能中心——温尼科特所谓的主观全能（subjective omnipotence）。是他的愿望创造了事物。如果他饥饿，渴望乳房，乳房就会出现；是他令乳房出现；是他创造了乳房。如果他冷，开始感到不适，世界就会变暖。他控制着周围世界的温度；他创造了他周遭的万物。母亲毫无耽搁、一拍不漏地“将世界带给”幼儿。温尼科特指出，正是母亲的应答敏感性给予幼儿短暂的幻想时刻（moment of illusion），让他以为是自身的愿望创造了他想要的客体。母亲在被需要的时候出场固然很关键，但同样关键的是她在不被需要的时候退场。她创建了温尼科特所称的抱持环境（holding environment），在这个物理心理空间中，幼儿得到保护而不知自己受保护，这种特有的无知无觉为接下来自发出现的体验打下了基础。<br>想法：</p><h3 id="2021-03-04-6"><a href="#2021-03-04-6" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：读者很可能会想到，任何心智正常的人都不愿或不能长时间为另一个人提供这种经验，无论那个人多么可爱。这正是关键所在。在温尼科特看来，母亲就是神志不清的。原初母性关注是一种建设性的短暂疯狂，使母亲能够悬置自己的主观性，成为幼儿主观性发展的介质。理想的状况是，母亲逐渐脱离这种替代自我的状态。她越来越感兴趣于自身的舒适、自身所关注的事物、自身的个性感受，因而她对孩子的愿望和动作的反应开始变得迟缓。她开始遗漏一拍，然后是两拍，再然后三拍。母亲慢慢地、逐渐减少“把世界带给”孩子，这对孩子的经验具有强大的影响，有些痛苦但颇有建设性。随着欲望与满足之间的差距逐渐加大，孩子慢慢认识到，尽管自以为全能的早期信念既自圆其说又令人信服，但他的欲望并非无所不能。孩子的需要和表达本身并不能带来满足，带来满足的是母亲的反应。这一逐渐清晰的认识具有巨大意义，幼儿第一次感到自己依赖着别人，尽管在外部观察者的眼中他毫无疑问地一直都是相当无助而依赖的。幼儿逐渐意识到，世界上不止有一种主观性，而是有许多种主观性；欲望的满足不仅需要表达，更需要与他人妥协，因为他人也有自身的欲望和计划。<br>想法：</p><h3 id="2021-03-04-7"><a href="#2021-03-04-7" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：过渡经验构成受保护的领域，为创造性自我提供活动和游戏的空间；它也是产生艺术和文化的经验领域。一个完全生活在主观全能中、与客观现实毫无联系的人，是自闭的、自我中心的。一个完全生活在客观现实，没有扎根于主观全能中的人，是肤浅地在适应生活，缺乏激情和原创力。而正是过渡国度的模棱两可，一方面将经验扎根于自体内部深邃自发的源泉，同时又在另一方面将自我表达与他人的主观性世界联系起来，如果母亲难以承受幼儿对她的使用，如果她退缩、垮塌或报复，幼儿就必须过早地关注外界，以丧失充分体验自身欲望为代价，这些欲望看上去是无所不能且危险的。结果是儿童害怕充分地需要和使用客体，日后则成为神经质地抑制自己欲望的成人。在温尼科特看来，成人的爱也需要间断的相互客体利用，双方都能遵从自己欲望的节奏和强度，而无须担忧对方能否承受。正是对方承受力的坚固可靠使得另一方与自身激情建立充分而热情的联系成为可能。<br>想法：</p><h3 id="2021-03-04-8"><a href="#2021-03-04-8" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：如果有些智能和情绪问题是他难以即刻理解和把握的，需要他承受些模棱两可、悬而未决，就会使他非常困惑并开始焦虑。<br>想法：</p><h3 id="2021-03-04-9"><a href="#2021-03-04-9" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：或许我们可以这样理解：彼得的成年生活是在寻找缺失的关键经验。过去，面对他自然浮现的兴奋，父母表现出的是恐慌和谨慎的态度，而不是相应地来适应他、满足他。他从来不认为人际环境会理所当然地满足他，这使他无法游戏般地探索自己的主观性，而是被迫发展出对世界不成熟的、理性的警惕和控制。他渴望放弃他所学会保持的警惕和控制，沉浸于自己的体验中漂流；然而他又害怕这样做，特别是当这需要另一个人参与的时候。根据温尼科特的观点，是长期的养育失败引起了自我的这种根本分裂，一方是欲望和意义的真诚源泉（真我），而另一方是由于被迫过早地应对外部世界而形成的顺从自我（假我）。在沙利文的一个自传片段中，他生动地描绘了温尼科特设想的这种分裂：“在我与我母亲的儿子之间有如此大的差别，以至于我常常觉得自己不过是她用来挂上她的幻想的衣架。”成为“我”，具有稳固的自体感，拥有真实体验，产生自己的个人意义，这些都需适于儿童主观性萌发的养育环境。幼儿只有在稳固地形成和确信“我”，并愉快地感受“我”之后，才开始具有作为“母亲的儿子”的感受，即一套他必须接受的形象和期待。被迫过早地面对做“母亲的儿子”的任务，代价将是失去对“我”的逐渐认识和表达，这将导致经验核心出现不和谐的断裂。<br>想法：</p><h3 id="2021-03-04-10"><a href="#2021-03-04-10" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：类似地，病人来到分析情境中，寻找自体新生所必需的体验。分析师把自己提供给病人自由使用，从而为病人提供了缺失的经验。分析师让病人感到，是病人自己创造了他，而分析师不指责病人对他的使用，这使病人能重新发现她自身想象和幻想的能力，产生非常真实、属于自己的、有意义的体验。<br>想法：</p><h3 id="2021-03-04-11"><a href="#2021-03-04-11" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：而鲍比主要关注的适应性本能动机，则是关于孩子与母亲的联结，鲍比称之为依恋（attachment）。他指出，建立与母亲的深刻而强韧的联结是增加幼儿生存几率的本能系统。与母亲越是亲近，幼儿越能确保得到更好的照料和保护，以免遭捕杀。鲍比描述了促进母婴亲近、调节依恋的五种本能反应成分：吸吮、微笑、黏附、哭泣和追随。<br>想法：</p><h3 id="2021-03-04-12"><a href="#2021-03-04-12" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：多是寻求客体的观点紧密相连，在鲍比重新阐述人格发展和心理病理的各种核心特征时，依恋概念成为最重要的内容。鲍比认为，情绪安全感反映出对是否可以找到依恋对象的信心，是通过早期童年经验而逐渐建立的。不同种类的焦虑都来源于与依恋客体分离的基本焦虑；从根本上来说，愤怒是对分离的反应和抗议。鲍比还指出，所有防御在本质上是反依恋（detachment），是抑制基本而核心的依恋需要，而情绪体验却正是以依恋需要为核心的。<br>想法：</p><h3 id="2021-03-04-13"><a href="#2021-03-04-13" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：鲍比的依恋概念与费尔贝恩认为力比中产生和形成的；而个体在生活中努力寻找意义和连续性的努力又影响了文化和历史的变化。例如，在对美国各种本土文化的研究中，埃里克森发现，地理和经济会通过儿童养育过程塑造人格，从而产生该种文化所需要的那类人。苏人是平原上的猎手，四处游荡，他们的组织是离心的；尤罗克人是渔人，捕捞每年一度洄游到克拉马斯河的鲑鱼，他们是以向心方式组织世界的。苏人注重力量；而尤罗克人注重控制和清洁。苏人的焦虑集中于丧失男性气概和失去行动能力；而尤罗克人的焦虑则集中于担忧被遗弃同时又没有食物供给。在养育孩子上，尤罗克人也与苏人不同，他们强调限制和禁令的重要性，而反对贪婪。他们延后初次哺乳的时间，而断奶却较早、较强硬，同时孩子被迫脱离母亲。埃里克森指出，这种养育方式培养出对食物充足时刻的幼儿式眷恋以及对超自然力量的祈求态度——这些都适合于捕捞鲑鱼的渔人生活。<br>想法：</p><h3 id="2021-03-04-14"><a href="#2021-03-04-14" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：埃里克森认为，这只是一种对世界的片面理解，而他的理解则是文化与文化差异塑造个体的发展。贯穿他理论的核心主题是个人与文化的相互渗透：个体的心灵是在特定文化背景的要求、价值观和判断<br>想法：</p><h3 id="2021-03-04-15"><a href="#2021-03-04-15" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：弗洛伊德认为，童年是心理生物驱力顺序展开、依次呈现，然后得到社会控制的阶段；埃里克森却认为不仅如此，童年期也是文化自我保存的方式，文化通过为幼儿的焦虑和身体感受赋予意义而得以保存。传统的精神分析观点认为本能驱力是心灵的原材料，通过外界社会力量的塑造和打磨而形成心灵。埃里克森则认为是文化和历史赋予心灵以生命，本无定形的生物潜能在文化和历史的介质中被转化成独特的人类生活。<br>想法：</p><h3 id="2021-03-04-16"><a href="#2021-03-04-16" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：自我发展理论是埃里克森最核心的贡献，他认为自我与驱力一样依次经历一系列的阶段或危机：<br>基本信任—基本信任缺乏自主性—羞耻和怀疑主动—内疚勤奋—自卑认同—角色混乱亲密—孤独繁衍—停滞自我整合—绝望<br>每个自我阶段对应一个驱力发展成熟的力比多阶段，并与该力比多阶段互为辩证关系。<br>想法：</p><h3 id="2021-03-04-17"><a href="#2021-03-04-17" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：例如，克莱因关于好乳房与坏乳房两极的偏执—分裂心位概念，也涉及了埃里克森在自我发展的第一个阶段所探讨的同样问题。克莱因认为，好坏两极源自婴幼儿力比多与攻击性之间的本能冲突；而埃里克森认为，信任和信任缺乏是不同的体验，分别源自儿童与养育者之间互动的成功与失败。温尼科特认为，抱持环境为真我或假我体验的形成提供了基础，而抱持环境的好坏取决于母亲，取决于母亲的心理动力特征和性格特点。类似地，沙利文认为儿童早期好坏的分裂起源于母亲的焦虑点。而埃里克森认为，是文化使生活划分出安全与危险，愉快与抑制，满足与挫折，而母亲是文化的代表和载体。因此，埃里克森认为，子女养育过程反映了儿童所处的文化的价值观和需求，这塑造了孩子的体验和日后的认同。<br>想法：</p><h3 id="2021-03-04-18"><a href="#2021-03-04-18" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：埃里克森以类似方式探讨自我发展的其他阶段，将弗洛伊德的性心理状态演化成在文化、历史环境中寻找定位的努力：自主—羞耻怀疑与肛门期有关；主动—内疚与生殖期及俄狄浦斯期有关；勤奋—自卑感则与潜伏期有关。但在这一点上，埃里克森利用并超越了弗洛伊德的性心理阶段说，以之作为说明自我发展顺序的框架。在弗洛伊德的发展理论中，在潜伏期开始之时，随着俄狄浦斯情结的解决，所有的重要发展已然完成。此后的生活基本上只是表现早期已建立的结构。埃里克森则认为自我成长远远没有止步于俄狄浦斯期，所以他在弗洛伊德的各阶段中加入了躯体危机、心理生物事件，以便提出他自己的心理社会观点。他将认同—角色混乱、亲密—孤独与青春期和青少年期联系起来；将繁衍—停滞与养育子女联系起来；将自我整合—绝望与躯体衰老的感受联系起来。<br>想法：</p><h3 id="2021-03-04-19"><a href="#2021-03-04-19" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：第一，埃里克森把自我的危机形容成一场两军对垒的战争，仿佛每个阶段的健康发展都应该以一方胜利而另一方失败而告终。其实，与其说埃里克森把这些危机看成是战争，不如说是看成对立统一的力量平衡。信任永远需要与一定的不信任相辅相成，保持创造性张力，自主与羞耻和怀疑的关系是如此，其他危机也是如此。此外，即使这种或那种危机在某个特定时期处于中心位置，但所有问题和张力在整个生命周期中都起作用。每个阶段在与随后发展的自我特点的冲突中得以重新加工，因此埃里克森把生命全程的自我发展不是看成一组阶梯，而更倾向于看成是一系列复杂的生命力量平衡，这些对立平衡的力量顺序展开，并始终彼此呼应。第二，埃里克森把自己提出的心理社会阶段作为弗洛伊德性心理阶段的扩展。但这不只是扩展。埃里克森不仅丰富了驱力的概念，而且改变了这个概念。2他在整合弗洛伊德生物本能的成熟时间表与社会习俗结构之时，已经改变了对驱力和社会环境的精神分析理解。<br>想法：</p><h3 id="2021-03-04-20"><a href="#2021-03-04-20" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：埃里克森最著名的概念是他提出的自我认同（ego identity），(1)这个概念有关青少年期、从儿童期向成年期的转变以及个体与社会环境的交汇点。埃里克森有意地以各种不同方式使用认同（identity）一词，正是这种灵活性促进了他探讨对个体的精神分析式理解与其他学科的交汇，如历史学、传记学和文化人类学等。<br>认同一词在不同的语境中传达多种不同含义，有时……它指的是意识中的一种个人认同感；而有时它又指无意识中对个人性格连续性的追求；第三种情况，则指自我整合这一潜在机制达到效果的标准；最后，它指的是对群体理念和认同保持内心的共同一致。（埃里克森，1959，第102页）<br>想法：</p><h3 id="2021-03-04-21"><a href="#2021-03-04-21" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：客体力比多和自恋力比多在本质上是相反的关系。弗洛伊德将力比多的能量库比喻成阿米巴原虫：在阿米巴原虫身体中心的原生质越多，它发出的伪足越少，反之亦然；一个人投注于自身的能量越多，可用于依恋他人的能量就越少，反之亦然。弗洛伊德认为精神分裂症状态就是力比多从客体大量撤回，进入二级自恋（secondary narcissism）的状态，促使个体跳过对父母的幼儿依恋，回到具有早期几个月生活特点的神奇的自我关注状态。此时她无法将对父母的力比多依恋转移到分析师的身上，因为没有剩余的依恋可供转移。当代分析师仍继续借助这一自恋理论来解释他们所遇到的某些临床难题。<br>想法：</p><h3 id="2021-03-04-22"><a href="#2021-03-04-22" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：爱德瓦多具有自恋性格障碍的所有迹象，这一诊断本质上等同于经典传统中所判定的无法分析：自我关注、表达流畅而肤浅、妄自尊大、对细枝末节敏感、不动感情地利用分析师而非真诚地投入合作的分析探询。根据经典的驱力理论，这种病人的力比多一度曾经指向外界，但是随着对现实世界更成熟的卷入，必然会带来俄狄浦斯期的失望，为了避免面对这种失望，他们撤回了力比多，转而变成防御性的自恋指向。经典观点认为，对这类病人取得治愈效果的唯一希望，取决于分析师或多或少能干预个体指向自身的力比多，使力比多脱离防御性的自恋指向，回到更<br>想法：</p><h3 id="2021-03-04-23"><a href="#2021-03-04-23" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：加成熟、指向外部的渠道。因为从根本上来说，正是这种自我卷入阻止了移情这一有力的治疗手段的发展，所以分析师从一开始就要着手处理这个巨大的缺陷。这类案例的传统临床治疗方式极大地依赖于对阻抗和防御进行分析，以暴露出阻碍真正移情形成的防御过程，并希望将其消除。通过持续、重复的运用面质，分析师会（例如）指出病人幼儿式的自我中心或傲慢的特权感。有时，为了打破自恋患者的妄自尊大，分析师会“采用启发病人幽默感的打趣、玩笑的态度，但常常却变成了挖苦、揶揄甚至嘲讽”（克利格曼，1958，第12页）。<br>想法：</p><h3 id="2021-03-04-24"><a href="#2021-03-04-24" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：。这些早期的自恋的心理状态包含了健康自恋的精髓；科胡特指出，必须让它们自己慢慢蜕变，这种蜕变只需要通过接触现实就可以实现。随着儿童对自己和父母的看法在日常生活中遭遇挫折和幻灭，儿童开始理解这些看法具有不符合现实的特性：他无法穿墙而过，父亲无法下令让他的足球队常胜不败，如此这般。在健康的发展中，对自己和他人夸大的形象会逐渐削弱到多少符合现实的比例。在总体上支持性的环境中，会发生适宜的挫折，不可避免然而可以调控。在这个安全的背景上，儿童应对自如，承受挫折或失望，并在此过程中内化了自身客体的功能特征。例如，他学会抚慰自己，而不是在绝望中崩溃；尽管失败，他开始体验内心的力量。科胡特感觉，他称之为蜕变内化（transmuting internalization）的过程，以细小的方式无数次地重复，建立了内心结构，最终形成安全、弹性的自我，保持着原初幼稚自恋状态的兴奋和活力的精髓。<br>想法：</p><h3 id="2021-03-04-25"><a href="#2021-03-04-25" class="headerlink" title="2021-03-04"></a>2021-03-04</h3><p>原文：科胡特发现，在自身客体移情的早期阶段（在有些案例中是很长时间），解译不仅不必要，而且具有破坏作用；解译可能令人注意到分析师的独立性，因此妨碍病人沉浸在发展所需的自身客体经验中。分析的干预不是给出解译，而是要说清楚病人需要分析师在移情中承担怎样的功能，开放地接纳这种需要，并在病人感到分析师在这个角色上有缺陷时进行共情。像父母一样，分析师无法（事实上也不应该）始终完美地符合病人的需要。也像父母一样，分析师无法让太阳升起或者保护病人不接触无情的生活现实。因此分析师就像称职的父母一样，会慢慢地让病人失望，并逐渐增加，让自恋移情（通过转变内化）转变成更为现实、但仍然有活力而坚固的对自我和他人的感受。<br>想法：</p><h3 id="2021-03-05"><a href="#2021-03-05" class="headerlink" title="2021-03-05"></a>2021-03-05</h3><p>原文：在精神分析整个历史中一直存在的最深的恐惧是，害怕分析会破坏创造力和激情。许多艺术家认为精神分析是对他们创造力的威胁；他们害怕分析性的理解在解除他们神经症性痛苦的同时，也可能会使他们艺术灵感的源泉枯竭。正如里尔克写道：“如果我的恶魔离开了我，我担心我的天使也要飞走了”（罗洛·梅，1969引用）。<br>想法：</p><h3 id="2021-03-05-1"><a href="#2021-03-05-1" class="headerlink" title="2021-03-05"></a>2021-03-05</h3><p>原文：柯恩伯格与雅各布森的一致之处在于，他也扩展并深化了弗洛伊德的驱力理论，提出驱力源于围绕早期客体关系而展开的复杂发展序列。弗洛伊德认为驱力是既定的、先天的；而在柯恩伯格的理论中，驱力仍然依赖于体质上的先天倾向，但最终是在与他人的互动中形成，因而是通过发展而建构的。柯恩伯格综合整理了多种理论。<br>想法：</p><h3 id="2021-03-05-2"><a href="#2021-03-05-2" class="headerlink" title="2021-03-05"></a>2021-03-05</h3><p>原文：洛伊沃尔德描述心灵存在着极其丰富的内部联系，即过去与当前、内部与外部、幼稚与成熟、自我与他人、幻想与实际之间的联系。他认为上述划分是充分相互渗透的辩证统一，而不是尖锐划分的两极。由此洛伊沃尔德提出，如果童年的经验被压抑，被严格地与成人的经验区分开来，那么幼儿式的、俄狄浦斯的爱就会削减和干扰成人的爱。于是童年的爱就会产生像鬼魂一样的影响，如同传说中没有得到安葬的鬼魂，纠缠着活人来寻求安息。如果童年经验从压抑中获得释放，被接受和修通，就会与当前经验发生非常不同的关系。洛伊沃尔德指出，人无需在童年的爱与成人的爱、过去与现在之间做出抉择。最恰当的理解是，与早期爱的客体的经验不是被弃诸脑后，而是通过成年爱的客体被重新发现和重新产生。新的爱并非与旧的爱完全不同，也并非仅仅是旧爱的代替。新的爱既新又旧，它带来新的经验，但在新经验中回响着旧的经验。早期爱的客体，如同祖先，为新的经验提供指导；当他们得到安葬和祭拜后，可以持续地通达现在，不再需要从痛苦的隔绝之中来支配现在，以寻找“得到承认的血统”（1980，第249页）。<br>想法：</p>]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 哲学 </tag>
            
            <tag> 心理学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高性能 JavaScript 之 DOM 篇</title>
      <link href="/2021/07/13/gao-xing-neng-javascript-zhi-dom-pian/"/>
      <url>/2021/07/13/gao-xing-neng-javascript-zhi-dom-pian/</url>
      
        <content type="html"><![CDATA[<h1 id="高性能-JavaScript-之-DOM-篇"><a href="#高性能-JavaScript-之-DOM-篇" class="headerlink" title="高性能 JavaScript 之 DOM 篇"></a><a href="https://segmentfault.com/a/1190000020808364" target="_blank" rel="noopener">高性能 JavaScript 之 DOM 篇</a></h1><p><a href="https://segmentfault.com/u/hison" target="_blank" rel="noopener"><strong>Hison</strong></a>发布于 2019-10-26</p><p>本篇文章主要分享一下操作DOM时的一些细节，来提高页面性能。<br>首先我们来思考以下几个问题。</p><ol><li>如何获取页面中所有<code>class</code>为<code>div1</code>和<code>div2</code>的<code>div</code>元素。</li><li>你了解<code>HTMLCollection</code>和<code>NodeList</code>吗？有什么区别？</li><li>如何获取一个元素的css属性值？</li><li>怎么减少重排和重绘？</li></ol><hr><h2 id="问题一：如何获取页面中所有class为div1和div2的div元素。"><a href="#问题一：如何获取页面中所有class为div1和div2的div元素。" class="headerlink" title="问题一：如何获取页面中所有class为div1和div2的div元素。"></a>问题一：如何获取页面中所有class为div1和div2的div元素。</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 这个问题如果我以前写的话，我会这么写。</span><span class="token keyword">var</span> errs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    divs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    className <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> len <span class="token operator">=</span> divs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>    className <span class="token operator">=</span> divs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>className<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>className <span class="token operator">===</span> <span class="token string">'div1'</span> <span class="token operator">||</span> className <span class="token operator">===</span> <span class="token string">'div2'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        errs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>divs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 看起来中规中矩，好像没什么大问题。</span><span class="token comment" spellcheck="true">// 但是现在我会这么写</span><span class="token keyword">var</span> errs2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'div.div1, div.div2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 用querySelectorAll,表面上看缩短了很多代码量，其实它的作用还不止这个。接下来我们引出第二个问题。</span></code></pre><hr><h2 id="问题二：你了解HTMLCollection和NodeList吗？有什么区别？"><a href="#问题二：你了解HTMLCollection和NodeList吗？有什么区别？" class="headerlink" title="问题二：你了解HTMLCollection和NodeList吗？有什么区别？"></a>问题二：你了解HTMLCollection和NodeList吗？有什么区别？</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 我们先来看两段代码。想一下这两段代码有什么区别。</span><span class="token comment" spellcheck="true">// 片段一</span><span class="token keyword">var</span> all <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> all<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// 片段二</span><span class="token keyword">var</span> all2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> all2<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>你可以分别复制一下这两段代码在你的浏览器中运行，看看有什么区别没有。前提是你的页面中至少有一个div。否则不会进入到循环中去。</p><ul><li>运行完之后你会发现，片段一运行完之后页面崩溃了。片段二正常如期运行。为什么呢？<ul><li>因为用<code>getElementsByTagName</code>方法获取到的是<code>HTMLCollection</code>, 而<strong><code>HTMLCollection</code>是实时获取的</strong>，也就是说，每次循环时请求<code>all.length</code>，都会重新去触发一次<code>getElementsByTagName</code>方法。导致<code>all.length</code>每次循环之后都会加1。最终造成了死循环。</li><li>而用<code>querySelectorAll</code>方法获取到的结果是<code>NodeList</code>，<strong><code>NodeList</code>不是实时获取的</strong>。</li><li>也正是因为这个原因，我们推荐使用<code>querySelector</code>去代替<code>getElementBy</code>方法。实时获取会造成页面不断重排，这极大的降低了性能。</li><li>另外：除了<code>getElementByXXX</code>方法外，<code>document.images</code>/<code>document.links</code>等方法返回的也是<code>HTMLCollection</code>。</li></ul></li></ul><hr><h2 id="问题三：如何获取一个元素的css属性值？"><a href="#问题三：如何获取一个元素的css属性值？" class="headerlink" title="问题三：如何获取一个元素的css属性值？"></a>问题三：如何获取一个元素的css属性值？</h2><ul><li>我们知道，直接用<code>div.style.color</code>这样的方式去获取css样式只能获取到行内写的属性，写在<code>style</code>标签中的样式是获取不到的。</li><li>标准浏览器中有一个<code>window.getComputedStyle</code>方法，可以获取实时的样式（在IE中是<code>currentStyle</code>）。</li><li>但是这个方法也会引起页面的重排，因为只有把页面重排之后他才会获取到实时的样式。</li></ul><hr><h2 id="问题四：如何减少重排和重绘次数。"><a href="#问题四：如何减少重排和重绘次数。" class="headerlink" title="问题四：如何减少重排和重绘次数。"></a>问题四：如何减少重排和重绘次数。</h2><ul><li>在改变DOM的一些样式时，重排和重绘是无法避免的，但是我们要尽量让这个次数降低，下面介绍集中方法。<ol><li>当需要给一个DOM元素加各种动画或者改变一系列样式时，先把这个元素设置成绝对定位。<ul><li>因为脱离文档流后，再对这个元素进行操作就不会影响到他周围的元素，也就不会发生重排。</li><li>等到一系列复杂的操作结束之后，再把这个元素的定位恢复到之前的样子。这样只进行了两次重排，能明显的提高性能。</li></ul></li><li>当我们需要改变很多样式时，不要用<code>style.color,style.width,style.height</code>这样一个一个去改，因为每次修改都会引起一次重排。<ul><li>我们应该使用给这个元素加一个类名，把所有的样式都写到这个类名中。</li><li>或者是改<code>style.cssText</code>。这样可以有效的减少重排的次数。</li></ul></li><li>用<code>fragment</code>代替<code>dom</code>。思考这样一个问题，如何给页面中插入10000个div元素。每次创建一个然后<code>append</code>到<code>body</code>中去吗？<ul><li>这显然不是一个好的办法。我们应该先把所有创建的元素都添加到一个<code>fragment</code>中。</li><li>然后再把<code>fragment</code>添加到<code>body</code>中去。这样只会引起一次重排，而不是1万次。</li></ul></li><li>介绍一些会引起重排的属性。当访问元素的以下属性时也会引起重排，因为这些属性是实时算的。<ul><li><code>offsetTop,offsetLeft,offsetWidth,offsetHeight</code></li><li><code>scrollTop,scrollLeft,scrollWidth,scrollHeight</code></li><li><code>clientTop,clientLeft,clientWidth,clientHeight</code></li></ul></li><li>尽可能少的访问DOM。看下面两段代码。</li></ol></li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 片段一</span>console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'test1'</span><span class="token punctuation">)</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML<span class="token operator">+</span><span class="token operator">=</span> i<span class="token punctuation">;</span><span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'test1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 打印结果80ms左右</span><span class="token comment" spellcheck="true">// 片段二</span>console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'test3'</span><span class="token punctuation">)</span><span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    count <span class="token operator">+</span><span class="token operator">=</span> i<span class="token punctuation">;</span><span class="token punctuation">}</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML<span class="token operator">+</span><span class="token operator">=</span> count<span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'test3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 打印结果0.3ms左右</span></code></pre><p>一个是不停的访问DOM，并修改内容，一个是先把内容缓存起来，只访问一次。打印出来时间相差好几百倍。</p><hr><h2 id="最后：说几个可以提高效率和性能的小细节。"><a href="#最后：说几个可以提高效率和性能的小细节。" class="headerlink" title="最后：说几个可以提高效率和性能的小细节。"></a>最后：说几个可以提高效率和性能的小细节。</h2><p>用正确的DOM属性。</p><ul><li>因为我们大部分时候需要操作的是元素节点，像什么文本节点，注释节点一般都会过滤掉。如果是这样的话，提倡用前面的属性代替后面的属性。</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// children → childNodes</span><span class="token comment" spellcheck="true">// childElementCount → childNodes.length</span><span class="token comment" spellcheck="true">// firstElementChild → firstChild</span><span class="token comment" spellcheck="true">// lastElementChild → lastChild</span><span class="token comment" spellcheck="true">// nextElementSibling → nextSibling</span><span class="token comment" spellcheck="true">// previousElementSibling → previousSibling</span></code></pre><p>需要给大量元素分发事件时，采取事件委托。因为浏览器不仅不需要分发很多事件，而且需要跟踪每个事件处理器，这也会占用更多内存。</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 前端 </tag>
            
            <tag> HTML5 </tag>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>querySelector 与 getElementById 性能比较</title>
      <link href="/2021/07/13/queryselector-yu-getelementbyid-xing-neng-bi-jiao/"/>
      <url>/2021/07/13/queryselector-yu-getelementbyid-xing-neng-bi-jiao/</url>
      
        <content type="html"><![CDATA[<h2 id="1-querySelector-与-getElementById"><a href="#1-querySelector-与-getElementById" class="headerlink" title="1. querySelector 与 getElementById"></a>1. querySelector 与 getElementById</h2><p>首先我们来比较 <code>querySelector</code> 与 <code>getElementById</code> 的差别，创建测试文件如下：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>test<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">        console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'querySelector'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'querySelector'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'getElementById'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'getElementById'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><strong>测试结果：</strong>IE11、Edge、Chrome</p><p><img src="/images/pic_39.png" alt="pic_39"></p><h2 id="2-querySelectorAll-与-getElementByClassName"><a href="#2-querySelectorAll-与-getElementByClassName" class="headerlink" title="2. querySelectorAll 与 getElementByClassName"></a>2. querySelectorAll 与 getElementByClassName</h2><p>我们再创建一个测试文件来比较 <code>querySelectorAll</code> 与 <code>getElementByClassName</code>，如下：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>test<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>test<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>test<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">        console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'querySelectorAll'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'querySelectorAll'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'getElementsByClassName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'getElementsByClassName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><strong>测试结果：</strong>IE11、Edge、Chrome</p><p><img src="/images/pic_40.png" alt="pic_40"></p><h2 id="结论："><a href="#结论：" class="headerlink" title="结论："></a>结论：</h2><p>IE 差距大。</p><p>Chrome 对 <code>querySelector</code> 和 <code>querySelectorAll</code> 进行了优化，与传统方式差距很小。</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 前端 </tag>
            
            <tag> HTML5 </tag>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tampermonkey 中使用 JavaScript 打包下载图片</title>
      <link href="/2021/07/08/shi-yong-javascript-da-bao-xia-zai-tu-pian/"/>
      <url>/2021/07/08/shi-yong-javascript-da-bao-xia-zai-tu-pian/</url>
      
        <content type="html"><![CDATA[<h1 id="Tampermonkey-例子："><a href="#Tampermonkey-例子：" class="headerlink" title="Tampermonkey 例子："></a>Tampermonkey 例子：</h1><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 引入插件：另存和压缩打包</span><span class="token comment" spellcheck="true">// @require      https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js</span><span class="token comment" spellcheck="true">// @require      https://cdn.jsdelivr.net/npm/jszip@3.6.0/dist/jszip.min.js</span><span class="token comment" spellcheck="true">// 批量下载 顺序下载 传入（图片链接数组，对应的带后缀的图片标题数组，文件夹名）</span>    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">batchDownload</span><span class="token punctuation">(</span>imgsUrl<span class="token punctuation">,</span> imgsTitles<span class="token punctuation">,</span> folderName<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">const</span> data <span class="token operator">=</span> imgsUrl<span class="token punctuation">;</span>      <span class="token keyword">const</span> zip <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSZip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 压缩包</span>      <span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token keyword">const</span> item <span class="token operator">=</span> data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getData</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">"blob"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 下载文件, 并存成ArrayBuffer对象 // 异步需把 await 去掉</span>          <span class="token keyword">const</span> file_name <span class="token operator">=</span> imgsTitles<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 获取文件名</span>          <span class="token comment" spellcheck="true">// （文件名，二进制流，多文件）</span>          zip<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token punctuation">{</span>            binary<span class="token punctuation">:</span> <span class="token boolean">true</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 逐个添加文件</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`第 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token operator">+</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 张，文件名：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file_name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，大小：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">parseInt</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>size <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> Kb，下载完成！等待压缩...`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>           <span class="token comment" spellcheck="true">// 处理错误 reject；不处理会打断 Promise.all</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 使用 Promise.all 异步执行</span>        <span class="token comment" spellcheck="true">// 返回 promise 结果数组，处理结果中的错误</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> err<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> i <span class="token operator">+</span> <span class="token string">"文件缺失！"</span><span class="token punctuation">)</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        zip<span class="token punctuation">.</span><span class="token function">generateAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          type<span class="token punctuation">:</span> <span class="token string">"blob"</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>content <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 生成二进制流</span>          <span class="token function">saveAs</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>folderName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">P]`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 利用 file-saver 保存文件</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// GM_xmlhttpRequest GET异步通用模块</span>    <span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"document"</span><span class="token punctuation">,</span> usermethod <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">GM_xmlhttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          method<span class="token punctuation">:</span> usermethod<span class="token punctuation">,</span>          url<span class="token punctuation">:</span> url<span class="token punctuation">,</span>          responseType<span class="token punctuation">:</span> type<span class="token punctuation">,</span>          onload<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token function">resolve</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>              <span class="token function">reject</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>          onerror<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"网络错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p><a href="https://github.com/Eished/jkforum_helper" target="_blank" rel="noopener">项目完整代码</a></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 前端 </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Tampermonkey </tag>
            
            <tag> Promise </tag>
            
            <tag> GM_xmlhttpRequest </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo prism 代码高亮问题</title>
      <link href="/2021/07/02/hexo-prism-dai-ma-gao-liang-wen-ti/"/>
      <url>/2021/07/02/hexo-prism-dai-ma-gao-liang-wen-ti/</url>
      
        <content type="html"><![CDATA[<h1 id="hexo-prism-代码高亮问题"><a href="#hexo-prism-代码高亮问题" class="headerlink" title="hexo prism 代码高亮问题"></a>hexo prism 代码高亮问题</h1><p><code>hexo-prism-plugin</code> 代码标注只支持小写英文，不支持符号、大写。</p><p>prism 支持的语言： <a href="https://prismjs.com/#languages-list" target="_blank" rel="noopener">https://prismjs.com/#languages-list</a></p><ul><li>小写</li></ul><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><ul><li>大写</li></ul><pre class=" language-CPP"><code class="language-CPP">#include <iostream>int main(){    return 0;}</code></pre><ul><li>大写+符号</li></ul><pre class=" language-C++"><code class="language-C++">#include <iostream>int main(){    return 0;}</code></pre><ul><li>小写+符号</li></ul><pre class=" language-c++"><code class="language-c++">#include <iostream>int main(){    return 0;}</code></pre>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> prism </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ 实现学生信息管理系统</title>
      <link href="/2021/07/02/c-shi-xian-xue-sheng-xin-xi-guan-li-xi-tong/"/>
      <url>/2021/07/02/c-shi-xian-xue-sheng-xin-xi-guan-li-xi-tong/</url>
      
        <content type="html"><![CDATA[<h1 id="cpp-实现学生信息管理系统"><a href="#cpp-实现学生信息管理系统" class="headerlink" title="cpp 实现学生信息管理系统"></a>cpp 实现学生信息管理系统</h1><blockquote><p><a href="https://github.com/Eished/C-cpp/blob/master/C%2B%2B%E5%AE%9E%E7%8E%B0%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F.md" target="_blank" rel="noopener">此笔记线更新地址</a></p><p><a href="https://github.com/Eished/C-cpp" target="_blank" rel="noopener">cpp 笔记和代码库</a></p></blockquote><h2 id="考试题目："><a href="#考试题目：" class="headerlink" title="考试题目："></a>考试题目：</h2><h3 id="A：学生信息存储（40-分）"><a href="#A：学生信息存储（40-分）" class="headerlink" title="A：学生信息存储（40 分）"></a>A：学生信息存储（40 分）</h3><ol><li><p><strong>业务描述：</strong></p><ul><li><p>某学校的学生信息包括：学号、姓名、性别、学院。</p></li><li><p>其中学号是整数；性别用单个大写字母表示，F 表示女性，M 表示男性；姓名是字符串类型。</p></li><li><p>学生学号固定长度 6 位，前两位表示学院，例如计算机学院编码 11，则首两位编码是 11；</p><p>中间两位表示入学年份，例如学生是 2019 年入学，则中间编码为 19：最后两位是自动按序编号，例如学生是 2019 年入学计算机学院的第 56 号学生，则学号为 111956。</p></li><li><p>假设学校有三个学院：</p><ul><li>计算机学院编码 11，</li><li>管理学院编码 22，</li><li>土木学院编码 33。</li></ul></li></ul></li><li><p><strong>程序开发要求：</strong></p><ol><li>要求使用 cpp 语言与面对对象设计思想实现开发。</li><li>定义一个学生类，包含上述学生信息。</li><li>在学生类中，定义输出函数 <code>Print</code> ，输出一个学生对象的信息。</li><li>定义学号生成函数 <code>GenID</code>，根据学生所属的学院、入学年份、学院顺序号，生成学生的学号。</li><li>学生类中，可以根据需要增加成员函数，但不能增加数据成员。</li><li>在主函数中，创建三个对象数组，对应三个学院，分别存储三个学院的学生对象。</li></ol></li><li><p><strong>输入：</strong></p><ol><li>第一行输入 t，表示有 t 个学生。</li><li>接着输入 t 行，每行输入一个学生信息共五个参数，包括姓名、性别、学院、入学年份和学院顺序号，数据之间用空格隔开。其中学院用缩写表示，CS 表示计算机学院，MA 表示管理学院，BU 表示土木学院。</li><li>每输入一个学生信息，就调用函数 <code>GenID</code> 生成学生学号，并创建一个新的学生对象。然后根据学院缩写，把新学生插入到对应对象数组的末尾。</li><li>数据输入的具体格式参考输入样例。</li></ol></li></ol><h3 id="B：学生信息操作（50-分）"><a href="#B：学生信息操作（50-分）" class="headerlink" title="B：学生信息操作（50 分）"></a>B：学生信息操作（50 分）</h3><ol><li><p><strong>业务描述：</strong></p><ul><li>在前一题的基础上：加入增加、删除、查询的信息操作</li><li>某学核的学生信息包括：学号、姓名、性别、学院。其中学号是整数；性别用单个大写字母表示，F 示女性，M 示男性；姓名是字符串类型。假设学校有三个学院：计算机字院编码 11，管理学院编码 22，土木学院编码 33。</li><li>编写一个程序完成学生信息的插入、存储、输出、增加、删除、查询等功能</li></ul></li><li><p><strong>程序开发要求：</strong></p><ol><li>要求使用 cpp 语言与面向对象设计思想实现开发。</li><li>定义一个学生类，不仅包含上述学生信息，还要增加静态数据成员 <code>total</code>，表示学生总数。要求静态数据成员必须是 private。</li><li>在学生中定义输出函数 <code>Print</code>，输出一个学生对象的信息。</li><li>学生类中可以根据需要增加成员函数，但不能增加据成员</li></ol></li><li><p><strong>在主函数中，完成以下要求：</strong></p><ol><li><p>创建三个对象数组，对应三个学院，分别存储三个学院的学生对象</p></li><li><p>定义插入函数 <code>Ins</code>，先创建一个新学生对象，根据学院缩写把新学生插入到对应数组的指定位置；插入前，指定位置上的原学生对象以及后面的学生对象都要往后移动一位。</p><p>提示：无需考虑插入位置非法的问题；题目的插入数组位置从 1 开始计算；每增加一个新学生，学生总数加 1。</p></li><li><p>定义删除函数 <code>Del</code>，根据提供的学号先找到学生对象，删除对应数组的对应学生对象；刪除后，刪除位置后面的学生对象都要往前移动一位。</p><p>提示：每删除一个学生，学生总数减 1。</p></li><li><p>定义查询函数 <code>Query</code>，根据提供的学号，查询学生是否存在，并调用输出的数 <code>Print</code> 信息作输出。</p></li><li><p>学生总数的所有操作都必须使用学生类的静态数据 <code>total</code> 来进行，不能在类外使用其他函数或变量进行统计。</p></li></ol></li></ol><h3 id="C：学生学号排序（10-分）"><a href="#C：学生学号排序（10-分）" class="headerlink" title="C：学生学号排序（10 分）"></a>C：学生学号排序（10 分）</h3><ol><li><strong>业务描述：</strong><ul><li>现在需要对学号进行排序。设有一个数组存储了所有学院所有学生的对象，采用简单选择排序法，实现所有学生对象学号从小到大排序。</li><li>简单选择排序算法说明<ul><li>假设 <code>n</code> 为待排序记录数，每一趟（例如第 <code>i</code> 趟，<code>i=1,2,...,n-1</code>）有 <code>n-i+1</code> 个待排序记录，</li><li>在第 <code>i</code> 趟中，通过 <code>n-i</code> 次比较，选出关键字最小的记录，与第 <code>i</code> 个记录交换。</li></ul></li></ul></li><li><strong>程序开发要求：</strong><ol><li>必须使用简单选择排序实现学生排序。</li><li>不允许使用第三方对象或函数实现排序，学生必须写出完整的排序算法。</li><li>无需考虑学号相同的情况。</li></ol></li></ol><h2 id="功能实现："><a href="#功能实现：" class="headerlink" title="功能实现："></a>功能实现：</h2><h3 id="A：输入文字模板"><a href="#A：输入文字模板" class="headerlink" title="A：输入文字模板"></a>A：输入文字模板</h3><p>张三 M CS 2019 11</p><p>杨六 M CS 2018 11</p><p>胡七 M CS 2017 11</p><p>李四 M MA 2020 22</p><p>王五 F BU 2019 33</p><h3 id="B：功能设计"><a href="#B：功能设计" class="headerlink" title="B：功能设计"></a>B：功能设计</h3><pre class=" language-cpp"><code class="language-cpp">    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"1:输入学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"2:打印学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"3:插入学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"4:查找学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"5:修改学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"6:删除学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"7:读取学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"8:保存学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"9:按学号从小到大排序\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"0:退出\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"请输入对应的序号："</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></code></pre><h3 id="C：实现代码"><a href="#C：实现代码" class="headerlink" title="C：实现代码"></a>C：实现代码</h3><h4 id="普通数组版："><a href="#普通数组版：" class="headerlink" title="普通数组版："></a>普通数组版：</h4><ul><li>要求静态数据成员必须是 private。</li><li>不能在类外使用其他函数或变量进行统计。</li><li>不能增加数据成员。</li></ul><h5 id="Student-h"><a href="#Student-h" class="headerlink" title="Student.h"></a>Student.h</h5><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">pragma</span> once</span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">{</span><span class="token keyword">private</span><span class="token operator">:</span>    <span class="token keyword">static</span> <span class="token keyword">int</span> total<span class="token punctuation">;</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">int</span> studNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"0"</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> sex <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> college<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"0"</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> year <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> colNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token function">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token function">Student</span><span class="token punctuation">(</span><span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span> sex<span class="token punctuation">,</span> <span class="token keyword">char</span> college<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> year<span class="token punctuation">,</span> <span class="token keyword">int</span> colNum<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">GenID</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">Total</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">setTotal</span><span class="token punctuation">(</span><span class="token keyword">int</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h5 id="Student-cpp"><a href="#Student-cpp" class="headerlink" title="Student.cpp"></a>Student.cpp</h5><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Student.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">int</span> Student<span class="token operator">::</span>total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>Student<span class="token operator">::</span><span class="token function">Student</span><span class="token punctuation">(</span><span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span> sex<span class="token punctuation">,</span> <span class="token keyword">char</span> college<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> year<span class="token punctuation">,</span> <span class="token keyword">int</span> colNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">strcpy_s</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">strcpy_s</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>college<span class="token punctuation">,</span> college<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>year <span class="token operator">=</span> year<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>colNum <span class="token operator">=</span> colNum<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>total<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Student<span class="token operator">::</span><span class="token function">GenID</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>    studNum <span class="token operator">=</span> colNum <span class="token operator">*</span> <span class="token number">10000</span> <span class="token operator">+</span> year <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> count<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Student<span class="token operator">::</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"学号："</span> <span class="token operator">&lt;&lt;</span> studNum <span class="token operator">&lt;&lt;</span> <span class="token string">"  姓名："</span> <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">"  性别："</span> <span class="token operator">&lt;&lt;</span> sex <span class="token operator">&lt;&lt;</span> <span class="token string">"  学院："</span> <span class="token operator">&lt;&lt;</span> college <span class="token operator">&lt;&lt;</span> <span class="token string">"  入学年份："</span> <span class="token operator">&lt;&lt;</span> year <span class="token operator">&lt;&lt;</span> <span class="token string">"  学院顺序号："</span> <span class="token operator">&lt;&lt;</span> colNum <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> Student<span class="token operator">::</span><span class="token function">Total</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> total<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Student<span class="token operator">::</span><span class="token function">setTotal</span><span class="token punctuation">(</span><span class="token keyword">int</span> total<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>total <span class="token operator">=</span> total<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h5 id="StudIMS-cpp"><a href="#StudIMS-cpp" class="headerlink" title="StudIMS.cpp"></a>StudIMS.cpp</h5><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Student.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fstream></span></span><span class="token macro property">#<span class="token directive keyword">define</span> M 30</span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"1:输入学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"2:打印学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"3:插入学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"4:查找学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"5:统计学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"6:删除学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"7:读取学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"8:保存学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"9:按学号从小到大排序\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"0:退出\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"请输入对应的序号："</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    Student CSarr<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 学生数组</span>    Student MAarr<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">;</span>    Student BUarr<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> CScount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 学号顺序号：只增不减</span>    <span class="token keyword">int</span> MAcount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> BUcount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> CSi <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 学生数组下标位置</span>    <span class="token keyword">int</span> MAi <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> BUi <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> cho<span class="token punctuation">;</span>        cin <span class="token operator">>></span> cho<span class="token punctuation">;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>cho<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 输入学生信息</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入录入人数："</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            cin <span class="token operator">>></span> t<span class="token punctuation">;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入：名字 性别 学院字母 入学年份 学院代码"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> t<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">char</span> college<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">char</span> sex<span class="token punctuation">;</span>                <span class="token keyword">int</span> year<span class="token punctuation">;</span>                <span class="token keyword">int</span> colNum<span class="token punctuation">;</span>                cin <span class="token operator">>></span> name <span class="token operator">>></span> sex <span class="token operator">>></span> college <span class="token operator">>></span> year <span class="token operator">>></span> colNum<span class="token punctuation">;</span>                Student <span class="token function">stud</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> college<span class="token punctuation">,</span> year<span class="token punctuation">,</span> colNum<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">switch</span> <span class="token punctuation">(</span>colNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>                    stud<span class="token punctuation">.</span><span class="token function">GenID</span><span class="token punctuation">(</span><span class="token operator">++</span>CScount<span class="token punctuation">)</span><span class="token punctuation">;</span>                    CSarr<span class="token punctuation">[</span>CSi<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> stud<span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">;</span>                <span class="token keyword">case</span> <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>                    stud<span class="token punctuation">.</span><span class="token function">GenID</span><span class="token punctuation">(</span><span class="token operator">++</span>MAcount<span class="token punctuation">)</span><span class="token punctuation">;</span>                    MAarr<span class="token punctuation">[</span>MAi<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> stud<span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">;</span>                <span class="token keyword">case</span> <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>                    stud<span class="token punctuation">.</span><span class="token function">GenID</span><span class="token punctuation">(</span><span class="token operator">++</span>BUcount<span class="token punctuation">)</span><span class="token punctuation">;</span>                    BUarr<span class="token punctuation">[</span>BUi<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> stud<span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">;</span>                <span class="token keyword">default</span><span class="token operator">:</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 打印学生信息</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">else</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">//break; // 打印插入位置非法的学生</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">else</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">//break;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">else</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">//break;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 插入学生信息</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入插入位置："</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token keyword">int</span> num<span class="token punctuation">;</span>            cin <span class="token operator">>></span> num<span class="token punctuation">;</span>            num <span class="token operator">=</span> num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入：名字 性别 学院字母 入学年份 学院代码"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">char</span> college<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">char</span> sex<span class="token punctuation">;</span>            <span class="token keyword">int</span> year<span class="token punctuation">;</span>            <span class="token keyword">int</span> colNum<span class="token punctuation">;</span>            cin <span class="token operator">>></span> name <span class="token operator">>></span> sex <span class="token operator">>></span> college <span class="token operator">>></span> year <span class="token operator">>></span> colNum<span class="token punctuation">;</span>            Student <span class="token function">stud</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> college<span class="token punctuation">,</span> year<span class="token punctuation">,</span> colNum<span class="token punctuation">)</span><span class="token punctuation">;</span>            Student studTmp<span class="token punctuation">;</span>            <span class="token keyword">switch</span> <span class="token punctuation">(</span>colNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>                stud<span class="token punctuation">.</span><span class="token function">GenID</span><span class="token punctuation">(</span><span class="token operator">++</span>CScount<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> num<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 插入位置超过当前输入队列长度，再次输入时会被覆盖；M改成CSi可解决</span>                    studTmp <span class="token operator">=</span> CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                    CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> stud<span class="token punctuation">;</span>                    stud <span class="token operator">=</span> studTmp<span class="token punctuation">;</span>                <span class="token punctuation">}</span>                CSi<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 数组下标增加</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>                stud<span class="token punctuation">.</span><span class="token function">GenID</span><span class="token punctuation">(</span><span class="token operator">++</span>MAcount<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> num<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    studTmp <span class="token operator">=</span> MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                    MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> stud<span class="token punctuation">;</span>                    stud <span class="token operator">=</span> studTmp<span class="token punctuation">;</span>                <span class="token punctuation">}</span>                MAi<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>                stud<span class="token punctuation">.</span><span class="token function">GenID</span><span class="token punctuation">(</span><span class="token operator">++</span>BUcount<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> num<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    studTmp <span class="token operator">=</span> BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                    BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> stud<span class="token punctuation">;</span>                    stud <span class="token operator">=</span> studTmp<span class="token punctuation">;</span>                <span class="token punctuation">}</span>                BUi<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">;</span>            <span class="token keyword">default</span><span class="token operator">:</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 查找学生信息</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入查询学号："</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token keyword">int</span> num<span class="token punctuation">;</span>            cin <span class="token operator">>></span> num<span class="token punctuation">;</span>            <span class="token keyword">int</span> colNum <span class="token operator">=</span> num <span class="token operator">/</span> <span class="token number">10000</span><span class="token punctuation">;</span>            <span class="token keyword">switch</span> <span class="token punctuation">(</span>colNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">==</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">break</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">case</span> <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">==</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">break</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">case</span> <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">==</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">break</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 统计学生信息</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            Student stud<span class="token punctuation">;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"总人数："</span> <span class="token operator">&lt;&lt;</span> stud<span class="token punctuation">.</span><span class="token function">Total</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"计算机学院人数："</span> <span class="token operator">&lt;&lt;</span> CSi <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"管理学院人数："</span> <span class="token operator">&lt;&lt;</span> MAi <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"土木学院人数："</span> <span class="token operator">&lt;&lt;</span> BUi <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 删除学生信息</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            Student stud<span class="token punctuation">;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入删除的学号："</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token keyword">int</span> num<span class="token punctuation">;</span>            cin <span class="token operator">>></span> num<span class="token punctuation">;</span>            <span class="token keyword">int</span> colNum <span class="token operator">=</span> num <span class="token operator">/</span> <span class="token number">10000</span><span class="token punctuation">;</span>            <span class="token keyword">switch</span> <span class="token punctuation">(</span>colNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">==</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> M <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            CSarr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> CSarr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        CSi<span class="token operator">--</span><span class="token punctuation">;</span>                        stud<span class="token punctuation">.</span><span class="token function">setTotal</span><span class="token punctuation">(</span>stud<span class="token punctuation">.</span><span class="token function">Total</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"删除成功"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>                        <span class="token keyword">break</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">case</span> <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">==</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> M <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            MAarr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> MAarr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        MAi<span class="token operator">--</span><span class="token punctuation">;</span>                        stud<span class="token punctuation">.</span><span class="token function">setTotal</span><span class="token punctuation">(</span>stud<span class="token punctuation">.</span><span class="token function">Total</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"删除成功"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>                        <span class="token keyword">break</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">case</span> <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">==</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> M <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            BUarr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> BUarr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        BUi<span class="token operator">--</span><span class="token punctuation">;</span>                        stud<span class="token punctuation">.</span><span class="token function">setTotal</span><span class="token punctuation">(</span>stud<span class="token punctuation">.</span><span class="token function">Total</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"删除成功"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>                        <span class="token keyword">break</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">default</span><span class="token operator">:</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 读取学生信息</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            Student stud<span class="token punctuation">;</span>            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// CS</span>            ifstream <span class="token function">fileCS</span><span class="token punctuation">(</span><span class="token string">"CS.dat"</span><span class="token punctuation">,</span> ios<span class="token operator">::</span>in <span class="token operator">|</span> ios<span class="token operator">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>fileCS<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>stud<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                stud<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> stud<span class="token punctuation">;</span>                i<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            CScount <span class="token operator">=</span> stud<span class="token punctuation">.</span>studNum <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 读最后一个对象的学号，作为起始值；乱序插入后有bug</span>            CSi <span class="token operator">=</span> i<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 初始化数组下标</span>            i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            fileCS<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// MA</span>            ifstream <span class="token function">fileMA</span><span class="token punctuation">(</span><span class="token string">"MA.dat"</span><span class="token punctuation">,</span> ios<span class="token operator">::</span>in <span class="token operator">|</span> ios<span class="token operator">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>fileMA<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>stud<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                stud<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> stud<span class="token punctuation">;</span>                i<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            MAcount <span class="token operator">=</span> stud<span class="token punctuation">.</span>studNum <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">;</span>            MAi <span class="token operator">=</span> i<span class="token punctuation">;</span>            i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            fileMA<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// BU</span>            ifstream <span class="token function">fileBU</span><span class="token punctuation">(</span><span class="token string">"BU.dat"</span><span class="token punctuation">,</span> ios<span class="token operator">::</span>in <span class="token operator">|</span> ios<span class="token operator">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>fileBU<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>stud<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                stud<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> stud<span class="token punctuation">;</span>                i<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            BUcount <span class="token operator">=</span> stud<span class="token punctuation">.</span>studNum <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">;</span>            BUi <span class="token operator">=</span> i<span class="token punctuation">;</span>            stud<span class="token punctuation">.</span><span class="token function">setTotal</span><span class="token punctuation">(</span>CScount <span class="token operator">+</span> MAcount <span class="token operator">+</span> BUcount<span class="token punctuation">)</span><span class="token punctuation">;</span>            fileBU<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取成功！"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 保存</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ofstream <span class="token function">fileCS</span><span class="token punctuation">(</span><span class="token string">"CS.dat"</span><span class="token punctuation">,</span> ios<span class="token operator">::</span>out <span class="token operator">|</span> ios<span class="token operator">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    fileCS<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            fileCS<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ofstream <span class="token function">fileMA</span><span class="token punctuation">(</span><span class="token string">"MA.dat"</span><span class="token punctuation">,</span> ios<span class="token operator">::</span>out <span class="token operator">|</span> ios<span class="token operator">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    fileMA<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            fileMA<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            ofstream <span class="token function">fileBU</span><span class="token punctuation">(</span><span class="token string">"BU.dat"</span><span class="token punctuation">,</span> ios<span class="token operator">::</span>out <span class="token operator">|</span> ios<span class="token operator">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    fileBU<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            fileBU<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"保存成功！"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">9</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 按学号从小到大排序</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            Student studs<span class="token punctuation">[</span>M <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    studs<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                    index<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    studs<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                    index<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    studs<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                    index<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">int</span> less <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            Student studTmp<span class="token punctuation">;</span>            Student studTmpSec<span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>studs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> M <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>studs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> studs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">-</span> studs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">></span> less<span class="token punctuation">)</span> <span class="token punctuation">{</span>                            less <span class="token operator">=</span> studs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">-</span> studs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum<span class="token punctuation">;</span>                            index <span class="token operator">=</span> j<span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>less<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token comment" spellcheck="true">// 插入到i位置 然后后移</span>                        studTmp <span class="token operator">=</span> studs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                        studs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> studs<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> M <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            studTmpSec <span class="token operator">=</span> studs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                            studs<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> studTmp<span class="token punctuation">;</span>                            studTmp <span class="token operator">=</span> studTmpSec<span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        <span class="token comment" spellcheck="true">// 删除 然后前移</span>                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> M <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            studs<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> studs<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        <span class="token comment" spellcheck="true">// studs[index].print();</span>                        less <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> M <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>studs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    studs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 退出</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"已退出"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入不正确!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h4 id="STL-vector-动态数组版："><a href="#STL-vector-动态数组版：" class="headerlink" title="STL vector 动态数组版："></a>STL vector 动态数组版：</h4><ul><li>静态数据成员公有。<ul><li>total 私有</li></ul></li><li>增加数据成员学号。<ul><li>未改进：静态数据不会存入对象二进制文件中，写入文件存储更方便复原。</li></ul></li><li>修改学生信息功能。</li></ul><h5 id="Student-h-1"><a href="#Student-h-1" class="headerlink" title="Student.h"></a>Student.h</h5><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">pragma</span> once</span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">{</span><span class="token keyword">private</span><span class="token operator">:</span>    <span class="token keyword">static</span> <span class="token keyword">int</span> total<span class="token punctuation">;</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">static</span> <span class="token keyword">int</span> csCount<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 学号，只增不减</span>    <span class="token keyword">static</span> <span class="token keyword">int</span> maCount<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">int</span> buCount<span class="token punctuation">;</span>    <span class="token keyword">int</span> studNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> sex <span class="token operator">=</span> <span class="token string">'F'</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> college<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> year <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> colNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token function">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token function">Student</span><span class="token punctuation">(</span><span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span> sex<span class="token punctuation">,</span> <span class="token keyword">char</span> college<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> year<span class="token punctuation">,</span> <span class="token keyword">int</span> colNum<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">GenID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">Total</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">setTotal</span><span class="token punctuation">(</span><span class="token keyword">int</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h5 id="Student-cpp-1"><a href="#Student-cpp-1" class="headerlink" title="Student.cpp"></a>Student.cpp</h5><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Student.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">int</span> Student<span class="token operator">::</span>total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> Student<span class="token operator">::</span>csCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> Student<span class="token operator">::</span>maCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> Student<span class="token operator">::</span>buCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>Student<span class="token operator">::</span><span class="token function">Student</span><span class="token punctuation">(</span><span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span> sex<span class="token punctuation">,</span> <span class="token keyword">char</span> college<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> year<span class="token punctuation">,</span> <span class="token keyword">int</span> colNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">strcpy_s</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">strcpy_s</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>college<span class="token punctuation">,</span> college<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>year <span class="token operator">=</span> year<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>colNum <span class="token operator">=</span> colNum<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>total<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>colNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>        csCount<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>        maCount<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>        buCount<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token operator">:</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> Student<span class="token operator">::</span><span class="token function">GenID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>colNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>        count <span class="token operator">=</span> csCount<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>        count <span class="token operator">=</span> maCount<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>        count <span class="token operator">=</span> buCount<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token operator">:</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    studNum <span class="token operator">=</span> colNum <span class="token operator">*</span> <span class="token number">10000</span> <span class="token operator">+</span> year <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> count<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Student<span class="token operator">::</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"学号："</span> <span class="token operator">&lt;&lt;</span> studNum <span class="token operator">&lt;&lt;</span> <span class="token string">"  姓名："</span> <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">"  性别："</span> <span class="token operator">&lt;&lt;</span> sex <span class="token operator">&lt;&lt;</span> <span class="token string">"  学院："</span> <span class="token operator">&lt;&lt;</span> college <span class="token operator">&lt;&lt;</span> <span class="token string">"  入学年份："</span> <span class="token operator">&lt;&lt;</span> year <span class="token operator">&lt;&lt;</span> <span class="token string">"  学院顺序号："</span> <span class="token operator">&lt;&lt;</span> colNum <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> Student<span class="token operator">::</span><span class="token function">Total</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> total<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Student<span class="token operator">::</span><span class="token function">setTotal</span><span class="token punctuation">(</span><span class="token keyword">int</span> total<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>total <span class="token operator">=</span> total<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h5 id="myfunc-h"><a href="#myfunc-h" class="headerlink" title="myfunc.h"></a>myfunc.h</h5><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">pragma</span> once</span><span class="token keyword">void</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">printAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">Del</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">Ins</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">Sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h5 id="stuInfoMS-cpp"><a href="#stuInfoMS-cpp" class="headerlink" title="stuInfoMS.cpp"></a>stuInfoMS.cpp</h5><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;vector></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fstream></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Student.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"myfunc.h"</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>vector<span class="token operator">&lt;</span>Student<span class="token operator">></span> CSarr<span class="token punctuation">;</span>vector<span class="token operator">&lt;</span>Student<span class="token operator">></span> MAarr<span class="token punctuation">;</span>vector<span class="token operator">&lt;</span>Student<span class="token operator">></span> BUarr<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> cho<span class="token punctuation">;</span>        cin <span class="token operator">>></span> cho<span class="token punctuation">;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>cho<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 输入学生信息</span>            <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 打印学生信息</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">printAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 插入学生信息</span>            <span class="token function">Ins</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 查找学生信息</span>            <span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 修改学生信息</span>            <span class="token function">modify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 删除学生信息</span>            <span class="token function">Del</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 读取学生信息</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"读取成功！"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 保存</span>            <span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"保存成功！"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">9</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 按学号从小到大排序</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">Sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 退出</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"已退出"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入不正确!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"1:输入学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"2:打印学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"3:插入学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"4:查找学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"5:修改学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"6:删除学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"7:读取学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"8:保存学生信息\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"9:按学号从小到大排序\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"0:退出\n"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"请输入对应的序号："</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入学生人数："</span><span class="token punctuation">;</span>    cin <span class="token operator">>></span> t<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入：名字 性别 学院字母 入学年份 学院代码"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> t<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">char</span> college<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">char</span> sex<span class="token punctuation">;</span>        <span class="token keyword">int</span> year<span class="token punctuation">;</span>        <span class="token keyword">int</span> colNum<span class="token punctuation">;</span>        cin <span class="token operator">>></span> name <span class="token operator">>></span> sex <span class="token operator">>></span> college <span class="token operator">>></span> year <span class="token operator">>></span> colNum<span class="token punctuation">;</span>        Student <span class="token function">stud</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> college<span class="token punctuation">,</span> year<span class="token punctuation">,</span> colNum<span class="token punctuation">)</span><span class="token punctuation">;</span>        stud<span class="token punctuation">.</span><span class="token function">GenID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>colNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>            CSarr<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>stud<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>            MAarr<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>stud<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>            BUarr<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>stud<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">default</span><span class="token operator">:</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">printAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    Student stud<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"总人数："</span> <span class="token operator">&lt;&lt;</span> stud<span class="token punctuation">.</span><span class="token function">Total</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"计算机学院人数："</span> <span class="token operator">&lt;&lt;</span> CSarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"管理学院人数："</span> <span class="token operator">&lt;&lt;</span> MAarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"土木学院人数："</span> <span class="token operator">&lt;&lt;</span> BUarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 输入学院 或 打印全部</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"计算机学院:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> CSarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"\n管理学院:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"\n土木学院:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BUarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">Ins</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入插入位置："</span><span class="token punctuation">;</span>    cin <span class="token operator">>></span> x<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入学生人数："</span><span class="token punctuation">;</span>    cin <span class="token operator">>></span> t<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入：名字 性别 学院字母 入学年份 学院代码"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> t<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">char</span> college<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">char</span> sex<span class="token punctuation">;</span>        <span class="token keyword">int</span> year<span class="token punctuation">;</span>        <span class="token keyword">int</span> colNum<span class="token punctuation">;</span>        cin <span class="token operator">>></span> name <span class="token operator">>></span> sex <span class="token operator">>></span> college <span class="token operator">>></span> year <span class="token operator">>></span> colNum<span class="token punctuation">;</span>        Student <span class="token function">stud</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> college<span class="token punctuation">,</span> year<span class="token punctuation">,</span> colNum<span class="token punctuation">)</span><span class="token punctuation">;</span>        stud<span class="token punctuation">.</span><span class="token function">GenID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>colNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>CSarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>                CSarr<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>CSarr<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> stud<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span> <span class="token punctuation">{</span>                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"插入位置大于数组长度"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>MAarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>                MAarr<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>MAarr<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> stud<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span> <span class="token punctuation">{</span>                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"插入位置大于数组长度"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>BUarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>                BUarr<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>BUarr<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> stud<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span> <span class="token punctuation">{</span>                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"插入位置大于数组长度"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">default</span><span class="token operator">:</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> num<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入查询的学号:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cin <span class="token operator">>></span> num<span class="token punctuation">;</span>    <span class="token keyword">int</span>    colNum <span class="token operator">=</span> num <span class="token operator">/</span> <span class="token number">10000</span><span class="token punctuation">;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>colNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> CSarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">==</span> num<span class="token punctuation">)</span>            <span class="token punctuation">{</span>                CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"未找到"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">==</span> num<span class="token punctuation">)</span>            <span class="token punctuation">{</span>                MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"未找到"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BUarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">==</span> num<span class="token punctuation">)</span>            <span class="token punctuation">{</span>                BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"未找到"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token operator">:</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">Del</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> num<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入删除的学号:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cin <span class="token operator">>></span> num<span class="token punctuation">;</span>    <span class="token keyword">int</span>    colNum <span class="token operator">=</span> num <span class="token operator">/</span> <span class="token number">10000</span><span class="token punctuation">;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>colNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> CSarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">==</span> num<span class="token punctuation">)</span>            <span class="token punctuation">{</span>                CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setTotal</span><span class="token punctuation">(</span>CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Total</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                CSarr<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>CSarr<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"未找到"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">==</span> num<span class="token punctuation">)</span>            <span class="token punctuation">{</span>                MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setTotal</span><span class="token punctuation">(</span>MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Total</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                MAarr<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>MAarr<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"未找到"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BUarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">==</span> num<span class="token punctuation">)</span>            <span class="token punctuation">{</span>                BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setTotal</span><span class="token punctuation">(</span>BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Total</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                BUarr<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>BUarr<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"未找到"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token operator">:</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">modify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> num<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入修改的学号:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cin <span class="token operator">>></span> num<span class="token punctuation">;</span>    <span class="token keyword">int</span>    colNum <span class="token operator">=</span> num <span class="token operator">/</span> <span class="token number">10000</span><span class="token punctuation">;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>colNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> CSarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">==</span> num<span class="token punctuation">)</span>            <span class="token punctuation">{</span>                CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>                <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">char</span> college<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">char</span> sex<span class="token punctuation">;</span>                <span class="token keyword">int</span> year<span class="token punctuation">;</span>                <span class="token keyword">int</span> colNum<span class="token punctuation">;</span>                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入：名字 性别 学院字母 入学年份 学院代码"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>                cin <span class="token operator">>></span> name <span class="token operator">>></span> sex <span class="token operator">>></span> college <span class="token operator">>></span> year <span class="token operator">>></span> colNum<span class="token punctuation">;</span>                <span class="token function">strcpy_s</span><span class="token punctuation">(</span>CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">strcpy_s</span><span class="token punctuation">(</span>CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>college<span class="token punctuation">,</span> college<span class="token punctuation">)</span><span class="token punctuation">;</span>                CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>                CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>year <span class="token operator">=</span> year<span class="token punctuation">;</span>                CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>colNum <span class="token operator">=</span> colNum<span class="token punctuation">;</span>                CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">GenID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"未找到"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">22</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">==</span> num<span class="token punctuation">)</span>            <span class="token punctuation">{</span>                MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>                <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">char</span> college<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">char</span> sex<span class="token punctuation">;</span>                <span class="token keyword">int</span> year<span class="token punctuation">;</span>                <span class="token keyword">int</span> colNum<span class="token punctuation">;</span>                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入：名字 性别 学院字母 入学年份 学院代码"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>                cin <span class="token operator">>></span> name <span class="token operator">>></span> sex <span class="token operator">>></span> college <span class="token operator">>></span> year <span class="token operator">>></span> colNum<span class="token punctuation">;</span>                <span class="token function">strcpy_s</span><span class="token punctuation">(</span>MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">strcpy_s</span><span class="token punctuation">(</span>MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>college<span class="token punctuation">,</span> college<span class="token punctuation">)</span><span class="token punctuation">;</span>                MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>                MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>year <span class="token operator">=</span> year<span class="token punctuation">;</span>                MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>colNum <span class="token operator">=</span> colNum<span class="token punctuation">;</span>                MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">GenID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"未找到"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">33</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BUarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">==</span> num<span class="token punctuation">)</span>            <span class="token punctuation">{</span>                BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>                <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">char</span> college<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">char</span> sex<span class="token punctuation">;</span>                <span class="token keyword">int</span> year<span class="token punctuation">;</span>                <span class="token keyword">int</span> colNum<span class="token punctuation">;</span>                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"输入：名字 性别 学院字母 入学年份 学院代码"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>                cin <span class="token operator">>></span> name <span class="token operator">>></span> sex <span class="token operator">>></span> college <span class="token operator">>></span> year <span class="token operator">>></span> colNum<span class="token punctuation">;</span>                <span class="token function">strcpy_s</span><span class="token punctuation">(</span>BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">strcpy_s</span><span class="token punctuation">(</span>BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>college<span class="token punctuation">,</span> college<span class="token punctuation">)</span><span class="token punctuation">;</span>                BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>                BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>year <span class="token operator">=</span> year<span class="token punctuation">;</span>                BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>colNum <span class="token operator">=</span> colNum<span class="token punctuation">;</span>                BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">GenID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"未找到"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token operator">:</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">Sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"简单选择排序算法，从小到大排序:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    vector<span class="token operator">&lt;</span>Student<span class="token operator">></span> studs<span class="token punctuation">;</span>    <span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> less <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> CSarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        studs<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        studs<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BUarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        studs<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>studs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> studs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> studs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>studs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">-</span> studs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">></span> less<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    less <span class="token operator">=</span> studs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum <span class="token operator">-</span> studs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>studNum<span class="token punctuation">;</span>                    temp <span class="token operator">=</span> j<span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>less<span class="token punctuation">)</span> <span class="token punctuation">{</span>                studs<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>studs<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> studs<span class="token punctuation">[</span>temp<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                studs<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>studs<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> temp <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                less <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"没有数据"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> studs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        studs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    ofstream <span class="token function">fileCS</span><span class="token punctuation">(</span><span class="token string">"CS.dat"</span><span class="token punctuation">,</span> ios<span class="token operator">::</span>out <span class="token operator">|</span> ios<span class="token operator">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> CSarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        fileCS<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>CSarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    ofstream <span class="token function">fileMA</span><span class="token punctuation">(</span><span class="token string">"MA.dat"</span><span class="token punctuation">,</span> ios<span class="token operator">::</span>out <span class="token operator">|</span> ios<span class="token operator">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        fileMA<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>MAarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    ofstream <span class="token function">fileBU</span><span class="token punctuation">(</span><span class="token string">"BU.dat"</span><span class="token punctuation">,</span> ios<span class="token operator">::</span>out <span class="token operator">|</span> ios<span class="token operator">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BUarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        fileBU<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>BUarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    fileCS<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    fileMA<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    fileBU<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    Student stud<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// CS</span>    ifstream <span class="token function">fileCS</span><span class="token punctuation">(</span><span class="token string">"CS.dat"</span><span class="token punctuation">,</span> ios<span class="token operator">::</span>in <span class="token operator">|</span> ios<span class="token operator">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>fileCS<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>stud<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        stud<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        CSarr<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>stud<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Student<span class="token operator">::</span>csCount <span class="token operator">=</span> stud<span class="token punctuation">.</span>studNum <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 初始化学号起始位置；最后一个对象的学号，乱序插入后有bug</span>    <span class="token comment" spellcheck="true">// MA</span>    ifstream <span class="token function">fileMA</span><span class="token punctuation">(</span><span class="token string">"MA.dat"</span><span class="token punctuation">,</span> ios<span class="token operator">::</span>in <span class="token operator">|</span> ios<span class="token operator">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>fileMA<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>stud<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        stud<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        MAarr<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>stud<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Student<span class="token operator">::</span>maCount <span class="token operator">=</span> stud<span class="token punctuation">.</span>studNum <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// BU</span>    ifstream <span class="token function">fileBU</span><span class="token punctuation">(</span><span class="token string">"BU.dat"</span><span class="token punctuation">,</span> ios<span class="token operator">::</span>in <span class="token operator">|</span> ios<span class="token operator">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>fileBU<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>stud<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        stud<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        BUarr<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>stud<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Student<span class="token operator">::</span>buCount <span class="token operator">=</span> stud<span class="token punctuation">.</span>studNum <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">;</span>    stud<span class="token punctuation">.</span><span class="token function">setTotal</span><span class="token punctuation">(</span>CSarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> MAarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> BUarr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    fileCS<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    fileMA<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    fileBU<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> C/C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 信息管理系统 </tag>
            
            <tag> C </tag>
            
            <tag> C++ </tag>
            
            <tag> 实践 </tag>
            
            <tag> 考试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用FTP软件和USB线进行文件传输</title>
      <link href="/2021/06/24/shi-yong-ftp-ruan-jian-he-usb-xian-jin-xing-wen-jian-chuan-shu/"/>
      <url>/2021/06/24/shi-yong-ftp-ruan-jian-he-usb-xian-jin-xing-wen-jian-chuan-shu/</url>
      
        <content type="html"><![CDATA[<h2 id="准备的软件"><a href="#准备的软件" class="headerlink" title="准备的软件"></a>准备的软件</h2><ol><li>手机端：实简FTP（Android）</li><li>电脑端：FlashFxp（Windows）</li></ol><h2 id="逐字稿"><a href="#逐字稿" class="headerlink" title="逐字稿:"></a>逐字稿:</h2><h3 id="介绍："><a href="#介绍：" class="headerlink" title="介绍："></a>介绍：</h3><p>大家好！这里是：We Know。</p><p>今天来给大家介绍一种，电脑和手机之间快速传输文件的方法。</p><p>传输速度平均40MB/S，是我目前发现的最快的方法。</p><p>首先要准备这两个软件和USB线。</p><p>这两个软件，软件市场有下载，</p><p>其它同类软件也可以，只要支持FTP即可。</p><h2 id="手机端操作："><a href="#手机端操作：" class="headerlink" title="手机端操作："></a>手机端操作：</h2><p>首先来看手机端操作：</p><p>打开 实简FTP，</p><p>设置 用户名和密码。</p><p>启动服务，后台运行。</p><p>然后进入手机设置，打开个人热点，</p><p>把手机用USB线连上电脑。</p><p>仅充电，选择USB共享网络就可以了。</p><h2 id="电脑端操作"><a href="#电脑端操作" class="headerlink" title="电脑端操作"></a>电脑端操作</h2><p>接下来是电脑端操作：</p><p>电脑提示连上网络，右键网络图标，打开网络设置，选择更改适配器选项，</p><p>禁用有线网卡或无线网卡，不禁用的话也可以用，但会经过路由器，</p><p>速度取决于路由器速度，通常只有10MB/S左右。</p><p>然后打开FlashFXP，左边是本地，打开收藏夹：选择素材文件夹</p><p>菜单栏选择站点，站点管理，新建站点</p><p>输入站点名，连接类型，地址，用户名，密码</p><p>然后就可以连接了</p><p>连上后显示在右边，选择自己要传的文件，拖过去就开始传输了，</p><p>右下角又显示需要的时间，传输速度之类的。</p><p>快进到99%，已经传输完了，可以看到平均速度。</p><h3 id="准备的软件-1"><a href="#准备的软件-1" class="headerlink" title="准备的软件"></a>准备的软件</h3><ol><li>手机端：实简FTP（Android）</li><li>电脑端：FlashFxp（Windows）</li></ol><h3 id="手机端"><a href="#手机端" class="headerlink" title="手机端"></a>手机端</h3><ol><li>USB连接电脑</li><li>个人热点，USB共享网络</li><li>设置开启FTP服务端软件</li></ol><h3 id="电脑端"><a href="#电脑端" class="headerlink" title="电脑端"></a>电脑端</h3><ol><li>更改适配器选项，禁用有线或无线网卡，留下手机USB共享的网卡</li><li>开启FTP客户端软件，连接手机服务端</li><li>传输文件</li></ol><p>传输完还原所有设置。</p><h3 id="注："><a href="#注：" class="headerlink" title="注："></a>注：</h3><ol><li>此方法无需网络</li><li>可以用无线网络传输，手机或电脑开热点</li></ol><p>USB连接只有40MB/s，因为小米手机只支持USB2.0，达到了传输速度上限，使用USB3.0的手机理论可达600MB/s，实际100MB/s左右</p><p>手机与电脑<br>最快传输文件的方式<br>轻松易操作</p><p>无线/有线传输<br>平均40MB/S</p>]]></content>
      
      
      <categories>
          
          <category> 计算机网络 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 局域网 </tag>
            
            <tag> FTP </tag>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tampermonkey 油猴脚本笔记</title>
      <link href="/2021/06/20/tampermonkey-you-hou-jiao-ben-bi-ji/"/>
      <url>/2021/06/20/tampermonkey-you-hou-jiao-ben-bi-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="Tampermonkey-语法"><a href="#Tampermonkey-语法" class="headerlink" title="Tampermonkey 语法"></a>Tampermonkey 语法</h1><h2 id="require-引入文件"><a href="#require-引入文件" class="headerlink" title="require 引入文件"></a>require 引入文件</h2><ul><li>引入后相当于在同一个文件内，可直接调用引入文件的函数。</li></ul><h2 id="GM-xmlhttpRequest-Promise-写法"><a href="#GM-xmlhttpRequest-Promise-写法" class="headerlink" title="GM_xmlhttpRequest Promise 写法"></a>GM_xmlhttpRequest Promise 写法</h2><pre class=" language-javascript"><code class="language-javascript">    <span class="token comment" spellcheck="true">// GM_xmlhttpRequest GET异步通用模块</span>    <span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"document"</span><span class="token punctuation">,</span> usermethod <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">GM_xmlhttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          method<span class="token punctuation">:</span> usermethod<span class="token punctuation">,</span>          url<span class="token punctuation">:</span> url<span class="token punctuation">,</span>          responseType<span class="token punctuation">:</span> type<span class="token punctuation">,</span>          onload<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token function">resolve</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"请求错误："</span> <span class="token operator">+</span> response<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token function">reject</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>          onerror<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"网络错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// GM_xmlhttpRequest POST异步通用模块</span>    <span class="token keyword">function</span> <span class="token function">postData</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> postData<span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"document"</span><span class="token punctuation">,</span> usermethod <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>        <span class="token function">GM_xmlhttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          method<span class="token punctuation">:</span> usermethod<span class="token punctuation">,</span>          url<span class="token punctuation">:</span> url<span class="token punctuation">,</span>          headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>            <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/x-www-form-urlencoded"</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>          data<span class="token punctuation">:</span> postData<span class="token punctuation">,</span>          responseType<span class="token punctuation">:</span> type<span class="token punctuation">,</span>          onload<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token function">resolve</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"请求错误："</span> <span class="token operator">+</span> response<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token function">reject</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>          onerror<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"网络错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><h2 id="脚本执行顺序"><a href="#脚本执行顺序" class="headerlink" title="脚本执行顺序"></a>脚本执行顺序</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// @require      file://d:\a.js</span><span class="token comment" spellcheck="true">// ==/UserScript==</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token string">'use strict'</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ol><li>require 引入文件</li><li><code>// ==/UserScript==</code> 下的内容</li><li><code>(function () { &#39;use strict&#39;;console.log(1);})();</code> 的内容</li></ol><h2 id="GM-addValueChangeListener"><a href="#GM-addValueChangeListener" class="headerlink" title="GM_addValueChangeListener"></a>GM_addValueChangeListener</h2><ul><li>先运行监听函数；</li><li>只要对应名称的值发生变化就可以监听到。</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">let</span> myname <span class="token operator">=</span> <span class="token string">"user"</span><span class="token punctuation">;</span><span class="token function">GM_addValueChangeListener</span><span class="token punctuation">(</span>myname<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>myname<span class="token punctuation">,</span> old_value<span class="token punctuation">,</span> new_value<span class="token punctuation">,</span> remote<span class="token punctuation">)</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myname<span class="token punctuation">,</span> old_value<span class="token punctuation">,</span> new_value<span class="token punctuation">,</span> remote<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token string">"a"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token string">"b"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">GM_setValue</span><span class="token punctuation">(</span>myname<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// console.log(2);</span><span class="token keyword">function</span> <span class="token function">launch1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  user<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// console.log(user);</span>  <span class="token function">GM_setValue</span><span class="token punctuation">(</span>myname<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">launch2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  user<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>  <span class="token function">GM_setValue</span><span class="token punctuation">(</span>myname<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// console.log("user", user);</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 前端 </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Tampermonkey </tag>
            
            <tag> Promise </tag>
            
            <tag> GM_xmlhttpRequest </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《新标准日本语·初级》学习笔记</title>
      <link href="/2021/06/07/xin-biao-zhun-ri-ben-yu-xue-xi-bi-ji/"/>
      <url>/2021/06/07/xin-biao-zhun-ri-ben-yu-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="新标日初级上"><a href="#新标日初级上" class="headerlink" title="新标日初级上"></a>新标日初级上</h1><blockquote><p>完整版笔记地址:  <a href="https://github.com/Eished/wfyyyf_notes" target="_blank" rel="noopener">https://github.com/Eished/wfyyyf_notes</a></p></blockquote><h2 id="书本介绍"><a href="#书本介绍" class="headerlink" title="书本介绍"></a>书本介绍</h2><h3 id="书本结构"><a href="#书本结构" class="headerlink" title="书本结构"></a>书本结构</h3><ol><li><p>上、下册各设6个”基本单元”，每个单元由4课构成。</p><p>上册另设”入门单元”</p></li><li><p>入门单元</p></li><li><p>基本单元</p><ol><li>寒暄用语</li><li>人物介绍</li><li>单元结构</li><li>单元扉页</li><li>单元末<ul><li>阅读文</li><li>实用场景对话</li><li>词语之泉</li><li>日本风情</li></ul></li></ol></li><li><p>模拟试题</p></li><li><p>附录</p><ul><li>为了整理学习项目，在上、下册的卷末都设置了附录。附录内容包括：课文译文”“练习<br>Ⅱ、模拟试题参考答案”“练习、模拟试题录音内容”“数、量词搭配使用表”“动词一览表”<br>“句型、表达索引”“总词汇表”“关联词语范畴一览表”“专栏日语译文”“图画词典”等。<br>●“总词汇表”中的动词以基本形的形式给出。<br>●¨数、量词搭配使用表”只收入上册附录。<br>●图画词典用插图和对译的方式介绍基本的动词、一类形容词等，只收入下册附录</li></ul></li></ol><h3 id="各课结构"><a href="#各课结构" class="headerlink" title="各课结构"></a>各课结构</h3><ol><li><p>基本课文 和 应用课文</p><ol><li>基本课文: 一二两个部分<ol><li>单句突出句型</li><li>对话再现句型</li></ol></li><li>应用课文: 实用会话</li></ol></li><li><p>语法解释 与 表达及词语讲解</p><p>“语法解释”和“表达及词语讲解”并置于“基本课文”和“应用课文”之间，以引导学习者加深对本课所学句型、语法项目以及相关表达的理解。关于学习顺序和方法，请参照本书的使用方法一例”（p.XI)</p><ol><li><p>语法解释</p><p>主要解释基本课文中出现的句型和语法项目。有时也涉及应用课文中有关项目，这时候用[人物]表示。</p><ul><li>标题：语法解释”中的标题用以下方式简明扼要地标出。</li></ul><p>下面是标题形式”与其“内容与含义”的对照表。</p><table><thead><tr><th align="left">标题形式</th><th align="left">内容与含义</th></tr></thead><tbody><tr><td align="left">名</td><td align="left">名词</td></tr><tr><td align="left">名[场所]</td><td align="left">表示处所的名词</td></tr><tr><td align="left">名[人]</td><td align="left">表示人的名词</td></tr><tr><td align="left">名[物]</td><td align="left">表示物的名词</td></tr><tr><td align="left">名[时间]</td><td align="left">时间名词</td></tr><tr><td align="left">名[交通工具]</td><td align="left">交通工具名词</td></tr><tr><td align="left">名[工具]</td><td align="left">工具\手段的名词</td></tr><tr><td align="left">名[数量]</td><td align="left">数量的名词</td></tr><tr><td align="left">名[次数]</td><td align="left">次数</td></tr><tr><td align="left">名[附着点]</td><td align="left"></td></tr><tr><td align="left">名[目的地]</td><td align="left"></td></tr><tr><td align="left">名＋の</td><td align="left">名词 + の</td></tr></tbody></table><table><thead><tr><th>形</th><th>一类形容词和二类形容词</th></tr></thead><tbody><tr><td>一类形</td><td>一类形容词</td></tr><tr><td>二类形</td><td>二类形容词</td></tr></tbody></table><table><thead><tr><th>动</th><th>动词</th></tr></thead><tbody><tr><td>一类动</td><td>一类动词</td></tr><tr><td>二类动</td><td></td></tr><tr><td>三类动</td><td></td></tr><tr><td>自动</td><td>自动词</td></tr><tr><td>他动</td><td>他动词</td></tr><tr><td>动(基本形)</td><td>动词的基本形</td></tr><tr><td>动(た形)</td><td></td></tr><tr><td>动(て形)</td><td></td></tr><tr><td>动(ば形)</td><td></td></tr><tr><td>动(意志形)</td><td></td></tr><tr><td>动(基本形/ない形)</td><td></td></tr><tr><td>动(否定)</td><td></td></tr><tr><td>动(简体形)</td><td></td></tr></tbody></table><table><thead><tr><th>小句</th><th>复句中的小句</th></tr></thead><tbody><tr><td>疑问词小句</td><td>包含疑问词的小句</td></tr><tr><td>小句(简体形)</td><td>以简体形结尾的小句</td></tr><tr><td>小句(动词简体形)</td><td>以动词简体形结尾的小句</td></tr><tr><td>小句(一类形/二类形/名)</td><td></td></tr><tr><td>小句(动词基本形/ない形)</td><td></td></tr><tr><td>小句(动词た形/ない形)</td><td></td></tr></tbody></table></li><li><p>表达及词语讲解</p><ul><li>对基本课文及应用课文中出现的需要注意的表达方式、词汇的用法进行讲解说明。应用课文中的有关项目用[人物]表示。讲解说明的原则是密切结合课文的具体内容进行，而不包罗该项目的全部意义和内容。另外，讲解时充分照顾到文化方面的因素。<br>所有例句中的日语汉字都注假名，附汉语翻译。例句当中重要的部分用黑体标出。</li></ul></li></ol></li><li><p>练习</p><ol><li>替换\改变说法等练习巩固基本功. 不设答案</li><li>听解\读解\填空\中译日. 有答案</li></ol></li><li><p>生词表</p><ul><li>生词的选择与排列：<ul><li>除独立词外，寒暄表达、惯用短语以及量词等附属词也一并列出。排列顺序是先将<strong>独立词</strong>按照词类集中排列，然后是<strong>寒暄表达</strong>、<strong>惯用短语</strong>以及<strong>量词</strong>等<strong>附属词</strong>。二者之间用虚线隔开。</li><li>独立词依据<strong>词类集中排列</strong>，词类相同的尽量将意思相近以及有关联的单词集中处理，以利于学习者联想、记忆。专有名词按照人名、地名、公司名称的顺序排列。</li></ul></li><li><strong>标出项目</strong>：<ul><li>独立词以“读法、声调、书写法、词类、汉语翻译”的形式标出。寒暄表达、惯用短语除不标词类一项之外，标出方式和独立词相同。</li></ul></li><li><strong>声调</strong>：<ul><li>如上所示，声调用线条表示。（参照：上册“人门单元”D.14）。</li><li>声调的标注方法参考了NK放送文化研究所幅《NHK日本語凳音了夕七&gt;卜辞典》。</li></ul></li><li><strong>书写法</strong>：生词的书写法在（）内给出。<ul><li>整个单词全部可以用汉字标出的在（）里标出汉字，如上面的“（社員）”。生词的一部分为汉字，一部分为平假名时在（）内两者一起标出，如“（书母）”。另外，“勉強L主寸”等三类动词，用“八老上5L主寸（勉強~）”的形式表示。</li></ul></li><li><strong>词类</strong>：词类及其缩略语如下。<ul><li>名词=名，代词=代，疑问词=疑，一类动词=动1，二类动词=动2，三类动词=动3，一类形容词=形1，二类形容词=形2，副词=副，连体词=连体，连词=连，叹词=叹，专有名词=专</li></ul></li><li><strong>汉语翻译</strong>：对于多义词一般只给出与课文内容相应的译词。</li></ul></li></ol><h3 id="语法体系"><a href="#语法体系" class="headerlink" title="语法体系"></a>语法体系</h3><ol><li><p>与¨学校语法”的对应</p><p>本书采用了不同于“学校语法”的语法体系，以下归纳本书使用的语法术语。</p><p>[动词活用对照表]</p></li></ol><h3 id="符号"><a href="#符号" class="headerlink" title="符号"></a>符号</h3><p>关于书写</p><ul><li>上册采用分写的方式，下册采用一般的方式。</li><li>因日文正式书写规则不用”？”“！”，本书也尽量避免使用该类符号，疑问句后面一般也使用“。”。但在一部分简体句中，为了有效地体现说话人的情感、感觉，也有使用了“?”“！”的地方。</li></ul><h2 id="日语语法-附录"><a href="#日语语法-附录" class="headerlink" title="日语语法 附录"></a>日语语法 附录</h2><p>在整个日语体系当中，按单词的<strong>意义，形态或职能</strong>加以分类，大体上被划分为<strong>十二品词类型</strong>，即名词、数词、代名词、动词、形容词、形容动词、连体词、副词、接续词、感叹词、助动词和助词。<br>按语言结构特点分类，日本语属于黏着语，阿尔泰语系。在语言表达上分为<strong>简体和敬体</strong>，另外有发达的敬语体系。</p><h3 id="语法特点"><a href="#语法特点" class="headerlink" title="语法特点"></a>语法特点</h3><ol><li><p>作为一种基本的结构，典型的日本句子的句式是<strong>主语－宾语－谓语</strong>。</p><ul><li>例如，太郎がりんごを食べた（Tarou ga ringo wo tabeta） 照字面直接的意思是”太郎一个苹果吃了”。</li></ul></li><li><p>当日本人觉着从语境中听者能理解，也就是谈话者或作者自信谈话对象对所谈及的情况有一定了解时，<strong>经常会省略主语或宾语</strong>。</p><ul><li>在这种情况下，上面所讲的那个句子可能会变成，りんごを食べた（ringo wo tabeta）（”吃了一个苹果”）或仅为：食べた（tabeta）（”吃了”）。</li></ul></li><li><p>日语不同于英语中，<strong>词序并不能表明名词在一个句子中的语法作用</strong>。</p><ul><li><p>名词也不像有些语言那样，会因语法需要加以变化。代之，<strong>语法作用是通过名词后面的虚词来表示的</strong>。</p></li><li><p>较重要的是<strong>が（ga）, は（wa）,お（o）,に（ni）和の（no）</strong>。虚词は（wa）特别重要，因为它标志着一个句子的话题或主题。</p></li></ul></li><li><p>日语中的<strong>动词变格不能反映出人称和单复数</strong>。</p><ul><li>在现代语中，所有<strong>动词</strong>在字典中的形式都是<strong>以元音u结尾</strong>。这样，动词“食べる”（taberu）就象英语中”吃”的动词原形”to eat”，尽管它本身实际上是现在时，意思是”eat（吃的动词原形）/eats（吃的第三人称单数）”或者 “will eat”（ 将吃，吃的将来时）。 其它的一些变格形式是“食べない”（tabenai）(“does not eat” or “will not eat”，英语的现在时不吃或将来时不会吃), “食べよう”（tabeyou）(“let‘s eat”or “someone may eat”英语的祈使句让我们吃或某人可吃) “食べたい”（tabetai）(“want/wants to eat”，想吃或单数人称的想吃), “食べた”（tabeta）(“ate”，英语中的过去时，吃过), “食べれば”（tabereba）(if someone eats”，英语的假设句，如果某人吃) 和“食べろ”（tabero） (“eat!”，英语中的命令句吃！) 。</li></ul></li></ol><h3 id="日语的时态"><a href="#日语的时态" class="headerlink" title="日语的时态"></a>日语的时态</h3><p>日语中主要有3种时态：过去时、现在时、将来时。其中，现在时和将来时没有明显的时态标记（即都采用动词原形），要靠动词的种类和上下文的关系区别。因此，从形态上说，我们也可以认为日语的时态分为过去时和非过去时两种。<br>例如：</p><ol><li><strong>过去时：（即带有时态标记“た”）</strong><ol><li>①読んだ（已经完成）对应的英语为“he read” ；<br>②読んでいた（尚未完成）“読んでいた”对应的英语为 “he was reading”（可以这么理解，但不完全是这样。这个更像西班牙语的过去未完成时。）</li></ol></li><li><strong>非过去时：（即不带时态标记“た”）</strong><ol><li>①読む（将要进行/反复恒常的动作） 对应的英语为“he is going to read /he reads”；</li><li>②読んでいる（正在进行）对应的英语为“he is reading”（这种形式用在像“読む”这样的表动作的词上时，可以认为正在进行，用于状态性动词时应该认为是一种已经结束的动作所造成的结果的存续。）</li></ol></li></ol><h3 id="书写"><a href="#书写" class="headerlink" title="书写"></a>书写</h3><p>通常情况下，日语是竖着书写的。不过随着电脑的普及，日语也出现了横向的写法。在书写中，遇到有汉字的词就要写汉字，横写时把对应假名写在汉字上边，竖写时写在汉字右边（日本汉字可不一定全是繁体字，即旧时或现在港台地区所说的“正体字”）。</p><h3 id="标点"><a href="#标点" class="headerlink" title="标点"></a>标点</h3><p>在标点方面，日语的句号、感叹号和省略号与汉语一样，逗号有“，”和“、”两种（同一段话只能用一种）。</p><p>引号使用规则也与汉语一样。</p><p>日语中有问号，不过一般几乎很少使用，使用时一般为简体表现。</p><p>通常情况表示疑问需要在句末加か，句尾仍用句号。</p><p>除逗号、句号外，现代日本还使用以下符号。</p><ol><li>引号「 」 引用句子和书写会话时使用，称作单引号，相当于汉语的引号，日语中不使用“”。</li><li>双引号『 』 在引用句中再次引用时使用，相当于汉语的双引号。</li></ol><h3 id="符号-1"><a href="#符号-1" class="headerlink" title="符号"></a>符号</h3><ol><li>々 — 重叠字符号<br>例：人々、国々、佐々木<br>注：过去中国大陆颁布的第二版简化汉字方案（已废止）也有采用々作为重叠字符号这样的语法。</li><li>~ — 波浪线符号，表示“从……到……”的意思。<br>例：东京<del>大阪 三月</del>五月</li></ol><p>作者：清水君SHIMIZU<br>链接：<a href="https://www.zhihu.com/question/341798682/answer/796392455" target="_blank" rel="noopener">https://www.zhihu.com/question/341798682/answer/796392455</a><br>来源：知乎<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p><p>一，日语语法结构是“主宾谓”。</p><p>わたし<strong>は</strong>りんご<strong>を</strong>食べます。</p><p>（每个词直接落下就是：我 苹果 吃）</p><p>（わたし＝我，りんご＝苹果，食べます＝吃，其他成分则是助词。）</p><p>标黑的部分，就是日语语法的重点“助词”。</p><p>句子被助词分成了三段，每个助词有每个助词的语法意义，但大致分出了主语，宾语和谓语。</p><p>所以日语的一大特点就是动词后置。</p><p>（助词は表示主语，を在动词前使用表示动作的对象宾语）</p><p>二，日语时态问题</p><p>日语时态很简单，不像英语那么复杂。</p><p>按照日本语法的划分，日语动词的时态有“过去”、“现在/未来”两种。</p><p>这里表现为动词本身的变化，如：“する”、“した”（做）</p><p>除此之外所说的各种时态，是借助英语的时态说法来表现，都需要+其他的词汇，</p><p>如：している=して+いる（正在做）</p><p>一般、 将来时：する （做）</p><p>进行时：している （正在做）</p><p>过去时、完成时：した（做过，做完）</p><p>三，黏着问题</p><p>以第一个句子为例：</p><p>わたしはりんごを<strong>食べます</strong>。</p><p>（我吃苹果。）</p><p>加黑部分是动词。</p><p>让我们来变化一下。</p><p>わたしはりんごを（<strong>食べ</strong>る）。</p><p>（我吃苹果。   简体形）</p><p>わたしはりんごを（<strong>食べ</strong>ています）。</p><p>（我正在吃苹果。）</p><p>わたしはりんごを（<strong>食べ</strong>ている）。</p><p>（我正在吃苹果。）简体形</p><p>わたしはりんごを（<strong>食べ</strong>ません）。</p><p>（我没吃苹果）</p><p>わたしはりんごを（<strong>食べ</strong>ない）。</p><p>（我没吃苹果）简体形</p><p>わたしはりんごを（<strong>食べ</strong>ました）。</p><p>（我吃了苹果）</p><p>わたしはりんごを（<strong>食べ</strong>た）。</p><p>（我吃了苹果）简体形</p><p>りんごを（<strong>食べ</strong>てください）。</p><p>（请你吃苹果。）</p><p>词头都没变，就是词尾变了，也就是所谓的黏上去。</p><h2 id="书籍推荐"><a href="#书籍推荐" class="headerlink" title="书籍推荐"></a>书籍推荐</h2><p>书单说明：列出了对我来说肥肠有用的书，其中红色为我觉得必备的<br><strong>1.</strong>《新版中日交流标准日本语初级上、下》人民教育出版社<br><strong>2.</strong>《新版中日交流标准日本语中级上》人民教育出版社<br>3从零快乐学日语语法下/（日）藤井麻里编著<br>4新日本语能力考试N4语法详解附练习解析文照海老原博编著<br><strong>5</strong>新日本语能力测试全力出击N2文字词汇HOLD住芝麻门外语，洪洁编著<br><strong>6</strong>新日本语能力测试全力出击N2语法HOLD住芦芝麻门外语，李占军编著<br>7新日语能力考试全真模拟试题解析版/（日）小池多津著<br>8新日语能力测试N2听力深度解密/总主编刘桂云主编金青华<br><strong>9</strong>新完全掌握日语能力考试N2级阅读/北京语言大学出版社<br><strong>10</strong>新完全掌握日语能力考试N2级听力/北京语言大学出版社<br><strong>11</strong>.历年真题09-16闲鱼购入10元<br>12新日本语能力考试完全解析&amp;模拟试题N2语言知识文字词汇语法/金基范编著<br>13最好考前做过这些题新日语能力考试N2语言知识（文字词汇语法）/（韩李钟权编</p><ul><li>启动阶段五十音背的滚瓜烂熟<br>（必须平假名+片假名一起）<br>了解一些基本的概念<br>比如音读训读，汉字词和语词<br>3.5开始看叶子老师在b站的初级标日课<br>1做随堂笔记<br>2每天复习前一天的笔记和语法<br>3走路听头天的课文和单词（喜马拉雅）<br>4期间还把新东方的教材<br>《从零快乐学日语语法》下册过了一<br>查缺补漏<br>5花一下午边剧剧边过了一遍N4语法书<br>发现自己敬语部分薄弱，恶补加深印象</li><li>4.3学完标日初级，开始自学标日中级<br>4.14放弃课本，开始石语法书、词汇书<br>比较后选择《全力出击》词汇、语法<br>语法200个必背，词汇6000个尽量<br>每天看一篇语法，一篇词汇，并复习下<br>前一天的内容做练习题<br>接续连体词&gt;动词&gt;形容词&gt;名词外来<br>走路听语法（莜）单词（黑皮）<br>选看《完全解析》填补基础沟壑，注重<br>复合词接头接尾多义词<br>515考试周开始日语份额缩水<br>522做了第一套完整题，被血虐<br>《全真模拟试题解析版》<br>发现差距：听力阅读<br>时间紧一不熟练/不集中</li><li>523阅读听力训练兼顾语法词汇<br>《新完全掌握》阅读、听力<br>《听力深度解密》<br>先熟悉题型（了如指掌），再提升素养<br>只做了例题，没有管练习<br>快速形成应试思维方式<br>6.5完成所有196个语法<br>专业课考试瑞不过气暂时放下日语<br>考完一科的当晚做一套真题（2）<br>挤出少量时间做听力训练<br>走路听音频，零碎时间看小D收藏</li><li>630下午四点考完最后一门专业课<br>当晚：一套真题井订正<br>复习《完全解析》<br>7.1下午：复习196个语法（看目录）<br>复习系统性笔记<br>晚上：一套真题并订正<br>《最好考前做过这些题》<br>顺序：副词复合动词其他<br>动词形容词名词<br>72中午进考场前<br>继续看《最好考前做过这些题》</li></ul>]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日语 </tag>
            
            <tag> 语言学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《王菲英语语法 第十四季》学习笔记</title>
      <link href="/2021/06/07/wang-fei-ying-yu-yu-fa/"/>
      <url>/2021/06/07/wang-fei-ying-yu-yu-fa/</url>
      
        <content type="html"><![CDATA[<h1 id="王菲英语语法-第十四季"><a href="#王菲英语语法-第十四季" class="headerlink" title="王菲英语语法 第十四季"></a>王菲英语语法 第十四季</h1><blockquote><p>完整版笔记地址:  <a href="https://github.com/Eished/wfyyyf_notes" target="_blank" rel="noopener">https://github.com/Eished/wfyyyf_notes</a></p></blockquote><h2 id="语法基础概念（10-9-8完美语法体系）"><a href="#语法基础概念（10-9-8完美语法体系）" class="headerlink" title="语法基础概念（10+9+8完美语法体系）"></a>语法基础概念（10+9+8完美语法体系）</h2><h3 id="十种词性"><a href="#十种词性" class="headerlink" title="十种词性"></a><u>十种</u>词性</h3><ol><li>介词 Prepositions</li><li>冠词 Articles</li><li>名词 Nouns</li><li>代词 Pronouns</li><li>数词 Numerals</li><li>副词 Adverbs</li><li>形容词 Adjectives</li><li>动词 Verbs</li><li>连词 Conjunctions</li><li>感叹词（只有叹词没有语法内容）</li></ol><h3 id="九种句子成分"><a href="#九种句子成分" class="headerlink" title="九种句子成分"></a><u>九种</u>句子成分</h3><ol><li>主语 Subject</li><li>谓语 Predicate Verb</li><li>宾语 Object</li><li>表语 Predicative（主语补语）</li><li>双宾 </li><li>宾补 Object Complement</li><li>定语 Attributive</li><li>状语 Adverbial</li><li>同位语 Appositive<h3 id="八种句式"><a href="#八种句式" class="headerlink" title="八种句式"></a><u>八种</u>句式</h3></li></ol><p><strong>五种基本句型源于动词性质</strong></p><ul><li><strong><u>五种</u>基础简单句</strong> Simple Sentence<ol><li>主 + 谓 + 宾</li><li>主 + 系 + 表</li><li>主 + 谓 + 双宾</li><li>主 + 谓 + 宾补</li><li>主 + 谓</li></ol></li><li><strong><u>三种</u>高级复合句</strong> Complex Sentence 复杂句<ol><li>名词性从句<ol><li>主语从句</li><li>宾语从句</li><li>表语从句</li><li>同位语从句</li></ol></li><li>定语从句</li><li>状语从句</li></ol></li></ul><h3 id="王菲语法树"><a href="#王菲语法树" class="headerlink" title="王菲语法树"></a>王菲语法树</h3><ol><li><strong>名词</strong>：<ol><li>单复数 </li><li>所有格 </li><li>主谓一致</li></ol></li><li><strong>代词</strong>：<ol><li>形式 </li><li>含义 </li><li>用法</li></ol></li><li><strong>数词</strong>： <ol><li>基数词 </li><li>序数词</li></ol></li><li><strong>冠词</strong>：<ol><li>定冠词 </li><li>不定冠词 </li><li>零冠词</li></ol></li><li><strong>形容词，副词</strong>：<ol><li>三级 </li><li>固定句型</li></ol></li><li><strong>介词</strong>：<ol><li>用法 </li><li>分类 </li><li>功能 </li><li>固定搭配</li></ol></li><li><strong>动词</strong>：<ol><li>时态 </li><li>语态 </li><li>非谓语动词</li><li>虚拟语气</li><li>独立主格结构</li></ol></li><li><strong>连词</strong>：<ol><li>并列连词</li><li>从属连词（三大从句）</li></ol></li><li><strong>其它</strong>：<ol><li>强调句 </li><li>倒装句 </li><li>反义疑问句</li></ol></li></ol><h3 id="基本概念-简单句（重要）"><a href="#基本概念-简单句（重要）" class="headerlink" title="基本概念 - 简单句（重要）"></a>基本概念 - 简单句（重要）</h3><ol><li><p><strong>陈述句（五种句型）</strong></p><ol><li><strong>主语 + 系动词 + 表语</strong>（系动词后面叫表语）<ul><li>London is the capital of England.</li><li>系动词: <ul><li>be 动词 </li><li>感官动词（与五官相关单词）</li></ul></li></ul></li><li><strong>主语 + 谓语</strong>（动词是<strong>不及物动词</strong>，不能加宾语）<ul><li>I get up early in the morning.</li></ul></li><li><strong>主语 + 谓语 + 宾语</strong><ul><li>I love watermelon.</li><li>表语/宾语本质相同<ul><li><strong>动词后面叫宾语</strong></li><li>两种特殊动词后面叫表语</li></ul></li></ul></li><li><strong>主 + 谓 + 双宾</strong>（直接宾语+间接宾语）<ul><li>The rabbit showed <em>us</em> a <em>carrot</em>.</li><li>改成被动句，会出现两个被动句<ul><li>us 和 carrot 都可以做被动语态的主语</li></ul></li></ul></li><li><strong>主 + 谓 + 宾语 + 宾补</strong><ul><li>They elected <em>Martin</em> their monitor.</li><li>改成被动句只有一个被动句<ul><li>只有 Martin 能做被动语态主语</li></ul></li></ul></li></ol></li><li><p><strong>陈述句形式</strong></p><ol><li><strong>肯定式</strong><ul><li>Honesty is the best policy.</li></ul></li><li><strong>否定式</strong><ul><li>She will not listen to me.</li><li>l don’ t think it right.</li><li>在助动词后面加 not , 不能直接加动词后面</li></ul></li></ol></li><li><p><strong>一般疑问句</strong></p><ul><li>可以用 yes/no 回答</li><li>陈述句变一般疑问句有<strong>三种类型</strong><ol><li><strong>提前系动词</strong><ul><li>陈述句: 主语 + 系动词 + 表语</li><li>疑问句: 系动词 + 主语 + 表语</li><li>You were coming with us. </li><li>Were you coming with us？ -Yes</li></ul></li><li><strong>提前助动词</strong><ul><li>陈述句: 主语 + 谓语 + (宾语)</li><li>疑问句: 助动词 + 主语 + 动词原形 + 其它<ul><li><strong>助动词</strong>: 帮助动词的动词 (完成<strong>语态/时态/疑问/否定</strong>) 无词义</li></ul></li><li>You <em>have found</em> a new job. </li><li><em>Have</em> you <em>found</em> a new job yet？<ul><li>Yes, I have/No, I haven ‘t.</li></ul></li></ul></li><li><strong>提前情态动词</strong><ul><li>陈述句: 主语 + 情态动词 + 动词原形 + 其它</li><li>疑问句: 情态动词 + 主语 + 动词原形 + 其它<ul><li><strong>情态动词</strong>和<strong>助动词</strong>都<strong>不能</strong>单独充当<strong>谓语</strong>, 必须和动词放在一起充当谓语</li><li><strong>情态动词</strong>: 有词义; <strong>助动词</strong>: 无词义</li></ul></li><li>You <em>can solve</em> this problem </li><li><em>Can</em> you <em>solve</em> this problem？<ul><li>Yes I can/No, l can’t.</li></ul></li></ul></li></ol></li></ul></li><li><p><strong>特殊疑问句</strong></p><ol><li><p>以特殊疑问词开头；</p></li><li><p>对句中某一成分提问；</p></li><li><p>不能用 Yes/No 进行回答</p><table><thead><tr><th>Who - 提问人</th><th>Where - 提问地点</th></tr></thead><tbody><tr><td>Whose - 提问所属</td><td>Why - 提问原因</td></tr><tr><td>Whom - 提问宾格人</td><td>How - 提问方式或数量</td></tr><tr><td>What - 提问事情或属性</td><td>How much/many - 提问数量</td></tr><tr><td>When - 提问时间</td><td>Which - 提问选择</td></tr></tbody></table><p>特殊疑问句 例句1</p><ul><li>Who were you on the phone with？</li><li>Jim.</li></ul><p>特殊疑问句 例句2</p><ul><li>Whom is he dating？</li><li>He is dating Anna.</li></ul></li></ol></li><li><p><strong>选择疑问句</strong></p><ol><li><p>选择疑问句<strong>用 or 连接</strong>；</p></li><li><p>提出两个或两个以上的句式供选择；</p></li><li><p>选择疑问句不能用 Yes/No 回答。</p><p>选择疑问句 例句1</p><ul><li>Do you like chocolate or vanilla better？</li></ul><p>选择疑问句 例句2</p><ul><li>Are you going to drive or do you want me to？</li></ul></li></ol></li><li><p><strong>反义疑问句</strong></p><ol><li><p>陈述句部分是<strong>肯定句</strong>，疑问句部分用<strong>否定句</strong>；</p></li><li><p>陈述句部分是<strong>否定句</strong>，反意疑问句用<strong>肯定句</strong>。</p><p><strong>前肯后否；前否后肯</strong></p><p><strong>反义疑问句</strong> 例句</p><ul><li>He is your teacher, isn’t he?</li><li>You found the key in the bedroom, didn’t you？</li><li>The boy has to clean his room, doesn’t he?</li></ul></li><li><p><strong>感叹句</strong>的反义疑问句</p><ul><li>一律用<strong>否定式提问</strong></li><li>What a clever boy, isn’t he?</li><li>What a lovely day, isn’t it？</li></ul></li><li><p><strong>祈使句</strong>的反义疑问句</p><ul><li>用 <strong>will you</strong></li><li>Let’s 开始, 用 <strong>shall we</strong></li></ul></li><li><p><strong>含 must</strong> 的反义疑问句</p><ul><li><strong>表“必须”</strong>：反意疑问句为 mustn’t…？/ needn’t…?<ul><li>He <u>must</u> study hard at English, mustn ‘t he？/neednt he?</li></ul></li><li><strong>表推测“一定，肯定”</strong>：反意疑问句与 must 后面的<strong>动词</strong>呼应<ul><li>You <u>must</u> be joking, aren’t you?</li></ul></li></ul></li><li><p><strong>含否定词</strong>的反义疑问句</p><ul><li>常见否定词：hardly; never; seldom; little; few; nowhere; nothing 等</li><li>反意疑问句用<strong>肯定提问</strong>。<ul><li>Frank <u>hardly</u> goes to parties, does he?</li><li>He has <u>few</u> triends, has he?</li></ul></li></ul></li><li><p><strong>复合句</strong>的反义疑问句</p><ul><li>复合句的反意疑问句都<strong>对主句提问</strong>。<ul><li>复合句: 两个以上句子构成, 从句连词的三大从句</li></ul></li><li><u>He was punished</u> <em>because</em> he violated the regulation, wasn ‘t he？</li><li>You never told me <em>that</em> you had been ill, did you?</li></ul></li><li><p><strong>宾语从句</strong>的反义疑问句</p><ul><li>I don’ t think/ suppose/ believe/ imagine 引导的<strong>宾语从句</strong>，反意疑问句应<strong>与从句的主语，谓语部分一致</strong>，用<strong>肯定式的提问</strong>。<ul><li>中英文否定词位置不一致, 否定词转移</li></ul></li><li>I don’ t <u>suppose anyone</u> will volunteer, will they?<ul><li>我相信没人会做 否定词属于后面从句</li></ul></li><li>I don’ t <u>believe she</u> has done it, has she?<ul><li>我相信她没做这件事, 否定词属于后面从句</li></ul></li></ul></li></ol></li><li><p><strong>感叹句</strong></p><ol><li><strong>What 感叹句</strong><ol><li>What + a/an + 形容词 + <strong>可数名词单数</strong> + [主语 + 谓语]！</li><li>What + a/an + <strong>名词</strong> + 主语 + 谓语！</li><li>What + 形容词 + <strong>不可数名词/复数名词</strong> + [主语 + 谓语]！<ul><li>What a marvelous sight!</li></ul></li></ol></li><li><strong>How 感叹句</strong><ol><li>How + <strong>形容词/副词</strong> + [主语 + 谓语]！</li><li>How + <strong>形容词</strong> + a/an + 可数名词单数 + [主语 + 谓语]!<ul><li>How noble of him to do that !</li><li>How intelligent you are！</li></ul></li></ol></li><li><strong>语气词/感叹号</strong><ul><li>Oh, I am depressed!</li><li>I cannot survive without you!</li></ul></li></ol></li><li><p><strong>祈使句</strong></p><p><strong>没有主语, 通常用动词开头</strong></p><ol><li>表示命令<ul><li>Please sit down.</li><li>Leave this place at once.</li></ul></li><li>表示请求或祝愿<ul><li>Have a safe trip！</li><li>Let’s go for a walk.</li></ul></li></ol></li></ol>]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 语言学习 </tag>
            
            <tag> 英语 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《被讨厌的勇气：自我启发之父 阿德勒的哲学课》读书笔记</title>
      <link href="/2020/06/09/bei-tao-yan-de-yong-qi/"/>
      <url>/2020/06/09/bei-tao-yan-de-yong-qi/</url>
      
        <content type="html"><![CDATA[<h2 id="一、评价与启发"><a href="#一、评价与启发" class="headerlink" title="一、评价与启发"></a>一、评价与启发</h2><h3 id="1）评价"><a href="#1）评价" class="headerlink" title="1）评价"></a>1）评价</h3><p>整本书注重于主观能动性，观点浅显易懂，否定原因论和精神分析，认为意识与过去无关，一切都是人的主观选择。</p><p>我觉得应该原因论与目的论相结合，书中理论逻辑才能自洽，肯定客观世界影响的同时，进行积极的自我暗示增强自信，然后做出行动得到认可获得更多自信，从而改变自己。</p><p>书的标题也可以验证这一说法：”被讨厌的勇气“，翻译过来就是”不求所有人认可的自信“。假设存在一个不被任何人认可的人，那么他必须先有自信（被认可），才能有”不求所有人认可的自信“。</p><p>原因论分析自我后能更好的接纳自我，本来自信的人刚好不需要这个过程，所以书的受众是本来自信的人。其它人则需要原因论分析自我后，先接纳自我、建立自信。</p><p>就像这位豆瓣网友所说，</p><blockquote><p>豆瓣网友：有评价说这种理论的局限性之一，就是“并非所有有缺陷的人都能得到积极的补偿。其补偿作用只适合用在缺陷者本身有足够的自信，并有外在支持的力量，才能发生理想的‘优越感’”，并且“解释太过消极，忽略了人尚有积极的支配欲”。</p><p>所以平日就活得很丧的人看完还是会很丧，但是对于正在积极建设自己心理的我来说，的确帮助很大。</p></blockquote><h3 id="2）启发"><a href="#2）启发" class="headerlink" title="2）启发"></a>2）启发</h3><p>最重要的启发在自信与人际关系的联系。</p><p>人想要改变就要获得自信，获得自信要获得他人认同、对他人有价值，让自己的价值在社会流通，从而获得更多的认同。</p><p>所以人际关系是人想要改变的充要条件，也是人能够改变的充要条件。</p><p><strong>不能逃避人际关系，想要改变就要接受更多的人际关系。</strong></p><p>人际关系的本质是认同感的交流、价值的交流。</p><h2 id="二、原文和想法"><a href="#二、原文和想法" class="headerlink" title="二、原文和想法"></a>二、原文和想法</h2><blockquote><p>原文：决定我们自身的不是过去的经历，而是我们自己赋予经历的意义</p></blockquote><p>想法：人的自我是由过去和环境所决定的，经历的意义是环境决定的。同一件事所处环境不同，意义便不同。主观能动可以影响自身而不能决定。</p><blockquote><p>原文：所谓愤怒其实只是可放可收的一种“手段”而已。</p></blockquote><p>想法：所有的情绪都是达成目的手段？婴儿有没有愤怒这种手段？愤怒是后天学习的表达方式，不属于先天性情绪。愤怒源于对事物或自我不可控的恐惧。恐惧=&gt;愤怒。例如动物对入侵者的威慑，入侵者危害到自身安全出于生存本能恐惧，从而做出威慑来自我保护。</p><blockquote><p>原文：青年：总而言之，您的主张还是以“人是可以改变的”为前提的吧？哲人：当然。否定我们人类的自由意志、把人看作机器一样的存在，这是弗洛伊德式的原因论</p></blockquote><p>想法：人的自由意志来自于人类自身，人类自身的自我意识来自于社会，自由意志不能脱离人类社会而存在。也就是说，人无法没有原因的改变。</p><blockquote><p> 原文：我们“并不是为了满足别人的期待而活着“</p></blockquote><p>想法：不要过于追求认可欲求</p><blockquote><p> 原文：阿德勒心理学认为“一切烦恼皆源于人际关系”。也就是说，我们都在追求从人际关系中解放出来的自由。但是，一个人在宇宙中生存之类的事情根本不可能。</p></blockquote><p>想法：不可能从人际关系解放</p><blockquote><p>原文：“自由就是被别人讨厌”。</p></blockquote><p>想法：自由=否定（认可欲求=不想被任何人讨厌），课题分离，分解扬弃人际关系。</p><blockquote><p>原文：“认可欲求”这个词，总而言之就是不想被任何人讨厌。</p></blockquote><p>想法：认可=不讨厌，不认可=讨厌，认可欲求=不想被任何人讨厌</p><blockquote><p>原文：阿德勒反对把精神和身体、理性和感情以及意识和无意识等分开考虑的一切二元论的价值观。</p></blockquote><p>想法：混沌的说法就无法验证。</p><blockquote><p>原文：把他人看作伙伴并能够从中感到“自己有位置”的状态，就叫共同体感觉。</p></blockquote><p>想法：有归属感的集体=&gt;共同体感觉</p><blockquote><p>原文：归属感不是生来就有的东西，要靠自己的手去获得。</p></blockquote><p>想法：归属感=认同自己并对自己有价值的集体</p><p>主动去寻找认同自己并对自己有价值的集体=获得共同体感觉 </p><blockquote><p>原文：活在害怕关系破裂的恐惧之中，那是为他人而活的一种不自由的生活方式</p></blockquote><p>想法：人是社会关系的总和，人无法脱离社会关系，不存在绝对自由的生活方式，只存在相对自由的生活方式，因此为他人而活也是一种自由，活在恐惧之中也是一种自由。 人为什么会寻求改变？寻求改变的源动力来自于社会关系。</p><blockquote><p>原文：阿德勒心理学反对一切“纵向关系”，提倡把所有的人际关系都看作“横向关系”。在某种意义上，这可以说是阿德勒心理学的基本原理。</p></blockquote><p>想法：人人平等 相互尊重，人的认知不同就不会平等，相互尊重的共同认知可以做到。相互尊重可以减少认可欲求</p><blockquote><p>原文：表扬这种行为含有“有能力者对没能力者所做的评价”这方面的特点。</p></blockquote><p>想法：赞扬和批评的定义过于模糊。如果不能批评不能赞扬如何分辨客观是非对错。</p><blockquote><p>原文：人只有在能够感觉自己有价值的时候才可以获得勇气。</p></blockquote><p>想法：勇气=自信，自信来自于价值，价值来自于他人的认同，人只有在被认同时才可以获得自信。</p><p>被表扬或批评会影响价值从而影响自信，因为价值来自于他人的认同。他人的认同来自于共同体，共同体是让自己有归属感的集体，归属感是自己认同的集体，所以共同体=对自己有价值的集体。</p><p>推导出=&gt;人只有在被对自己有价值的集体肯定时才可以获得自信。</p><blockquote><p>原文：按照存在标准来考虑的话，我们仅仅因为“存在于这里”，就已经对他人有用、有价值了，这是不容怀疑的事实。</p></blockquote><p>想法：存在只有使用价值，并不会带来商品的价值，而是过去的劳动创造了自己商品的价值。婴儿的存在是否有价值，父母的劳动创造了婴儿的价值。婴儿不是自然独立的存在，而是人类的产物。对于婴儿的自我感知，婴儿会因他人的认可而认为自己有价值，得不到认可则会认为自己没有价值。而人是社会关系的总和，对于社会任何人都有价值。</p><blockquote><p>原文：只要存在着，就有价值</p></blockquote><p>想法：商品的二重性（注释1），有使用价值，没有价值，不是商品。不是商品，对他人没有价值。对他人没有价值，不属于他人的共同体。不属于他人的共同体，无法获得认同就无法获得自信（勇气）。</p><p>人想要改变就要获得自信，获得自信要获得他人认同、对他人有价值，让自己的价值在社会流通，从而获得更多的肯定。</p><p>人际关系是人想要改变的充要条件，也是人能够改变的充要条件。</p><blockquote><p>注释1：马哲对商品价值的定义   </p><ol><li>使用价值是一种物品能够满足人们某种需要的属性，即物品的有用性。使用价值是商品的自然属性，它是由物品的物理、化学、生物等特性所决定的。  </li><li>价值是无差别的一般人类劳动的凝结，形成商品的价值。商品的价值在质上是相同的，只有量的差别，因而可以相互比较。价值反映商品生产者之间的关系，是商品的社会属性。</li></ol></blockquote><blockquote><p>原文：并不是说将任何人都变成朋友或者像对待朋友一样去对待每一个人，不是这样的，重要的是意识上的平等以及坚持自己应有的主张</p></blockquote><p>想法：平等是相对的、相互的；意识上完全人人平等很难到，意识上相互尊重容易做到。</p><blockquote><p>原文：接受不能更换的事物，接受现实的“这个我”，然后，关于那些可以改变的事情，拿出改变的“勇气”。这就是自我接纳。</p></blockquote><p>想法：如何确定不能更换的事物和现实的我，这个“不能更换”、“现实”都是由自我定义的，人类自身的自我意识来自于社会，自信来自于社会对自己有价值的集体肯定，形成社会决定论闭环。主观能动让自我有了全新的认知，这是不接受现实的结果。这句话表达自我范围内的接纳，但起决定作用的是社会。</p><blockquote><p>原文：在相信他人的时候不附加任何条件。即使没有足以构成信用的客观依据也依然相信，不考虑抵押之类的事情，无条件地相信。这就是信赖。</p></blockquote><p>想法：不存在无条件的相信，相信都存在原因。他者信赖不存在。</p><blockquote><p>原文：青年：信赖的反义词？……哎哎，这个……</p><p>哲人：是怀疑。假设你把人际关系的基础建立在“怀疑”之上。怀疑他人、怀疑朋友、甚至怀疑家人或恋人，生活中处处充满怀疑。那么，这样究竟会产生什么样的关系呢？对方也能够瞬时感觉到你怀疑的目光，会凭直觉认为“这个人不信赖我”。你认为这样还能建立起什么积极的关系吗？只有我们选择了无条件的信赖，才可以构筑更加深厚的关系。</p></blockquote><p>想法：没有怀疑哪有信赖。怀疑是生存本能恐惧的表现。</p><blockquote><p>原文：如果不敢去信赖别人，那最终就会与任何人都建立不了深厚的关系</p></blockquote><p>想法：怀疑到信赖是一个必然的获得信赖的过程</p><blockquote><p>原文：对作为伙伴的他人给予影响、作出贡献，这就是他者贡献。</p></blockquote><blockquote><p>原文：他者贡献并不是舍弃“我”而为他人效劳，它反而是为了能够体会到“我”的价值而采取的一种手段。</p></blockquote><blockquote><p>原文：青年：您是说工作的本质是对他人的贡献？</p><p>哲人：当然，赚钱也是一个重大要素。正如你之前查到的陀思妥耶夫斯基所说的“被铸造的自由”一样。但是，有些富豪已经拥有了一生也花不完的巨额财产，但他们中的多数人至今依然继续忙碌工作着。为什么要工作呢？是因为无底的欲望吗？不是。这是为了他者贡献继而获得“可以在这里的”归属感。获得巨额财富之后便致力于参加慈善活动的富豪们，也为了能够体会自我价值、确认“可以在这里”的归属感而进行着各种各样的活动。</p></blockquote><p>想法：利他的本质是利己</p><blockquote><p>原文：</p><p>哲人：为了方便起见，前面我一直按照自我接纳、他者信赖、他者贡献这种顺序来进行说明。</p><p>但是，这三者是缺一不可的整体。正因为接受了真实的自我——也就是“自我接纳”——才能够不惧背叛地做到“他者信赖”；</p><p>而且，正因为对他人给予无条件的信赖并能够视他人为自己的伙伴，才能够做到“他者贡献”；</p><p>同时，正因为对他人有所贡献，才能够体会到“我对他人有用”进而接受真实的自己，做到“自我接纳”。</p><p>你前些天做的笔记还带着吗？</p><p>青年：啊，是那个关于阿德勒心理学所提出的目标的笔记吧。自那天之后我就一直随身携带。</p><p>在这里。</p><p>行为方面的目标：①自立。②与社会和谐共处。</p><p>支撑这种行为的心理方面的目标：①“我有能力”的意识。②“人人都是我的伙伴”的意识。</p><p>哲人：如果把这个笔记与刚才的话结合起来看，应该能够理解得更加深刻。</p><p>也就是说，①所说的“自立”与“我有能力的意识”是关于自我接纳的话题。</p><p>另一方面，②所说的“与社会和谐共处”和“人人都是我的伙伴的意识”则与他者信赖和他者贡献有关。</p></blockquote><p>想法：融入社会</p><blockquote><p>原文：哲人：对人而言，最大的不幸就是不喜欢自己。对于这种现实，阿德勒准备了极其简单的回答——“我对共同体有益”或者“我对他人有用”这种想法就足以让人体会到自己的价值。</p></blockquote><p>想法：对于社会每个人都有价值</p><blockquote><p>原文：哲人：因为过去和未来根本不存在，所以才要谈现在。起决定作用的既不是昨天也不是明天，而是“此时此刻”。</p></blockquote><p>想法：活在当下</p><blockquote><p>原文：哲人：所以阿德勒在说了“并不存在普遍性的人生意义”之后还说：“人生意义是自己赋予自己的。”</p></blockquote><p>想法：不要活在别人的期待中，为自己而活</p><blockquote><p>原文：“我的力量无穷大”。</p></blockquote><blockquote><p>原文：如果“我”改变，“世界”就会改变。世界不是靠他人改变而只能靠“我”来改变。</p></blockquote><p>想法：自我暗示，加强自信心</p>]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 哲学 </tag>
            
            <tag> 心理学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTML5与CSS3实现动态网页</title>
      <link href="/2020/06/08/html5-yu-css3-shi-xian-dong-tai-wang-ye/"/>
      <url>/2020/06/08/html5-yu-css3-shi-xian-dong-tai-wang-ye/</url>
      
        <content type="html"><![CDATA[<h1 id="HTML5与CSS3实现动态网页"><a href="#HTML5与CSS3实现动态网页" class="headerlink" title="HTML5与CSS3实现动态网页"></a>HTML5与CSS3实现动态网页</h1><h2 id="步骤1-初识HTML5"><a href="#步骤1-初识HTML5" class="headerlink" title="步骤1: 初识HTML5"></a>步骤1: 初识HTML5</h2><pre><code>本阶段内容主要涵盖H5新增、删除标签、标签属性变化以及HTML5布局知识。通过本阶段学习，大家可以运用HTML5标签轻松实现网页音乐播放器和视频播放器，熟练运用HTML5的语义化标签进行静态网页的开发。</code></pre><ul><li><p>HTML5 ≈ HTML + CSS + JS + API</p></li><li><h4 id="学前准备："><a href="#学前准备：" class="headerlink" title="学前准备："></a>学前准备：</h4><p>​    了解HTML基本知识<br>​    具备CSS基础<br>​    熟练使用JavaScript</p></li><li><h4 id="移动互联网-HTML5-的优势"><a href="#移动互联网-HTML5-的优势" class="headerlink" title="移动互联网 HTML5 的优势"></a>移动互联网 HTML5 的优势</h4><ul><li>跨平台<ul><li>HTML5 是唯一通吃PC、Mac、iPhone、Android等主流平台的语言</li></ul></li><li>快速迭代<ul><li>互联网产品大多免费、且有网络效应，后来者抢夺用户难度非常大</li></ul></li><li>减低成本<ul><li>HTML5 开发比原生APP开发成本低一半</li></ul></li><li>导流入口多<ul><li>HTML5 应用导流非常容易</li></ul></li></ul></li><li><h4 id="Web-改变趋势"><a href="#Web-改变趋势" class="headerlink" title="Web 改变趋势"></a>Web 改变趋势</h4><ul><li>Native APP → WebApp → Hybrid App</li><li>PC → 移动 → 智慧互联</li></ul></li><li><h4 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h4><ul><li>掌握新标签以及新属性的功能特点，并熟练应用</li><li>了解HTML5的前景及学习展望</li><li>明确未来的学习目标和深入学习的方向</li><li>为移动前端打好基础</li></ul></li></ul><h3 id="第1课-HTML5标签变化"><a href="#第1课-HTML5标签变化" class="headerlink" title="第1课 HTML5标签变化"></a>第1课 HTML5标签变化</h3><pre><code>    HTML5标签变化    HTML5文档类型如何定义，有哪些标签，以及如何使用，从整体认识HTML5    DTD、新增的标签、删除的标签、重定义标签</code></pre><ul><li><p>HTML <code>&lt;!DOCTYPE&gt;</code> 标签</p><ul><li><p>定义和用法：</p><ul><li>版本声明，在文档的第一行</li></ul></li><li><p>不是 HTML 标签</p></li><li><p>常用声明：</p><blockquote><h3 id="HTML-4-01-Strict"><a href="#HTML-4-01-Strict" class="headerlink" title="HTML 4.01 Strict"></a>HTML 4.01 Strict</h3><p>该 DTD 包含所有 HTML 元素和属性，但不包括展示性的和弃用的元素（比如 font）。不允许框架集（Framesets）。</p><pre><code>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot; &quot;http://www.w3.org/TR/html4/strict.dtd&quot;&gt;</code></pre><h3 id="HTML-4-01-Transitional"><a href="#HTML-4-01-Transitional" class="headerlink" title="HTML 4.01 Transitional"></a>HTML 4.01 Transitional</h3><p>该 DTD 包含所有 HTML 元素和属性，包括展示性的和弃用的元素（比如 font）。不允许框架集（Framesets）。</p><pre><code>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</code></pre><h3 id="HTML-4-01-Frameset"><a href="#HTML-4-01-Frameset" class="headerlink" title="HTML 4.01 Frameset"></a>HTML 4.01 Frameset</h3><p>该 DTD 等同于 HTML 4.01 Transitional，但允许框架集内容。</p><pre><code>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Frameset//EN&quot; &quot;http://www.w3.org/TR/html4/frameset.dtd&quot;&gt;</code></pre></blockquote></li></ul></li><li><p>文档类型定义（DTD)</p><ul><li>DTD：定义合法的 XML 文档构建模块，它使用一系列合法元素来定义文档结构</li><li>HTML 中的 DTD：规定了标记语言的规则，浏览器才能正确的显示内容</li><li>HTML5 中的 DTD：HTML5 不基于 SGML，所以不需要引用 DTD</li><li>HTML 元素和文档类型：<a href="http://www.w3school.com.cn/tags/html_ref_dtd.asp" target="_blank" rel="noopener">www.w3school.com.cn/tags/html_ref_dtd.asp</a></li></ul></li></ul><h4 id="新增的标签"><a href="#新增的标签" class="headerlink" title="新增的标签"></a>新增的标签</h4><h5 id="结构标签"><a href="#结构标签" class="headerlink" title="结构标签"></a>结构标签</h5><ul><li>块状元素，有意义的 div</li></ul><table><thead><tr><th>标签</th><th>描述</th></tr></thead><tbody><tr><td><code>&lt;header&gt;</code></td><td>定义了一个页面或一个头部区域</td></tr><tr><td><code>&lt;nav&gt;</code></td><td>定义导航栏链接</td></tr><tr><td><code>&lt;section&gt;</code></td><td>定义一个区域</td></tr><tr><td><code>&lt;aside&gt;</code></td><td>定义页面内容部分的侧边栏</td></tr><tr><td><code>&lt;hgroup&gt;</code></td><td>定义文件中一个区块的相关信息</td></tr><tr><td><code>&lt;figure&gt;</code></td><td>定义一组媒体内容以及他们的标题</td></tr><tr><td><code>&lt;figcaption&gt;</code></td><td>定义 figure 元素的标题</td></tr><tr><td><code>&lt;footer&gt;</code></td><td>定义一个页面或一个区域的底部</td></tr><tr><td><code>&lt;article&gt;</code></td><td>定义一篇文章</td></tr><tr><td><code>&lt;dialog&gt;</code></td><td>定义一个会话框，类似微信</td></tr></tbody></table><ul><li>标签嵌套级别：header / section / footer &gt; aside / article / figure / hgroup / nav &gt; div / figcaption</li></ul><h5 id="多媒体标签"><a href="#多媒体标签" class="headerlink" title="多媒体标签"></a>多媒体标签</h5><ul><li>三类媒体标签</li></ul><table><thead><tr><th>标签</th><th>描述</th></tr></thead><tbody><tr><td><code>&lt;video&gt;</code></td><td>定义一个视频</td></tr><tr><td><code>&lt;audio&gt;</code></td><td>定义音频内容</td></tr><tr><td><code>&lt;source&gt;</code></td><td>定义媒体资源</td></tr><tr><td><code>&lt;canvas&gt;</code></td><td>定义画布</td></tr><tr><td><code>&lt;embed&gt;</code></td><td>定义外部的可交互的内容或插件，如：flash</td></tr></tbody></table><ul><li>默认属性：<code>controls=&quot;controls&quot; width=&quot;200px&quot; autoplay=&quot;autoplay&quot; loop=&quot;-1&quot;</code></li><li>标签的意义：多媒体标签的出现意味着富媒体的发展以及支持不使用插件的情况下操作媒体文件，极大的提高可用户体验</li></ul><h5 id="Web-应用标签"><a href="#Web-应用标签" class="headerlink" title="Web 应用标签"></a>Web 应用标签</h5><ul><li><h5 id="状态标签："><a href="#状态标签：" class="headerlink" title="状态标签："></a>状态标签：</h5><table><thead><tr><th>标签</th><th>描述</th></tr></thead><tbody><tr><td><code>&lt;meter&gt;</code></td><td>状态标签（实时状态显示：气压、气温）</td></tr><tr><td><code>&lt;progress&gt;</code></td><td>状态标签（任务过程：安装、加载）</td></tr></tbody></table><ul><li>浏览器兼容：</li></ul><table><thead><tr><th>标签</th><th>兼容性</th></tr></thead><tbody><tr><td><code>&lt;meter&gt;</code></td><td>Chrome、Opera</td></tr><tr><td><code>&lt;progress&gt;</code></td><td>Chrome、FireFox、Opera</td></tr></tbody></table></li><li><h5 id="列表标签"><a href="#列表标签" class="headerlink" title="列表标签"></a>列表标签</h5><table><thead><tr><th>标签</th><th>描述</th></tr></thead><tbody><tr><td><code>&lt;datalist&gt;</code></td><td>为 <code>input</code> 标记定义一个下拉列表，配合 <code>option</code></td></tr><tr><td><code>&lt;details&gt;</code></td><td>标记定义一个元素的详细内容，配合 <code>summary</code></td></tr></tbody></table><ul><li>浏览器兼容</li></ul><table><thead><tr><th>标签</th><th>兼容性</th></tr></thead><tbody><tr><td><code>&lt;datalist&gt;</code></td><td>FireFox、Opera</td></tr><tr><td><code>&lt;datails&gt;</code></td><td>Chrome</td></tr></tbody></table></li><li><h5 id="Menu-标签"><a href="#Menu-标签" class="headerlink" title="Menu 标签"></a>Menu 标签</h5><table><thead><tr><th>标签</th><th>描述</th></tr></thead><tbody><tr><td><code>&lt;menu&gt;</code></td><td>命令列表（<strong>目前所有浏览器不支持</strong>）</td></tr><tr><td><code>&lt;menuitem&gt;</code></td><td>menu 命令列表标签（只有 FireFox8.0+ 支持）</td></tr><tr><td><code>&lt;command&gt;</code></td><td>menu 标记定义一个命令按钮（只有 IE9 支持）</td></tr></tbody></table></li></ul><h5 id="其它标签"><a href="#其它标签" class="headerlink" title="其它标签"></a>其它标签</h5><ul><li><p>注释标签</p><table><thead><tr><th>标签</th><th>描述</th></tr></thead><tbody><tr><td><code>&lt;ruby&gt;</code></td><td>定义注释或音标</td></tr><tr><td><code>&lt;rt&gt;</code></td><td>定义对ruby的注释内容文本</td></tr><tr><td><code>&lt;rp&gt;</code></td><td>告诉不支持的浏览器如何去显示</td></tr></tbody></table></li><li><p><code>&lt;mark&gt;</code> ：定义有标记的文本（黄色选中显示）</p><ul><li>兼容IE9以上所有浏览器</li></ul></li><li><p><code>&lt;output&gt;</code> ：定义一些输出类型，计算表单结果配合 <code>oninput</code> 事件</p></li><li><p><code>&lt;keygen&gt;</code> ：定义表单里一个生成的键值（加密信息传送）</p></li><li><p><code>&lt;time&gt;</code> ：定义一个日期/事件，目前所有主流浏览器都不支持</p></li></ul><h4 id="删除的标签"><a href="#删除的标签" class="headerlink" title="删除的标签"></a>删除的标签</h4><ul><li>纯表现的元素<ul><li>basefont、big、center、font、s、strike、tt、u</li></ul></li><li>对可用性产生负面影响的元素<ul><li>frame、frameset、noframes</li></ul></li><li>产生混淆的元素<ul><li>acronym、applet、isindex、dir</li></ul></li></ul><h4 id="重定义标签"><a href="#重定义标签" class="headerlink" title="重定义标签"></a>重定义标签</h4><ul><li><p>显示不变，表达的含义进行了重新定义的标签</p><table><thead><tr><th>标签</th><th>描述</th></tr></thead><tbody><tr><td><code>&lt;b&gt;</code></td><td>代表内联文本，通常是粗体，没有传递表示重要的意思</td></tr><tr><td><code>&lt;i&gt;</code></td><td>代表内联文本，通常是斜体，没有传递表示重要的意思</td></tr><tr><td><code>&lt;dd&gt;</code></td><td>可以同details于figure以前使用，定义包含文本，dialog也可以用</td></tr><tr><td><code>&lt;dt&gt;</code></td><td>可以同details于figure以前使用，汇总细节，dialog也可以用</td></tr><tr><td><code>&lt;hr&gt;</code></td><td>表示主题结束，而不是水平线，虽然显示相同</td></tr><tr><td><code>&lt;menu&gt;</code></td><td>重新定义用户界面菜单，配合commond或者menitem使用</td></tr><tr><td><code>&lt;small&gt;</code></td><td>表示小字体，例如打印注释或者法律条款</td></tr><tr><td><code>&lt;strong&gt;</code></td><td>表示重要性而不是强调符号</td></tr></tbody></table></li></ul><h3 id="第2课-HTML5网页布局"><a href="#第2课-HTML5网页布局" class="headerlink" title="第2课 HTML5网页布局"></a>第2课 HTML5网页布局</h3><pre><code>    HTML5网页布局    传统布局与HTML5网页布局的区别和意义，通过案例讲解如何使用HTML5搭建网页</code></pre><h4 id="传统布局与HTML5布局"><a href="#传统布局与HTML5布局" class="headerlink" title="传统布局与HTML5布局"></a>传统布局与HTML5布局</h4><h4 id="新布局的意义"><a href="#新布局的意义" class="headerlink" title="新布局的意义"></a>新布局的意义</h4><ul><li>语义化<ul><li>HTML5 可以让更语义化的结构化代码标签代替大量的无意义的 div 标签<ul><li>这种语义化特性提升了网页的质量和语义</li><li>减少了以前用于 CSS 调用的 class 和 id 属性</li></ul></li><li>对搜索引擎更友好<ul><li>新的架构标签带来的是网页布局的改变，即提升搜索引擎的友好</li></ul></li></ul></li></ul><h3 id="第3课-HTML5属性变化"><a href="#第3课-HTML5属性变化" class="headerlink" title="第3课 HTML5属性变化"></a>第3课 HTML5属性变化</h3><pre><code>    HTML5属性变化    了解这些属性带来的好处，加深对标签的认识，将提高以后的开发效率    input、表单属性、链接属性、其它属性 </code></pre><h4 id="input-属性"><a href="#input-属性" class="headerlink" title="input 属性"></a>input 属性</h4><ul><li>email 、url、number、tel ：手机端输入法有效果</li><li>Date picker 类型：<ul><li>Date：选取日、月、年</li><li>Mouth：选取月、年</li><li>Week：选取周、年</li><li>Time：选取时间（小时、分钟）</li><li>Datetime：选取时间、日、月、年（utc时间），safari opera兼容</li><li>Datetime-local：选取使时间、日、月、年（本地时间）chrome safari opera兼容</li></ul></li><li>range 类型：取值范围，<code>&lt;input type=&quot;range&quot; name=&quot;range&quot; min=&quot;1&quot; max=&quot;10&quot;&gt;</code></li><li>search 类型：带清空的输入框，<code>&lt;input type=&quot;search&quot; name=&quot;search&quot;&gt;</code></li><li>color 类型：取色器，<code>&lt;input type=&quot;color&quot; name=&quot;color&quot;&gt;</code></li></ul><h4 id="表单属性"><a href="#表单属性" class="headerlink" title="表单属性"></a>表单属性</h4><ul><li>autocomplete 属性：<ul><li><code>form</code> 或 <code>input</code> 域应该拥有自动完成功能</li><li><code>&lt;form autocomplete=&quot;on&quot;&gt;&lt;/form&gt;</code></li><li>autocomplete 适用于 <code>&lt;form&gt;</code> 标签，以及以下类型的 <code>&lt;input&gt;</code> 标签：<ul><li>text、search、url、telephone、email、password、datepickers、range、color</li></ul></li></ul></li><li><code>autofocus=&quot;autofocus&quot;</code> 属性：<ul><li>页面加载时，域自动获得焦点</li><li><code>&lt;input type=&quot;text autofocus=&quot;autofocus&quot;&gt;</code></li><li>适用于所有 input 标签</li></ul></li><li>multiple 属性：<ul><li>规定输入域中可以选择多个值</li><li><code>&lt;input type=&quot;text multiple=&quot;multiple&quot;&gt;</code></li><li>适用于email、file类型 input标签</li></ul></li><li>placeholder 属性：<ul><li>提供一种提示（hint），描述输入域所期待的值</li><li><code>&lt;input type=&quot;search&quot; placeholder=&quot;Search Content&quot;</code></li><li>适用于 input 标签 type 属性为：<ul><li>text、search、url、telephone、email、password</li></ul></li></ul></li><li>required 属性：<ul><li>规定必须在提交之前填写输入域（不能为空）</li><li><code>&lt;input type=&quot;text&quot; required=&quot;required&quot;&gt;</code></li><li>适用于 input 标签 type 属性为：<ul><li>text、search、url、telephone、email、password、date pinckers、number、checkbox、radio、file</li></ul></li></ul></li></ul><h4 id="链接属性"><a href="#链接属性" class="headerlink" title="链接属性"></a>链接属性</h4><ul><li><code>&lt;link&gt;</code> 的 <code>sizes</code> 属性：<ul><li><code>&lt;link rel=&quot;icon&quot; href=&quot;icon.gif&quot; type=&quot;image/gif&quot; sizes=&quot;16x16&quot;&gt;</code></li></ul></li><li><code>&lt;base&gt;</code> 的 <code>target</code> 属性 ：<ul><li><code>&lt;base href=&quot;http://localhost/&quot; target=&quot;_blank&quot;&gt;</code></li></ul></li><li>超链接<code>&lt;a&gt;</code> 属性：<ul><li><code>a:meida=&quot;&quot;</code>：表示对设备进行优化，<code>handhelp</code> 对手持设备支持，<code>tv</code> 对电视设备支持</li><li><code>a:hreflang=&quot;zh&quot;</code>：设置语言，这里表示中文</li><li><code>a:rel=&quot;external&quot;</code>：设置超链接的引用，这里表示外部链接</li></ul></li></ul><h4 id="其它属性"><a href="#其它属性" class="headerlink" title="其它属性"></a>其它属性</h4><ul><li>script 标签<ul><li>defer：加载完脚本后并不执行，而是等整个页面加载完之后再执行<ul><li><code>&lt;script defer src=&quot;url&quot;&gt;&lt;/script&gt;</code></li><li>原来只兼容IE，现在已经兼容所有浏览器</li></ul></li><li>async：加载完脚本后立即执行，不用等整个页面加载完，属于异步执行<ul><li><code>&lt;script async src=&quot;url&quot;&gt;&lt;/script&gt;</code></li><li>兼容所有浏览器</li></ul></li></ul></li><li>ol 标签<ul><li>Start：有序列表起始位置</li><li>Reserved：有序列表倒叙</li></ul></li><li>html 标签<ul><li>manifest=”cache.manifest” <ul><li>定义页面离线应用文件</li><li><code>&lt;html manifest=&quot;cache.manifest&quot;</code></li></ul></li></ul></li><li>style 标签<ul><li>scoped：内嵌 CSS</li><li><code>&lt;style scoped&gt; &lt;/style&gt;</code></li></ul></li></ul><h2 id="步骤2-搞懂CSS3"><a href="#步骤2-搞懂CSS3" class="headerlink" title="步骤2: 搞懂CSS3"></a>步骤2: 搞懂CSS3</h2><pre><code>本阶段内容主要涵盖CSS3选择器、边框、圆角、背景、渐变、转换、过渡、动画等知识。通过本阶段学习，大家将能够更加准确的控制页面的布局等样式效果，实现非常炫酷的CSS3动画特效，让网页丰富多彩。</code></pre><h3 id="点击去GitHub查看完整版"><a href="#点击去GitHub查看完整版" class="headerlink" title="点击去GitHub查看完整版"></a><a href="https://github.com/Eished/HTML5-CSS-JS-BS-jQ-CJS-TS_notes/blob/master/HTML5-imooc.md" target="_blank" rel="noopener">点击去GitHub查看完整版</a></h3><h2 id="步骤5-项目实战"><a href="#步骤5-项目实战" class="headerlink" title="步骤5: 项目实战"></a>步骤5: 项目实战</h2><pre><code>    光学不练假把式，实践是巩固知识最好的方法，本环节，将带领大家一步步开发出炫酷的动态网页，让大家能够从实践中总结经验，并且提升解决问题的能力。</code></pre><h3 id="点击去GitHub查看完整版-1"><a href="#点击去GitHub查看完整版-1" class="headerlink" title="点击去GitHub查看完整版"></a><a href="https://github.com/Eished/HTML5-CSS-JS-BS-jQ-CJS-TS_notes/blob/master/HTML5-imooc.md" target="_blank" rel="noopener">点击去GitHub查看完整版</a></h3>]]></content>
      
      
      <categories>
          
          <category> HTML/CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> HTML5 </tag>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js从零开发web server博客项目</title>
      <link href="/2020/06/03/node-js-da-jian-bo-ke/"/>
      <url>/2020/06/03/node-js-da-jian-bo-ke/</url>
      
        <content type="html"><![CDATA[<h1 id="Node-js从零开发web-server博客项目"><a href="#Node-js从零开发web-server博客项目" class="headerlink" title="Node.js从零开发web server博客项目"></a>Node.js从零开发web server博客项目</h1><blockquote><p><strong>篇幅过长, 仅展示目录和部分代码</strong></p></blockquote><h1 id="点击去GitHub查看完整版"><a href="#点击去GitHub查看完整版" class="headerlink" title="点击去GitHub查看完整版"></a><a href="https://github.com/Eished/node_blog_notes" target="_blank" rel="noopener">点击去GitHub查看完整版</a></h1><h2 id="开发接口（不用框架）"><a href="#开发接口（不用框架）" class="headerlink" title="开发接口（不用框架）"></a>开发接口（不用框架）</h2><h3 id="http请求概述"><a href="#http请求概述" class="headerlink" title="http请求概述"></a>http请求概述</h3><ul><li>DNS 解析，建立 TCP 连接，发送 http 请求</li><li>server 接收到 http 请求，处理并返回数据</li><li>客户端接收到返回数据，处理数据（例如渲染、执行JS）</li></ul><h3 id="Node-js-处理http-请求"><a href="#Node-js-处理http-请求" class="headerlink" title="Node.js 处理http 请求"></a>Node.js 处理http 请求</h3><ul><li>get 请求和 querystring</li><li>post 请求和 postdata</li><li>路由（接口、地址）</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//浏览器访问 http://localhost:8000/</span></code></pre><h4 id="Node-js-处理-get-请求"><a href="#Node-js-处理-get-请求" class="headerlink" title="Node.js 处理 get 请求"></a>Node.js 处理 get 请求</h4><ul><li>get  请求，客户端向 server 端获取数据，如查询博客列表</li><li>通过 querystring 来传递数据，如 a.html?a=100&amp;b=200</li><li>浏览器直接访问，发送 get 请求</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>method<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//GET</span>    <span class="token keyword">const</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>url <span class="token comment" spellcheck="true">//获取请求的完整 URL</span>    <span class="token comment" spellcheck="true">//关键解析[0]是'?'前的内容, [1]是'?'后内容</span>    req<span class="token punctuation">.</span>query <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>     res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//将 querystring 返回</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//浏览器访问 http://localhost:8000/</span></code></pre><h4 id="Node-js-处理-post-请求"><a href="#Node-js-处理-post-请求" class="headerlink" title="Node.js 处理 post 请求"></a>Node.js 处理 post 请求</h4><ul><li>post 请求，即客户端要像服务端传递数据，如新建博客</li><li>通过 post data 传递数据，后面解释</li><li>浏览器无法直接模拟，需要手写JS，或者使用 postman app</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'POST'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         <span class="token comment" spellcheck="true">// POST 必须大写</span>        <span class="token comment" spellcheck="true">//数据格式</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'content-type: '</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'content-type'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//接收数据</span>        <span class="token keyword">let</span> postData <span class="token operator">=</span> <span class="token string">''</span>        <span class="token comment" spellcheck="true">//开始接收数据</span>        req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> chunk <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            postData <span class="token operator">+</span><span class="token operator">=</span> chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//结束数据接收</span>        req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span>， <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'postData:'</span><span class="token punctuation">,</span> postData<span class="token punctuation">)</span>            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'hello world!'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//在这里返回，因为是异步</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span></code></pre><h4 id="Node-js-处理路由"><a href="#Node-js-处理路由" class="headerlink" title="Node.js 处理路由"></a>Node.js 处理路由</h4><ul><li><code>https://github.com/username/xxx</code> 每个斜线后面的唯一标识就是路由</li></ul><h4 id="Node-js-综合应用"><a href="#Node-js-综合应用" class="headerlink" title="Node.js 综合应用"></a>Node.js 综合应用</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span>method    <span class="token keyword">const</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>url    <span class="token keyword">const</span> path <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">//重点：split('?'[0])语法弄清楚</span>    <span class="token keyword">const</span> query <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">//设置返回值格式为 JSON</span>    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/json'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">//返回的数据</span>    <span class="token keyword">const</span> resData <span class="token operator">=</span> <span class="token punctuation">{</span>        method<span class="token punctuation">,</span>        url<span class="token punctuation">,</span>        path<span class="token punctuation">,</span>        query    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//返回</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'GET'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>            JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span>        <span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'POST'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">let</span> postData <span class="token operator">=</span> <span class="token string">''</span>        <span class="token comment" spellcheck="true">//res.on('data')指每次发送的数据</span>        <span class="token comment" spellcheck="true">//chunk 逐步接收数据 req绑定一个data方法 chunk是变量</span>        req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> chunk <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            postData <span class="token operator">+</span><span class="token operator">=</span> chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">//req.on(end)数据发送完成；</span>        req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'postData:'</span><span class="token punctuation">,</span> postData<span class="token punctuation">)</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resData:'</span><span class="token punctuation">,</span> resData<span class="token punctuation">)</span>            resData<span class="token punctuation">.</span>postData <span class="token operator">=</span> postData            <span class="token comment" spellcheck="true">//返回</span>            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>                JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>resData<span class="token punctuation">)</span>            <span class="token punctuation">)</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'OK'</span><span class="token punctuation">)</span></code></pre><h3 id="搭建开发环境"><a href="#搭建开发环境" class="headerlink" title="搭建开发环境"></a>搭建开发环境</h3><ul><li>从零搭建，不使用框架</li><li>使用 nodemon 监测文件变化，自动重启 node</li><li>使用 cross-env 设置环境变量，兼容Mac Linux 和 Windows</li><li>配置完后使用 <code>$ npm run dev</code> 命令启动项目</li></ul><h4 id="开始搭建"><a href="#开始搭建" class="headerlink" title="开始搭建"></a>开始搭建</h4><p><strong>使用npm安装上述插件，设置npm镜像源</strong></p><ol><li><p>查看npm源地址<br> <code>npm config list</code></p></li><li><p>结果:<br> <code>metrics-registry = &quot;http://registry.npm.taobao.org/&quot;</code></p></li><li><p>修改registry地址，比如修改为淘宝镜像源。<br> <code>npm set registry https://registry.npm.taobao.org/</code><br> 如果有一天你肉身FQ到国外，用不上了，用rm命令删掉它<br> <code>npm config rm registry</code></p></li><li><p><code>npm install -g nodemon</code></p></li><li><p><code>npm install -g cross-env</code></p></li></ol><p><strong>新建文件夹blog_1，在里面新建bin文件夹和app.js，在bin里面新建<a href="http://www.js文件" target="_blank" rel="noopener">www.js文件</a></strong></p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// package.json 代码 注意： =不能有空格</span><span class="token punctuation">{</span>  <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"blog_1"</span><span class="token punctuation">,</span>  <span class="token string">"version"</span><span class="token punctuation">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>  <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"www.js"</span><span class="token punctuation">,</span>  <span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token string">"test"</span><span class="token punctuation">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span><span class="token punctuation">,</span>    <span class="token string">"dev"</span><span class="token punctuation">:</span> <span class="token string">"cross-env NODE_ENV=dev nodemon ./bin/www.js"</span><span class="token punctuation">,</span>    <span class="token string">"prd"</span><span class="token punctuation">:</span> <span class="token string">"cross-env NODE_ENV=production nodemon ./bin/www.js"</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token string">"author"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token string">"license"</span><span class="token punctuation">:</span> <span class="token string">"ISC"</span><span class="token punctuation">}</span></code></pre><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// ./bin/www.js 代码</span><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token keyword">const</span> PORT <span class="token operator">=</span> <span class="token number">300</span><span class="token keyword">const</span> serverHandle <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../app'</span><span class="token punctuation">)</span><span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>serverHandle<span class="token punctuation">)</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>PORT<span class="token punctuation">)</span></code></pre><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// app.js 代码</span><span class="token keyword">const</span> handleBlogRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./src/router/blog'</span><span class="token punctuation">)</span><span class="token keyword">const</span> handleUserRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./src/router/user'</span><span class="token punctuation">)</span><span class="token keyword">const</span> serverHandle <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//设置返回值格式 JSON</span>    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/json'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// const resData = {</span>    <span class="token comment" spellcheck="true">//     name: 'zhang',</span>    <span class="token comment" spellcheck="true">//     site: 'imooc',</span>    <span class="token comment" spellcheck="true">//     env: process.env.NODE_ENV</span>    <span class="token comment" spellcheck="true">// }</span>    <span class="token comment" spellcheck="true">// res.end(</span>    <span class="token comment" spellcheck="true">//     JSON.stringify(resData)</span>    <span class="token comment" spellcheck="true">// )</span>    <span class="token comment" spellcheck="true">//处理 blog 路由</span>    <span class="token keyword">const</span> blogData <span class="token operator">=</span> <span class="token function">handleBlogRouter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>blogData<span class="token punctuation">)</span> <span class="token punctuation">{</span>        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>            JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>blogData<span class="token punctuation">)</span>        <span class="token punctuation">)</span>        <span class="token keyword">return</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//处理 user 路由</span>    <span class="token keyword">const</span> userData <span class="token operator">=</span> <span class="token function">handleUserRouter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>userData<span class="token punctuation">)</span> <span class="token punctuation">{</span>        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>            JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>userData<span class="token punctuation">)</span>        <span class="token punctuation">)</span>        <span class="token keyword">return</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//未命中路由，返回404</span>    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"Content-type"</span><span class="token punctuation">:</span> <span class="token string">"text/plain"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"404 Not Found\n"</span><span class="token punctuation">)</span>    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> serverHandle</code></pre><h3 id="开发接口"><a href="#开发接口" class="headerlink" title="开发接口"></a>开发接口</h3><h4 id="初始化路由"><a href="#初始化路由" class="headerlink" title="初始化路由"></a>初始化路由</h4><ul><li>初始化路由：根据之前设计方案，做出路由</li><li>返回假数据：将路由和数据处理分离，以符合设计原则</li></ul><h4 id="接口设计方案"><a href="#接口设计方案" class="headerlink" title="接口设计方案"></a>接口设计方案</h4><table><thead><tr><th>描述</th><th>接口</th><th>方法</th><th>url参数</th><th>备注</th></tr></thead><tbody><tr><td>获取博客列表</td><td>/api/blog/list</td><td>get</td><td>author 作者，keyword 搜索关键字</td><td>参数为空则不进行查询过滤</td></tr><tr><td>获取一篇博客的内容</td><td>/api/blog/detail</td><td>get</td><td>id</td><td></td></tr><tr><td>新增一篇博客</td><td>/api/blog/new</td><td>post</td><td></td><td>post 中有新增的信息</td></tr><tr><td>更新一篇博客</td><td>/api/blog/update</td><td>post</td><td>id</td><td>postData 中有更新信息</td></tr><tr><td>删除一篇博客</td><td>/api/blog/del</td><td>post</td><td>id</td><td></td></tr><tr><td>登录</td><td>/api/user/login</td><td>post</td><td></td><td>postData 中有用户名和密码</td></tr></tbody></table><p>具体代码：</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// ./src/router/user.js</span><span class="token keyword">const</span> handleUserRouter <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span>method <span class="token comment" spellcheck="true">//GET POST</span>    <span class="token comment" spellcheck="true">//登录</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'POST'</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/api/user/login'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">{</span>            msg<span class="token punctuation">:</span> <span class="token string">'这是登录的接口'</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> handleUserRouter<span class="token comment" spellcheck="true">// ./src/router/blog.js</span><span class="token keyword">const</span> handleUserRouter <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span>method <span class="token comment" spellcheck="true">//GET POST</span>    <span class="token comment" spellcheck="true">//登录</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'POST'</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/api/user/login'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">{</span>            msg<span class="token punctuation">:</span> <span class="token string">'这是登录的接口'</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> handleUserRouter</code></pre><h4 id="开发路由-博客列表"><a href="#开发路由-博客列表" class="headerlink" title="开发路由 博客列表"></a>开发路由 博客列表</h4><ol><li><p>业务分层 拆分业务</p><ul><li>createServer 业务单独放在 <code>./bin/www.js</code></li><li>系统基本设置、基本信息 <code>app.js</code> 放在根目录</li><li>路由功能 <code>./src/router/xxx.js</code></li><li>数据管理 <code>./src/contoller/xxx.js</code></li><li>数据处理</li></ul></li><li><p>博客列表代码</p></li></ol><h4 id="开发路由-博客详情"><a href="#开发路由-博客详情" class="headerlink" title="开发路由 博客详情"></a>开发路由 博客详情</h4><ul><li><p>博客代码同上一章</p></li><li><p>使用 promise 读取文件，避免 callback-hell</p></li></ul><h4 id="开发路由-（处理POSTData）"><a href="#开发路由-（处理POSTData）" class="headerlink" title="开发路由 （处理POSTData）"></a>开发路由 （处理POSTData）</h4><h4 id="开发路由-（新建和更新博客路由）"><a href="#开发路由-（新建和更新博客路由）" class="headerlink" title="开发路由 （新建和更新博客路由）"></a>开发路由 （新建和更新博客路由）</h4><h4 id="开发路由-（删除博客路由和登录博客路由）"><a href="#开发路由-（删除博客路由和登录博客路由）" class="headerlink" title="开发路由 （删除博客路由和登录博客路由）"></a>开发路由 （删除博客路由和登录博客路由）</h4><ul><li><p><strong>删除博客</strong></p></li><li><p><strong>登录博客</strong></p></li></ul><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul><li><p>node.js 处理 http 请求的常用技能，postman 的使用</p></li><li><p>node.js 开发博客项目的接口（未连接数据库，未登录使用）</p></li><li><p>为何要将 router 和 controller 分开？</p></li><li><p>路由和  API 区别：</p><ul><li>API ：前后端、不同端（子系统）之间对接的通用术语</li><li>路由：系统内部的接口定义，是 API 的一部分</li></ul></li></ul><h2 id="使用MySQL数据库"><a href="#使用MySQL数据库" class="headerlink" title="使用MySQL数据库"></a>使用MySQL数据库</h2><h3 id="MySQL安装"><a href="#MySQL安装" class="headerlink" title="MySQL安装"></a>MySQL安装</h3><p><strong>讲解步骤：</strong></p><ol><li><p>MySQL 的介绍、安装和使用</p></li><li><p>node.js 连接 MySQL</p></li><li><p>API 连接 MySQL</p></li></ol><p>为什么使用MySQL？</p><ul><li>MySQL 最常用，有专人运维</li><li>MySQL 有问题可以随时查到</li><li>MySQL 本身是复杂的，本课只讲使用</li></ul><h4 id="MySQL-介绍："><a href="#MySQL-介绍：" class="headerlink" title="MySQL 介绍："></a>MySQL 介绍：</h4><ul><li>web server 中最流行的关系型数据库</li><li>免费下载学习</li><li>轻量级，易学易用</li></ul><p>MySQL 下载： <a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/mysql/</a> </p><h4 id="MySQL-安装："><a href="#MySQL-安装：" class="headerlink" title="MySQL 安装："></a>MySQL 安装：</h4><ul><li>解压，打开根目录初始化<code>my.ini</code> 文件， 自行创建在安装根目录下创建<code>my.ini</code></li></ul><pre class=" language-ini"><code class="language-ini"><span class="token selector">  [mysqld]</span>  # 设置3306端口<span class="token constant">  port</span><span class="token attr-value"><span class="token punctuation">=</span>3306</span>  # 设置mysql的安装目录<span class="token constant">  basedir</span><span class="token attr-value"><span class="token punctuation">=</span>C:\Program Files\MySQL</span>  # 设置mysql数据库的数据的存放目录<span class="token constant">  datadir</span><span class="token attr-value"><span class="token punctuation">=</span>C:\Program Files\MySQL\Data</span>  # 允许最大连接数<span class="token constant">  max_connections</span><span class="token attr-value"><span class="token punctuation">=</span>200</span>  # 允许连接失败的次数。<span class="token constant">  max_connect_errors</span><span class="token attr-value"><span class="token punctuation">=</span>10</span>  # 服务端使用的字符集默认为utf8mb4<span class="token constant">  character-set-server</span><span class="token attr-value"><span class="token punctuation">=</span>utf8mb4</span>  # 创建新表时将使用的默认存储引擎<span class="token constant">  default-storage-engine</span><span class="token attr-value"><span class="token punctuation">=</span>INNODB</span>  # 默认使用“mysql_native_password”插件认证  #mysql_native_password<span class="token constant">  default_authentication_plugin</span><span class="token attr-value"><span class="token punctuation">=</span>mysql_native_password</span><span class="token selector">  [mysql]</span>  # 设置mysql客户端默认字符集<span class="token constant">  default-character-set</span><span class="token attr-value"><span class="token punctuation">=</span>utf8mb4</span><span class="token selector">  [client]</span>  # 设置mysql客户端连接服务端时默认使用的端口<span class="token constant">  port</span><span class="token attr-value"><span class="token punctuation">=</span>3306</span><span class="token constant">  default-character-set</span><span class="token attr-value"><span class="token punctuation">=</span>utf8mb4</span></code></pre><p>   配置文件中的路径要和实际存放的路径一致（要手动创建Data文件夹） </p><ul><li><p>打开系统设置，配置环境变量 ` Path = ‘解压目录’\bin</p></li><li><p>初始化安装：<code>mysqld --initialize --console</code></p><p>注意输出信息：<code>root @ localhost：后面是初始密码（不含首位空格）</code>，后续登录需要用到，复制密码先保存起来</p></li><li><p>安装MySQL 服务：<code>mysqld --install[服务名]</code> 不填默认<code>mysql</code></p></li><li><p>启动MySQL：<code>net start mysql</code></p></li></ul><h4 id="使用官方客户端管理mysql"><a href="#使用官方客户端管理mysql" class="headerlink" title="使用官方客户端管理mysql"></a>使用官方客户端管理mysql</h4><ul><li><p>Wrokbench 下载地址：<a href="https://dev.mysql.com/downloads/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/</a></p></li><li><p>默认安装，打开后输入之前保存的默认密码登录</p></li><li><p>弹出修改密码界面，修改密码再登录</p></li></ul><h3 id="MySQL基本使用"><a href="#MySQL基本使用" class="headerlink" title="MySQL基本使用"></a>MySQL基本使用</h3><h4 id="根据需求设计表"><a href="#根据需求设计表" class="headerlink" title="根据需求设计表"></a>根据需求设计表</h4><p>users：</p><table><thead><tr><th align="center">id</th><th align="center">username</th><th align="center">password</th><th align="center">realname</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">zhangsan</td><td align="center">123</td><td align="center">张三</td></tr><tr><td align="center">2</td><td align="center">lisi</td><td align="center">1234</td><td align="center">李四</td></tr></tbody></table><p>blogs：</p><table><thead><tr><th align="center">id</th><th align="center">title</th><th align="center">content</th><th align="center">createtime</th><th align="center">author</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">标题A</td><td align="center">内容A</td><td align="center">1573989043149</td><td align="center">zhangsan</td></tr><tr><td align="center">2</td><td align="center">标题B</td><td align="center">内容B</td><td align="center">1573989111301</td><td align="center">lisi</td></tr></tbody></table><h4 id="MySQL语法和操作"><a href="#MySQL语法和操作" class="headerlink" title="MySQL语法和操作"></a>MySQL语法和操作</h4><p>右键表 <code>Drop table</code> 删除</p><p>右键表 <code>Alter table</code> 修改</p><h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><ul><li>如何建库、如何建表</li><li>建表时常用数据类型（ int bigint varchar longtext）</li><li>SQL 语句实现增删改查</li></ul><h3 id="Node-js-操作-MySQL"><a href="#Node-js-操作-MySQL" class="headerlink" title="Node.js 操作 MySQL"></a>Node.js 操作 MySQL</h3><ol><li><p>示例：用 demo 演示 Node.js 操作 MySQL</p></li><li><p>封装：将其封装为系统可用的工具</p></li><li><p>使用：让 API 直接操作 MySQL</p></li></ol><h4 id="Node-js-操作-MySQL-demo"><a href="#Node-js-操作-MySQL-demo" class="headerlink" title="Node.js 操作 MySQL demo"></a>Node.js 操作 MySQL demo</h4><h4 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h4><ul><li>Node.js 连接 MySQL，如何执行 sql 语句</li><li>根据 NODE_ENV 区分设置</li><li>封装 exec 函数，API 使用 exec 操作数据库</li></ul><h2 id="用户登录"><a href="#用户登录" class="headerlink" title="用户登录"></a>用户登录</h2><ul><li>核心：登录校验 &amp; 登录信息存储</li><li>为何只讲登录，不讲注册？<ul><li>注册复杂程度低，涉及内容少</li><li>登录有统一解决方案</li></ul></li></ul><h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><ul><li>什么是 Cookie</li></ul><h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><ul><li>Cookie 存放信息非常危险</li><li>如何解决：cookie 中存储 userId， server 端对应 username</li><li>解决方案：session ，即 server 端储存用户信息</li></ul><p><strong>当前代码 session 代码的问题</strong></p><ul><li>session 是 JS 变量，放在 Node.js 进程内存中</li><li>进程内存有限，访问量过大，内存暴增怎么办？</li><li>正式上线是多进程，进程之间内存无法共享</li></ul><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><h4 id="Redis-特点"><a href="#Redis-特点" class="headerlink" title="Redis 特点"></a>Redis 特点</h4><ul><li>Web Server 最常用的缓存数据库，数据储存在内存中</li><li>相比于 MySQL ，访问速度极快</li><li>成本更高，储存空间小</li><li>将 Web Server 和 Redis 拆分为两个单独服务</li><li>双方独立，可扩展</li><li>像 MySQL 一样</li></ul><h4 id="安装-Redis"><a href="#安装-Redis" class="headerlink" title="安装 Redis"></a>安装 Redis</h4><ul><li>Windows <a href="http://www.runoob.com/redis/redis-install.html" target="_blank" rel="noopener">http://www.runoob.com/redis/redis-install.html</a></li><li>Mac 使用 brew install redis</li></ul><p>打开系统设置，配置环境变量  <code>Path = C:\Program Files\Redis</code></p><h3 id="开发登录-前端联调"><a href="#开发登录-前端联调" class="headerlink" title="开发登录 前端联调"></a>开发登录 前端联调</h3><ul><li>登录依赖 Cookie，必须用浏览器</li><li>Cookie 跨域不共享，前端和 server 端必须同域</li><li>需要用到 Nginx 做代理，让前后端共域</li></ul><h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h3><ul><li>IO 操作的性能瓶颈<ul><li>IO 包括 “网络 IO” 和 “文件 IO”</li><li>相对于 CPU 计算和内存读写， IO 的突出特点就是：慢</li><li>如何在有限的硬件资源下提高 IO 的操作效率</li></ul></li></ul><h3 id="写日志"><a href="#写日志" class="headerlink" title="写日志"></a>写日志</h3><h3 id="日志拆分"><a href="#日志拆分" class="headerlink" title="日志拆分"></a>日志拆分</h3><ul><li>日志内容会慢慢积累，放在一个文件中不好处理</li><li>按时间划分日志文件，如 2019-02-10.access.log</li><li>实现方式：Linux 的 crontab 命令，即定时任务</li></ul><h4 id="Crontab"><a href="#Crontab" class="headerlink" title="Crontab"></a>Crontab</h4><ul><li><p>设置定时任务，格式：<code>***** command</code> </p><pre><code>  *分钟*小时*天*月*星期 command脚本命令</code></pre><pre><code></code></pre></li><li><p>将 access.log 拷贝并重命名为 2019-02-10.access.log </p><ul><li>清空 access.log 文件，继续积累日志<pre><code></code></pre></li></ul></li></ul><h4 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h4><h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><ul><li>日志对 server 的重要性</li><li>IO 性能瓶颈，使用 stream 提高性能， node.js 中如何操作</li><li>使用 Crontab 拆分日志，使用 readline 分析日志内容</li></ul><h2 id="Web-安全"><a href="#Web-安全" class="headerlink" title="Web 安全"></a>Web 安全</h2><h3 id="常见安全问题和解决方案"><a href="#常见安全问题和解决方案" class="headerlink" title="常见安全问题和解决方案"></a>常见安全问题和解决方案</h3><ul><li>SQL 注入：窃取数据库内容</li><li>XSS攻击：窃取前端的 Cookie 内容</li><li>密码加密：保障用户信息安全（重要）</li><li>Server 端攻击方式非常多，预防手段也非常多</li><li>本科只讲常见的、能通过 Web Server ( Node.js ) 层面预防的</li><li>有些攻击需要<strong>硬件和服务</strong>来支持（需要 OP 支持），如 DDOS</li></ul><h4 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h4><ul><li>最原始、最简单的攻击，从有了 Web2.0 就有了 SQL 注入攻击</li><li>攻击方式：输入一个 SQL 片段，最终拼接成一段攻击代码</li><li>预防措施：使用 MySQL　的 escape 函数处理输入数据内容即可</li></ul><h3 id="不用框架开发博客总结"><a href="#不用框架开发博客总结" class="headerlink" title="不用框架开发博客总结"></a>不用框架开发博客总结</h3><h4 id="主要课程"><a href="#主要课程" class="headerlink" title="主要课程"></a>主要课程</h4><ol><li>处理 Http 接口</li><li>连接数据库</li><li>实现登录</li><li>安全</li><li>日志</li><li>上线（最后一起讲）</li></ol><h4 id="Server-和前端区别"><a href="#Server-和前端区别" class="headerlink" title="Server 和前端区别"></a>Server 和前端区别</h4><ul><li>服务稳定性（zui后讲）</li><li>内存 CPU （优化 扩展）</li><li>日志记录</li><li>安全（包括登录验证）</li><li>集群和服务拆分</li></ul><h4 id="下一步要怎么做"><a href="#下一步要怎么做" class="headerlink" title="下一步要怎么做"></a>下一步要怎么做</h4><ul><li>不使用框架开发，从零开始，关注底层 API</li><li>很琐碎、复杂，没有标准，很容易写乱</li><li>适合学习，但不适合应用，接下来开始 Express 和 Koa2</li></ul><h2 id="Express-框架"><a href="#Express-框架" class="headerlink" title="Express 框架"></a>Express 框架</h2><h3 id="Express-介绍"><a href="#Express-介绍" class="headerlink" title="Express 介绍"></a>Express 介绍</h3><ul><li>Express 是 Node.js 最常用的 Web Server 框架</li><li>什么是框架？</li><li>不要以为 Express 框架过时了</li></ul><p>目录</p><ul><li>Express 下载、安装和使用，了解 Express 中间件机制</li><li>开发接口、连接数据库、实现登录、记录日志</li><li>分析 Express 中间件原理</li></ul><p>介绍 Express </p><ul><li>安装（使用脚手架 Express-grnerator）</li><li>初始化代码介绍，处理路由</li><li>使用中间件</li></ul><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h3><ul><li>使用框架开发的好处（相比之前不使用框架）</li><li>express 的使用和路由处理，以及操作 session redis 日志等</li><li>express 中间件的使用和原理</li></ul><h4 id="下一步"><a href="#下一步" class="headerlink" title="下一步"></a>下一步</h4><ul><li>JS 的异步回调带来了很多问题，Promise 也不能解决所有</li><li>Node.js 已经支持 async/await 语法，要用起来</li><li>Ko2 也已经原生支持 async/await 语法，接下来讲解</li></ul><h2 id="Koa2-框架"><a href="#Koa2-框架" class="headerlink" title="Koa2 框架"></a>Koa2 框架</h2><h4 id="总结-5"><a href="#总结-5" class="headerlink" title="总结"></a>总结</h4><ul><li>使用 async/await 的好处</li><li>koa2 的使用，以及如何操作 session redis 日志</li><li>koa2 中间件的使用和原理</li></ul><p>下一步：</p><ul><li>一直处于开发环境，和前端联调过，但从未上线</li><li>如何实现线上服务稳定性？PM2 是什么？</li><li>nginx 在线上环境扮演了什么重要作用？</li></ul><h2 id="线上环境"><a href="#线上环境" class="headerlink" title="线上环境"></a>线上环境</h2><ul><li>服务器稳定性</li><li>充分利用服务器硬件资源，以便提高性能</li><li>线上日志记录</li></ul><p>PM2 功能：</p><ul><li>进程守护，系统崩溃自动重启</li><li>启动多进程，充分利用 CPU 和内存</li><li>自带日志记录功能</li></ul><h4 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h4><ul><li>为何使用多进程？<ul><li>回顾之前讲 session 时说过， 操作系统限制一个进程的内存</li><li>内存：无法充分利用机器全部内存</li><li>CPU：无法充分利用多核CPU</li></ul></li><li>多进程和 redis<ul><li>多进程之间，内存无法共享</li><li>多进程访问一个 redis ，实现数据共享</li></ul></li></ul><h4 id="关于服务器运维"><a href="#关于服务器运维" class="headerlink" title="关于服务器运维"></a>关于服务器运维</h4><ul><li>服务器运维，一般都由专业的 OP 人员和部门来处理</li><li>大公司都有自己的运维团队</li><li>中小型工期推荐使用一些云服务，如阿里云的 node 平台</li></ul><h4 id="总结-6"><a href="#总结-6" class="headerlink" title="总结"></a>总结</h4><ul><li>PM2 的核心价值</li><li>PM2 的常用命令和配置，日志记录</li><li>多进程</li></ul><h2 id="课程总结"><a href="#课程总结" class="headerlink" title="课程总结"></a>课程总结</h2>]]></content>
      
      
      <categories>
          
          <category> Node.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue2.5从零基础入门到实战项目开发去哪儿网App</title>
      <link href="/2020/06/02/vue2-5-cong-ling-ji-chu-ru-men-dao-shi-zhan-xiang-mu-kai-fa-qu-na-er-wang-app/"/>
      <url>/2020/06/02/vue2-5-cong-ling-ji-chu-ru-men-dao-shi-zhan-xiang-mu-kai-fa-qu-na-er-wang-app/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/Eished/vue-travel" target="_blank" rel="noopener">项目代码</a></p><h1 id="第1章-课程介绍"><a href="#第1章-课程介绍" class="headerlink" title="第1章 课程介绍"></a>第1章 课程介绍</h1><pre><code>本章主要介绍课程的知识大纲，学习前提，讲授方式及预期收获。</code></pre><h2 id="1-1-课程简介"><a href="#1-1-课程简介" class="headerlink" title="1-1 课程简介"></a>1-1 课程简介</h2><h3 id="课程流程"><a href="#课程流程" class="headerlink" title="课程流程"></a>课程流程</h3><p><img src="https://github.com/Eished/Vue_notes/raw/master/readme.assets/image-20200128143531674.png" alt="image-20200128143518066"></p><h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><p><img src="https://github.com/Eished/Vue_notes/raw/master/readme.assets/image-20200128143531674.png" alt="image-20200128143531674"></p><h3 id="课程安排"><a href="#课程安排" class="headerlink" title="课程安排"></a>课程安排</h3><p><img src="https://github.com/Eished/Vue_notes/raw/master/readme.assets/image-20200128143728763.png" alt="image-20200128143728763"></p><h3 id="学习前提"><a href="#学习前提" class="headerlink" title="学习前提"></a>学习前提</h3><p><img src="https://github.com/Eished/Vue_notes/raw/master/readme.assets/image-20200128143807549.png" alt="image-20200128143807549"></p><h3 id="讲授方式"><a href="#讲授方式" class="headerlink" title="讲授方式"></a>讲授方式</h3><ol><li>通俗易懂的案例讲解</li><li>借助基础知识实现项目</li><li>带着你编写每一行代码</li><li>图文讲解复杂知识点</li></ol><h3 id="课程收获"><a href="#课程收获" class="headerlink" title="课程收获"></a>课程收获</h3><ol><li>彻底入门Vue的使用</li><li>理解整个Vue项目的开发流程</li><li>移动端页面布局技巧</li><li>上手中型Vue项目的开发</li><li>规范的代码编写</li></ol><h1 id="第2章-Vue-起步"><a href="#第2章-Vue-起步" class="headerlink" title="第2章 Vue 起步"></a>第2章 Vue 起步</h1><pre><code>本章将快速讲解部分 Vue 基础语法，通过 TodoList 功能的编写，在熟悉基础语法的基础上，扩展解析 MVVM 模式及前端组件化的概念及优势。</code></pre><h2 id="2-1-课程学习方法"><a href="#2-1-课程学习方法" class="headerlink" title="2-1 课程学习方法"></a>2-1 课程学习方法</h2><blockquote><p>官方文档:</p><p><a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/</a></p></blockquote><ul><li>基于官方文档<ul><li>视频学习后看官方文档</li></ul></li></ul><h2 id="2-2-hello-world"><a href="#2-2-hello-world" class="headerlink" title="2-2 hello world"></a>2-2 hello world</h2><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Hello world<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{content}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>{{content}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token comment" spellcheck="true">// document.getElementById('app').innerHTML = 'Hello world'</span>    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>      data<span class="token punctuation">:</span> <span class="token punctuation">{</span>        content<span class="token punctuation">:</span> <span class="token string">'Hello world'</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      app<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string">'hi bye'</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h2 id="2-3-开发TodoList（v-model、v-for、v-on）"><a href="#2-3-开发TodoList（v-model、v-for、v-on）" class="headerlink" title="2-3 开发TodoList（v-model、v-for、v-on）"></a>2-3 开发TodoList（v-model、v-for、v-on）</h2><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>TodoList<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>inputValue<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleBtnClick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item in list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{item}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>      data<span class="token punctuation">:</span> <span class="token punctuation">{</span>        list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'第一课的内容'</span><span class="token punctuation">,</span> <span class="token string">'第二课的内容'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        inputValue<span class="token punctuation">:</span> <span class="token string">''</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token function">handleBtnClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>inputValue<span class="token punctuation">)</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>inputValue <span class="token operator">=</span> <span class="token string">''</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h2 id="2-4-MVVM模式"><a href="#2-4-MVVM模式" class="headerlink" title="2-4 MVVM模式"></a>2-4 MVVM模式</h2><p><strong>传统的 MVP 设计模式</strong></p><ul><li>Model : 数据层</li><li>Presenter : 呈现层, 业务逻辑</li><li>View : 视图层, DOM 展示</li></ul><p><img src="https://github.com/Eished/Vue_notes/raw/master/readme.assets/image-20200128165658026.png" alt="image-20200128165658026"></p><ul><li><p>实例: </p><ul><li>80% 代码在操作 DOM</li></ul><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>TodoList JQuery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./jquery1.12.4.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token comment" spellcheck="true">// M (模型层) V 视图 P(控制器)</span>    <span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    $<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>Page<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>      init<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bindEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      bindEvents<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> btn <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#btn'</span><span class="token punctuation">)</span>        btn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> $<span class="token punctuation">.</span><span class="token function">proxy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleBtnClick<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      handleBtnClick<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> inputElm <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#input"</span><span class="token punctuation">)</span>        <span class="token keyword">var</span> inputValue <span class="token operator">=</span> inputElm<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">var</span> ulElem <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#list"</span><span class="token punctuation">)</span>        ulElem<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'&lt;li>'</span> <span class="token operator">+</span> inputValue <span class="token operator">+</span> <span class="token string">'&lt;/li>'</span><span class="token punctuation">)</span>        inputElm<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">var</span> page <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    page<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></li></ul><p><strong>MVVM 设计模式</strong></p><p><img src="https://github.com/Eished/Vue_notes/raw/master/readme.assets/image-20200128172339251.png" alt="image-20200128172339251"></p><ul><li>只要操作 Model 层和 View 层</li><li>Vue 自动帮我们操作 ViewModel 层<ul><li>通过 Object.defineProperties 和 虚拟 DOM 实现</li></ul></li></ul><h2 id="2-5-前端组件化"><a href="#2-5-前端组件化" class="headerlink" title="2-5 前端组件化"></a>2-5 前端组件化</h2><ul><li>每个组件就是页面的一个区域</li></ul><h2 id="2-6-使用组件改造TodoList"><a href="#2-6-使用组件改造TodoList" class="headerlink" title="2-6 使用组件改造TodoList"></a>2-6 使用组件改造TodoList</h2><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>TodoList<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>inputValue<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleBtnClick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>      <span class="token comment" spellcheck="true">&lt;!-- &lt;li v-for="item in list">{{item}}&lt;/li> --></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>todo-item</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item in list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>todo-item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token comment" spellcheck="true">// // 全局组件</span>    <span class="token comment" spellcheck="true">// Vue.component("TodoItem", {</span>    <span class="token comment" spellcheck="true">//   props: ['content'], // 接收 v-bind:content 传递的值</span>    <span class="token comment" spellcheck="true">//   template: "&lt;li>{{content}}&lt;/li>" // 模板内使用字符串</span>    <span class="token comment" spellcheck="true">// })</span>    <span class="token keyword">var</span> TodoItem <span class="token operator">=</span> <span class="token punctuation">{</span>      props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      template<span class="token punctuation">:</span> <span class="token string">"&lt;li>{{content}}&lt;/li>"</span>    <span class="token punctuation">}</span>    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>      components<span class="token punctuation">:</span> <span class="token punctuation">{</span>        TodoItem<span class="token punctuation">:</span> TodoItem <span class="token comment" spellcheck="true">// 注册局部组件</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      data<span class="token punctuation">:</span> <span class="token punctuation">{</span>        list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'第一课的内容'</span><span class="token punctuation">,</span> <span class="token string">'第二课的内容'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        inputValue<span class="token punctuation">:</span> <span class="token string">''</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token function">handleBtnClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>inputValue<span class="token punctuation">)</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>inputValue <span class="token operator">=</span> <span class="token string">''</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h2 id="2-7-简单的组件间传值"><a href="#2-7-简单的组件间传值" class="headerlink" title="2-7 简单的组件间传值"></a>2-7 简单的组件间传值</h2><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>TodoList<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>inputValue<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleBtnClick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>      <span class="token comment" spellcheck="true">&lt;!-- &lt;li v-for="item in list">{{item}}&lt;/li> --></span>      <span class="token comment" spellcheck="true">&lt;!-- v-bind: 可以简写为: --></span>      <span class="token comment" spellcheck="true">&lt;!-- v-on: 可以简写为@ --></span>      <span class="token comment" spellcheck="true">&lt;!-- @delete="handleItemDelete" 监听 $emit 传递的 delete 事件 --></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>todo-item</span> <span class="token attr-name">:content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">:index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(item,index) in list<span class="token punctuation">"</span></span> <span class="token attr-name">@delete</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleItemDelete<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>todo-item</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token comment" spellcheck="true">// // 全局组件</span>    <span class="token comment" spellcheck="true">// Vue.component("TodoItem", {</span>    <span class="token comment" spellcheck="true">//   props: ['content'], // 接收 v-bind:content 传递的值</span>    <span class="token comment" spellcheck="true">//   template: "&lt;li>{{content}}&lt;/li>" // 模板内使用字符串</span>    <span class="token comment" spellcheck="true">// })</span>    <span class="token keyword">var</span> TodoItem <span class="token operator">=</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// 父组件向子组件传值, v-bind: 发送和 props 接收</span>      props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      template<span class="token punctuation">:</span> <span class="token string">"&lt;li @click='handleItemClick'>{{content}}&lt;/li>"</span><span class="token punctuation">,</span>      methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>        handleItemClick<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token comment" spellcheck="true">// $emit 向外触发事件; 父组件监听此事件传值</span>          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">"delete"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>      components<span class="token punctuation">:</span> <span class="token punctuation">{</span>        TodoItem<span class="token punctuation">:</span> TodoItem <span class="token comment" spellcheck="true">// 注册局部组件</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      data<span class="token punctuation">:</span> <span class="token punctuation">{</span>        list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'第一课的内容'</span><span class="token punctuation">,</span> <span class="token string">'第二课的内容'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        inputValue<span class="token punctuation">:</span> <span class="token string">''</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>        handleBtnClick<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>$data<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>inputValue<span class="token punctuation">)</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>inputValue <span class="token operator">=</span> <span class="token string">''</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        handleItemDelete<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h2 id="2-8-章节小结"><a href="#2-8-章节小结" class="headerlink" title="2-8 章节小结"></a>2-8 章节小结</h2><p>作业: 仔细阅读Vue介绍部分文档, 查漏补缺</p><ol><li><p><code>v-bind</code> attribute 被称为<strong>指令</strong></p></li><li><p><code>app3.seen = false</code> : 显示或隐藏元素</p></li><li><p><code>v-for</code> 指令可以绑定数组的数据来渲染一个项目列表</p><ul><li><code>v-for=&quot;todo in todos&quot;</code></li></ul></li><li><p><code>v-on</code> 指令添加一个事件监听器，通过它调用在 Vue 实例中定义的方法</p><ul><li><code>v-on:click=&quot;reverseMessage&quot;</code></li></ul></li><li><p><code>v-model</code> 指令，它能轻松实现表单输入和应用状态之间的双向绑定</p><ul><li><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app-6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{{ message }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token keyword">var</span> app6 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  el<span class="token punctuation">:</span> <span class="token string">'#app-6'</span><span class="token punctuation">,</span>  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>    message<span class="token punctuation">:</span> <span class="token string">'Hello Vue!'</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li></ul></li><li><p>组件系统允许我们使用小型、独立和通常可复用的组件构建大型应用。几乎任意类型的应用界面都可以抽象为一个组件树：</p><ul><li><p>一个组件本质上是一个拥有预定义选项的一个 Vue 实例。</p></li><li><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 定义名为 todo-item 的新组件</span>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'todo-item'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>  template<span class="token punctuation">:</span> <span class="token string">'&lt;li>这是个待办项&lt;/li>'</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></li></ul></li></ol><p>   <img src="https://github.com/Eished/Vue_notes/raw/master/readme.assets/components.png" alt="Component Tree"></p><ol start="7"><li>子单元通过 prop 接口与父单元进行了良好的解耦。</li></ol><h1 id="点击去GitHub查看完整版"><a href="#点击去GitHub查看完整版" class="headerlink" title="点击去GitHub查看完整版"></a><a href="https://github.com/Eished/Vue_notes" target="_blank" rel="noopener">点击去GitHub查看完整版</a></h1>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript ES6-10语法</title>
      <link href="/2020/06/02/javascript-es6-10/"/>
      <url>/2020/06/02/javascript-es6-10/</url>
      
        <content type="html"><![CDATA[<h1 id="第1章-课程介绍与环境搭建"><a href="#第1章-课程介绍与环境搭建" class="headerlink" title="第1章 课程介绍与环境搭建"></a>第1章 课程介绍与环境搭建</h1><p>  JS作为前端的立身之本，让大家了解学习这门课的必要性。考虑到很多同学刚刚接触前端或者对工程化方法不太了解，为了快速进入到学习状态，我们提供了极其简单的方式帮大家准备好学习环境。</p><h2 id="1-1-课程导学-试看"><a href="#1-1-课程导学-试看" class="headerlink" title="1-1 课程导学 试看"></a>1-1 课程导学 试看</h2><h3 id="怎么学？"><a href="#怎么学？" class="headerlink" title="怎么学？"></a>怎么学？</h3><ol><li>一天后：体验乐趣</li><li>十天后：进入状态</li><li>一个月后：养成习惯</li><li>三个月后：收获知识</li><li>五个月后：形成思维习惯</li></ol><h3 id="课程内容"><a href="#课程内容" class="headerlink" title="课程内容"></a>课程内容</h3><ol><li>快速搭建开发环境</li><li>学习语法</li><li>推荐阅读材料</li><li>练习题</li><li>Vue 框架内实战</li><li>学习开发环境如何构建</li></ol><h3 id="适用人群"><a href="#适用人群" class="headerlink" title="适用人群"></a>适用人群</h3><ol><li>拥有 JavaScript ES3 以上基础</li><li>会编程，有编程思维</li><li>有耐心</li><li>求上进</li></ol><p>1-2 电子书位置</p><h2 id="1-3-环境准备"><a href="#1-3-环境准备" class="headerlink" title="1-3 环境准备"></a>1-3 环境准备</h2><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><ul><li><p>原理</p><ol><li>ES6-10 ：原生代码</li><li>Babel→Webpack ：构建转换</li><li>ES5 ：浏览器可以识别的代码</li></ol></li><li><p>开发环境</p><ul><li>Chrome和Node环境</li><li>自动刷新 自动编译</li><li>格式化编写代码</li></ul></li></ul><h2 id="1-4-Node-安装"><a href="#1-4-Node-安装" class="headerlink" title="1-4 Node 安装"></a>1-4 Node 安装</h2><ul><li>Node 安装：-v 12.2.0<ul><li>npm</li><li>npx</li></ul></li></ul><h2 id="1-5-初始化项目"><a href="#1-5-初始化项目" class="headerlink" title="1-5 初始化项目"></a>1-5 初始化项目</h2><h3 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h3><pre><code>npx es10-cli create projectName // 创建模板文件命令</code></pre><p>启动项目</p><pre><code>cd projectNamenpm installnpm starttouch static/lesson2-1.js // 新建文件命令</code></pre><h2 id="1-6-编辑器配置"><a href="#1-6-编辑器配置" class="headerlink" title="1-6 编辑器配置"></a>1-6 编辑器配置</h2><p>VS code 插件 beautify 和 ESLint</p><h1 id="第2章-ES6基础知识"><a href="#第2章-ES6基础知识" class="headerlink" title="第2章 ES6基础知识"></a>第2章 ES6基础知识</h1><p>  ES6语法相对于ES5有了非常大的改变，让原生 JavaScript 能力再上一个台阶，这个章节会分门别类进行讲述，单纯讲语法既乏味也不利于记忆更不知道如何运用，我们以应用场景开场分别给出ES5和ES6两种不同的解决方案，循序渐进剖析语法…</p><h2 id="Let-amp-Const"><a href="#Let-amp-Const" class="headerlink" title="Let &amp; Const"></a>Let &amp; Const</h2><h3 id="2-1-作用域（1）"><a href="#2-1-作用域（1）" class="headerlink" title="2-1 作用域（1）"></a>2-1 作用域（1）</h3><ol><li>var 声明的全局变量相当于 window 的属性，但无法删除，属性可以删除</li><li>没有var 定义的变量是作为 window 的属性定义的，是全局属性</li><li>在函数内部没有 var 定义的变量是window 的属性，是全局属性</li></ol><h3 id="2-2-作用域（2）"><a href="#2-2-作用域（2）" class="headerlink" title="2-2 作用域（2）"></a>2-2 作用域（2）</h3><ul><li>函数作用域 = 局部作用域</li><li>var 定义的变量会变量提升</li><li>let 定义的变量具有块状作用域</li></ul><h4 id="this-与-动态作用域-的关系"><a href="#this-与-动态作用域-的关系" class="headerlink" title="this 与 动态作用域 的关系"></a>this 与 动态作用域 的关系</h4><ul><li>this 具有动态指向</li></ul><h4 id="四种作用域"><a href="#四种作用域" class="headerlink" title="四种作用域"></a>四种作用域</h4><ol><li>全局作用域</li><li>函数作用域</li><li>块状作用域 ，配合 let 和 const 使用</li><li>动态作用域</li></ol><h3 id="2-3-什么是作用域"><a href="#2-3-什么是作用域" class="headerlink" title="2-3 什么是作用域"></a>2-3 什么是作用域</h3><p>几乎所有编程语言就是在变量中储存值，并且能够读取和修改这些值。事实上在变量中储存和取出值得能力，给程序赋予了状态。</p><p>如果没有这样的概念，一个程序虽然可以执行一些任务，但是它们将会受到极大的限制而且不会非常有趣。</p><p>但是这些变量该储存在哪？又如何读取？为了完成这个目标需要制定一些规则，规则就是：作用域。</p><ul><li><h4 id="四种常见作用域类型："><a href="#四种常见作用域类型：" class="headerlink" title="四种常见作用域类型："></a>四种常见作用域类型：</h4><table><thead><tr><th>对象</th><th>类型</th></tr></thead><tbody><tr><td>global</td><td>全局作用域</td></tr><tr><td>function</td><td>函数作用域（局部作用域）</td></tr><tr><td>{}</td><td>块状作用域</td></tr><tr><td>this</td><td>动态作用域</td></tr></tbody></table></li><li><blockquote><p>如果一个变量 或者其它表达式不在“当前得作用域”，那么JavaScript机制会继续沿着作用域链上查找直到找到全局作用域，通常是指沿着链式得作用域查找，而不能从父作用域引用子作用域中的变量和引用</p></blockquote></li></ul><h3 id="2-4-let-amp-const"><a href="#2-4-let-amp-const" class="headerlink" title="2-4 let&amp;const"></a>2-4 let&amp;const</h3><ul><li>let 声明的特点<ul><li>块状作用域</li><li>不能用用全局变量的属性访问</li><li>不能重复定义</li><li>不会变量提升</li></ul></li><li>const 声明的特点<ul><li><strong>只能赋值一次</strong></li><li><strong>初始化时一定要赋值</strong></li><li>块状作用域</li><li>不能用用全局变量的属性访问</li><li>不能重复定义</li><li>不会变量提升</li></ul></li><li>阅读<ol><li>什么是作用域</li><li>JavaScript深入之词法作用域和动态作用域</li><li>深入理解JS中声明提升、作用域（链）和 this 关键字</li></ol></li></ul><h2 id="数组-Array"><a href="#数组-Array" class="headerlink" title="数组 - Array"></a>数组 - Array</h2><h3 id="2-6-ES5中数组有多少种遍历的方法？"><a href="#2-6-ES5中数组有多少种遍历的方法？" class="headerlink" title="2-6 ES5中数组有多少种遍历的方法？"></a>2-6 ES5中数组有多少种遍历的方法？</h3><p>他们有什么优势和缺点？</p><ol><li><p>for 循环</p></li><li><p>forEach ：<code>arr.forEach(funciton (item) {console.log(item)})</code></p><blockquote><p>不支持 <code>break</code> 和 <code>continue</code></p><p>return false 相当于 continue</p><p>隐式索引</p></blockquote></li><li><p>every ：<code>arr.every(funciton (item) {console.log(item)})</code></p><blockquote><p>是否继续执行取决于函数返回值 true 、false</p><p>如果数组中检测到有一个元素不满足，则整个表达式返回 <em>false</em> ，且剩余的元素不会再进行检测。</p><p>如果所有元素都满足条件，则返回 true。</p></blockquote></li><li><p>some：依次执行数组的每个元素：</p><blockquote><p>如果有一个元素满足条件，则表达式返回<em>true</em> , 剩余的元素不会再执行检测。</p><p>如果没有满足条件的元素，则返回false。</p></blockquote></li><li><p>for in ：<code>for ( let index in Object) {console.log(Object[index])}</code></p><blockquote><p>为对象设计的，数组的属性和下标作为字符串遍历</p><p>支持 continue 和 break</p></blockquote></li></ol><h3 id="2-7-ES6中数组有多少种遍历的方法？"><a href="#2-7-ES6中数组有多少种遍历的方法？" class="headerlink" title="2-7 ES6中数组有多少种遍历的方法？"></a>2-7 ES6中数组有多少种遍历的方法？</h3><ol><li><p>for of ：<code>for (let item of arr) { console.log(item)}</code></p><blockquote><p>不仅可以遍历数组和对象</p><p>可以遍历自定义数据结构</p></blockquote></li><li><p>map()</p><blockquote><p>map() 方法返回一个新数组，数组中的元素为原始数组元素调用函数处理后的值。</p><p>map() 方法按照原始数组元素顺序依次处理元素。</p><p>这种方式也是用的比较广泛的，虽然用起来比较优雅，但实际效率还比不上foreach</p></blockquote></li></ol><h3 id="2-8-Array-from（如何将伪数组转换成数组？）"><a href="#2-8-Array-from（如何将伪数组转换成数组？）" class="headerlink" title="2-8 Array.from（如何将伪数组转换成数组？）"></a>2-8 Array.from（如何将伪数组转换成数组？）</h3><h4 id="ES5"><a href="#ES5" class="headerlink" title="ES5"></a>ES5</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// collection</span><span class="token keyword">let</span> imgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>doncument<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// NodeList</span></code></pre><h4 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h4><ul><li><p>Array.from(arrayLike, mapFn, thisArg)</p><blockquote><p>ES6 新增方法，专门转换伪数组到数组，也可用于生成数组</p></blockquote></li></ul><pre class=" language-js"><code class="language-js">Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">from</span> <span class="token comment" spellcheck="true">// ES6 新增方法</span>Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>arrayLike<span class="token punctuation">,</span> mapFn<span class="token punctuation">,</span> thisArg<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 语法 伪数组，函数返回值，this指向</span><span class="token keyword">let</span> args <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span></code></pre><h4 id="什么叫伪数组"><a href="#什么叫伪数组" class="headerlink" title="什么叫伪数组"></a>什么叫伪数组</h4><ol><li>按照索引方式存储数据</li><li>具有 length 属性</li></ol><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> array <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> length<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h3 id="2-9-Array-of-fill（如何生成新数组？）"><a href="#2-9-Array-of-fill（如何生成新数组？）" class="headerlink" title="2-9 Array.of-fill（如何生成新数组？）"></a>2-9 Array.of-fill（如何生成新数组？）</h3><p>ES6 新方法</p><ul><li><p>Array(5) ：初始化长度为5的数组</p></li><li><p>new Array(1,2,3)：初始化数组，同时生成数据</p></li><li><p>Array.of(1,2,3)：初始化数组，同时生成数据</p></li><li><p>Array.fill(value,start,end)：填充数据</p></li></ul><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// Array.prototype.of</span><span class="token keyword">let</span> array <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// Array.prototype.fill</span><span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>Array<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>start<span class="token punctuation">,</span>end<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 语法 填充值，起始位，截止值。 默认填充所有元素</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h3 id="2-10-Find-amp-FindIndex（如何查找数组？）"><a href="#2-10-Find-amp-FindIndex（如何查找数组？）" class="headerlink" title="2-10 Find&amp;FindIndex（如何查找数组？）"></a>2-10 Find&amp;FindIndex（如何查找数组？）</h3><ul><li><p>array.filter(fn)：ES5，返回符合fn 条件的所有值，没有则为空</p></li><li><p>Array.find(fn)：ES6，查找数组中符合fn 条件的第一个值，并返回，没有则为 undefined</p></li><li><p>Array.findIndex()：ES6，返回位置，未找到则-1</p></li></ul><pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> array <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">)</span><span class="token keyword">let</span> find <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> item <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 查找下标</span><span class="token keyword">let</span> find <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> item <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>find<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="Class-Update"><a href="#Class-Update" class="headerlink" title="Class Update"></a>Class Update</h2><h3 id="2-12-Class基础语法（怎么声明一个类？）"><a href="#2-12-Class基础语法（怎么声明一个类？）" class="headerlink" title="2-12 Class基础语法（怎么声明一个类？）"></a>2-12 Class基础语法（怎么声明一个类？）</h3><h4 id="ES5中怎么声明一个类"><a href="#ES5中怎么声明一个类" class="headerlink" title="ES5中怎么声明一个类"></a>ES5中怎么声明一个类</h4><ul><li><pre class=" language-JS"><code class="language-JS">let Animal = function (type) {  this.type = type}Animal.prototype.eat = function () {  console.log('you are eatting food hello');}let dog = new Animal('food')let cat = new Animal('fish')console.log(dog)console.log(cat)// 修改实例对象原型链上的方法cat.constructor.prototype.eat = function () {  console.log('error')}dog.eat()cat.eat()</code></pre></li></ul><h4 id="ES6中声明一个类"><a href="#ES6中声明一个类" class="headerlink" title="ES6中声明一个类"></a>ES6中声明一个类</h4><ul><li><pre class=" language-JS"><code class="language-JS">class Animal {  constructor(type) {    this.type = type  }  eat() {    console.log('i am food')  }}let dog = new Animal('food')let cat = new Animal('fish')console.log(dog)console.log(cat)// 修改实例对象原型链上的方法cat.constructor.prototype.eat = function () {  console.log('error')}dog.eat()cat.eat()console.log(typeof Animal);</code></pre></li></ul><h3 id="点击去GitHub查看完整版"><a href="#点击去GitHub查看完整版" class="headerlink" title="点击去GitHub查看完整版"></a><a href="https://github.com/Eished/JavaScript_notes/blob/master/JavaScriptES6-10_notes/JavaScriptES6-10.md" target="_blank" rel="noopener">点击去GitHub查看完整版</a></h3>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript从入门到精通</title>
      <link href="/2020/06/02/javascript-cong-ru-men-dao-jing-tong/"/>
      <url>/2020/06/02/javascript-cong-ru-men-dao-jing-tong/</url>
      
        <content type="html"><![CDATA[<h1 id="JavaScript从入门到精通"><a href="#JavaScript从入门到精通" class="headerlink" title="JavaScript从入门到精通"></a><a href="https://www.bilibili.com/video/av29885002" target="_blank" rel="noopener">JavaScript从入门到精通</a></h1><h2 id="初探-JavaScript-魅力"><a href="#初探-JavaScript-魅力" class="headerlink" title="初探 JavaScript 魅力"></a>初探 JavaScript 魅力</h2><h3 id="JavsScript-是什么"><a href="#JavsScript-是什么" class="headerlink" title="JavsScript 是什么"></a>JavsScript 是什么</h3><ul><li>网页特效原理<ul><li>JavaScript 就是修改样式（文档）</li></ul></li><li>编写 JS 的流程<ul><li>布局：HTML + CSS </li><li>属性：确定要修改的属性</li><li>事件： 确定用户 做哪些操作（产品设计）</li><li>编写 JS ：在事件中，用 JS 来修改页面元素的样式</li></ul></li></ul><h3 id="第一个-JS-特效：鼠标提示框"><a href="#第一个-JS-特效：鼠标提示框" class="headerlink" title="第一个 JS 特效：鼠标提示框"></a>第一个 JS 特效：鼠标提示框</h3><ul><li><p>分析效果实现原理</p><ul><li>样式：<code>div</code> 的 <code>display / none</code></li><li>事件：<code>onmouseover / onmouseout</code></li><li>动手编写效果</li></ul></li><li><p>特效基础</p><ul><li>事件驱动：<code>onmouseover</code></li><li>元素属性操作：<code>obj.style.[...]</code></li><li>特效实现原理概括：响应式用户操作，对页面元素样式修改</li></ul></li><li><p>兼容性问题 </p><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// div2.style.display='block'; // 部分浏览器不兼容</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display<span class="token operator">=</span><span class="token string">'block'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 所有浏览器兼容</span></code></pre></li><li><p>函数</p><ul><li>制作更复杂的效果</li><li>直接在事件内写代码会很乱<ul><li>引入 <code>function()</code> 函数的基本形式</li><li>把 JS 标签里放入到函数里，类似于 css 里的 <code>class</code></li><li>变量的使用：别名</li></ul></li><li>定义和调用<ul><li>函数定义：告诉系统有这个函数，不会执行</li><li>函数调用：执行函数里面的代码</li><li>关系和区别</li></ul></li></ul></li><li><p>代码</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>第一个JS效果<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">      <span class="token selector"><span class="token id">#div2</span> </span><span class="token punctuation">{</span>        <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>         <span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>         <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>         <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">50</span>px<span class="token punctuation">;</span>         <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">16</span>px<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token selector"><span class="token id">#div1</span> </span><span class="token punctuation">{</span>        <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>         <span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>         <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>         <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>         <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">16</span>px<span class="token punctuation">;</span>      <span class="token punctuation">}</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token comment" spellcheck="true">// 封装 getElementById 函数</span>    <span class="token keyword">function</span> <span class="token keyword">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 显示 div2</span>    <span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// div2.style.display='block'; // 部分浏览器不兼容</span>      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'div2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display<span class="token operator">=</span><span class="token string">'block'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 隐藏 div2</span>    <span class="token keyword">function</span> <span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// div2.style.display='none'; // 部分浏览器不兼容</span>      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'div2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// div1 变绿</span>    <span class="token keyword">function</span> <span class="token function">toGreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>background<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// div1 变蓝</span>    <span class="token keyword">function</span> <span class="token function">toblue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>background<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// div1 变红</span>    <span class="token keyword">function</span> <span class="token function">toRed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>background<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 点击循环变色</span>    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i='</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">toGreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        i<span class="token operator">++</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i='</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">toblue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        i<span class="token operator">++</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i='</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">toRed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        i <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i='</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>     <span class="token comment" spellcheck="true">&lt;!-- 调用页内函数修改样式 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>changeColor()<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>按钮<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>      <span class="token comment" spellcheck="true">&lt;!-- 行内 JS 修改样式 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">onmouseover</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div2.style.display<span class="token punctuation">=</span><span class="token punctuation">'</span>block<span class="token punctuation">'</span>;<span class="token punctuation">"</span></span> <span class="token attr-name">onmouseout</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div2.style.display<span class="token punctuation">=</span><span class="token punctuation">'</span>none<span class="token punctuation">'</span>;<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>按钮<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>文字<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>文字2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></li></ul><h3 id="网页换肤和-if-判断"><a href="#网页换肤和-if-判断" class="headerlink" title="网页换肤和 if 判断"></a>网页换肤和 if 判断</h3><ul><li><p>网页换肤</p><ul><li>土豆网 “开灯” “关灯效果”</li><li>任何标签都可以加 ID ，包括 link</li><li>任何标签的属性，都可以修改</li><li>HTML 里面怎么写，JS 里面就怎么写</li></ul></li><li><p>if 判断</p><ul><li>特效实现原理</li><li>if 基本形式</li><li>JS 里面 <code>= 赋值， == 判断</code></li><li>为 a 链接添加 JS <ul><li><code>&lt;a href=&quot;javascript:;&quot;&gt;&lt;/a&gt;</code></li></ul></li><li>className  的使用<ul><li><code>class</code> 是关键字，所以用 <code>className</code> 代替</li><li>其它 HTML 里面怎么写，JS 里面就怎么写</li></ul></li></ul></li><li><p>代码</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Content-Type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html;charset<span class="token punctuation">=</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>link1<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>css/grey.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token keyword">function</span> <span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'b1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token string">'关灯'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'link1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'css/black.css'</span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'b1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'开灯'</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'black'</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'link1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'css/grey.css'</span><span class="token punctuation">;</span>        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'b1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'关灯'</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bl2:'</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'link1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>href<span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">changeText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'text1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'456'</span><span class="token punctuation">;</span>      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'text1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'文字1'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">showHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> div2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>div2<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">==</span> <span class="token string">'block'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        div2<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        div2<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>        div2<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">'blue'</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'display:'</span><span class="token punctuation">,</span> div2<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">class1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      div<span class="token punctuation">.</span>className<span class="token operator">=</span><span class="token string">'div5'</span><span class="token punctuation">;</span>      div<span class="token punctuation">.</span>id<span class="token operator">=</span><span class="token string">'div5'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 换肤 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>b1<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>changeColor()<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>关灯<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>显示隐藏div2<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>showHide()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- HTMl 里面怎么写，JS 里面就怎么写 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text1<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>123<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>改文字<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>changeText()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- a 链接的使用 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>javascript:;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- className 的使用 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>className<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>class1()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></li></ul><h3 id="函数传参"><a href="#函数传参" class="headerlink" title="函数传参"></a>函数传参</h3><ul><li><p>改变背景颜色</p><ul><li>函数传参：参数就是占位符<ul><li>函数里面变量用传参</li></ul></li></ul></li><li><p>改变 div 的任意样式</p><ul><li>操纵属性的第二种方式<ul><li>要修改的属性不确定时：<code>元素.style[ 变量/字符串 ] = 变量/字符串</code></li><li>JS 中用 <code>.</code> 的地方都可以用 <code>[]</code> 代替;</li><li>字符串变量区别和关系 ：带引号是字符串，不带是变量</li></ul></li><li>将属性名作为参数传递</li></ul></li><li><p>style 与 className </p><ul><li><code>元素.style.属性 = 变量/字符串</code> <ul><li>style 是修改行内样式</li></ul></li><li>行内样式优先级最高，之后再修改 className 不会有效果</li><li>建议：只操作一种样式，要么只操作 style ，要么只操作 className</li></ul></li><li><p>代码：</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>函数传参<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">      <span class="token selector">div </span><span class="token punctuation">{</span>        <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>         <span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>         <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>         <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>         <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">16</span>px<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token selector"><span class="token class">.div2</span> </span><span class="token punctuation">{</span>        <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>         <span class="token property">background</span><span class="token punctuation">:</span> grey<span class="token punctuation">;</span>         <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>         <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>       <span class="token punctuation">}</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">    <span class="token comment" spellcheck="true">// 封装 getElementById 函数</span>    <span class="token keyword">function</span> <span class="token keyword">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// div1 变绿</span>    <span class="token keyword">function</span> <span class="token function">toGreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>background<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// div1 变蓝</span>    <span class="token keyword">function</span> <span class="token function">toblue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>background<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// div1 变红</span>    <span class="token keyword">function</span> <span class="token function">toRed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>background<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 点击循环变色</span>    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i='</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">toGreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        i<span class="token operator">++</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i='</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">toblue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        i<span class="token operator">++</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i='</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">toRed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        i <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i='</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 函数传参</span>    <span class="token keyword">function</span> <span class="token function">toColor</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> width<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> color<span class="token punctuation">;</span>      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> width<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 将属性名作为参数传递</span>    <span class="token keyword">function</span> <span class="token function">chgName</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> width<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">// get('div1').style.name = width; // name 会被当作属性赋值</span>      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'style'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> width<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 数组 可以加字符串或者变量</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 样式优先级</span>    <span class="token keyword">function</span> <span class="token function">chgClass</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>className <span class="token operator">=</span>  className<span class="token punctuation">;</span>     <span class="token punctuation">}</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 调用页内函数修改样式 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>changeColor()<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>循环<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 函数传参 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toColor(<span class="token punctuation">'</span>green<span class="token punctuation">'</span>, <span class="token punctuation">'</span>200px<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>变绿<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toColor(<span class="token punctuation">'</span>blue<span class="token punctuation">'</span>, <span class="token punctuation">'</span>300px<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>变蓝<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toColor(<span class="token punctuation">'</span>red<span class="token punctuation">'</span>, <span class="token punctuation">'</span>400px<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>变红<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chgName(<span class="token punctuation">'</span>height<span class="token punctuation">'</span>, <span class="token punctuation">'</span>200px<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>变高<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>chgClass(<span class="token punctuation">'</span>div2<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>class变灰<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></li></ul><h3 id="提取行间事件"><a href="#提取行间事件" class="headerlink" title="提取行间事件"></a>提取行间事件</h3><ul><li>提取事件<ul><li>为元素添加事件<ul><li>事件和其它属性一样，可以用 JS 添加：<code>元素.事件 = 函数名/函数;</code><ul><li>不能加括号，加括号直接执行函数</li></ul></li><li><code>window.onload</code> 的意义：等待页面加载完成再执行 JS</li><li>行为( js )、样式( css )、结构( html ) 三者分离</li></ul></li></ul></li><li>获取一组元素<ul><li><code>元素.getElementsByTagName(&#39;标签名&#39;)</code><ul><li>数组的使用</li><li>数组的属性</li></ul></li><li>全选的实现</li></ul></li><li>代码: 同下</li></ul><h3 id="循环-while-和-for"><a href="#循环-while-和-for" class="headerlink" title="循环 while 和 for"></a>循环 while 和 for</h3><ul><li><p>用 while 引入 循环的概念</p><ul><li>while 循环语法<ul><li>自增的意义</li><li>循环的构成：初始化、条件、语句、自增</li></ul></li></ul></li><li><p>for 循环</p><ul><li>用 for 代替 while 循环<ul><li>用 for 循环为一组元素甜腻骄傲事件</li><li>什么时候用循环—-一组元素</li></ul></li><li>例子<ul><li>全选—- checked 属性</li><li>反选—- for 循环配合 if 判断</li></ul></li></ul></li><li><p>代码:</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>提取行间事件和循环<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">      <span class="token selector">div </span><span class="token punctuation">{</span>        <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>         <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid black<span class="token punctuation">;</span>         <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>         <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>         <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span>        <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>      <span class="token punctuation">}</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">      window<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 封装 getElementById 函数</span>        <span class="token keyword">function</span> <span class="token keyword">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 封装 getElementsByTagName</span>        <span class="token keyword">function</span> <span class="token function">gets</span><span class="token punctuation">(</span>tagName<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span>tagName<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 提取行间样式</span>        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'提取成功'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 修改一组元素中的某一个元素</span>        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'btn2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">'blue'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>         <span class="token comment" spellcheck="true">// 修改一组元素- while 循环</span>        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'btn3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>          <span class="token keyword">while</span> <span class="token punctuation">(</span> i <span class="token operator">&lt;</span> <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">'yellow'</span><span class="token punctuation">;</span>            i<span class="token operator">++</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>         <span class="token comment" spellcheck="true">// for</span>        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'btn4'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">'pink'</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>         <span class="token comment" spellcheck="true">// 全选的实现 if 判断 无需div</span>        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'btn5'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'checkbox'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>checked <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>checked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>checked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>         <span class="token comment" spellcheck="true">// 元素.getElementsByTagName 方法 单个div</span>        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'btn6'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">var</span> div2 <span class="token operator">=</span> <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'div2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">var</span> inp <span class="token operator">=</span> div2<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> inp<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// console.log(inp);</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>inp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>checked <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              inp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>checked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>              inp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>checked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 元素.getElementsByTagName 方法 多个div</span>        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'btn7'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">var</span> div2 <span class="token operator">=</span> <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> div2<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">var</span> div <span class="token operator">=</span> <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">var</span> inps <span class="token operator">=</span> div<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> a <span class="token operator">&lt;</span> inps<span class="token punctuation">.</span>length<span class="token punctuation">;</span> a<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span>inps<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">.</span>checked <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                inps<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">.</span>checked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                inps<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">.</span>checked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 提取行间样式 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn1<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>按钮<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 修改一组元素中的某一个元素 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn2<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>改第三个元素<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment" spellcheck="true">&lt;!-- 修改一组元素-循环 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn3<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>while循环改一组元素<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn4<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>for循环改一组元素<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn5<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>全选<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn6<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>全选2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn7<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>全选3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></li></ul><h3 id="导航栏选项卡"><a href="#导航栏选项卡" class="headerlink" title="导航栏选项卡"></a>导航栏选项卡</h3><ul><li><p>按钮的实现</p><ul><li>添加事件<ul><li>this 的使用: 指当前发生事件的元素</li></ul></li><li>先清空所有按钮，再选中当前按钮</li></ul></li><li><p>内容的实现（ul）</p><ul><li>先隐藏所有 ul，再显示当前 ul<ul><li>索引值的使用：什么时候用索引值</li><li>HTML 添加 index 会被 FireFox 过滤</li><li>JS 添加 index</li></ul></li></ul></li><li><p>代码:</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Content-Type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html;charset<span class="token punctuation">=</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>导航选项卡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">      <span class="token selector">body </span><span class="token punctuation">{</span>        <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token selector"><span class="token id">#div2</span> </span><span class="token punctuation">{</span>        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span>        <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span>        <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>        <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token selector"><span class="token id">#div1</span> </span><span class="token punctuation">{</span>        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span>        <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>        <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">0</span>px<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token selector">ul </span><span class="token punctuation">{</span>        <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>        <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">157</span>, <span class="token number">234</span>, <span class="token number">253</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>        <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span>        <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token selector"><span class="token class">.ul</span> </span><span class="token punctuation">{</span>        <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token selector">a </span><span class="token punctuation">{</span>        <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>        <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">49</span>px<span class="token punctuation">;</span>        <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>        <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">7</span>, <span class="token number">184</span>, <span class="token number">253</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token property">border-left</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">0</span>, <span class="token number">234</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token selector"><span class="token class">.a</span> </span><span class="token punctuation">{</span>        <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">32</span>, <span class="token number">108</span>, <span class="token number">221</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">      window<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// 封装 getElementById 函数</span>        <span class="token keyword">function</span> <span class="token keyword">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 封装 getElementsByTagName</span>        <span class="token keyword">function</span> <span class="token function">gets</span><span class="token punctuation">(</span>tagName<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span>tagName<span class="token punctuation">)</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 显示第一个元素</span>        <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'ul'</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 当鼠标覆盖某个标签时 显示对应元素</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>index <span class="token operator">=</span> i<span class="token punctuation">;</span>          <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>onmouseover <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> a <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> a<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>              <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// console.log(this);</span>            <span class="token function">gets</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'ul'</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:;<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:;<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:;<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:;<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></li></ul><h2 id="JavaScript-基础-点击去Github查看完整版"><a href="#JavaScript-基础-点击去Github查看完整版" class="headerlink" title="JavaScript 基础 点击去Github查看完整版"></a><a href="https://github.com/Eished/JavaScript_notes" target="_blank" rel="noopener">JavaScript 基础 点击去Github查看完整版</a></h2>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo Front-matter 介绍</title>
      <link href="/2020/06/02/hexo-front-matter-jie-shao/"/>
      <url>/2020/06/02/hexo-front-matter-jie-shao/</url>
      
        <content type="html"><![CDATA[<h1 id="文章-Front-matter-介绍"><a href="#文章-Front-matter-介绍" class="headerlink" title="文章 Front-matter 介绍"></a>文章 Front-matter 介绍</h1><h2 id="Front-matter-选项详解"><a href="#Front-matter-选项详解" class="headerlink" title="Front-matter 选项详解"></a>Front-matter 选项详解</h2><p><code>Front-matter</code> 选项中的所有内容均为<strong>非必填</strong>的。但我仍然建议至少填写 <code>title</code> 和 <code>date</code> 的值。</p><table><thead><tr><th>配置选项</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>title</td><td><code>Markdown</code> 的文件标题</td><td>文章标题，强烈建议填写此选项</td></tr><tr><td>date</td><td>文件创建时的日期时间</td><td>发布时间，强烈建议填写此选项，且最好保证全局唯一</td></tr><tr><td>author</td><td>根 <code>_config.yml</code> 中的 <code>author</code></td><td>文章作者</td></tr><tr><td>img</td><td><code>featureImages</code> 中的某个值</td><td>文章特征图，推荐使用图床(腾讯云、七牛云、又拍云等)来做图片的路径.如: <code>http://xxx.com/xxx.jpg</code></td></tr><tr><td>top</td><td><code>true</code></td><td>推荐文章（文章是否置顶），如果 <code>top</code> 值为 <code>true</code>，则会作为首页推荐文章</td></tr><tr><td>cover</td><td><code>false</code></td><td><code>v1.0.2</code>版本新增，表示该文章是否需要加入到首页轮播封面中</td></tr><tr><td>coverImg</td><td>无</td><td><code>v1.0.2</code>版本新增，表示该文章在首页轮播封面需要显示的图片路径，如果没有，则默认使用文章的特色图片</td></tr><tr><td>password</td><td>无</td><td>文章阅读密码，如果要对文章设置阅读验证密码的话，就可以设置 <code>password</code> 的值，该值必须是用 <code>SHA256</code> 加密后的密码，防止被他人识破。前提是在主题的 <code>config.yml</code> 中激活了 <code>verifyPassword</code> 选项</td></tr><tr><td>toc</td><td><code>true</code></td><td>是否开启 TOC，可以针对某篇文章单独关闭 TOC 的功能。前提是在主题的 <code>config.yml</code> 中激活了 <code>toc</code> 选项</td></tr><tr><td>mathjax</td><td><code>false</code></td><td>是否开启数学公式支持 ，本文章是否开启 <code>mathjax</code>，且需要在主题的 <code>_config.yml</code> 文件中也需要开启才行</td></tr><tr><td>summary</td><td>无</td><td>文章摘要，自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要</td></tr><tr><td>categories</td><td>无</td><td>文章分类，本主题的分类表示宏观上大的分类，只建议一篇文章一个分类</td></tr><tr><td>tags</td><td>无</td><td>文章标签，一篇文章可以多个标签</td></tr><tr><td>keywords</td><td>文章标题</td><td>文章关键字，SEO 时需要</td></tr><tr><td>reprintPolicy</td><td>cc_by</td><td>文章转载规则， 可以是 cc_by, cc_by_nd, cc_by_sa, cc_by_nc, cc_by_nc_nd, cc_by_nc_sa, cc0, noreprint 或 pay 中的一个</td></tr></tbody></table><blockquote><p><strong>注意</strong>:</p><ol><li>如果 <code>img</code> 属性不填写的话，文章特色图会根据文章标题的 <code>hashcode</code> 的值取余，然后选取主题中对应的特色图片，从而达到让所有文章都的特色图<strong>各有特色</strong>。</li><li><code>date</code> 的值尽量保证每篇文章是唯一的，因为本主题中 <code>Gitalk</code> 和 <code>Gitment</code> 识别 <code>id</code> 是通过 <code>date</code> 的值来作为唯一标识的。</li><li>如果要对文章设置阅读验证密码的功能，不仅要在 Front-matter 中设置采用了 SHA256 加密的 password 的值，还需要在主题的 <code>_config.yml</code> 中激活了配置。有些在线的 SHA256 加密的地址，可供你使用：<a href="http://tool.oschina.net/encrypt?type=2" target="_blank" rel="noopener">开源中国在线工具</a>、<a href="http://encode.chahuo.com/" target="_blank" rel="noopener">chahuo</a>、<a href="http://tool.chinaz.com/tools/hash.aspx" target="_blank" rel="noopener">站长工具</a>。</li><li>您可以在文章md文件的 front-matter 中指定 reprintPolicy 来给单个文章配置转载规则</li></ol></blockquote><p>以下为文章的 <code>Front-matter</code> 示例。</p><h2 id="最简示例"><a href="#最简示例" class="headerlink" title="最简示例"></a>最简示例</h2><pre><code>---title: typora-vue-theme主题介绍date: 2018-09-07 09:25:00---</code></pre><h2 id="最全示例"><a href="#最全示例" class="headerlink" title="最全示例"></a>最全示例</h2><pre><code>---title: typora-vue-theme主题介绍date: 2018-09-07 09:25:00author: 赵奇img: /source/images/xxx.jpgtop: truecover: truecoverImg: /images/1.jpgpassword: 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92toc: falsemathjax: falsesummary: 这是你自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要categories: Markdowntags:  - Typora  - Markdown---</code></pre><h1 id="Hexo-指令"><a href="#Hexo-指令" class="headerlink" title="Hexo 指令"></a>Hexo 指令</h1><iframe src="https://www.youtube.com/embed/mgdXi5npArQ" frameborder="0" loading="lazy" allowfullscreen="" style="box-sizing: inherit; margin: 1em 0px; padding: 0px; border: 0px; outline: 0px; font-weight: inherit; font-style: inherit; font-family: inherit; font-size: 15px; vertical-align: baseline;"></iframe><h2 id="init"><a href="#init" class="headerlink" title="init"></a>init</h2><pre><code>$ hexo init [folder]</code></pre><p>新建一个网站。如果没有设置 <code>folder</code> ，Hexo 默认在目前的文件夹建立网站。</p><h2 id="new"><a href="#new" class="headerlink" title="new"></a>new</h2><pre><code>$ hexo new [layout] &lt;title&gt;</code></pre><p>新建一篇文章。如果没有设置 <code>layout</code> 的话，默认使用 <a href="https://hexo.io/zh-cn/docs/configuration" target="_blank" rel="noopener">_config.yml</a> 中的 <code>default_layout</code> 参数代替。如果标题包含空格的话，请使用引号括起来。</p><pre><code>$ hexo new &quot;post title with whitespace&quot;</code></pre><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>-p</code>, <code>--path</code></td><td align="left">自定义新文章的路径</td></tr><tr><td align="left"><code>-r</code>, <code>--replace</code></td><td align="left">如果存在同名文章，将其替换</td></tr><tr><td align="left"><code>-s</code>, <code>--slug</code></td><td align="left">文章的 Slug，作为新文章的文件名和发布后的 URL</td></tr></tbody></table><p>默认情况下，Hexo 会使用文章的标题来决定文章文件的路径。对于独立页面来说，Hexo 会创建一个以标题为名字的目录，并在目录中放置一个 <code>index.md</code> 文件。你可以使用 <code>--path</code> 参数来覆盖上述行为、自行决定文件的目录：</p><pre><code>hexo new page --path about/me &quot;About me&quot;</code></pre><p>以上命令会创建一个 <code>source/about/me.md</code> 文件，同时 Front Matter 中的 title 为 <code>&quot;About me&quot;</code></p><p>注意！title 是必须指定的！如果你这么做并不能达到你的目的：</p><pre><code>hexo new page --path about/me</code></pre><p>此时 Hexo 会创建 <code>source/_posts/about/me.md</code>，同时 <code>me.md</code> 的 Front Matter 中的 title 为 <code>&quot;page&quot;</code>。这是因为在上述命令中，hexo-cli 将 <code>page</code> 视为指定文章的标题、并采用默认的 <code>layout</code>。</p><h2 id="generate"><a href="#generate" class="headerlink" title="generate"></a>generate</h2><pre><code>$ hexo generate</code></pre><p>生成静态文件。</p><table><thead><tr><th align="left">选项</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>-d</code>, <code>--deploy</code></td><td align="left">文件生成后立即部署网站</td></tr><tr><td align="left"><code>-w</code>, <code>--watch</code></td><td align="left">监视文件变动</td></tr><tr><td align="left"><code>-b</code>, <code>--bail</code></td><td align="left">生成过程中如果发生任何未处理的异常则抛出异常</td></tr><tr><td align="left"><code>-f</code>, <code>--force</code></td><td align="left">强制重新生成文件 Hexo 引入了差分机制，如果 <code>public</code> 目录存在，那么 <code>hexo g</code> 只会重新生成改动的文件。 使用该参数的效果接近 <code>hexo clean &amp;&amp; hexo generate</code></td></tr><tr><td align="left"><code>-c</code>, <code>--concurrency</code></td><td align="left">最大同时生成文件的数量，默认无限制</td></tr></tbody></table><p>该命令可以简写为</p><pre><code>$ hexo g</code></pre><h2 id="publish"><a href="#publish" class="headerlink" title="publish"></a>publish</h2><pre><code>$ hexo publish [layout] &lt;filename&gt;</code></pre><p>发表草稿。</p><h2 id="server"><a href="#server" class="headerlink" title="server"></a>server</h2><pre><code>$ hexo server</code></pre><p>启动服务器。默认情况下，访问网址为： <code>http://localhost:4000/</code>。</p><table><thead><tr><th align="left">选项</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>-p</code>, <code>--port</code></td><td align="left">重设端口</td></tr><tr><td align="left"><code>-s</code>, <code>--static</code></td><td align="left">只使用静态文件</td></tr><tr><td align="left"><code>-l</code>, <code>--log</code></td><td align="left">启动日记记录，使用覆盖记录格式</td></tr></tbody></table><h2 id="deploy"><a href="#deploy" class="headerlink" title="deploy"></a>deploy</h2><pre><code>$ hexo deploy</code></pre><p>部署网站。</p><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>-g</code>, <code>--generate</code></td><td align="left">部署之前预先生成静态文件</td></tr></tbody></table><p>该命令可以简写为：</p><pre><code>$ hexo d</code></pre><h2 id="render"><a href="#render" class="headerlink" title="render"></a>render</h2><pre><code>$ hexo render &lt;file1&gt; [file2] ...</code></pre><p>渲染文件。</p><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>-o</code>, <code>--output</code></td><td align="left">设置输出路径</td></tr></tbody></table><h2 id="migrate"><a href="#migrate" class="headerlink" title="migrate"></a>migrate</h2><pre><code>$ hexo migrate &lt;type&gt;</code></pre><p>从其他博客系统 <a href="https://hexo.io/zh-cn/docs/migration" target="_blank" rel="noopener">迁移内容</a>。</p><h2 id="clean"><a href="#clean" class="headerlink" title="clean"></a>clean</h2><pre><code>$ hexo clean</code></pre><p>清除缓存文件 (<code>db.json</code>) 和已生成的静态文件 (<code>public</code>)。</p><p>在某些情况（尤其是更换主题后），如果发现您对站点的更改无论如何也不生效，您可能需要运行该命令。</p><h2 id="list"><a href="#list" class="headerlink" title="list"></a>list</h2><pre><code>$ hexo list &lt;type&gt;</code></pre><p>列出网站资料。</p><h2 id="version"><a href="#version" class="headerlink" title="version"></a>version</h2><pre><code>$ hexo version</code></pre><p>显示 Hexo 版本。</p><h2 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h2><h3 id="安全模式"><a href="#安全模式" class="headerlink" title="安全模式"></a>安全模式</h3><pre><code>$ hexo --safe</code></pre><p>在安全模式下，不会载入插件和脚本。当您在安装新插件遭遇问题时，可以尝试以安全模式重新执行。</p><h3 id="调试模式"><a href="#调试模式" class="headerlink" title="调试模式"></a>调试模式</h3><pre><code>$ hexo --debug</code></pre><p>在终端中显示调试信息并记录到 <code>debug.log</code>。当您碰到问题时，可以尝试用调试模式重新执行一次，并 <a href="https://github.com/hexojs/hexo/issues/new" target="_blank" rel="noopener">提交调试信息到 GitHub</a>。</p><h3 id="简洁模式"><a href="#简洁模式" class="headerlink" title="简洁模式"></a>简洁模式</h3><pre><code>$ hexo --silent</code></pre><p>隐藏终端信息。</p><h3 id="自定义配置文件的路径"><a href="#自定义配置文件的路径" class="headerlink" title="自定义配置文件的路径"></a>自定义配置文件的路径</h3><pre><code># 使用 custom.yml 代替默认的 _config.yml$ hexo server --config custom.yml# 使用 custom.yml 和 custom2.json，其中 custom2.json 优先级更高$ hexo generate --config custom.yml,custom2.json,custom3.yml</code></pre><p>自定义配置文件的路径，指定这个参数后将不再使用默认的 <code>_config.yml</code>。<br>你可以使用一个 YAML 或 JSON 文件的路径，也可以使用逗号分隔（无空格）的多个 YAML 或 JSON 文件的路径。例如：</p><pre><code># 使用 custom.yml 代替默认的 _config.yml$ hexo server --config custom.yml# 使用 custom.yml, custom2.json 和 custom3.yml，其中 custom3.yml 优先级最高，其次是 custom2.json$ hexo generate --config custom.yml,custom2.json,custom3.yml</code></pre><p>当你指定了多个配置文件以后，Hexo 会按顺序将这部分配置文件合并成一个 <code>_multiconfig.yml</code>。如果遇到重复的配置，排在后面的文件的配置会覆盖排在前面的文件的配置。这个原则适用于任意数量、任意深度的 YAML 和 JSON 文件。</p><h3 id="显示草稿"><a href="#显示草稿" class="headerlink" title="显示草稿"></a>显示草稿</h3><pre><code>$ hexo --draft</code></pre><p>显示 <code>source/_drafts</code> 文件夹中的草稿文章。</p><h3 id="自定义-CWD"><a href="#自定义-CWD" class="headerlink" title="自定义 CWD"></a>自定义 CWD</h3><pre><code>$ hexo --cwd /path/to/cwd</code></pre><p>自定义当前工作目录（Current working directory）的路径。</p>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Typora </tag>
            
            <tag> Markdown </tag>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git和GitHub详解</title>
      <link href="/2020/06/02/git-he-github-xiang-jie/"/>
      <url>/2020/06/02/git-he-github-xiang-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="Git和GitHub详解"><a href="#Git和GitHub详解" class="headerlink" title="Git和GitHub详解"></a><a href="https://github.com/Eished/git_notes" target="_blank" rel="noopener">Git和GitHub详解</a></h1><h2 id="（一）Git基础"><a href="#（一）Git基础" class="headerlink" title="（一）Git基础"></a>（一）Git基础</h2><h3 id="Git-下载和安装"><a href="#Git-下载和安装" class="headerlink" title="Git 下载和安装"></a>Git 下载和安装</h3><ul><li>下载地址： <a href="https://git-scm.com/downloads" target="_blank" rel="noopener">https://git-scm.com/downloads</a></li><li>使用默认值安装</li><li>资源管理器内单击鼠标右键选择 <code>Git Bash Here</code></li><li>输入<code>git --version</code> 检查是否安装成功</li></ul><h3 id="Git-基本工作流程"><a href="#Git-基本工作流程" class="headerlink" title="Git 基本工作流程"></a>Git 基本工作流程</h3><blockquote><p><a href="https://camo.githubusercontent.com/b3a8463c493afefb96ed483106ceea6966782b27/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f342f32352f313632666363303938376266316330613f696d61676556696577322f302f772f313238302f682f3936302f666f726d61742f776562702f69676e6f72652d6572726f722f31" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/b3a8463c493afefb96ed483106ceea6966782b27/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f342f32352f313632666363303938376266316330613f696d61676556696577322f302f772f313238302f682f3936302f666f726d61742f776562702f69676e6f72652d6572726f722f31" alt="git操作通用流程"></a></p><p>主要涉及到四个关键点：</p><ol><li>工作区：本地电脑存放项目文件的地方，比如learnGitProject文件夹；</li><li>暂存区（Index/Stage）：在使用git管理项目文件的时候，其本地的项目文件会多出一个.git的文件夹，将这个.git文件夹称之为版本库。其中.git文件夹中包含了两个部分，一个是暂存区（Index或者Stage）,顾名思义就是暂时存放文件的地方，通常使用add命令将工作区的文件添加到暂存区里；</li><li>本地仓库：.git文件夹里还包括git自动创建的master分支，并且将HEAD指针指向master分支。使用commit命令可以将暂存区中的文件添加到本地仓库中；</li><li>远程仓库：不是在本地仓库中，项目代码在远程git服务器上，比如项目放在github上，就是一个远程仓库，通常使用clone命令将远程仓库拷贝到本地仓库中，开发后推送到远程仓库中即可；</li></ol><p>更细节的来看：</p><p><a href="https://camo.githubusercontent.com/9d199e09df4405718621937e8798cba7cf1964fb/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f342f32352f313632666363306537653731316463373f696d61676556696577322f302f772f313238302f682f3936302f666f726d61742f776562702f69676e6f72652d6572726f722f31" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/9d199e09df4405718621937e8798cba7cf1964fb/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f342f32352f313632666363306537653731316463373f696d61676556696577322f302f772f313238302f682f3936302f666f726d61742f776562702f69676e6f72652d6572726f722f31" alt="git几个核心区域间的关系"></a></p><p>日常开发时代码实际上放置在工作区中，也就是本地的XXX.java这些文件，通过add等这些命令将代码文教提交给暂存区（Index/Stage），也就意味着代码全权交给了git进行管理，之后通过commit等命令将暂存区提交给master分支上，也就是意味打了一个版本，也可以说代码提交到了本地仓库中。另外，团队协作过程中自然而然还涉及到与远程仓库的交互。</p><p>因此，经过这样的分析，git命令可以分为这样的逻辑进行理解和记忆：</p><ol><li><p>git管理配置的命令；</p><p><strong>几个核心存储区的交互命令：</strong></p></li><li><p>工作区与暂存区的交互；</p></li><li><p>暂存区与本地仓库（分支）上的交互；</p></li><li><p>本地仓库与远程仓库的交互。</p></li></ol><p>作者：你听___ 链接：<a href="https://juejin.im/post/5ae072906fb9a07a9e4ce596" target="_blank" rel="noopener">https://juejin.im/post/5ae072906fb9a07a9e4ce596</a> 来源：掘金 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote><table><thead><tr><th>工作目录</th><th>暂存区</th><th>git 仓库</th><th>远程仓库</th></tr></thead><tbody><tr><td>被Git管理的项目</td><td>临时存放被修改的文件</td><td>目录用于存放提交记录</td><td>远程代码仓库</td></tr><tr><td><code>git init</code></td><td><code>git add</code></td><td><code>git commit</code></td><td><code>git push</code></td></tr></tbody></table><h3 id="Git使用前的配置命令"><a href="#Git使用前的配置命令" class="headerlink" title="Git使用前的配置命令"></a>Git使用前的配置命令</h3><p>在使用前告诉git你是谁：</p><ol><li><p>第一次使用git，配置用户信息</p><ol><li>配置用户名：<code>git config --global user.name &quot;your name&quot;</code>;</li><li>配置用户邮箱：<code>git config --global user.email &quot;youremail@github.com&quot;</code>;</li></ol></li><li><blockquote><p>查询配置信息</p></blockquote><ol><li>列出当前配置：<code>git config --list</code>;</li><li>列出repository配置：<code>git config --local --list</code>;</li><li>列出全局配置：<code>git config --global --list</code>;</li><li>列出系统配置：<code>git config --system --list</code>;</li></ol></li><li><blockquote><p>其他配置</p></blockquote><ol><li>配置解决冲突时使用哪种差异分析工具，比如要使用vimdiff：<code>git config --global merge.tool vimdiff</code>;</li><li>配置git命令输出为彩色的：<code>git config --global color.ui auto</code>;</li><li>配置git使用的文本编辑器：<code>git config --global core.editor vi</code>;</li></ol></li><li><blockquote><p>注：</p></blockquote><ol><li>更改–&gt;重复上述命令</li><li>也可直接修改 <code>C:\Users\用户\.gitconfig</code></li></ol></li></ol><h3 id="工作区上的操作命令"><a href="#工作区上的操作命令" class="headerlink" title="工作区上的操作命令"></a>工作区上的操作命令</h3><h4 id="提交步骤"><a href="#提交步骤" class="headerlink" title="提交步骤"></a>提交步骤</h4><ol><li><p><code>git init</code> 初始化git仓库</p><blockquote><blockquote><p>新建仓库</p></blockquote><ol><li>将工作区中的项目文件使用git进行管理，即创建一个新的本地仓库：<code>git init</code>；</li><li>从远程git仓库复制项目：<code>git clone</code>; 克隆项目时如果想定义新的项目名，可以在clone命令后指定新的项目名：<code>git clone git://github.com/wasd/example.git NewName</code>；</li></ol></blockquote></li><li><p><code>git status</code> 查看文件状态</p><blockquote><blockquote><p>查新信息</p></blockquote><ol><li>查询当前工作区所有文件的状态：<code>git status</code>;</li><li>比较工作区中当前文件和暂存区之间的差异，也就是修改之后还没有暂存的内容：git diff；指定文件在工作区和暂存区上差异比较：<code>git diff</code>;</li></ol></blockquote></li><li><p><code>git add 文件/文件列表</code> 提交到暂存区</p><blockquote><blockquote><p>提交</p></blockquote><ol><li>提交工作区所有文件到暂存区：<code>git add .</code></li><li>提交工作区中指定文件到暂存区：<code>git add ...</code>;</li><li>提交工作区中某个文件夹中所有文件到暂存区：<code>git add [dir]</code>;</li></ol></blockquote></li><li><p><code>git commit -m 提交信息</code> 向仓库提交代码</p><blockquote><blockquote><p>提交文件到版本库</p></blockquote><ol><li>将暂存区中的文件提交到本地仓库中，即打上新版本：<code>git commit -m &quot;commit_info&quot;</code>;</li><li>将所有已经使用git管理过的文件暂存后一并提交，跳过add到暂存区的过程：<code>git commit -a -m &quot;commit_info&quot;</code>;</li><li>提交文件时，发现漏掉几个文件，或者注释写错了，可以撤销上一次提交：<code>git commit --amend</code>;</li></ol></blockquote></li><li><p><code>git log</code> 查看提交记录</p><blockquote><blockquote><p>查看信息</p></blockquote><ol><li>比较暂存区与上一版本的差异：<code>git diff --cached</code>;</li><li>指定文件在暂存区和本地仓库的不同：<code>git diff --cached</code>;</li><li>查看提交历史：git log；参数<code>-p</code>展开每次提交的内容差异，用<code>-2</code>显示最近的两次更新，如<code>git log -p -2</code>;</li></ol></blockquote></li></ol><h4 id="撤销"><a href="#撤销" class="headerlink" title="撤销"></a>撤销</h4><ul><li><p>用暂存区中的文件覆盖工作目录中的文件：<code>git checkout -- 文件名</code> 不加 <code>-- 文件名</code>则覆盖全部文件</p></li><li><p>将文件从暂存区中删除：<code>git rm --cached 文件名</code></p></li><li><p>将git仓库中指定的更新记录恢复出来，并且覆盖暂存区和工作目录：<code>git reset --hard commitID</code></p></li><li><blockquote><blockquote><p>撤销</p></blockquote><ol><li>删除工作区文件，并且也从暂存区删除对应文件的记录：<code>git rm</code>;</li><li>从暂存区中删除文件，但是工作区依然还有该文件:<code>git rm --cached</code>;</li><li>取消暂存区已经暂存的文件：<code>git reset HEAD ...</code>;</li><li>撤销上一次对文件的操作：<code>git checkout --</code>。要确定上一次对文件的修改不再需要，如果想保留上一次的修改以备以后继续工作，可以使用stashing和分支来处理；</li><li>隐藏当前变更，以便能够切换分支：<code>git stash</code>；</li><li>查看当前所有的储藏：<code>git stash list</code>；</li><li>应用最新的储藏：<code>git stash apply</code>，如果想应用更早的储藏：<code>git stash apply stash@{2}</code>；重新应用被暂存的变更，需要加上<code>--index</code>参数：<code>git stash apply --index</code>;</li><li>使用apply命令只是应用储藏，而内容仍然还在栈上，需要移除指定的储藏：<code>git stash drop stash{0}</code>；如果使用pop命令不仅可以重新应用储藏，还可以立刻从堆栈中清除：<code>git stash pop</code>;</li><li>在某些情况下，你可能想应用储藏的修改，在进行了一些其他的修改后，又要取消之前所应用储藏的修改。Git没有提供类似于 stash unapply 的命令，但是可以通过取消该储藏的补丁达到同样的效果：<code>git stash show -p stash@{0} | git apply -R</code>；同样的，如果你沒有指定具体的某个储藏，Git 会选择最近的储藏：<code>git stash show -p | git apply -R</code>；</li></ol><blockquote><p>更新文件</p></blockquote><ol><li>重命名文件，并将已改名文件提交到暂存区：<code>git mv [file-original] [file-renamed]</code>;</li></ol></blockquote></li></ul><h2 id="点击去GitHub查看完整版"><a href="#点击去GitHub查看完整版" class="headerlink" title="点击去GitHub查看完整版"></a><a href="https://github.com/Eished/git_notes" target="_blank" rel="noopener">点击去GitHub查看完整版</a></h2>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> Github </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
